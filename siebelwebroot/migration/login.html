<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>Siebel Migration Application</title>
    <link rel="icon" href="../images/favicon.ico" type="image/vnd.microsoft.icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="description" content="Oracle Siebel Cloud">
    <meta name="keywords" content="Oracle, Siebel">
    <meta content="telephone=no" name="format-detection">

    <script type='text/javascript' src='../scripts/3rdParty/jquery.js'></script>
    <script src="../scripts/3rdParty/jquery-ui/current/ui/minified/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css"
        href="../scripts/3rdParty/jquery-ui/current/themes/base/minified/jquery-ui.min.css">
    <script type='text/javascript' src='../scripts/3rdParty/knockout.js'></script>
    <link rel="stylesheet" type="text/css" href="../files/dev2prod.css" />
    <script>
        // If SSO is enabled, we don't want to display login.html, instead after SSO authentication, display
        // index.html page directly.
        var loginURL = document.URL.replace(/#.*$/, "");
        var baseUrl = loginURL.replace("login.html", "");
        baseUrl = baseUrl.replace("migration", "sma");
        $.ajax({
            url: baseUrl + 'isSingleSignOn',
            type: 'GET',
            crossDomain: true,
            headers: {
                'Content-Type': 'application/json'
            },
            async: false,
                success: function (response) {
                    $("#maskoverlay").addClass("hide");
                    response = JSON.parse(response);
                    if (response && response["status"]) {
                        if (response["status"] == "error") {
                            if (response.msg && response.msg != "") {
                                alert(response.msg);
                            } else {
                                alert("Could not Authenticate user");
                            }
                            if (localStorage.rememberUser && localStorage.rememberUser == "false") {
                                localStorage.username = "";
                            }
                            var redirectUrl = "";
                            if (response.ssoLogOffURL && response.ssoLogOffURL != "") {
                                redirectUrl = response.ssoLogOffURL;
                                if (response.returnURLQueryParam && response.returnURLQueryParam != "") {
                                    redirectUrl += "?" + response.returnURLQueryParam + "=" + baseUrl;
                                }
                                window.location = redirectUrl;
                            }
                        } else {
                            if (response["isSSO"] == "true") {
                                localStorage.setItem("username", response["username"]);
                                sessionStorage.setItem("SRN", response["SRN"]);
                                sessionStorage.setItem("repoUpgraded", response["repoUpgraded"]);
                                sessionStorage.setItem("dbType", response["dbType"]);
                                location.href = "./index.html";
                            }
                        }
                    } else {
                        alert("Server you are trying to access is either busy or experiencing difficulties. Try after some time");
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $("#maskoverlay").addClass("hide");
                    response = JSON.parse(response);
                    if (response.msg && response.msg != "") {
                        alert(response.msg);
                    } else {
                        alert("Server you are trying to access is either busy or experiencing difficulties. Try after some time");
                    }
                    if (response.ssoLogOffURL && response.ssoLogOffURL != "") {
                        redirectUrl = response.ssoLogOffURL;
                        if (response.returnURLQueryParam && response.returnURLQueryParam != "") {
                            redirectUrl += "?" + response.returnURLQueryParam + "=" + baseUrl;
                        }
                        window.location = redirectUrl;
                    }
                }
        });
    </script>
</head>
<body class="siebui-login-body">
    <div id="maskoverlay" class="siebui-mask-overlay">
        <div id="mask-img" class="siebui-mask-outer">
            <div class="siebui-mask-inner"></div>
        </div>
    </div>
    <form name="MigrationLogin">
        <div class="siebui-login-container">
            <div id='template-login'>
                <div id="loginLogo" class="siebui-login-logo"></div>
                <div id="formContent" class="siebui-login-form">
                    <div class="siebui-fieldset">
                        <label class="siebui-ctrl-label" data-res="INTL_LOGIN_USER_ID">User ID</label>
                        <span class="siebui-ctrl-input">
                            <input type="text" name="MigrationUserName" value="" tabindex="1" size="10" maxlength="100"
                                autocapitalize="off" autocorrect="off" title="User ID" class="siebui-d2p-validate-input" id="loginUserName"
                                data-bind="textInput: username" onblur="validateInput(this.value, 'User Name','window', this.id)">
                        </span>
                    </div>
                    <div class="siebui-fieldset">
                        <label class="siebui-ctrl-label" data-res="INTL_LOGIN_PWD">Password</label>
                        <span class="siebui-ctrl-password">
                            <input type="password" name="MigartionPassword" autocomplete="off" tabindex="2" size="10"
                                maxlength="100" title="Password" data-bind="textInput: password">
                        </span>
                    </div>

                    <div class="siebui-fieldset">
                        <label class="siebui-ctrl-label" data-res="INTL_LOGIN_LANGUAGE">Language</label>
                        <span class="siebui-ctrl-input">
                            <select id="lang" tabindex="3" data-bind="options: languageOptions,value: language, optionsText: 'name', optionsValue: 'value'"></select>
                        </span>
                    </div>
                    <div class="siebui-fieldset">
                        <input type="checkbox" name="MigrationRememberUser" style="width: 13px" title="Remember my User ID"
                            tabindex="4"
                            data-bind="checked: rememberUser">
                        <label class="siebui-ctrl-label" data-res="INTL_LOGIN_REMEMBER_USER">Remember my User ID</label>
                    </div>

                    <div class="siebui-login-btn">
                        <a href="JavaScript:void(0)" id="login" data-bind="click: events.login" tabindex="5"
                            data-res="INTL_LOGIN_BTN_LOGIN_TEXT">Login</a>
                    </div>

                    <div class="siebui-login-title" data-res="INTL_APP_TITTLE">Siebel Migration</div>
                </div>
                <div id="statusBar" class="siebui-error">
                    <br>
                    <br>
                </div>
            </div>
        </div>
    </form>

    <script>
        //remove any Hash Tags
        var loginURL = document.URL.replace(/#.*$/, "");
        var baseUrl = loginURL.replace("login.html", "");
        baseUrl = baseUrl.replace("migration", "sma");
        $(document).ready(function () {
            parent.document.onkeydown = function (e) {
                e = e || parent.e;
                var keyCode = e.keyCode;
                if (e.which == 13) {
                    $("#login").trigger("click");
                    e.preventDefault();
                }
            };

            //For auto focus
            if (loginViewModel.rememberUser()) {
                document.MigrationLogin.MigartionPassword.focus();
            } else {
                document.MigrationLogin.MigrationUserName.focus();
            }
        });
    </script>
    <script src="scripts/login.js"></script>
</body>
</html>
