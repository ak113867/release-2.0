/*<ORACLECOPYRIGHT>
* Copyright (C) 2008-2024
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
/* 24.2.0.0SIA[2024_02] */
typeof SiebelApp.PharmaCallValidatorsvc=="undefined"&&(SiebelJS.Namespace("SiebelApp.PharmaCallValidatorsvc"),define("siebel/offline/PharmaCallValidatorsvc",["siebel/offline/model","siebel/offline/servicemodel"],function(){var e=0,t=0,n=!1,r=!1,i=[],s={},o={},u=!0,a=!0,f="",l=!0,c=[],h=1,p=6,d=1,v=2,m=4,g=[],y,b,w,E,S=SiebelApp.Offlineconstants,x={};return x[S.get("DOUIREG_OBJ_NAME")]="LS Pharma Validation Service",x[S.get("DOUIREG_SRVC_NAME")]="PharmaCallValidatorsvc",SiebelApp.S_App.Model.ServiceRegistry(x),SiebelApp.PharmaCallValidatorsvc=function(){function S(){SiebelApp.PharmaCallValidatorsvc.superclass.constructor.call(this)}function x(e){var t={err:!1},n,r=function(){e.DeleteRecord(),t={err:!1},e.GetWS().length>0&&r.call(this)};return e.CheckActiveRow()===!0&&r.call(this),t}function T(e){var t;for(var n=0;n<g.length;n++)g[n].GetName().trim()===e&&(t=g[n]);return t}function N(e){var t={err:!1},n;return t=k(e,"Attendee Call"),n=t,t={err:!1,retVal:n.retVal},t}function C(e){var t={err:!1},n;return t=k(e,"Account Call"),n=t,t={err:!1,retVal:n.retVal},t}function k(e,t){var n={err:!1},r,i="",s="";if(!c.IsEmpty(e)){n=i=e.FieldValue("Category"),r=n,n={err:!1},i=r.retVal,s=SiebelApp.S_App.Model.GetLovValName(t,"TODO_TYPE");var o=!1;i===s&&(o=!0),n={err:!1,retVal:o}}return n}function L(e){var t=!1;if(!c.IsEmpty(e)){var n=e.split(",");n[1].valueOf()&f&&(t=!0)}return t}function A(e,t){var n={};if(t){var r=e.split(",");n.RuleName=r[0],n.EventToCheck=r[1],n.MethodName=r[2],n.ErrMsgType=r[3],n.RuleType=r[4],o=n}else n.RuleName="",n.EventToCheck="",n.MethodName="",n.ErrMsgType="",n.RuleType="",o=n}function O(){return o}function M(e){var t={err:!1},n;SiebelJS.Log("Invoked InitValidationMsg Method");var r,i;return s={},s.RuleName=o.RuleName,s.ObjectType=e,e==="CONTACT"?(r=T("Pharma Professional Call - Mobile"),t=r.FieldValue("Contact Id"),n=t,t={err:!1},i=n.retVal,s.ObjectId=i):e==="PHARMA CALL"?(r=T("Pharma Professional Call - Mobile"),t=r.FieldValue("Id"),n=t,t={err:!1},i=n.retVal,s.ObjectId=i):e==="EMPLOYEE"&&(r=T("Employee")),t}function _(n,r,a,f){SiebelJS.Log("Invoked LogValidationMsg Method"),c.IsEmpty(r)&&(r=""),c.IsEmpty(a)&&(a="");if(u===!1)return;var l="",h={},p=SiebelApp.S_App.OfflineLocaleObject,d=p.GetLocalString(n);if(!c.IsEmpty(d)){var v=SiebelApp.S_App.Model.GetLovNameVal(s.RuleName,"LS_VALIDATION_RULE_NAME");l=v+" : "+d}n==="SSAPhmaValidationRuleIgnored"?(SiebelJS.Log("LogValidationMsg  Rule Ignored "),s.ErrMsgType="IGNORE",l=s.RuleName+" : Rule Ignored"):n==="SSAPhmaValidationRulePassed"?(SiebelJS.Log("LogValidationMsg Success"),s.ErrMsgType="SUCCESS",l=s.RuleName+" : Rule Passed"):(SiebelJS.Log("LogValidationMsg Failed"),f?s.ErrMsgType=f.trim():s.ErrMsgType=o.ErrMsgType.trim(),s.ErrMsgType==="ERROR"?e++:s.ErrMsgType==="WARNING"&&t++),c.IsEmpty(r)||(l=l.replace(/%1/g,r)),c.IsEmpty(a)||(l=l.replace(/%2/g,a)),s.Message=l,h=s,(s.ErrMsgType==="ERROR"||s.ErrMsgType==="WARNING")&&i.push(h)}function D(){var e={err:!1},t;e=M("PHARMA CALL");var n="",r="",i=P("Pharma Call Products Detailed"),s=T("Pharma Professional Call - Mobile");return e=s.FieldValue("Type"),t=e,e={err:!1},n=t.retVal,r=SiebelApp.S_App.Model.GetLovValName(n,"TODO_TYPE"),i||r.indexOf("Sample Drop")!==-1?_("SSAPhmaValidationRulePassed"):_("SSAPhmaErrDetailProd")}function P(e){var t=!1,n=T(e);return n.CheckActiveRow()===!0&&(t=!0),t}function H(){var e={err:!1},t;e=M("PHARMA CALL");var n=T("Pharma Professional Call - Mobile");if(!c.IsEmpty(n)){e=n.FieldValue("Start Date"),t=e,e={err:!1};var r=t.retVal;if((new Date(r)).getTime()>(new Date).getTime())return _("SSAPhmaErrNoSignAfterToday")}return e}function B(){var e={err:!1},t,n="";e=M("EMPLOYEE");var r=T("Pharma Professional Call - Mobile");return e=r.FieldValue("Primary Owner Id"),t=e,e={err:!1},n=t.retVal,n!==SiebelApp.S_App.Model.GetLoginId()?_("SSAPhmaErrNoSignUnlessOwn"):_("SSAPhmaValidationRulePassed")}function j(){var e={err:!1},t,n=1,r={},i=!1;e=M("PHARMA CALL");var s=T("Pharma Call Products Detailed"),o=function(){e=s.FieldValue("Priority"),t=e,e={err:!1};var u=t.retVal,a=parseInt(u,10);if(c.IsEmpty(u)||a===0||r[a]){_("IDS_LS_TARGET_PRIORITY_VALIDATION_FAILED"),i=!0;return}r[a]=a,e=s.NextRecord(),t=e,e={err:!1};var f=t.err;f||(n++,o.call(this))};s.CheckActiveRow()===!0?o.call(this):i=!0,t=e,e={err:!1};if(!i&&r!=="undefined"&&r!==null)for(var u=1;u<=n;u++)if(!r[u]){_("IDS_LS_TARGET_PRIORITY_VALIDATION_FAILED");break}return e}function F(){var e={err:!1},t,n=!1,r="",i="",s="";e=M("PHARMA CALL");var o=T("Pharma Professional Call - Mobile");e=o.FieldValue("Category"),t=e,e={err:!1},s=t.retVal,s="Required Fields To Submit: "+s,i=SiebelApp.Metadata.GetUserProperty(s,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(c.IsEmpty(i))return e;var u=i.split(","),a=u.length;for(var f=0;f<a;f++){e=r=o.FieldValue(u[f]);if(c.IsEmpty(r))return n=!0,_("SSAFReqFieldNotExist",u[f])}return e}function I(){var e={err:!1},t,i="";e=M("PHARMA CALL");if(!n&&!r)return _("SSAPhmaValidationRuleIgnored");var o=T("Pharma Professional Call - Mobile");e=o.FieldValue("Contact Full Name"),t=e;var u=t.retVal;e=o.FieldValue("Paper Signature"),t=e;var a=t.retVal;e=o.FieldValue("Signature Captured"),t=e;var f=t.retVal;e=o.FieldValue("Sample Reference Number"),t=e,e={err:!1};var l=t.retVal;if(a===!0){i=SiebelApp.Metadata.GetUserProperty("Enable Paper Reference Required",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(i.toLowerCase()==="y"){if(c.IsEmpty(l))return _("SSAPhrmaErrRefNumIfSamp",u)}else c.IsEmpty(l)&&(e=o.FieldValue("Id"),t=e,i=t.retVal,e=o.SetFieldValue("Sample Reference Number",i))}else{if(f.toLowerCase()!=="y")return s.RuleName="CALL NEED SIGN RULE",_("SSAPhmaErrCallNeedsSign",u);if(i.toLowerCase()==="y"){if(c.IsEmpty(l))return _("SSAPhrmaErrRefNumIfSamp",u)}else c.IsEmpty(l)&&(e=o.FieldValue("Id"),t=e,i=t.retVal,e=o.SetFieldValue("Sample Reference Number",i))}return e}function q(){var e={err:!1},t,i=!1,s="",o="";e=M("PHARMA CALL");var u=T("Pharma Professional Call - Mobile"
);if(!c.IsEmpty(u)){e=u.FieldValue("Signature Captured"),t=e,e={err:!1},i=t.retVal,i===!1&&(e=i=u.FieldValue("Paper Signature"),t=e,e={err:!1},i=t.retVal);var a=i?!0:!1;if(!n&&!r&&!a)return _("SSAPhmaValidationRuleIgnored");e=a=u.FieldValue("Signature Captured");if(a){var f=T("Pharma Promotional Items Dropped");if(f.CheckActiveRow()!==!0)return _("SSAPhmaValidationRuleIgnored")}}return e}function R(){var e={err:!1},t,i=!1,s="",o="",u="",a="";e=M("CONTACT"),s=SiebelApp.Metadata.GetUserProperty("SRE Professional Types",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(c.IsEmpty(s))return _("SSAPhmaValidationRuleIgnored"),i=!0,e={err:!1,retVal:i},e;var f=T("Pharma Professional Call - Mobile");e=f.FieldValue("Professional Type"),t=e,e={err:!1},o=t.retVal;var l=SiebelApp.S_App.Model.GetLovValName(o,"CONTACT_TYPE"),h=","+l+",",p=s.indexOf(h);return!c.IsEmpty(o)&&p!==-1?(_("SSAPhmaValidationRulePassed"),i=!0,e={err:!1,retVal:i},e):(e=U(),t=e,function(t){e={err:!1};var s=t.retVal,o=SiebelApp.S_App.Model.GetLovValName(s,"STATE_ABBREV"),f="SRE PT Exception - License: "+l;u=SiebelApp.Metadata.GetUserProperty(f,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service")),f="SRE PT Exception - DEA: "+l,a=SiebelApp.Metadata.GetUserProperty(f,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service")),c.IsEmpty(u)&&(u=""),c.IsEmpty(a)&&(a=""),!c.IsEmpty(s)&&a.indexOf(o)<0&&n?(_("SSAPhrmaErrNotValidProfTypeForSRE"),e={err:i,retVal:i}):!c.IsEmpty(s)&&u.indexOf(o)<0&&(n||r)?(_("SSAPhrmaErrNotValidProfTypeForSRE"),e={err:i,retVal:i}):c.IsEmpty(s)||(_("SSAPhmaValidationRulePassed"),e={err:i,retVal:i}),!n&&!r&&(_("SSAPhmaValidationRuleIgnored"),e={err:i,retVal:i});if(!c.IsEmpty(s)&&(u.indexOf(o)>=0||a.indexOf(o)>=0))return i=!0,e={err:!1,retVal:!0},e}.call(this,t),e)}function U(){var e={err:!1},t,n="",r=T("Pharma Professional Call - Mobile"),i=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE");e=r.FieldValue("Category"),t=e,e={err:!1};var s=t.retVal;if(s===i){var o=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile"),u=o.GetBusComp("Pharma Professional Call - Mobile");e=r.FieldValue("Parent Activity Id"),t=e;var a=t.retVal;e=u.SetFldSearchSpec("Id",a),u.ActivateField("State"),e=u.Execute(),t=e,e=u.Home(),t=e,e={err:!1};if(u.CheckActiveRow()===!0){e=u.FieldValue("State"),t=e;var n=t.retVal;SiebelApp.S_App.Model.ReleaseBO(o),e={err:!1,retVal:n}}}else{e=r.FieldValue("State"),t=e,e={err:!1},n=t.retVal;if(!c.IsEmpty(n))e={err:!1,retVal:n};else{var f="State",l=T("CUT Address - CE");e=l.FieldValue(f),t=e;var n=t.retVal;e={err:!1,retVal:n}}}return e}function z(){M("PHARMA CALL")}function W(){var e={err:!1},t;e=M("PHARMA CALL");var n=!1,r=!1,i=!1,s=O().ErrMsgType;if(s!=="IGNORE"){var o=T("Pharma Promotional Items Dropped"),u=function(){e=o.FieldValue("Sum Qty Alloc"),t=e;var s=t.retVal;e=o.SetFieldValue("Calc Sum Qty Alloc",s),t=e,e=o.FieldValue("Max Per Allocation"),t=e,s=t.retVal,e=o.SetFieldValue("Alloc Max Qty Per Period",s,!0),t=e,e=o.FieldValue("Max Per Call"),t=e,s=t.retVal,e=o.SetFieldValue("Alloc Max Qty Per Call",s,!0),e=o.FieldValue("Quantity"),t=e,function(t){e={err:!1};var s=t.retVal;if(s<=0)return;e=ct.call(this,o,!0),t=e,i=t.retVal,n=!i,e=J(o),t=e,r=t.retVal,n=!r,e=K(o),t=e,r=t.retVal,n=!r,e=o.NextRecord(),t=e,e={err:!1};var a=t.err;a||u.call(this)}.call(this,t)};o.CheckActiveRow()===!0&&u.call(this)}return e}function X(){var e={err:!1},t;e=M("PHARMA CALL");var n=!1,r=O().ErrMsgType;if(r!=="IGNORE"){var i=T("LS PCD Presentation Details BC"),s=function(){e=i.FieldValue("Response"),t=e,e={err:!1};var r=t.retVal;if(c.IsEmpty(r))n=!0;else{e=i.NextRecord(),t=e,e={err:!1};var o=t.err;o||s.call(this)}};return i&&!c.IsEmpty(i)&&i.CheckActiveRow()===!0&&s.call(this),n===!0?_("IDS_LS_PHARMA_EDT_RSP_REQD"):_("SSAPhmaValidationRulePassed")}return _("SSAPhmaValidationRuleIgnored")}function V(){var e={err:!1},t;b=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile");var n=b.GetBusComp("Pharma Professional Call - Mobile"),r=this.GetContext().GetBusComp().GetParentBusComp(),i=b.GetBusComp("Employee");E=SiebelApp.S_App.Model.GetBusObj("Account");var s=E.GetBusComp("CUT Address - CE"),o=SiebelApp.S_App.Model.GetLovNameVal("Account Call","TODO_TYPE"),u=SiebelApp.S_App.Model.GetLovNameVal("Professional Call","TODO_TYPE");e=r.FieldValue("Parent Activity Id"),t=e;var a=t.retVal;e=r.FieldValue("Category"),t=e;var f=t.retVal;e=r.FieldValue("Contact Address Id"),t=e;var l=t.retVal;g.push(r),i.ActivateField("OK to Sample"),e=i.Execute(),t=e,e=i.Home(),t=e,e={err:!1},g.push(i);if(f===u&&l)e=s.SetFldSearchSpec("Id",l);else{n.SetSearchExpr("[Parent Activity Id] = '"+a+"' AND [Category] = '"+o+"'"),n.ActivateField("Contact Address Id"),n.ActivateField("Account Address Id"),e=n.Execute(),t=e,e=n.Home(),t=e,e={err:!1};if(n.CheckActiveRow()===!0){e=n.FieldValue("Contact Address Id"),t=e,l=t.retVal,e=n.FieldValue("Account Address Id"),t=e,e={err:!1};var c=t.retVal;l?e=s.SetFldSearchSpec("Id",l):e=s.SetFldSearchSpec("Id",c)}}return t=e,e=s.Execute(),t=e,e=s.Home(),t=e,e={err:!1},g.push(s),e}function $(e){var t={err:!1},n,r=!1;u=!1;var i=SiebelApp.Metadata.GetUserProperty("Enable Stop Sampling Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(c.IsEmpty(i))return t;var s=i.split(","),a=s[0],f=s[1],l=s[2];return o.RuleName=a,o.ErrMsgType=l,f==="N"?t:(o.RuleName=a,V.call(this),t=Q(),n=t,function(e){t={err:!1},r=e.retVal;if(!r)return t={err:!1,retVal:r},SiebelApp.S_App.Model.ReleaseBO(b),SiebelApp.S_App.Model.ReleaseBO(E),t;t=Y(),e=t,function(e){t={err:!1},r=e.retVal;if(!r)return t={err:!1,retVal:r},SiebelApp.S_App.Model.ReleaseBO(b),SiebelApp.S_App.Model.ReleaseBO(E),t;t=R(),e=t,r=e.retVal,t={err:!1,retVal:r},SiebelApp.S_App.Model.ReleaseBO(b),SiebelApp.S_App.Model.ReleaseBO(E)}.call(this,e)}.call(this,n),u=!0,t)}function J(e){var t={err:!1},n,r;t=M("PHARMA CALL");var i=SiebelApp.Metadata.GetUserProperty("Enable Max Samples Per Call Sub Rule"
,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(c.IsEmpty(i))return t={err:!1,retVal:!0},t;var u=i.split(","),a=u[0],f=u[1],l=u[2];o.RuleName=a,o.ErrMsgType=l;if(f==="N")return t={err:!1,retVal:!0},t;t=e.FieldValue("Quantity"),n=t;var h=n.retVal;return t=e.FieldValue("Max Per Call"),n=t,function(n){t={err:!1};var o=n.retVal,u=parseInt(o,10),a=parseInt(h,10);if(u>0&&a<=u||c.IsEmpty(o))return r=!0,t={err:!1,retVal:r},t;s.RuleName="MAX PER CALL SUB RULE",t=e.FieldValue("Name"),n=t,function(e){t={err:!1};var n=e.retVal;if(!c.IsEmpty(i))return t={err:!1,retVal:!1},_("SSAPhmaErrMaxQtyPerCallExceeded",n,o,l),t}.call(this,n)}.call(this,n),t}function K(e){var t={err:!1},n,r=!0,i=SiebelApp.Metadata.GetUserProperty("Enable Max Samples Per Allocation Period Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(c.IsEmpty(i))return t;var o=i.split(","),u=o[0],a=o[1],f=o[2];if(a==="N")return t;t=e.FieldValue("Sum Qty Alloc"),n=t;var l=n.retVal;return t=e.FieldValue("Max Per Allocatio"),n=t,function(n){t={err:!1};var o=n.retVal;if(c.IsEmpty(o))return t={err:!1,retVal:!0},t;var a=o.valueOf();if(a>0&&l<=a||c.IsEmpty(o))return r=!0,t={err:!1,retVal:r},t;r=!1,s.RuleName=u,s.ErrMsgType=f;var h=t=e.FieldValue("Name");if(!c.IsEmpty(i))return t={err:!1,retVal:!1},_("SSAPhmaErrMaxQtyPerAllocPeriodExceeded",h,o,f),t}.call(this,n),t}function Q(){var e={err:!1},t,i=!1;return M("EMPLOYEE"),e=G(),t=e,e={err:!1},i=t.retVal,n||r?i?_("SSAPhmaValidationRulePassed"):_("SSAPhmaValdnMsgInValidEmpToSample"):_("SSAPhmaValidationRuleIgnored"),e={err:!1,retVal:i},e}function G(){var e={err:!1},t,n=T("Employee"),r,i=!1,s="OK to Sample";if(n.CheckActiveRow()===!0){e=n.FieldValue(s),t=e,e={err:!1},r=t.retVal;if(r.toLowerCase()==="y"||r.toLowerCase()==="true")i=!0;e={err:!1,retVal:i}}else e={err:!1,retVal:i};return e}function Y(){var e={err:!1},t,i=!1;return M("CONTACT"),e=Z(),t=e,e={err:!1},i=t.retVal,n||r?i?_("SSAPhmaValidationRulePassed"):_("SSAPhrmaErrOKToSampleFlgNotSet"):_("SSAPhmaValidationRuleIgnored"),e={err:!1,retVal:i},e}function Z(){var e={err:!1},t,n=T("Pharma Professional Call - Mobile"),r,i=!1,s="OK To Sample";e=n.FieldValue(s),t=e,e={err:!1},r=t.retVal;if(r.toLowerCase()==="y"||r.toLowerCase()==="true")i=!0;return e={err:!1,retVal:i},e}function et(){var e={err:!1},t,i=!1,s=!1;e=M("CONTACT"),e=U(),t=e,e={err:!1};var o=t.retVal;if(!c.IsEmpty(o)){if(!r&&!n||!a)return _("SSAPhmaValidationRuleIgnored");var u=T("Pharma Professional State Licenses"),f=SiebelApp.Metadata.GetUserProperty("License Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));return e=u.FieldValue(f),t=e,function(t){e={err:!1};var n=t.retVal;return c.IsEmpty(n)?i=!0:(new Date(n)).getTime()<(new Date).getTime()&&(s=!0),!i&&!s?_("SSAPhmaValidationRulePassed"):i?_("SSAPhrmaErrLicFldsNotFilled","License Expiry Date"):_("SSAPhrmaErrLicNumExpDtExpired")}.call(this,t),e}return _("SSAPhrmaErrLicNumExpDtExpired")}function tt(){var e={err:!1},t,i=!1,s=!1;e=M("CONTACT"),e=U(),t=e,e={err:!1};var o=t.retVal;if(!c.IsEmpty(o)){if(!r&&!n||!a)return _("SSAPhmaValidationRuleIgnored");var u=T("Pharma Professional State Licenses"),f=SiebelApp.Metadata.GetUserProperty("License Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));return e=u.FieldValue(f),t=e,function(t){e={err:!1};var n=t.retVal;c.IsEmpty(n)?s=!0:i=!0;if(!s&&i)return _("SSAPhmaValidationRulePassed");if(s)return _("SSAPhrmaErrLicFldsNotFilled","License Number")}.call(this,t),e}return _("SSAPhrmaErrLicFldsNotFilled","License Number")}function nt(){var e={err:!1},t,n=!1,r=!1,i="",s="";e=M("CONTACT");var o=T("Pharma Professional State Licenses");e=U(),t=e,e={err:!1};var u=t.retVal;if(!c.IsEmpty(u)){var a=SiebelApp.Metadata.GetUserProperty("License Status Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));return e=o.FieldValue(a),t=e,function(t){e={err:!1};var o=t.retVal;if(c.IsEmpty(o))n=!0;else{i=SiebelApp.S_App.Model.GetLovValName(o,"STATE_LICENSE_STATUS"),s=SiebelApp.Metadata.GetUserProperty("Valid License Status",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(c.IsEmpty(s))i==="Active"&&(r=!0);else{var u=s.split(",");for(var a=0;a<u.length;a++)if(i===u[a]){r=!0;break}}}if(n)return _("SSAPhrmaErrLicFldsNotFilled","License Status");if(!r)return _("SSAPhrmaErrLicStatusInactive");if(!n&&r)return _("SSAPhmaValidationRulePassed")}.call(this,t),e}return _("SSAPhrmaErrLicStatusInactive")}function rt(){var e={err:!1},t,r=!1;e=M("CONTACT");var i=T("Pharma Professional Call - Mobile");e=i.FieldValue("Category"),t=e,e={err:!1};var s=t.retVal,o=SiebelApp.S_App.Model.GetLovValName(s,"TODO_TYPE");return!n||!l||o==="Attendee Call"?_("SSAPhmaValidationRuleIgnored"):(e=it(),t=e,function(t){return e={err:!1},r=t.retVal,r?_("SSAPhmaValidationRulePassed"):_("SSAPhrmaErrDEANumNotValid")}.call(this,t),e)}function it(){var e={err:!1},t,n=!1,r=T("Pharma Address Inter Table - CE");e=r.FieldValue("DEA#"),t=e,e={err:!1};var i=t.retVal,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;if(i.length!==9)return e={err:!1,retVal:n},e;s=i.charAt(0),o=i.charAt(1),u=i.charAt(2),a=i.charAt(3),f=i.charAt(4),l=i.charAt(5),c=i.charAt(6),h=i.charAt(7),p=i.charAt(8);if(s===s.toUpperCase()&&o===o.toUpperCase()){if(isNaN(u)||isNaN(a)||isNaN(f)||isNaN(l)||isNaN(c)||isNaN(h)||isNaN(p))return e={err:!1,retVal:n},e;d=u.valueOf(),v=a.valueOf(),m=f.valueOf(),g=l.valueOf(),y=c.valueOf(),b=h.valueOf(),w=p.valueOf(),E=parseInt(d,10)+parseInt(m,10)+parseInt(y,10),S=parseInt(v,10)+parseInt(g,10)+parseInt(b,10),w=parseInt(w,10),x=E+2*S,x%10===w&&(n=!0)}return e={err:!1,retVal:n},e}function st(){var e={err:!1},t,r=!1,i=!1,s="",o="",u,a;e=M("CONTACT");var f=T("Pharma Professional Call - Mobile");e=f.FieldValue("Category"),t=e,e={err:!1};var h=t.retVal,p=SiebelApp.S_App.Model.GetLovValName(h,"TODO_TYPE");return!n||!l||p==="Attendee Call"?_("SSAPhmaValidationRuleIgnored"):(f=T("Pharma Address Inter Table - CE"),e=f.FieldValue
("DEA Expr"),t=e,function(t){e={err:!1};var n=t.retVal;return c.IsEmpty(n)?a=!0:(new Date(n)).getTime()<(new Date).getTime()&&(u=!0),r?_("SSAPhrmaErrDEANumFldsNotFilled","DEA Expiry Date"):u?_("SSAPhrmaErrDEANumExpDtExpired"):_("SSAPhmaValidationRulePassed")}.call(this,t),e)}function ot(){var e={err:!1},t;e=M("PHARMA CALL");var n=!1,r=!1,i=!1,s=O().ErrMsgType;if(s!=="IGNORE"){var o=T("Pharma Call Sample Dropped");if(o.CheckActiveRow()===!0){e=o.FieldValue("Sum Qty Alloc"),t=e;var u=t.retVal;e=o.SetFieldValue("Calc Sum Qty Alloc",u),t=e,e=o.FieldValue("Max Per Allocation"),t=e,u=t.retVal,e=o.SetFieldValue("Alloc Max Qty Per Period",u),t=e,e=o.FieldValue("Max Per Call"),t=e,u=t.retVal,e=o.SetFieldValue("Alloc Max Qty Per Call",u),e=o.FieldValue("Quantity"),t=e,function(t){e={err:!1};var s=t.retVal;if(s<=0)return e;e=ct.call(this,o,!0),t=e,i=t.retVal,n=!i,e=ut(o),t=e,e={err:!1},r=t.retVal,n=!r,r&&(e=at(o),t=e,e={err:!1},r=t.retVal,n=!r),e=J(o),t=e,r=t.retVal,n=!r,e=K(o),t=e,e={err:!1},r=t.retVal,n=!r}.call(this,t)}}return e}function ut(e){var t={err:!1},n,r=!1,i=SiebelApp.Metadata.GetUserProperty("Enable Lot Validation Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(c.IsEmpty(i))return t={err:!1,retVal:!0},t;var o=i.split(","),u=o[0],a=o[1],f=o[2];if(c.IsEmpty(i)||a.toLowerCase()!=="y")return r=!0,t;s.RuleName=u;var l=t=e.FieldValue("Name"),h=t=e.FieldValue("Lot Name"),p=t=e.FieldValue("Call Date"),d=t=e.FieldValue("Parent Inventory Flag"),v=t=e.FieldValue("Parent Lots Defined Flag"),m=SiebelApp.Metadata.GetUserProperty("Validate Lot# Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service")),g=t=e.FieldValue("Parent Lots Defined Flag");if(!c.IsEmpty(h)){if((new Date(g)).getTime()<(new Date).getTime())return s.RuleName="LOT EXPIRY RULE",_("IDS_LS_PHARMA_EXPIRED_LOT")}else if(c.IsEmpty(h)&&v){var y=SiebelApp.S_App.Model.GetSystemPreference("Samples Lots Enabled"),b=SiebelApp.S_App.Model.GetSystemPreference("Lots For Disperse Only");if(y.toLowerCase()===!0&&b.toLowerCase()!==!0)return _("IDS_LS_PHARMA_LOT_NUMBER_REQ","Lot #")}return r=!0,r}function at(e){var t={err:!1},n,r=!1,i=SiebelApp.Metadata.GetUserProperty("Enable Lot Cutoff Validation Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(c.IsEmpty(i))return t={err:!1,retVal:!0},t;var o=i.split(","),u=o[0],a=o[1],f=o[2];if(c.IsEmpty(i)||a.toLowerCase!=="y")return r=!0,t;s.RuleName=u;var l=new Date,h=t=e.FieldValue("Lot Name");if(!c.IsEmpty(h)){var p=t=e.FieldValue("Cutoff Date"),d=t=e.FieldValue("Name");if(!c.IsEmpty(p)&&(new Date(p)).getTime()<(new Date).getTime())return _("SSAPhmaValdnMsgLotCutOff",d)}return r=!0,t}function ft(){var e={err:!1},t,i=["Last Name","Contact First Name","Address","Title"],s,o=0;e=M("CONTACT");if(!n&&!r)return _("SSAPhmaValidationRuleIgnored");var u=T("Pharma Professional Call - Mobile"),a=function(){e=u.FieldValue(i[o]),t=e,e={err:!1},s=t.retVal;if(c.IsEmpty(s)){if(i[o]!=="Title")return _("SSAPhrmaErrProfProfileNotFilled",i[o]);e=ht(u),t=e,function(t){return e={err:!1},s=t.retVal,c.IsEmpty(s)?_("SSAPhrmaErrProfProfileNotFilled",i[o]):_("SSAPhmaValidationRulePassed")}.call(this,t)}else{if(!(o<3))return _("SSAPhmaValidationRulePassed");o++,a.call(this)}};return u.CheckActiveRow()===!0&&a.call(this),e}function lt(){M("PHARMA CALL");var e=!1;return e=P("Pharma Call Sample Dropped"),e?_("SSAPhmaValidationRulePassed"):_("SSAPhmaErrSampDropSign")}function ct(e,t){var n={err:!1},r;n=M("PHARMA CALL"),t=!0;var i=SiebelApp.Metadata.GetUserProperty("Enable Stop Sampling Sub Rule",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(c.IsEmpty(i))return n;var s=i.split(","),u=s[0],a=s[1],f=s[2];o.RuleName=u,o.ErrMsgType=f;if(a==="N")return n;o.RuleName=u,n=e.FieldValue("Name"),r=n;var l=r.retVal;return n=e.FieldValue("Stop Sampling Flag"),r=n,function(e){n={err:!1};var r=e.retVal;r.toLowerCase()==="y"&&(t=!1);if(!t)return c.IsEmpty(f)?_("SSAPhmaValdnMsgStopSampling",l):_("SSAPhmaValdnMsgStopSampling",l,null,f),n={err:!1,retVal:t},n}.call(this,r),n}function ht(e){var t={err:!1},n,r=T("Contact");if(r.CheckActiveRow()===!0){t=r.FieldValue("M/M"),n=t;var i=n.retVal;t={err:!1,retVal:i}}return t}function pt(e){var t={err:!1},n,r="",i=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile"),s=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE");t=e.FieldValue("Category"),n=t,t={err:!1};var o=n.retVal;if(o===s){var u=i.GetBusComp("Pharma Professional Call - Mobile");t=e.FieldValue("Parent Activity Id"),n=t;var a=n.retVal;t=u.SetFldSearchSpec("Id",a),u.ActivateField("State"),t=u.Execute(),n=t,t=u.Home(),n=t,t={err:!1};if(u.CheckActiveRow()===!0){t=u.FieldValue("State"),n=t;var r=n.retVal;SiebelApp.S_App.Model.ReleaseBO(i),t={err:!1,retVal:r}}}else{t=e.FieldValue("State"),n=t,t={err:!1},r=n.retVal;if(!c.IsEmpty(r))t={err:!1,retVal:r};else{var f="State",l=i.GetBusComp("CUT Address - CE");t=e.FieldValue("Contact Address Id"),n=t;var h=n.retVal;t=e.FieldValue("Account Address Id"),n=t,t={err:!1};var p=n.retVal;h?t=l.SetFldSearchSpec("Id",h):t=l.SetFldSearchSpec("Id",p),t=l.FieldValue(f),n=t,r=n.retVal,SiebelApp.S_App.Model.ReleaseBO(i),t={err:!1,retVal:r}}}return t}var c=SiebelJS.Dependency("SiebelApp.Utils");return SiebelJS.Extend(S,SiebelApp.ServiceModel),S.prototype.CanInvokeMethod=function(e){var t={err:!1},n;return e==="CallValidate"?(t={err:!1,retVal:!0},t):e==="CanAddSample"?(t={err:!1,retVal:!0},t):SiebelApp.PharmaCallValidatorsvc.superclass.CanInvokeMethod.call(this,e)},S.prototype.InvokeMethod=function(e,t){var n={err:!1},r,i=CCFMiscUtil_CreatePropSet();if(!e)return n={err:!1,retVal:!1},n;if(e==="CallValidate"){g=[];var s=SiebelApp.S_App.GetActiveView().GetActiveApplet().GetBusComp();n=this.ExecuteAllBCs(s),r=n,n={err:!1};var o=r.err;o!==!0&&(n=this.CallValidate(t),r=n,i=r.retVal,this.CleanUp(),n={err:!1,retVal:i})}else{if(e!=="CanAddSample")return SiebelApp.PharmaCallValidatorsvc.superclass.InvokeMethod.
call(this,e,t);var u=this.GetContext().GetBusComp().GetParentBusComp();u&&u.CheckActiveRow()===!0&&(n=$.call(this,t),r=n,n={err:r.err,retVal:r.retVal})}return n},S.prototype.ExecuteAllBCs=function(e){var t={err:!1},n,r=[];y=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile");var i=y.GetBusComp("Pharma Attendee Call Mobile"),s=y.GetBusComp("Pharma Call Products Detailed"),o=y.GetBusComp("Pharma Promotional Items Dropped"),u=y.GetBusComp("Pharma Call Sample Dropped"),a=y.GetBusComp("LS Pharma Call Validation Results"),f=y.GetBusComp("LS PCD Presentation Details BC");w=SiebelApp.S_App.Model.GetBusObj("Contact");var l=w.GetBusComp("Pharma Professional State Licenses"),h=w.GetBusComp("Pharma Address Inter Table - CE"),p=w.GetBusComp("Contact"),d=y.GetBusComp("Employee");E=SiebelApp.S_App.Model.GetBusObj("Account");var v=E.GetBusComp("CUT Address - CE"),m=[],b=0;t=e.FieldValue("Id"),n=t;var S=n.retVal;t=e.FieldValue("Category"),n=t;var T=n.retVal;t=e.FieldValue("Contact Id"),n=t;var N=n.retVal;t=pt(e),n=t;var C=n.retVal;t=e.FieldValue("Contact Address Id"),n=t;var k=n.retVal;t=e.FieldValue("Account Address Id"),n=t;var L=n.retVal;e=y.GetBusComp("Pharma Professional Call - Mobile"),t=e.SetFldSearchSpec("Id",S),e.ActivateField("Title"),e.ActivateField("Contact First Name"),e.ActivateField("Contact Acct Id"),e.ActivateField("OK To Sample"),e.ActivateField("State"),e.ActivateField("Sample Reference Number"),e.ActivateField("Activity UId"),e.ActivateField("Parent Activity Id"),e.ActivateField("Category"),e.ActivateField("ContactId"),e.ActivateField("Account Name"),e.ActivateField("Account Id"),e.ActivateField("Last Name"),e.ActivateField("Contact Id"),e.ActivateField("Call Status"),e.ActivateField("Address"),e.ActivateField("Account Address Id"),e.ActivateField("Contact Address Id"),e.ActivateField("License Expiry Date"),e.ActivateField("License Number"),e.ActivateField("License Status"),e.ActivateField("Professional Type"),e.ActivateField("Signature Captured"),e.ActivateField("Start Date"),e.ActivateField("Primary Owner Id"),t=e.Execute(),n=t,t=e.Home(),n=t,t={err:!1},e&&!c.IsEmpty(e)&&g.push(e);var A=function(){u.ActivateField("Activity Id"),u.ActivateField("Lot Name"),u.ActivateField("Parent Inventory Flag"),u.ActivateField("Parent Lots Defined Flag"),u.ActivateField("Cutoff Date"),u.ActivateField("Call Date"),u.ActivateField("Max Per Call"),u.ActivateField("Max Per Allocation"),u.ActivateField("Sum Qty Alloc"),u.ActivateField("Stop Sampling Flag"),u.ActivateField("Controlled Substance"),u.ActivateField("Calc Sum Qty Alloc"),u.ActivateField("Alloc Max Qty Per Period"),u.ActivateField("Alloc Max Qty Per Call"),u.ActivateField("Quantity"),t=u.SetFldSearchSpec("Activity Id",S)},O=function(){g.push(u)},M=function(){a.ActivateField("Object Id"),a.ActivateField("Object Type"),a.ActivateField("Rule Number"),a.ActivateField("Message Type"),a.ActivateField("Message Type LIC"),a.ActivateField("Message"),a.ActivateField("Call Id"),t=a.SetFldSearchSpec("Call Id",S)},_=function(){g.push(a)},D=function(){return[a]},P=function(){s.ActivateField("Name"),s.ActivateField("Product Id"),s.ActivateField("Priority"),s.ActivateField("Product Allocation Id"),t=s.SetFldSearchSpec("Activity Id",S)},H=function(){g.push(s)},B=function(){o.ActivateField("Max Per Call"),o.ActivateField("Max Per Allocation"),o.ActivateField("Stop Sampling Flag"),o.ActivateField("Sum Qty Alloc"),o.ActivateField("Calc Sum Qty Alloc"),o.ActivateField("Alloc Max Qty Per Period"),o.ActivateField("Alloc Max Qty Per Call"),o.ActivateField("Quantity"),t=o.SetFldSearchSpec("Activity Id",S)},j=function(){g.push(o)},F=function(){i.ActivateField("Parent Activity Id"),i.SetSearchExpr("[Parent Activity Id] = '"+S+"'")},I=function(){g.push(i)},q=function(){var e=SiebelApp.Metadata.GetUserProperty("License Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service")),n=SiebelApp.Metadata.GetUserProperty("License Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service")),r=SiebelApp.Metadata.GetUserProperty("License Status Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));l.ActivateField(e),l.ActivateField(n),l.ActivateField(r),l.ActivateField("One Time Sample Flag"),t=l.SetFldSearchSpec("Professional Id",N),t=l.SetFldSearchSpec("State",C)},R=function(){g.push(l)},U=function(){var e=SiebelApp.Metadata.GetUserProperty("DEA Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));h.ActivateField(e),e=SiebelApp.Metadata.GetUserProperty("DEA Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service")),h.ActivateField(e),t=h.SetFldSearchSpec("Professional Id",N),t=h.SetFldSearchSpec("Address Id",k)},z=function(){g.push(h)},W=function(){var e=SiebelApp.S_App.Model.GetLoginId();d.ActivateField("Id"),d.ActivateField("OK to Sample"),t=d.SetFldSearchSpec("Id",e)},X=function(){g.push(d)},V=function(){var e=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE"),n=SiebelApp.S_App.Model.GetLovNameVal("Professional Call","TODO_TYPE");T===n&&k?t=v.SetFldSearchSpec("Id",k):t=v.SetFldSearchSpec("Id",L)},$=function(){g.push(v)},J=function(){p.SetSearchSpec("[Id] = '"+N+"'")},K=function(){t=p.PositionById(N),g.push(p)},Q=function(){f.ActivateField("Response"),t=f.SetFldSearchSpec("Activity Id",S)},G=function(){g.push(f)};return u&&!c.IsEmpty(u)&&(m[b++]={execute:u.Execute,executeScope:u,preExecute:A},m[b++]={execute:u.Home,executeScope:u,postExecute:O}),a&&!c.IsEmpty(a)&&(m[b++]={execute:a.Execute,executeScope:a,preExecute:M},m[b++]={execute:a.Home,executeScope:a,postExecute:_}),m[b++]={execute:x,executeScope:this,preExecute:D},s&&!c.IsEmpty(s)&&(m[b++]={execute:s.Execute,executeScope:s,preExecute:P},m[b++]={execute:s.Home,executeScope:s,postExecute:H}),o&&!c.IsEmpty(o)&&(m[b++]={execute:o.Execute,executeScope:o,preExecute:B},m[b++]={execute:o.Home,executeScope:o,postExecute:j}),i&&!c.IsEmpty(i)&&(m[b++]={execute:i.Execute,executeScope
:i,preExecute:F},m[b++]={execute:i.Home,executeScope:i,postExecute:I}),l&&!c.IsEmpty(l)&&(m[b++]={execute:l.Execute,executeScope:l,preExecute:q},m[b++]={execute:l.Home,executeScope:l,postExecute:R}),h&&!c.IsEmpty(h)&&(m[b++]={execute:h.Execute,executeScope:h,preExecute:U},m[b++]={execute:h.Home,executeScope:h,postExecute:z}),d&&!c.IsEmpty(d)&&(m[b++]={execute:d.Execute,executeScope:d,preExecute:W},m[b++]={execute:d.Home,executeScope:d,postExecute:X}),v&&!c.IsEmpty(v)&&(m[b++]={execute:v.Execute,executeScope:v,preExecute:V},m[b++]={execute:v.Home,executeScope:v,postExecute:$}),p&&!c.IsEmpty(p)&&(m[b++]={execute:p.Execute,executeScope:p,preExecute:J},m[b++]={execute:p.Home,executeScope:p,postExecute:K}),f&&!c.IsEmpty(f)&&(m[b++]={execute:f.Execute,executeScope:f,preExecute:Q},m[b++]={execute:f.Home,executeScope:f,postExecute:G}),n=SiebelApp.OfflineAppMgr.eachSyncOp(this,m),t={err:!1,retval:"success"},t},S.prototype.CallValidate=function(n){var r={err:!1},i;SiebelJS.Log("Invoked CallValidateOverride ");var s="Submit",o=CCFMiscUtil_CreatePropSet();e=0,t=0,s=n.GetProperty("EventName");var u=T("Pharma Professional Call - Mobile");r=N(u),i=r,r={err:!1};var a=i.retVal;if(a){r=this.ValidateAttendeeCall(u,s),i=r;var f=e,l=t;o.SetProperty("ErrorCount",f),o.SetProperty("WarningCount",l),e=t=0,r={err:!1,retVal:o}}else{r=C(u),i=r,r={err:!1};var c=i.retVal;if(c){r=this.ValidateAccountCall(u,s),i=r;var f=e,l=t;o.SetProperty("ErrorCount",f),o.SetProperty("WarningCount",l),e=t=0,r={err:!1,retVal:o}}else{r=this.ValidateProfCall(u,s),i=r;var f=e,l=t;o.SetProperty("ErrorCount",f),o.SetProperty("WarningCount",l),e=t=0,r={err:!1,retVal:o}}}return r},S.prototype.ValidateAttendeeCall=function(e,t){var n={err:!1},r;SiebelJS.Log("Invoked ValidateAttendeeCall Method");var s=[],o=!1;n=this.ExecuteAllBCs(e),r=n,n=this.PreValidate(),r=n,n=this.SetValidateEventCode(t),r=n,n={err:!1};for(var u=1;u<=20;u++){var a="Validation Rule "+u,f=SiebelApp.Metadata.GetUserProperty(a,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));s.push(f)}var l=s.length,h=0,p=function(){var t=s[h];if(!c.IsEmpty(t)){var u=t.split(",");if((u[4].valueOf()&v)===v){o=!0,A(t,!0);var a=this.ValidateRule(t);r=n,n={err:!1};var a=r.retVal;A(t,!1),h++;if(h<l)p.call(this);else{o||(i=""),n=e.FieldValue("Id"),r=n;var f=r.retVal;n=this.UpsertResult(f)}}else h++,p.call(this)}else h++,h<l&&p.call(this)};return p.call(this),n},S.prototype.ValidateAccountCall=function(e,t){var n={err:!1},r;SiebelJS.Log("Invoked ValidateAccountCall Method");var s=[],o=!1,u;n=this.PreValidate(),r=n,n=this.SetValidateEventCode(t),r=n,n={err:!1};for(var a=1;a<=21;a++){var f="Validation Rule "+a,l=SiebelApp.Metadata.GetUserProperty(f,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));s.push(l)}var h=s.length,p=0,d=function(){var e=s[p];if(!c.IsEmpty(e)){var t=e.split(",");if((t[4].valueOf()&m)===m){o=!0,A(e,!0);var u=this.ValidateRule(e);r=n,n={err:!1};var u=r.retVal;A(e,!1),p++,p<h?d.call(this):o||(i="")}else p++,d.call(this)}else p++,p<h&&d.call(this)};d.call(this),n=e.FieldValue("Id"),r=n;var u=r.retVal;n=this.UpsertResult(u),r=n,n={err:!1},SiebelApp.OfflineAppMgr.PostActions("ActionRPCCompleted");var v=SiebelApp.S_App.Model.GetBusObj("Pharma Professional Call - Mobile"),g=v.GetBusComp("Pharma Professional Call - Mobile"),d=function(){this.CleanUp(),n=this.ValidateAttendeeCall(g,"SUBMIT"),r=n,n=g.NextRecord(),r=n,n={err:!1};var e=r.err;e||d.call(this)},y=SiebelApp.S_App.Model.GetLovNameVal("Attendee Call","TODO_TYPE");return g.SetSearchExpr("[Parent Activity Id] = '"+u+"' AND [Category] = '"+y+"'"),n=g.Execute(),r=n,n=g.Home(),r=n,n={err:!1},g.CheckActiveRow()===!0&&(d.call(this),r=n,n={err:!1},this.CleanUp(),SiebelApp.S_App.Model.ReleaseBO(v)),n},S.prototype.ValidateProfCall=function(e,t){var n={err:!1},r;SiebelJS.Log("Invoked ValidateProfCall Method");var s=[],o=!1;n=this.PreValidate(),r=n,n=this.SetValidateEventCode(t),r=n,n={err:!1};for(var u=1;u<=21;u++){var a="Validation Rule "+u,f=SiebelApp.Metadata.GetUserProperty(a,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));s.push(f)}var l=s.length,h=0,p=function(){var e=s[h];if(!c.IsEmpty(e)){var t=e.split(",");if((t[4].valueOf()&d)===d){o=!0,A(e,!0);var u=this.ValidateRule(e);r=n,n={err:!1};var u=r.retVal;A(e,!1),h++,h<l?p.call(this):o||(i="")}else h++,p.call(this)}else h++,h<l&&p.call(this)};p.call(this),r=n,n=e.FieldValue("Id"),r=n;var v=r.retVal;return n=this.UpsertResult(v),r=n,n={err:!1},SiebelApp.OfflineAppMgr.PostActions("ActionRPCCompleted"),n},S.prototype.CleanUp=function(){SiebelJS.Log("Invoked CleanUp Method"),i=[],g=[],SiebelApp.S_App.Model.ReleaseBO(y),SiebelApp.S_App.Model.ReleaseBO(w),SiebelApp.S_App.Model.ReleaseBO(E),b&&SiebelApp.S_App.Model.ReleaseBO(b)},S.prototype.PreValidate=function(){var e={err:!1},t;SiebelJS.Log("Invoked PreValidate Method");var i=T("Pharma Professional Call - Mobile");e=i.FieldValue("Category"),t=e,e={err:!1};var s=t.retVal,o=SiebelApp.S_App.Model.GetLovValName(s,"TODO_TYPE");return o==="Attendee Call"||o==="Professional Call"?(this.SaveCallProductState("Pharma Call Products Detailed"),t=e,e=this.SetCtrledSamplingFlags(),t=e,e=this.ProcessSREProfTypeException(),t=e,e=this.SetCallType(),t=e,e={err:!1}):(n=!1,r=!1),e},S.prototype.SaveCallProductState=function(){SiebelJS.Log("Invoked SaveCallProductState Method")},S.prototype.SetCallType=function(){var e={err:!1},t;SiebelJS.Log("Invoked SetCallType Method");var n,r,i=!1,s=!1,o=!1,u,a;return n=T("Pharma Professional Call - Mobile"),r=SiebelApp.S_App.GetActiveView().GetActiveApplet().GetBusComp(),i=P("Pharma Call Products Detailed"),s=P("Pharma Call Sample Dropped"),i&&s&&o?u=SiebelApp.S_App.Model.GetLovNameVal("DETAIL WITH SAMPLES","TODO_TYPE"):i&&s||i&&o?u=SiebelApp.S_App.Model.GetLovNameVal("Detail With Sample Drop","TODO_TYPE"):i?u=SiebelApp.S_App.Model.GetLovNameVal("Detail","TODO_TYPE"):s||o?u=SiebelApp.S_App.Model.GetLovNameVal("Sample Drop","TODO_TYPE"):u=SiebelApp.S_App.Model.GetLovNameVal
("Call","TODO_TYPE"),e=n.SetFieldValue("Type",u,!0),t=e,e=r.SetFieldValue("Type",u,!0),e},S.prototype.ProcessSREProfTypeException=function(){var e={err:!1},t;SiebelJS.Log("Invoked ProcessSREProfTypeException Method");var n=!0,r=!0,i="",s=T("Pharma Professional Call - Mobile");e=U(),t=e;var o=t.retVal;e=s.FieldValue("Professional Type"),t=e,e={err:!1};var u=t.retVal,f=SiebelApp.S_App.Model.GetLovValName(u,"CONTACT_TYPE"),h=SiebelApp.S_App.Model.GetLovValName(o,"STATE_ABBREV"),p="SRE PT Exception - License: "+f,d=SiebelApp.Metadata.GetUserProperty(p,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(!c.IsEmpty(d)){i=d.split("|");if(i[0]===h||i[1]===h)a=!1}p="SRE PT Exception - DEA: "+f,d=SiebelApp.Metadata.GetUserProperty(p,SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(!c.IsEmpty(d)){i=d.split("|");if(i[0]===h||i[1]===h)l=!1}return e},S.prototype.CopyStateLicenseInfo=function(){var e={err:!1},t;SiebelJS.Log("Invoked CopyStateLicenseInfo Method");var n="",r="",i="",s=T("Pharma Professional Call - Mobile"),o=e=U();e=s.FieldValue("Contact Id"),t=e;var u=t.retVal;s.SetCommitPending(!0),e=s.WriteRecord();if(!c.IsEmpty(o)){var a=T("Pharma Professional State Licenses"),f=SiebelApp.Metadata.GetUserProperty("License Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service")),l=SiebelApp.Metadata.GetUserProperty("License Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service")),h=SiebelApp.Metadata.GetUserProperty("License Status Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));if(a.CheckActiveRow()===!0){e=n=a.FieldValue(f),e=r=a.FieldValue(l),e=i=a.FieldValue(h);var p=e=a.FieldValue("One Time Sample Flag")}s.IsCommitPending()===!0&&(e=s.WriteRecord()),e=s.SetFieldValue("License Number",n),e=s.SetFieldValue("License Expiry Date",r),e=s.SetFieldValue("License Status",i),e=s.WriteRecord()}return e},S.prototype.CopyDEAInfo=function(){SiebelJS.Log("Invoked CopyDEAInfo Method");var e=T("Pharma Professional Call - Mobile"),t=e.FieldValue("Contact Id"),n=e.FieldValue("Contact Address Id");if(!c.IsEmpty(t)&&!c.IsEmpty(n)){var r=T("Pharma Address Inter Table - CE");if(r.CheckActiveRow()!==!0)return;var i=SiebelApp.Metadata.GetUserProperty("DEA Number Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service")),s=r.FieldValue(i);i=SiebelApp.Metadata.GetUserProperty("DEA Expiry Date Field",SiebelApp.Metadata.GetBusServiceDef("LS Pharma Validation Service"));var o=r.FieldValue(i);!c.IsEmpty(s)&&!c.IsEmpty(o)&&(e.SetFieldValue("DEA#",s),e.SetFieldValue("DEA Expiry Date",o),e.WriteRecord())}},S.prototype.SetCtrledSamplingFlags=function(){var e={err:!1},t;SiebelJS.Log("Invoked SetCtrledSamplingFlags Method"),n=!1,r=!1;var i=T("Pharma Call Sample Dropped");if(!c.IsEmpty(i)){var s=function(o){if(i.CheckActiveRow()===!0){e=i.FieldValue("Controlled Substance"),t=e,e={err:!1};var u=t.retVal;u==="Y"?n=!0:r=!0,e=i.NextRecord(),t=e,e={err:!1};var a=t.err;a?e=i.Home():s.call(this)}};i.CheckActiveRow()===!0&&s.call(this)}return e},S.prototype.SetValidateEventCode=function(e){var t={err:!1},n;SiebelJS.Log("Invoked SetValidateEventCode Method");var r=!1,i=!1,s=!1,o=T("Pharma Professional Call - Mobile");t=o.FieldValue("Category"),n=t,t={err:!1};var u=n.retVal,a=SiebelApp.S_App.Model.GetLovValName(u,"TODO_TYPE");return a==="Account Call"?(f=p,t):(c.IsEmpty(e)?(t=o.FieldValue("Signature Captured"),n=t,t={err:!1},s=n.retVal,s===!1&&(t=o.FieldValue("Paper Signature"),n=t,t={err:!1},s=n.retVal),r=s?!0:!1,r?f=p:f=h):e.toLowerCase()==="sign"?f=h:f=p,t)},S.prototype.UpsertResult=function(e){var t={err:!1},n;SiebelJS.Log("Invoked UpsertResult Method");var r=!1,s={},o="",u=SiebelApp.S_App.OfflineErrorObject,a=T("LS Pharma Call Validation Results");a.CheckActiveRow()===!0&&(r=!0);var f=i.length,l=0,c=1,h=[],p=[],d=[],v=["Message Type","Message Type LIC","Message","Call Id","Rule Number"],m=["strTemp","ErrMsgType","Message","Call Id"],g,y;for(g=0;g<f*2;g+=2){y=g;var b=function(n){return s=i[l],s.ErrMsgType.toLowerCase()==="error"?o=SiebelApp.S_App.Model.GetLovNameVal("ERROR","LS_VALIDATION_MESSAGE_TYPE"):s.ErrMsgType.toLowerCase()==="ignore"?o=SiebelApp.S_App.Model.GetLovNameVal("IGNORE","LS_VALIDATION_MESSAGE_TYPE"):s.ErrMsgType.toLowerCase()==="warning"?o=SiebelApp.S_App.Model.GetLovNameVal("WARNING","LS_VALIDATION_MESSAGE_TYPE"):o=SiebelApp.S_App.Model.GetLovNameVal("SUCCESS","LS_VALIDATION_MESSAGE_TYPE"),n===0&&(t=a.NewRecord(!1)),p[0]=v[n],n===0?p[1]=o:n===1?p[1]=s.ErrMsgType:n===2?p[1]=s.Message:n===3?p[1]=e:n===4&&(p[1]=c,c++),p[2]=!0,p},w=function(){return a.SetCommitPending(!0),d[0]=!1,d},E=function(){l++};h[y]={execute:a.SetFieldValue,executeScope:a,preExecute:b,iterations:5},h[y+1]={execute:a.WriteRecord,executeScope:a,preExecute:w,postExecute:E}}if(f>0){n=SiebelApp.OfflineAppMgr.eachSyncOp(this,h);var S=SiebelApp.S_App.GetActiveView().GetBusObj().GetBusComp("LS Pharma Call Validation Results");t=S.Execute(),n=t,t=S.Home(),n=t,t={err:!1,retVal:"Success"}}return t},S.prototype.PostValidate=function(){SiebelJS.Log("Invoked PostValidate Method"),this.RestoreCallProductState("Pharma Call Products Detailed")},S.prototype.RestoreCallProductState=function(e){SiebelJS.Log("Invoked RestoreCallProductState Method")},S.prototype.ValidateRule=function(e){SiebelJS.Log("Invoked LogValidationMsg Method");var t=!1;t=L(e);if(t===!0){var n=e.split(","),r=n[2].trim();switch(r){case"IsValidCallDate":H();break;case"AreProductsDetailed":D();break;case"IsValidPositionToSubmit":B();break;case"AreProdDetailedValid":j();break;case"ValidateReqFields":F();break;case"ValidateSampRefNum":I();break;case"IsCallDateInReconciled":q();break;case"IsValidSREProfType":R();break;case"AreSamplesRequestedValid":z();break;case"ArePromoItemsDroppedValid":W.call(this);break;case"IsLicenseExpired":et();break;case"IsValidLicenseNumber":tt();break;case"IsValidLicenseStatus":nt();break;case"IsValidProfProfile":ft();break;case"IsValidEmpToSample"
:Q.call(this);break;case"IsValidDEANumber":rt();break;case"IsDEAExpired":st();break;case"IsValidProfToSample":Y();break;case"AreSamplesDropped":lt();break;case"AreSamplesDroppedValid":ot();break;case"IsDetailingFeedbackSubmitted":X();break;default:}}},S}(),"SiebelAppFacade.PharmaCallValidatorsvc"}));
