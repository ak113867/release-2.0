/*<ORACLECOPYRIGHT>
* Copyright (C) 2008-2024
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
/* 24.2.0.0SIA[2024_02] */
function initCTIClientMgr(){gbInit==0?(CTILog(0,"m","initCTIClientMgr: running"),SiebelApp.CTIClientMgr.SetReady(!0),gbInit=!0,CTILog(0,"m","initCTIClientMgr: done")):CTILog(1,"m","initCTIClientMgr: did initialize before")}function DumpPS(e,t){if(!e)return;var n="";t+="   ",n=t+"Type: "+e.GetType()+"\n";var r=e.EnumProperties(!0);do r&&(sMsg=t+r+":"+e.GetProperty(r)+"\n",n+=sMsg);while(r=e.EnumProperties(!1));var i=e.EnumChildren(!0);do i&&(n+=DumpPS(i,t));while(i=e.EnumChildren(!1));return n+"\n"}function jsMAPtoPropSet(e,t){var n=CCFMiscUtil_CreatePropSet();for(var r in e)n.SetProperty(r,e[r]);return t!=null&&n.SetType(t),n}function jsArraytoPropSet(e,t,n){var r=CCFMiscUtil_CreatePropSet(),i;for(var s=0;s<e.length;s++)i=t+(s+1),r.SetProperty(i,e[s]);return n!=null&&r.SetType(n),r}function PStojsMAP(e){var t={},n=e.EnumProperties(!0);do n&&(t[n]=e.GetProperty(n));while(n=e.EnumProperties(!1));return t}function CTILog(e,t,n){var r;switch(t){case"c":r="Client";break;case"m":r="Manager";break;case"s":r="Service";break;case"d":r="Driver";break;default:r="Unknown"}var i="CTIClientMgr: "+r+": "+n;if(e<0||e>3)e=1;SiebelApp.S_App.CommToolbarUtil.Log(e,i)}typeof SiebelApp.S_App.CommToolbarItem=="undefined"&&(SiebelJS.Namespace("SiebelApp.S_App.CommToolbarItem"),SiebelApp.S_App.CommToolbarItem=function(){function e(e){this.m_type="",this.m_name="",this.m_id="",this.m_value="",this.m_prev_icon_class_suffix="",this.m_icon_class_suffix="",this.m_image="",this.m_imgd="",this.m_state="disabled",this.m_effect="",this.m_img_src=this.m_img,this.m_tooltipFromTools="",this.m_tooltip="",this.m_width=0,this.m_sequence=0,this.m_command="",this.m_dynamictooltipCmd="",this.m_bSticky=!1,this.m_index=0,this.m_bStatic=!1;var t=e.split(";"),n,r,i=t.length;for(var s=0;s<i;s++){var o=t[s],u=o.indexOf("=");if(u<0)continue;n=$.trim(o.substr(0,u)).toLowerCase(),r=$.trim(o.substr(u+1));switch(n){case"name":this.m_name=r,this.m_id=this.m_name.replace(/\s/g,"_");break;case"image":r.length>0&&(r=this.GetCommToolbar().GetURLBase()+this.GetCommToolbar().GetImageURL()+"/"+r),this.m_image=r;break;case"disabledimage":r.length>0&&(r=this.GetCommToolbar().GetURLBase()+this.GetCommToolbar().GetImageURL()+"/"+r),this.m_imgd=r;break;case"sequence":var a=r.split(".");this.m_iSeq=a[0],a.length>1&&(this.m_index=a[1]);break;case"reflection":this.m_bSticky=!0;break;case"type":this.m_type=r.toLowerCase();break;case"command":this.m_command=r;break;case"width":this.m_width=r;break;case"tooltip":this.m_tooltip=r,this.m_tooltipFromTools=this.m_tooltip;break;case"dynamictooltipcmd":this.m_dynamictooltipCmd=r;break;default:}}this.m_tooltip.length<=0&&(this.m_tooltip=this.m_name),this.m_imgd===this.m_image&&(this.m_bStatic=!0,this.m_image.length>0&&(this.m_prev_icon_class_suffix=this.m_icon_class_suffix,this.m_icon_class_suffix=this.m_image.slice(this.m_image.lastIndexOf("/")+1).replace(/\s+/g,"-").replace(/\./g,"_").toLowerCase()))}function t(e,t){SiebelApp.S_App.CommToolbarUtil.Log(e,"commToolbarItem.js: "+t)}return e.prototype.GetCommToolbar=function(){return SiebelApp.S_App.CommToolbar},e.prototype.SetEnabled=function(e){e.toLowerCase()==="true"?this.m_state="enabled":this.m_state="disabled",this.GetCommToolbar().UpdateHTMLControl(this,"state")},e.prototype.SetToggle=function(e){e.toLowerCase()==="true"?this.m_effect="toggled":this.m_effect="untoggled",this.GetCommToolbar().UpdateHTMLControl(this,"effect")},e.prototype.Blink=function(e){e.toLowerCase()==="true"?this.m_effect="blinking":this.m_effect="unblinking",this.GetCommToolbar().UpdateHTMLControl(this,"effect")},e.prototype.StartTimer=function(e,t){this.GetCommToolbar().UpdateHTMLControl(this,"starttimer",[e,t])},e.prototype.StopTimer=function(){this.GetCommToolbar().UpdateHTMLControl(this,"stoptimer")},e.prototype.SetTooltip=function(e){e.length>0?(this.m_tooltip=e,this.GetCommToolbar().UpdateHTMLControl(this,"changetooltip")):this.m_type==="edit"&&(this.m_tooltip=this.m_name,this.GetCommToolbar().UpdateHTMLControl(this,"changetooltip"))},e.prototype.ChangeValue=function(e){var n=[];switch(this.m_type){case"edit":this.m_value=e;break;case"combo box":n=e.split(",");var r=n.length;for(var i=0;i<r;i++)n[i]=$.trim(n[i]);n.length%2!==0&&e!==""&&t(1,"changeValue: got wrong format for control:"+this.m_name);break;case"button":var s=e.split(",");this.m_image=$.trim(s[0]),this.m_prev_icon_class_suffix=this.m_icon_class_suffix,this.m_image.length>0&&this.m_image.indexOf(this.GetCommToolbar().GetImageURL()+"/")<0?(this.m_icon_class_suffix=this.m_image.replace(/\s+/g,"-").replace(/\./g,"_").toLowerCase(),this.m_image=this.GetCommToolbar().GetURLBase()+this.GetCommToolbar().GetImageURL()+"/"+this.m_image):this.m_image.length>0?this.m_icon_class_suffix=this.m_image.slice(this.m_image.lastIndexOf("/")+1).replace(/\s+/g,"-").replace(/\./g,"_").toLowerCase():this.m_icon_class_suffix="",s[1]!==undefined&&(this.m_imgd=$.trim(s[1]),this.m_imgd.length>0&&this.m_imgd.indexOf(this.GetCommToolbar().GetImageURL()+"/")<0&&(this.m_imgd=this.GetCommToolbar().GetURLBase()+this.GetCommToolbar().GetImageURL()+"/"+this.m_imgd));break;default:return}this.GetCommToolbar().UpdateHTMLControl(this,"value",n)},e.prototype.TriggerEvent=function(e){this.GetCommToolbar().TriggerEvent(this.m_name,e)},e.prototype.ReplaceInfo=function(e){this.m_name=e.m_name,this.m_type=e.m_type,this.m_prev_icon_class_suffix=e.m_prev_icon_class_suffix,this.m_icon_class_suffix=e.m_icon_class_suffix,this.m_image=e.m_image,this.m_imgd=e.m_imgd,this.m_state=e.m_state,this.m_effect=e.m_effect,this.m_value=e.m_value,this.m_width=e.m_width,this.m_tooltipFromTools=e.m_tooltipFromTools,this.m_tooltip=e.m_tooltip,this.m_command=e.m_command,this.ChangeValue(this.m_image+","+this.m_imgd)},e}()),typeof SiebelAppFacade.CommToolbarPresentationModel=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.CommToolbarPresentationModel"),define("siebel/commToolbarpmodel",["siebel/pmodel"],function(){return SiebelAppFacade.CommToolbarPresentationModel=function(){function e
(e){SiebelAppFacade.CommToolbarPresentationModel.superclass.constructor.call(this,e)}return SiebelJS.Extend(e,SiebelAppFacade.PresentationModel),e.prototype.Init=function(){SiebelAppFacade.PresentationModel.superclass.Init.apply(this,arguments),this.AttachEventHandler("CommCommandBtnClicked",function(e,t,n){this.ExecuteMethod("InvokeCommandByItemName",e,t,n)}),this.AttachEventHandler("PreShow",function(){return this.ExecuteMethod("ParseParameters")}),this.AttachEventHandler("PostShow",function(){this.ExecuteMethod("InitCTIToolbar")}),this.AddProperty("InitFailed",!1)},e}(),"SiebelAppFacade.CommToolbarPresentationModel"})),typeof SiebelAppFacade.CommToolbarPhyRenderer=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.CommToolbarPhyRenderer"),define("siebel/commToolbarprender",["siebel/basephyrenderer"],function(){return SiebelAppFacade.CommToolbarPhyRenderer=function(){function r(e){SiebelAppFacade.CommToolbarPhyRenderer.superclass.constructor.call(this,e),this.m_toolbarUI=$(e.Get("GetPlaceholder")),this.m_focusEditBeforeClick="",this.m_sSelText="",this.m_curFocusEditName="",this.m_timerId=0,this.m_oldtitle="",this.m_mapOrderToName={},this.m_mapNameToOrder={},this.m_mouseupfromSelf=!1,this.m_bIsMakeCallPopupNeeded=e.Get("IsMakeCallPopupNeeded"),this.m_lastClickTime=0,this.m_EditPrevStatusMap={},this.m_EditBoxTextMap={},this.m_notificationMap={},this.m_iNotificationId=0}function i(){if($(this).data("hovered")||$(this).data("focused")){var e=$(this).attr("old-aria-label")!==undefined?$(this).attr("old-aria-label"):$(this).attr("aria-label");$(this).tooltip("enable").tooltip("open");var t=$(this).attr("aria-describedby"),n=$("#"+t).children().text();$(this).attr("aria-label",n).attr("old-aria-label",e),$(this).data("focused")&&($(this).triggerHandler("blur"),$(this).triggerHandler("focus")),window.status=n}}function s(t,n){var r=t.data.ctx,i=$(this).parent().next();i.css("display")==="none"?($(this).parent().siblings().has("div").hide().attr({"aria-hidden":"true","aria-expanded":"false"}).prev().children().attr("aria-label",e.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL")),i.show().removeAttr("aria-hidden"),$(this).attr("aria-label",e.GetLocalString("IDS_CTI_SIDEWAYBTN_HIDE_LABEL")).parent().next().attr("aria-expanded","true")):(i.hide().attr({"aria-hidden":"true","aria-expanded":"false"}),$(this).attr("aria-label",e.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL"))),r.m_focusEditBeforeClick!==""&&!n?r.m_toolbarUI.find("#"+r.m_focusEditBeforeClick.replace(/\s/g,"_")).focus():r.m_toolbarUI.hasClass("siebui-tb-cti-float")&&$(this).focus(),r.m_focusEditBeforeClick=""}function o(t,n){var r=t.data.ctx,i=r.GetPM(),s=$(this).attr("name");r.m_toolbarUI.hasClass("siebui-tb-cti-float")&&!$(this).hasClass("siebui-tb-cti-child-btn")&&$(this).focus();if($(this).hasClass("siebui-tb-cti-btn-img-enabled")){if((new Date).getTime()-r.m_lastClickTime<750){r.m_lastClickTime=(new Date).getTime();return}r.m_lastClickTime=(new Date).getTime();var o=r.GetCtrlData();o.SelText=r.m_sSelText,i.OnControlEvent("CommCommandBtnClicked",s,o,n),i.ExecuteMethod("ClearFocusInfo"),i.ExecuteMethod("ApplySticky",$(this).attr("name")),$(this).hasClass("siebui-tb-cti-child-btn")&&($(this).parent().parent().hide().attr({"aria-hidden":"true","aria-expanded":"false"}).prev().children().attr("aria-label",e.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL")),r.MoveTabIndex(!1,$(this).attr("id"),!0))}SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Clicking ["+$(this).attr("name")+"]")}function u(e,t){var n=e.data.ctx,r=n.GetPM(),i=$(this).attr("name"),s=n.GetCtrlData();s.SelText=n.m_sSelText,r.OnControlEvent("CommCommandBtnClicked",i,s,t),r.ExecuteMethod("ClearFocusInfo")}function a(e){var t=e.data.ctx,n=t.GetPM();t.m_sSelText=t.GetSelText(),t.m_focusEditBeforeClick=t.m_curFocusEditName,$(this).hasClass("siebui-tb-cti-btn-img-enabled")&&e.which===1&&$(this).addClass("commBtnClicked siebui-tb-cti-btn-img-clicked"),($(this).hasClass("siebui-tb-cti-parent-btn")||$(this).hasClass("siebui-tb-cti-child-btn")||$(this).hasClass("siebui-tb-cti-dropdown"))&&e.which===1&&n.ExecuteMethod("CollectFocusInfo")}function f(){$(this).removeClass("commBtnClicked siebui-tb-cti-btn-img-clicked")}function l(e){var t=e.data.ctx,n=t.GetPM();$(this).data("hovered",!0);var r=$(this).attr("name");n.ExecuteMethod("InvokeCommandToolTip",r,t.GetCtrlData(!0))}function c(){$(this).removeClass("commBtnClicked siebui-tb-cti-btn-img-clicked");if(!$(this).data("hovered"))return;$(this).data("hovered",!1),(!/msie|trident/.test(navigator.userAgent.toLowerCase())||!$(this).hasClass("siebui-tb-cti-dropdown"))&&$(this).tooltip("close").tooltip("disable");var e=$(this).attr("old-aria-label");e!==undefined&&$(this).attr("aria-label",e).removeAttr("old-aria-label")}function h(e){var t=e.data.ctx;if($(this).attr("tabindex")!=="0")return;switch(e.which){case $.ui.keyCode.RIGHT:$(this)[0].tagName.toUpperCase()!=="INPUT"&&(t.MoveTabIndex(!0,$(this).attr("id"),!0),e.preventDefault());break;case $.ui.keyCode.LEFT:$(this)[0].tagName.toUpperCase()!=="INPUT"&&(t.MoveTabIndex(!1,$(this).attr("id"),!0),e.preventDefault());break;case $.ui.keyCode.SPACE:case $.ui.keyCode.ENTER:$(this).trigger("click",[!0]),e.preventDefault();break;case $.ui.keyCode.TAB:$(this)[0].tagName.toUpperCase()==="INPUT"&&(e.shiftKey?t.MoveTabIndex(!1,$(this).attr("id"),!0):t.MoveTabIndex(!0,$(this).attr("id"),!0),e.preventDefault());break;default:}}function p(e){var t=e.data.ctx,n=$(this).attr("name"),r=t.m_EditBoxTextMap[n],i=$.trim($(this).val());t.m_EditBoxTextMap[n]=i,!r&&i?I.call(t,n,t.GetCtrlData(!0),!0,"text changed from empty to non empty"):r&&!i&&I.call(t,n,t.GetCtrlData(!0),!1,"text changed from non empty to empty")}function d(e){var t=e.data.ctx,n=t.GetPM();if(e.which===119){var r=$(this).attr("name");n.ExecuteMethod("InvokeCommandToolTip",r,t.GetCtrlData(),!0)}}function v(e){var t=e.data.ctx;$(this).data("focused",!1);var n=$(this).attr("name");if($(this).hasClass("siebui-tb-cti-edit-box")){t.m_curFocusEditName=""
;if($.trim($(this).val())){var r=t.GetCtrlData(!0);r.FocusEdit="",I.call(t,n,r,!1,"focus lost when non empty")}}$(this).removeClass("commFocused siebui-tb-cti-btn-img-focused");var i=$(this);setTimeout(function(){i.tooltip("close").tooltip("disable");var e=i.attr("old-aria-label");e!==undefined&&i.attr("aria-label",e).removeAttr("old-aria-label")},100)}function m(e){var t=e.data.ctx;$(this).data("focused",!0),$(this).hasClass("siebui-tb-cti-edit-box")&&(t.m_curFocusEditName=$(this).attr("name"),$.trim($(this).val())&&I.call(t,t.m_curFocusEditName,t.GetCtrlData(!0),!0,"focus gained when non empty")),t.m_toolbarUI.find(".siebui-tb-cti-btn-img-focused").removeClass("commFocused siebui-tb-cti-btn-img-focused"),t.FocusControl($(this)),$(this).addClass("commFocused siebui-tb-cti-btn-img-focused")}function g(e){var t=e.data.ctx;t.m_mouseupfromSelf=!0}function y(e){var t=e.data.ctx;$(this).text().length>0&&t.MakeCallToUIPhone($(this).text(),$(this),t.m_bIsMakeCallPopupNeeded)}function b(e){var t=e.data.ctx,n=$(this).prev().val();t.GetPM().ExecuteMethod("CallContactFromUIEnabled")&&t.MakeCallToUIPhone($(this).prev().val(),$(this),t.m_bIsMakeCallPopupNeeded)}function w(){this.m_timerId!==0&&(clearInterval(this.m_timerId),this.m_timerId=0,document.title=this.m_oldtitle)}function E(e){var t=e.data.ctx;w.call(t)}function S(e){var t;return e.m_effect==="toggled"&&e.m_name.indexOf("Agent State")!==-1?t="Change To Ready. Enabled.":e.m_state==="enabled"&&e.m_name.indexOf("Agent State")!==-1?t="Change To Not Ready. Enabled.":e.m_effect!==""?t=e.m_effect:t=e.m_state,utils.IsEmpty(e.m_tooltip)?e.m_name:e.m_tooltip+". "+t}function x(e){e.close(),e.autoClose=!0}function T(){var e=this.m_notificationMap;for(var t in e)e[t].close()}function N(e,r,i){var s=null;SiebelApp.SiebelNotification&&SiebelApp.SiebelNotification.permission==="granted"&&(s=new SiebelApp.SiebelNotification(this.m_oldtitle,{body:e,requireInteraction:!0,icon:r}));if(s===null)return;this.m_iNotificationId===t&&(this.m_iNotificationId=0),s.id=++this.m_iNotificationId,this.m_notificationMap[s.id]=s;var o=this;if(i)var u=setTimeout(function(){x(s)},n);s.onclose=function(){delete o.m_notificationMap[this.id],$.isEmptyObject(o.m_notificationMap)&&(o.m_iNotificationId=0),i&&(clearTimeout(u),s.autoClose===!0&&N.call(o,e,r,i))},s.onclick=function(){window.focus(),T.call(o)}}function A(e){var t=e.data.ctx;t.CtrlBtnOp(e.data.ctrlButton,"TOGGLE"),t.m_mouseupfromSelf=!0}function O(e){var t=e.data.ctx;e.which===$.ui.keyCode.ENTER&&t.CtrlBtnOp(e.data.ctrlButton,"TOGGLE")}function M(e){var t=e.data.ctx;t.CtrlBtnOp(e.data.ctrlButton,"FLOAT",e)}function _(e){var t=e.data.ctx;t.m_mouseupfromSelf===!1&&t.CtrlBtnOp(e.data.ctrlButton,"HIDDEN_FLOAT"),t.m_mouseupfromSelf=!1}function D(e){var t=$(e.target),n=t.attr("id");e.preventDefault(),n==="commPanelCTIToShowMore"?B(e,t):n==="commPanelCTIToShowLess"&&H(e,t)}function P(e){(e.which===$.ui.keyCode.ENTER||e.which===$.ui.keyCode.SPACE)&&D(e)}function H(e,t){var n=$("#CommunicationPanelContainer #commPanelCTIToShowMore"),r=$("#CommunicationPanelContainer #commPanelCTIToShowLess");if(n.length===0||r.length===0)return;var i=n.css("display")!=="none";if(i)return;n.show().attr("aria-hidden",!1),r.hide().attr("aria-hidden",!0),e&&t&&n.focus(),j(e)}function B(e,t){var n=$("#CommunicationPanelContainer #commPanelCTIToShowMore"),r=$("#CommunicationPanelContainer #commPanelCTIToShowLess");if(n.length===0||r.length===0)return;var i=r.css("display")!=="none";if(i)return;r.show().attr("aria-hidden",!1),n.hide().attr("aria-hidden",!0),e&&t&&r.focus(),j(e)}function j(e){var t=$("#CommunicationPanelContainer #CTIToolbar");t.length>0&&t.toggleClass("siebui-comm-panel-less"),F.call(e.data.ctx,"CTIToolbar: Toggle")}function F(e){$("#CommunicationPanelContainer").length>0&&$(window).trigger("resize.commpanel",e)}function I(e,t,n,r){if(this.m_EditPrevStatusMap[e]!==n){SiebelApp.S_App.CommToolbarUtil.Log(3,"Status Update for "+e+": "+r);var i=this.GetPM();i.ExecuteMethod("EditBoxStatusUpdate",e,t),i.ExecuteMethod("ClearFocusInfo"),this.m_EditPrevStatusMap[e]=n}}function q(){var t=$("#siebui-toolbar-toggle-communication-panel").find("li[name='Toggle Communication Panel']"),n;t.length>0&&!t.hasClass("siebui-toolbar-toggle-communication-panel-notification")&&(t.attr("data-initial-title")===undefined&&t.attr("data-initial-title",t.attr("title")),n=(t.attr("data-initial-title")||"")+e.GetLocalString("IDS_COMM_PANEL_NOTIFICATION"),t.addClass("siebui-toolbar-toggle-communication-panel-notification").attr("aria-label",n).attr("title",n))}var e=SiebelJS.Dependency("SiebelApp.S_App.LocaleObject"),t=5e3,n=3e3;SiebelJS.Extend(r,SiebelAppFacade.BasePR),r.prototype.Init=function(){SiebelAppFacade.CommToolbarPhyRenderer.superclass.Init.call(this),this.AttachPMBinding("ShowStatusText",this.ShowStatusText),this.AttachPMBinding("ShowMessageWithAlert",this.ShowMessageWithAlert),this.AttachPMBinding("TriggerEvent",this.TriggerEvent,{scope:this}),this.AttachPMBinding("PlaySound",this.PlaySound,{scope:this}),this.AttachPMBinding("UpdateHTMLControl",this.UpdateHTMLControl,{scope:this}),this.AttachPMBinding("DrawUsersAttention",this.DrawUsersAttention,{scope:this}),this.AttachPMBinding("BlinkParentBtn",this.BlinkParentBtn),this.AttachPMBinding("GotoCTIToolbar",this.GotoCTIToolbar,{scope:this}),this.AttachPMBinding("HideCTIToolbar",this.HideCTIToolbar,{scope:this}),this.AttachPMBinding("UpdateCallContactFromUI",this.UpdateCallContactFromUI),this.AttachPMBinding("OpenCallContactFromUIPopup",this.OpenCallContactFromUIPopup,{scope:this}),this.AttachPMBinding("NotifyCommPanel",q)},r.prototype.GetControljqObj=function(e){var t=$('<div role="presentation"></div>'),n,r;if(e===undefined)return t=$(),t;switch(e.m_type){case"button":var i=e.m_image;e.m_state==="disabled"&&(i=e.m_imgd),n=$("<span></span>"),n.attr({name:e.m_name,id:e.m_id,title:e.m_tooltip,alt:S(e),role:"button","aria-label":S(e),tabindex:"-1"}),r=$("<img>"),r.attr({src:i}),n.append(r),e.m_name.indexOf("Agent State"
)>=0&&n.attr("aria-pressed","false"),t.attr("id","CommBtn_"+e.m_id),e.m_name.indexOf("SidewayPopup")===0?(t.addClass("commSidewayBtnContainer siebui-tb-cti-sideway-poup-btn-container siebui-commbtn-enabled siebui-tb-cti-btn-enabled"),n.addClass("commSidewayBtn siebui-tb-cti-sideway-poup-btn commBtnEnabled siebui-tb-cti-btn-img-enabled")):(e.m_index!==0?(n.addClass("commSubBtn siebui-tb-cti-child-btn"),t.addClass("commSubBtnContainer siebui-tb-cti-child-btn-container")):(n.addClass("commTopBtn siebui-tb-cti-parent-btn"),t.addClass("commTopBtnContainer siebui-tb-cti-parent-btn-container")),e.m_state==="enabled"?(t.addClass("siebui-commbtn-enabled siebui-tb-cti-btn-enabled"),n.addClass("commBtnEnabled siebui-tb-cti-btn-img-enabled")):(t.addClass("siebui-commbtn-disabled siebui-tb-cti-btn-disabled"),n.addClass("siebui-tb-cti-btn-img-disabled"))),t.append(n),this.InjectAutomationAttr(e,n);break;case"edit":n=$("<input/>"),n.attr({id:e.m_id,name:e.m_name,title:e.m_tooltip,alt:utils.IsEmpty(e.m_tooltip)?e.m_name:e.m_tooltip,type:"text",value:e.m_value,style:"width: "+e.m_width*.7+"em",tabindex:"-1",role:"textbox","aria-label":utils.IsEmpty(e.m_tooltip)?e.m_name:e.m_tooltip}),n.addClass("commEdit siebui-tb-cti-edit-box"),t.attr("id","CommEdit_"+e.m_id),t.addClass("commEditContainer siebui-tb-cti-edit-box-container"),t.append(n),this.InjectAutomationAttr(e,n);break;case"combo box":n=$("<select></select>"),n.attr({id:e.m_id,name:e.m_name,title:e.m_tooltip,style:"width: "+e.m_width*.7+"em",tabindex:"-1",role:"combobox","aria-label":utils.IsEmpty(e.m_tooltip)?e.m_name:e.m_tooltip}),n.addClass("commCombo siebui-tb-cti-dropdown"),t.attr("id","CommCombo_"+e.m_id),t.addClass("commComboContainer siebui-tb-cti-dropdown-container"),t.append(n),this.InjectAutomationAttr(e,n);break;case"separator":n=$("<span></span>"),n.attr({id:e.m_id,role:"separator"}),n.addClass("commSep siebui-tb-cti-separator"),t.attr("id","CommSep_"+e.m_id),t.addClass("commSepContainer siebui-tb-cti-separator-container"),t.append(n);break;case"timer":n=$("<span></span>"),n.text("00:00:00"),n.attr({id:e.m_id,name:e.m_name,tabindex:"-1",role:"timer","aria-label":utils.IsEmpty(e.m_tooltip)?e.m_name:e.m_tooltip}),n.addClass("commTimerSpan siebui-tb-cti-timer"),t.attr("id","CommTimer_"+e.m_id),t.addClass("commTimerContainer siebui-tb-cti-timer-container"),t.append(n),this.InjectAutomationAttr(e,n);break;default:t=$()}return t.attr("id")!==""&&e.m_name!==""&&t.addClass("siebui-tb-cti-item-"+e.m_name.replace(/\s+/g,"-").toLowerCase()),t},r.prototype.InjectAutomationAttr=function(e,t){this.GetPM().Get("IsAutomationEnabled")&&t.attr({rn:e.m_name,un:e.m_id,ot:e.m_type})},r.prototype.ShowUI=function(){if(!SiebelApp.S_App.CommToolbarUtil.IsDeviceSupported()){var t=$("#s_toolbar").find("[name='Toggle CTI Toolbar']");t.length>0&&t.addClass("hidden"),SiebelApp.S_App.CommToolbarUtil.LogMsg(0,"Disable CTI for non-windows device in ShowUI");return}SiebelAppFacade.CommToolbarPhyRenderer.superclass.ShowUI.call(this);var n=$("#CommunicationPanelContainer #CTIToolbar"),r=null,i=null,s=null,o="",u="",a=utils.IsTrue(SiebelApp.S_App.IsAutoOn()),f=consts.get("SWE_PROP_AUTOM_OT"),l=consts.get("SWE_PROP_AUTOM_RN"),c=consts.get("SWE_PROP_AUTOM_UN");n.length>0&&(n.addClass("siebui-tb-cti-container"),r=n.find("#commPanelCTIToggle"),r.length>0&&(s=r.find("#commPanelCTIToShowMore"),i=r.find("#commPanelCTIToShowLess"),s.length>0&&(o=e.GetLocalString("IDS_COMM_PANEL_TOGGLE_SHOW_MORE"),s.parent("div").attr("title",o),s.attr("aria-label",o),a&&s.attr(f,"button").attr(l,"commPanelCTIShowMore").attr(c,o)),i.length>0&&(u=e.GetLocalString("IDS_COMM_PANEL_TOGGLE_SHOW_LESS"),i.parent("div").attr("title",u),i.attr("aria-label",u),a&&i.attr(f,"button").attr(l,"commPanelCTIShowLess").attr(c,u))));var h=null,p=null,d=0,v=this.GetPM();if(!v.OnControlEvent("PreShow"))return;var m=v.Get("GetPopSidewayCtrl"),g=m.m_name,y=0,b=v.Get("GetTopControlNum"),w=v.Get("GetTopCtrlsSeqMap"),E=v.Get("GetSubCtrlsSeqMap"),S,x=$("<div></div>"),T,N=!0,C=0;this.m_toolbarUI.attr({role:"toolbar","aria-label":e.GetLocalString("IDS_CTI_TOOLBAR_TITLE"),"aria-expanded":"true"}).parent().attr({role:"navigation","aria-label":e.GetLocalString("IDS_CTI_TOOLBAR_REGION_LABEL")});for(var k=1;k<=b;k++){h=w[k];if(h!==undefined){T=this.GetControljqObj(h),N&&(T.children().attr("tabindex","0"),N=!1),x.append(T),h.m_type!=="separator"&&(this.m_mapNameToOrder[h.m_id]=C,this.m_mapOrderToName[C++]=h.m_id),S=E[k],S===undefined?d=0:d=E[k].length-1;if(d>0){m.m_id=g+y++,T=this.GetControljqObj(m),T.children().attr("aria-label",e.GetLocalString("IDS_CTI_SIDEWAYBTN_SHOW_LABEL")),x.append(T),this.m_mapNameToOrder[m.m_id]=C,this.m_mapOrderToName[C++]=m.m_id;var L=$("<div></div>");L.attr("id","SubCmdOf"+h.m_id),L.attr("role","group"),L.addClass("commSubCmdContainer siebui-tb-cti-btn-group-container");for(var A=1;A<=d;A++)p=S[A],L.append(this.GetControljqObj(p)),this.m_mapNameToOrder[p.m_id]=C,this.m_mapOrderToName[C++]=p.m_id;L.hide().attr({"aria-hidden":"true","aria-expanded":"false"}),x.append(L)}}}this.m_toolbarUI.hide().append(x.contents()).show().find(".siebui-tb-cti-parent-btn, .siebui-tb-cti-child-btn, .siebui-tb-cti-sideway-poup-btn, .siebui-tb-cti-timer, .siebui-tb-cti-edit-box, .siebui-tb-cti-dropdown").tooltip({position:{my:"left top",at:"right bottom+5",collision:"flipfit"},tooltipClass:"siebui-tooltip-cti",show:null,hide:null}).tooltip("disable"),F.call(this,"CTIToolbar: ShowUI"),SiebelApp.SiebelNotification?SiebelApp.SiebelNotification.requestPermission(function(e){}):SiebelApp.S_App.CommToolbarUtil.LogMsg(2,"Siebel notification is not supported.")},r.prototype.CollectComboValue=function(){var e={};return $(".siebui-tb-cti-dropdown").each(function(){var t=$(this).attr("name"),n=$(this).find(":selected");n.length>0?e[t]=n.val():e[t]=""}),e},r.prototype.CollectEditText=function(){var e={};return $(".siebui-tb-cti-edit-box").each(function(){var t=$(this).attr("name"),n=$(this).val();n=n.replace(/\s/g,""),e[t]=n}),e},r.prototype
.GetFocusEditName=function(e){if(e){var t=document.activeElement.id;return t!==""?$("#"+t.replace(/\s/g,"\\ ")).attr("name"):""}return this.m_focusEditBeforeClick},r.prototype.GetSelText=function(){var e="";try{if(window.getSelection)if(document.activeElement&&document.activeElement.tagName&&(document.activeElement.tagName.toLowerCase()==="textarea"||document.activeElement.tagName.toLowerCase()==="input")){var t=document.activeElement.value;e=t.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var n=window.getSelection();e=n.toString()}else if(document.selection&&document.selection.createRange){var r=document.selection.createRange();e=r.text}}catch(i){SiebelApp.S_App.CommToolbarUtil.Log(3,"commToolbarprender.js: get selected text failed!")}return e},r.prototype.GetCtrlData=function(e){return{ComboValue:this.CollectComboValue(),EditText:this.CollectEditText(),FocusEdit:this.GetFocusEditName(e),SelText:this.GetSelText()}},r.prototype.BindEvents=function(){if(!SiebelApp.S_App.CommToolbarUtil.IsDeviceSupported()){SiebelApp.S_App.CommToolbarUtil.LogMsg(0,"Disable CTI for non-windows device in BindEvents");return}SiebelAppFacade.CommToolbarPhyRenderer.superclass.BindEvents.call(this);var e=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(!e)return;var t=".siebui-tb-cti-parent-btn, .siebui-tb-cti-child-btn, .siebui-tb-cti-sideway-poup-btn, .siebui-tb-cti-timer, .siebui-tb-cti-edit-box, .siebui-tb-cti-dropdown",n=".siebui-tb-cti-parent-btn, .siebui-tb-cti-child-btn, .siebui-tb-cti-sideway-poup-btn, .siebui-tb-cti-dropdown, .siebui-tb-cti-timer",r=this.m_toolbarUI;e.Manage(r,"ShowTooltipEvt",{},i,t).Manage(r,"click",{ctx:this},s,".siebui-tb-cti-sideway-poup-btn").Manage(r,"click",{ctx:this},o,".siebui-tb-cti-parent-btn, .siebui-tb-cti-child-btn").Manage(r,"change",{ctx:this},u,".siebui-tb-cti-dropdown").Manage(r,"down",{ctx:this},a,n).Manage(r,"up",{ctx:this},f,n).Manage(r,"over",{ctx:this},l,t).Manage(r,"out",{ctx:this},c,t).Manage(r,"keydown",{ctx:this},h,"[tabindex]").Manage(r,"keyup",{ctx:this},p,".siebui-tb-cti-edit-box").Manage(r,"keypress",{ctx:this},d,n).Manage(r,"blur",{ctx:this},v,t).Manage(r,"focus",{ctx:this},m,t).Manage(r,"up",{ctx:this},g);var w=$("#s_toolbar").find("[name='Toggle CTI Toolbar']");w.length>0&&this.RegisterControlBtn(w),e.Manage($("#_sweview, #SiebMainView"),"click",{ctx:this},y,".siebui-ctrl-link-call-from-ui-enabled").Manage($("#_sweview, #SiebMainView"),"click",{ctx:this},b,".siebui-icon-phone-outbound").Manage($(document),"up",{ctx:this},E).Manage($(document),"keydown",{ctx:this},E);var S=$("#CommunicationPanelContainer #commPanelCTIToggle");S.length>0&&(e.Manage(S,"click",{ctx:this},D),e.Manage(S,"keydown",{ctx:this},P))},r.prototype.BindData=function(){if(!SiebelApp.S_App.CommToolbarUtil.IsDeviceSupported()){SiebelApp.S_App.CommToolbarUtil.LogMsg(0,"Disable CTI for non-windows device in BindData");return}SiebelAppFacade.CommToolbarPhyRenderer.superclass.BindData.call(this),this.GetPM().OnControlEvent("PostShow")},r.prototype.MakeCallToUIPhone=function(t,n,r){var i=this.GetPM(),s=this,o;if(r){var u=$("#comm_makecall_popup");u.length<=0&&(u=$('<div id="comm_makecall_popup"></div>'),u.append("<div id='comm_makecall_popup_content' class='siebui-popup-cti-call-from-ui-text'></div>"));if(t.length<=0&&u.hasClass("ui-dialog-content"))u.dialog("close");else{var a=[{text:e.GetLocalString("IDS_CTI_CALL"),id:"ctiCallBtn",click:function(){i.ExecuteMethod("CallContactFromUI",t,s.GetCtrlData()),SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Make Call to phone number ["+t+"]"),$(this).dialog("close"),n.focus()}}];SiebelApp.S_App.GetDirection()?o={my:"right top",at:"left-10 bottom",of:n}:o={my:"left top",at:"right+10 bottom",of:n},u.dialog({title:e.GetLocalString("IDS_CTI_PHONE_LABEL"),buttons:a,position:o,dialogClass:"commMakeCallFromUIPopup siebui-popup-cti-call-from-ui",close:function(){n.focus()}}),$("#comm_makecall_popup_content").html(t),u.parent().find(".ui-dialog-titlebar-close").attr("title",e.GetLocalString("IDS_MSG_CLOSE"));if(utils.IsTrue(SiebelApp.S_App.IsAutoOn())){var f=u.parent().find(".ui-dialog-titlebar-close");f.length>0&&f.attr({ot:"button",rn:"PopupClose",un:"PopupClose"});var l=u.parent().find("#ctiCallBtn");l.length>0&&l.attr({ot:"button",rn:"CTICall",un:e.GetLocalString("IDS_CTI_CALL")})}}}else t.length>0&&(i.ExecuteMethod("CallContactFromUI",t,this.GetCtrlData()),SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Make Call to phone number ["+t+"]"))},r.prototype.TriggerEvent=function(e,t){var n=e.replace(/\s/g,"\\ ");this.m_toolbarUI.find("#"+n).trigger(t)},r.prototype.RefreshControl=function(e,t){var n=e.m_id,r,i=this.m_toolbarUI.find("#"+n),s;if(i.length<=0)return;if(e.m_type==="button"){s=i.find("img");if(t==="state"){r=s.attr("src");if(r!=="")switch(e.m_state){case"enabled":r=e.m_image,s.attr("src",r),i.addClass("commBtnEnabled siebui-tb-cti-btn-img-enabled").removeClass("siebui-tb-cti-btn-img-disabled").removeAttr("aria-disabled").parent().addClass("siebui-commbtn-enabled siebui-tb-cti-btn-enabled").removeClass("siebui-commbtn-disabled siebui-tb-cti-btn-disabled"),SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Enabled ["+e.m_name+"]");break;case"disabled":r=e.m_imgd,r&&s.attr("src",r),i.addClass("siebui-tb-cti-btn-img-disabled").removeClass("commBtnEnabled siebui-tb-cti-btn-img-enabled").attr("aria-disabled","true").parent().removeClass("siebui-commbtn-enabled siebui-tb-cti-btn-enabled").addClass("siebui-commbtn-disabled siebui-tb-cti-btn-disabled")}i.attr({alt:S(e),"aria-label":S(e)}).removeAttr("old-aria-label")}else if(t==="effect"){r=s.attr("src");if(r!=="")switch(e.m_effect){case"toggled":i.addClass("commBtnToggled siebui-tb-cti-btn-img-toggled").attr("aria-pressed","true").parent();break;case"untoggled":e.m_effect="",i.removeClass("commBtnToggled siebui-tb-cti-btn-img-toggled").parent(),i.attr("aria-pressed")!==undefined&&i.attr("aria-pressed","false");break;case"blinking":i.addEffectForCommToolbar("blink"
),SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Blinking ["+e.m_name+"]");break;case"unblinking":e.m_effect="",i.addEffectForCommToolbar("stopblink"),n.indexOf("Accept_Work")>=0&&T.call(this)}i.attr({alt:S(e),"aria-label":S(e)}).removeAttr("old-aria-label")}else t==="value"&&(e.m_bStatic?(r=e.m_image,e.m_prev_icon_class_suffix!==""&&i.removeClass("siebui-tb-cti-btn-icon-"+e.m_prev_icon_class_suffix),e.m_icon_class_suffix!==""&&i.addClass("siebui-tb-cti-btn-icon-"+e.m_icon_class_suffix)):e.m_state==="enabled"?r=e.m_image:r=e.m_imgd,r===""?(s.attr("src",r),i.hide(),i.attr("tabindex")==="0"&&this.FocusControl(this.m_toolbarUI.find('img[tabindex][aria-disabled!="true"]:visible').first()),i.attr("aria-hidden","true")):(s.attr("src",r),i.show().removeAttr("aria-hidden")))}t==="tooltip"&&i.tooltip("enable").attr("title",e.m_tooltip).tooltip("disable").trigger("ShowTooltipEvt")},r.prototype.MoveTabIndex=function(e,t,n){var r,i;r=this.m_mapNameToOrder[t],e?i=this.m_mapOrderToName[++r]:i=this.m_mapOrderToName[--r];while(i!==undefined&&($("#"+i).hasClass("siebui-tb-cti-child-btn")&&$("#"+i).parent().parent().css("display")==="none"||$("#"+i).css("display")==="none"))e?++r:--r,i=this.m_mapOrderToName[r];return i===undefined?!1:($("#"+t).attr("tabindex","-1"),$("#"+i).attr("tabindex","0"),n&&$("#"+i).focus(),!0)},r.prototype.FocusControl=function(e){this.m_toolbarUI.find('[tabindex="0"]').attr("tabindex","-1"),e.attr("tabindex","0")},r.prototype.UpdateHTMLControl=function(e,t,n){if(e===undefined||t==="")return;var r=e.m_id;switch(t){case"state":this.RefreshControl(e,"state");break;case"effect":this.RefreshControl(e,"effect");break;case"value":switch(e.m_type){case"edit":this.m_toolbarUI.find("#"+r).attr("value",e.m_value);break;case"combo box":this.m_toolbarUI.find("#"+r).empty();for(var i=0;i<n.length;i+=2)if(i+1<n.length){var s=$("<option></option>");s.append(n[i]).attr({value:n[i+1],role:"option"}),this.m_toolbarUI.find("#"+r).append(s)}break;case"button":this.RefreshControl(e,"value");break;default:}break;case"starttimer":this.m_toolbarUI.find("#"+r).addEffectForCommToolbar("starttimer",{driverTime:n[0],serverTime:n[1]});break;case"stoptimer":this.m_toolbarUI.find("#"+r).addEffectForCommToolbar("stoptimer");break;case"changetooltip":this.RefreshControl(e,"tooltip");break;case"":break;default:}},r.prototype.ShowStatusText=function(e,t){window.status=e;var n=$("#CommunicationPanelContainer #CommPanelMessageCTI");n.length===0&&(n=$("#MsgLayer"));if(n.length>0){var r=n.attr("timerid");r>0&&clearTimeout(r);if(e.length>75){var i=e;e=e.substr(0,75)+"...",n.html('<span id="MessageSpan" class="CommStatusMessage siebui-tb-cti-status-msg" title="'+i+'" role="alert">'+e+"</span>")}else n.html('<span id="MessageSpan" class="CommStatusMessage siebui-tb-cti-status-msg" role="alert">'+e+"</span>");this.GetPM().Get("InitFailed")||(r=setTimeout(function(){n.html("")},t),n.attr("timerid",r))}},r.prototype.ShowMessageWithAlert=function(e){utils.Alert(e)},r.prototype.DrawUsersAttention=function(e){if(this.m_timerId===0){this.m_oldtitle=document.title;var t=this.m_oldtitle,n=0;this.m_timerId=setInterval(function(){n%2===1?document.title=e:document.title=t,n++},1e3)}if(!document.hasFocus()){var r=$("<img/>");/msie|trident/.test(navigator.userAgent.toLowerCase())?r[0].src="images/icon_cti_web_notification_ie.png":r[0].src="images/icon_cti_web_notification.png",N.call(this,e,r[0].src,/firefox/.test(navigator.userAgent.toLowerCase()))}},r.prototype.PlaySound=function(e){this.m_toolbarUI.find("#CommSounderWrapper").length>0?this.m_toolbarUI.find("#CommSounderWrapper").empty():this.m_toolbarUI.append('<div id="CommSounderWrapper" style="visibility:hidden" aria-hidden="true"></div>'),this.m_toolbarUI.find("#CommSounderWrapper").append('<audio autoplay src="'+e+'"></audio>')};var C,k,L={DOCK:{next_status:["HIDDEN"],status_func:function(e,t){t.removeClass("floatToolbar siebui-tb-cti-float"),t.removeClass("siebui-no-display"),e.isBlink===!0&&(e.isBlink=!1,e.addEffectForCommToolbar("stopblink")),t.data("uiDraggable")!==undefined&&t.draggable("option","disabled",!0),t.attr("aria-expanded","true").removeAttr("aria-hidden").removeAttr("aria-disabled")}},HIDDEN:{next_status:["DOCK","FLOAT"],status_func:function(e,t){t.hasClass("siebui-tb-cti-float")&&(C=t.offset(),t.removeClass("floatToolbar siebui-tb-cti-float")),t.addClass("siebui-no-display"),e.isBlink===!0&&e.addEffectForCommToolbar("blink"),t.attr({"aria-expanded":"false","aria-hidden":"true"})}},FLOAT:{next_status:["DOCK","HIDDEN"],status_func:function(e,t,n){t.removeClass("siebui-no-display"),t.addClass("floatToolbar siebui-tb-cti-float"),t.data("uiDraggable")===undefined?(t.position({my:"left top",at:"right bottom",of:e,collision:"flipfit"}),$.ui.ddmanager&&($.ui.ddmanager.dragStart===undefined&&($.ui.ddmanager.dragStart=function(){}),$.ui.ddmanager.dragStop===undefined&&($.ui.ddmanager.dragStop=function(){})),t.draggable({containment:"window"}),navigator.appName.indexOf("Microsoft")<0&&t.mousedown(function(){if(e.status==="FLOAT"){var n=t.find('[tabindex="0"]').attr("id"),r=t.find(".siebui-tb-cti-edit-box");r.length>0&&r.first().focus().blur(),$("#"+n).hasClass("siebui-tb-cti-edit-box")||t.find("#"+n).focus()}})):(t.offset(C),t.draggable("option","disabled",!1)),e.isBlink===!0&&(e.isBlink=!1,e.addEffectForCommToolbar("stopblink")),t.attr("aria-expanded","true").removeAttr("aria-hidden").removeAttr("aria-disabled")}},UNKNOWN:{next_status:[],stauts_func:undefined}};return r.prototype.CtrlBtnOp=function(e,t,n){var r=$(SiebelApp.S_App.CommToolbar.GetPlaceholder());e.status===undefined&&(r.css("display")==="block"?e.status="DOCK":r.css("display")==="none"?e.status="HIDDEN":(SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: toolbar control display is: "+r.css("display")),e.status="UNKNOWN"));var i=t;if(i==="TOGGLE")e.status==="DOCK"?i="HIDDEN":i="DOCK";else if(i==="HIDDEN_FLOAT"){if(e.status!=="FLOAT")return;i="HIDDEN"}var s=L[e.status];if(s==="undefined"){SiebelApp.S_App
.CommToolbarUtil.Log(2,"commToolbarprender.js: unknown toolbar status: "+s);return}var o=s.next_status;for(var u=0,a=o.length;u<a;u++){var f=o[u];if(f===i){e.status=i;var l=L[i];l.status_func(e,r,n);return}}},r.prototype.BlinkParentBtn=function(){if(k===undefined||k.status===undefined)return;k.status==="HIDDEN"&&(k.isBlink=!0,k.addEffectForCommToolbar("blink"))},r.prototype.StopBlinkCtrlBtn=function(){if(k===undefined)return;k.isBlink=!1,k.status!=="Dock"&&k.addEffectForCommToolbar("stopblink")},r.prototype.RegisterControlBtn=function(e){k=e;if(k.length===0)return;var t=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(!t)return;t.Manage(e,"up",{ctx:this,ctrlButton:k},A).Manage(e,"keydown",{ctx:this,ctrlButton:k},O).Manage(e,"over",{ctx:this,ctrlButton:k},M).Manage($(document),"up",{ctx:this,ctrlButton:k},_)},r.prototype.GotoCTIToolbar=function(){this.m_toolbarUI.find('[tabindex="0"]').focus()},r.prototype.HideCTIToolbar=function(){this.m_toolbarUI.addClass("forcehide"),$("#CommunicationPanelContainer").find("#CommPanelHeaderCTI").addClass("forcehide"),$("#CommunicationPanelContainer").find("#SS_ChatUI").addClass("forcehide")},r.prototype.UpdateCallContactFromUI=function(e){if(e)$(".siebui-ctrl-link-call-from-ui-disabled").removeClass("siebui-call-from-ui-disabled siebui-ctrl-link-call-from-ui-disabled").addClass("siebui-call-from-ui-enabled siebui-ctrl-link-call-from-ui-enabled");else{$(".siebui-ctrl-link-call-from-ui-enabled").removeClass("siebui-call-from-ui-enabled siebui-ctrl-link-call-from-ui-enabled").addClass("siebui-call-from-ui-disabled siebui-ctrl-link-call-from-ui-disabled");try{var t=$("#comm_makecall_popup");t.length>0&&t.dialog("close")}catch(n){SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: "+n)}}},r.prototype.OpenCallContactFromUIPopup=function(e,t){try{var n=$("input[name='"+t+"']");if(this.m_bIsMakeCallPopupNeeded)if(e.length>0)n.length===0&&(n=$(":focus").first()),n.length>0&&this.MakeCallToUIPhone(e,n,!0);else{var r=$("#comm_makecall_popup");r.length>0&&r.dialog("close")}else e.length>0&&this.MakeCallToUIPhone(e)}catch(i){SiebelApp.S_App.CommToolbarUtil.Log(2,"commToolbarprender.js: "+i)}},function(e){function t(e){var t=Math.floor(e/1e3),n=Math.floor(t/3600);t-=n*3600;var r=Math.floor(t/60);return t-=r*60,n<10&&(n="0"+n),r<10&&(r="0"+r),t<10&&(t="0"+t),n+":"+r+":"+t}var n={blink:function(t){var n={delay:500,opacity:1},r=e.extend(n,t);return this.each(function(){var t=e(this);t.attr("timerid")>0&&clearInterval(t.attr("timerid"));var n=setInterval(function(){t.css("opacity")==="1"?t.animate({opacity:0},r.delay/2,"",function(){t.attr("timerid")==="0"&&t.css("opacity",r.opacity===1?1:0)}):t.animate({opacity:1},r.delay/2)},r.delay);t.attr("timerid",n)})},stopblink:function(t){var n={opacity:1},r=e.extend(n,t);return this.each(function(){var t=e(this);t.attr("timerid")>0&&(clearInterval(t.attr("timerid")),t.attr("timerid",0),t.stop(),t.removeAttr("style"))})},starttimer:function(n){var r={delay:1e3},i=e.extend(r,n);return this.each(function(){var n=e(this),r=i.driverTime*1e3,s=i.serverTime*1e3,o=new Date,u=(new Date).getTime()-o.getTime()+s-r;n.text(t(u)),n.attr("timerid")>0&&clearInterval(n.attr("timerid"));var a=setInterval(function(){u=(new Date).getTime()-o.getTime()+s-r,n.text(t(u))},i.delay);n.attr("timerid",a)})},stoptimer:function(){return this.each(function(){var t=e(this);t.text("00:00:00"),t.attr("timerid")>0&&(clearInterval(t.attr("timerid")),t.attr("timerid",0))})}};e.fn.addEffectForCommToolbar=function(e){if(n[e])return n[e].apply(this,Array.prototype.slice.call(arguments,1))}}(jQuery),r}(),"SiebelAppFacade.CommToolbarPhyRenderer"})),typeof SiebelApp.S_App.CommToolbar=="undefined"&&(SiebelJS.Namespace("SiebelApp.S_App.CommToolbar"),SiebelApp.S_App.CommToolbar=function(){function B(){var e;return B=function(){return e},B.prototype=this,e=new B,e.constructor=B,e}function j(e){var t=/^\+{0,1}\d*$/;return t.test(e)}function F(e){var t=r[e];return t===undefined&&(t=i[e]),t}function I(e,t){var n={FromCTIToolBar:"true"},s=!1,o={};$.extend(o,r,i);for(var u in o)if(o.hasOwnProperty(u)){var a=o[u];if(a.m_type==="edit")s=!1,e.FocusEdit===u&&(s=!0),e.EditText!==undefined&&e.EditText[u]!==undefined&&(n[u]=e.EditText[u],n[u+"_HasFocus"]=t||s?"true":"false");else if(a.m_type==="combo box"&&e.ComboValue!==undefined){var f=e.ComboValue[u];f!==undefined&&f.length>0&&(n[u]=f)}}var l=e.SelText;l!==undefined&&l.length>0&&(n.SelectedText=l);var c;T===null||t?c=z():c=T;var h=c.BusComp,p=c.Field;return h!==undefined&&h.length>0&&(n.FocusBusComp=h,p!==undefined&&p.length>0&&(n.FocusField=p)),n.refID=SiebelApp.S_App.CommToolbarUtil.GetRefId(),n}function q(e,t){return e!==undefined?!0:(V(2,"Control not found : "+t),!1)}function R(e,t,n){for(var r=0;r<n.length;r++)e[n[r]]=t.GetProperty(n[r])}function U(e){return e!==null&&e!==undefined}function z(){var e={BusComp:"",Field:""},t=App(),n,r,i,s,o;return t===undefined||t===null?(V(2,"App() failed!"),e):(n=t.GetMainView(),n===undefined||n===null?(V(2,"Get no main view!"),e):(r=n.GetActiveApplet(),r===undefined||r===null?(V(2,"No active applet found!"),e):(i=r.GetBusComp(),i===undefined||i===null?V(2,"No BC found for current active applet !"):e.BusComp=i.GetName(),s=r.GetActiveControl(),s===undefined||s===null?V(3,"No active control found for current active applet!"):(o=s.GetFieldName(),e.Field=o),e)))}function W(){return a===!1?!0:SiebelApp.S_App.CommToolbarUtil.ImplicitSave()}function X(){return SiebelApp.S_App.GetPopupPM().Get("state")===e.get("POPUP_STATE_VISIBLE")?!0:!1}function V(e,t){SiebelApp.S_App.CommToolbarUtil.Log(e,"commToolbarpui.js: "+t)}function J(){var e=3,t=!0;SiebelApp.S_App.CommToolbarUtil.SetLogLevel(e),k=t}function K(e,t){var n=SiebelAppFacade.ComponentMgr.FindComponent({id:"Search Results Pane Applet"});if(!n){V(1,"Failed at invoking Search Pane, Search component unavailable! ");return}var r=CCFMiscUtil_CreatePropSet(),i=CCFMiscUtil_CreatePropSet(),s=CCFMiscUtil_CreatePropSet();V(3,"Passing search data pairs as following to search method:"
),r.SetProperty("bcDisplayName",e);for(var o in t)if(t.hasOwnProperty(o)){var u=t[o];s.SetProperty(o,u),V(3,o+": "+u)}r.AddChild(s),V(0,"Invoke ExposedOpenSearchPanel for "+e),SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] Invoke ExposedOpenSearchPanel for ["+e+"]"),n.ExecuteMethod("ExposedOpenSearchPanel",r,i)}var e=SiebelJS.Dependency("SiebelApp.Constants"),t,n={},r={},i={},s={},o=0,u=null,a=!1,f="7000",l="CTI Message",c=[],h=0,p,d=!1,v,m,g=!1,y=!1,b=0,w=0,E="",S="",x={},T=null,N="",C=!1,k=!0,L=!1,A="",O=0,M=3,_=!1,D=0,P=5,H=0;return B.prototype.SetPModel=function(e){t=e},B.prototype.GetPModel=function(){return t},B.prototype.GetName=function(){return e.get("SWE_PST_COMM_TOOLBAR")},B.prototype.GetPropArray=function(){return["GetTopControlNum","GetTopCtrlsSeqMap","GetSubCtrlsSeqMap","GetPopSidewayCtrl","GetPlaceholder","GetBackgroundColor","IsMakeCallPopupNeeded","IsAutomationEnabled"]},B.prototype.GetMethodArray=function(){return["InvokeCommandByItemName","InvokeCommandToolTip","ShowPreviousMessage","ShowNextMessage","ShowStatusText","ShowMessageWithAlert","PlaySound","UpdateHTMLControl","TriggerEvent","ApplySticky","DrawUsersAttention","BlinkParentBtn","GotoCTIToolbar","HideCTIToolbar","CollectFocusInfo","ClearFocusInfo","CallContactFromUI","UpdateCallContactFromUI","OpenCallContactFromUIPopup","EditBoxStatusUpdate","CallContactFromUIEnabled","HandleGotoCTIToolbar","ParseParameters","InitCTIToolbar","NotifyCommPanel"]},B.prototype.Init=function(){var e=this.GetParamFromHiddenTag();return this.ProcessObjectInfo(e)?!0:!1},B.prototype.HandleGotoCTIToolbar=function(){return this.GotoCTIToolbar(),!0},B.prototype.GetTopControlNum=function(){return o},B.prototype.GetTopCtrlsSeqMap=function(){return n},B.prototype.GetSubCtrlsSeqMap=function(){return s},B.prototype.GetPopSidewayCtrl=function(){return r.SidewayPopup},B.prototype.GetPlaceholder=function(){return".siebui-tb-cti"},B.prototype.GetBackgroundColor=function(){return this.GetParameter("BGColor")},B.prototype.GetImageURL=function(){return this.GetParameter("ImageURL")},B.prototype.GetURLBase=function(){return this.GetParameter("URLBase")},B.prototype.IsMakeCallPopupNeeded=function(){return k},B.prototype.IsAutomationEnabled=function(){return L},B.prototype.ParseParameters=function(){if($(this.GetPlaceholder()).length<=0)return V(1,"No place holder for CTI toolbar!"),!1;try{return J(),V(0,"CTI toolbar: INIT.begin"),this.Init()?!0:(V(1,"Init process failed!"),!1)}catch(e){return V(1,"Init process failed!"),!1}},B.prototype.InitCTIToolbar=function(){try{SiebelApp.S_App.CommToolbarUtil.InitShellUI(),V(0,"CTI toolbar: INIT.end")}catch(e){V(1,"Init process failed!")}},B.prototype.GetParamFromHiddenTag=function(){var e=new JSSPropertySet;return $(this.GetPlaceholder()).children("input").each(function(){var t=$(this);e.SetProperty(t.attr("name"),t.attr("value")),t.attr("aria-hidden","true")}),e},B.prototype.ProcessObjectInfo=function(e){u=e;var t=this.GetParameter("AutomationEnabled");return t!==undefined&&t.toLowerCase()==="true"&&(L=!0),p=this.GetParameter("SRN"),p===undefined&&(p=""),this.GetParameter("IsUseCookie").toLowerCase()==="true"&&(d=!0),V(3,"IsUseCookie = "+d),d||(v=this.GetParameter("SNAME"),v!==undefined?(m=this.GetParameter("SID"),m!==undefined?m=encodeURIComponent(m):m=""):V(2,"SNAME parameter is missing.")),this.ParseControlInfo()?!0:!1},B.prototype.GetParameter=function(e){return u.GetProperty(e)},B.prototype.ParseControlInfo=function(){var e=-1,t=0,u=0,a,f,l,c=SiebelApp.S_App.CommToolbarItem,h=this.GetParameter("SidewayPopup")+";Type=Button;Command=SidewayPopup;Enabled=true",p=new c(h);p.m_state="enabled",r.SidewayPopup=p,o=this.GetParameter("NumberOfControls");if(o===undefined)return V(2,"NumberOfControls parameter is missing."),!1;if(!j(o))return V(2,"Value of NumberOfControls is: "+o),!1;var d=o;for(var v=1;v<=d;v++){l=this.GetParameter("Control"+v);if(l===undefined)V(2,"Parameter with name Control"+v+" is missing.");else{a=new c(l),e!==a.m_iSeq&&(e=a.m_iSeq,t++,u=0),a.m_iSeq=t,a.m_index>0&&(a.m_index=++u),a.m_index===0&&(n[a.m_iSeq]=a,r[a.m_name]=a);if(a.m_index>0||a.m_bSticky===!0)a.m_index>0&&o--,i[a.m_name]=a,f=s[a.m_iSeq],f===undefined&&(f=[],s[a.m_iSeq]=f),a.m_index!==0&&(f[a.m_index]=a)}}for(var m=0;m<o;m++){a=n[m+1];if(a===undefined)continue;if(a.m_bSticky===!0){f=s[m+1];if(f!==undefined)for(var g=1;g<f.length;g++)f[g].m_bSticky=!0}}return!0},B.prototype.InvokeCommandByItemName=function(e,t,n){var r=F(e);if(r===undefined){V(2,"Control with name: "+e+"is not found.");return}if(r.m_state==="enabled"&&W()===!0){var i=I(t,n),s=r.m_command;if(SiebelApp.S_App.CommToolbarUtil.IsPSRLogEnabled()===!0){var o=F(e).m_tooltip;o==="Write PSR Log"&&(i.PSRLog=SiebelApp.S_App.CommToolbarUtil.GetPSRLog())}V(3,"InvokeToolbarCommand for control: "+e),SiebelApp.S_App.CommToolbarUtil.SendCommand({url:s,inputKV:i,error:function(){SiebelApp.S_App.CommToolbarUtil.ErrorWhenInvokeCommand(),V(2,"Failed invoking command for control: "+e+"!")},needUIFProcessRP:!0})}},B.prototype.InvokeCommandToolTip=function(e,t,n){var r=F(e);if(r===undefined){V(2,"Control with name: "+e+"is not found.");return}if(g===!1)r.SetTooltip(r.m_tooltipFromTools);else{var i=r.m_dynamictooltipCmd;if(i.length>0){var s=I(t,n);s.ControlName=r.m_name,V(3,"invokeCommandToolTip for control: "+e),SiebelApp.S_App.CommToolbarUtil.SendCommand({url:i,inputKV:s,error:function(){r.SetTooltip(r.m_tooltipFromTools),V(2,"Failed getting dynamic tooltip for control: "+e+", Use static tooltip.")}})}else r.SetTooltip(r.m_tooltipFromTools)}},B.prototype.CallContactFromUI=function(e,t){if(W()===!0&&N.length>0){var n=I(t);n.UIPhone=e;var r=this.GetParameter("InitCommand1").replace("ShellUIInit",N);V(3,"Make call to "+n.UIPhone+" using command "+N),SiebelApp.S_App.CommToolbarUtil.SendCommand({url:r,inputKV:n,error:function(){V(2,"Failed invoking command: "+N+"!")},needUIFProcessRP:!0})}},B.prototype.EditBoxStatusUpdate=function(e,t){if(_)return;var n=I(t),r=this.GetParameter("InitCommand1").replace
("ShellUIInit","EditBoxStatusUpdate");SiebelApp.S_App.CommToolbarUtil.SendCommand({url:r,inputKV:n,error:function(){V(2,"Failed invoking command: EditBoxStatusUpdate!")},needUIFProcessRP:!1})},B.prototype.ExecuteCommand=function(e){var t=null,n=null,r=!1,s=!1;if(e.name===undefined){V(2,"Invalid command!");return}e.m_type!=="UPDATEMENU"&&e.m_type!=="UPDATEMENU"&&(t=F(e.control));if(t!==undefined&&t!==null&&t.m_bSticky===!0){n=i[e.control];if(n===undefined||n===null){n=null;var o="Error: Fail to find the sticky item from Sideway";this.LogMsg(1,o)}}switch(e.name.toUpperCase()){case"CTICLIENTMGR":SiebelApp.CTIClientMgr.ProcessPushData(e.value);break;case"ENABLECONTROL":if(e.control==="CallFromUI"){if(e.value===undefined){V(2,"Invalid command : "+e);return}e.value.toLowerCase()==="true"?C=!0:C=!1,this.UpdateCallContactFromUI(C)}else if(q(t,e.control)){if(e.value===undefined){V(2,"Invalid command : "+e);return}t.SetEnabled(e.value),n!==null&&n.m_id!==t.m_id&&n.SetEnabled(e.value),r=!0}break;case"UPDATEMENU":if(e.control===undefined||e.value===undefined){V(2,"Invalid command : "+e);return}SiebelApp.S_App.CommToolbarUtil.UpdateCmdMgrMenu(e.control,e.value.toLowerCase());break;case"MSGDISPLAYINTERVAL":if(e.value===undefined){V(2," Invalid command : "+e);return}f=e.value;break;case"IMPLICITSAVE":if(e.value===undefined){V(2,"Invalid command : "+e);return}e.value.toUpperCase()==="TRUE"&&(a=!0);break;case"CTIMESSAGEPREFIX":if(e.value===undefined){V(2,"Invalid command : "+e);return}l=e.value;break;case"CHANGEVALUE":if(q(t,e.control)){if(e.value===undefined){V(2,"Invalid command : "+e);return}t.ChangeValue(e.value),n!==null&&n.m_id!==t.m_id&&n.ChangeValue(e.value)}r=!0;break;case"BLINKCONTROL":if(q(t,e.control)){if(e.value===undefined){V(2,"Invalid command : "+e);return}t.Blink(e.value),n!==null&&n.m_id!==t.m_id&&n.Blink(e.value),y===!0&&t.m_name.indexOf("Accept Work")>=0&&e.value.toUpperCase()==="TRUE"&&this.TriggerEvent(t.m_name,"click")}r=!0;break;case"CHANGETOOLTIP":if(q(t,e.control)){if(e.value===undefined){V(2,"Invalid command : "+e);return}t.SetTooltip(e.value),n!==null&&n.m_id!==t.m_id&&n.SetTooltip(e.value)}break;case"STARTTIMER":var u=e.startTime,c=e.serverTime;if(q(t,e.control)){if(u===undefined||c===undefined){V(2,"Invalid command : "+e);return}t.StartTimer(u,c)}break;case"STOPTIMER":q(t,e.control)&&t.StopTimer();break;case"SHOWALERT":if(e.message===undefined){V(2,"Invalid command : "+e);return}this.ShowMessageWithAlert(e.message);break;case"SHOWDOCUMENT":case"DOPOPUP":case"DOSWEENCODECMD":var h=e.checkPopup!==undefined&&e.checkPopup.toUpperCase()==="TRUE"&&X(),p=e.url.indexOf("OpenEmailPopup")<0&&e.url.indexOf("UpdateCustDashboardWithBookmark")<0&&e.url.indexOf("HoldChat")<0&&e.url.indexOf("ResumeChat")<0;if(!h&&p)e.name.toUpperCase()==="SHOWDOCUMENT"&&W()===!0?SiebelApp.S_App.CommToolbarUtil.ShowDocument(e.url,e.target,e.encodedCmd,e.viewName):e.name.toUpperCase()==="DOPOPUP"?SiebelApp.S_App.CommToolbarUtil.DoPopup(e.url,e.width,e.height):e.name.toUpperCase()==="DOSWEENCODECMD"&&W()===!0&&SiebelApp.S_App.CommToolbarUtil.DoSweCmd(e.url);else{if(e.name.toUpperCase()!=="DOSWEENCODECMD"&&e.urlParameters!==undefined){R(e,e.urlParameters,["SWEService","SWEMethod","SWECmd"]);if(U(e.SWEService)&&e.SWEService.length>0&&U(e.SWEMethod)&&e.SWEMethod.length>0&&U(e.SWECmd)&&e.SWECmd.toUpperCase()==="INVOKEMETHOD"){var d=SiebelApp.S_App.GetService(e.SWEService);d&&((p||h)&&e.urlParameters.SetProperty("ExecuteCommand","No"),d.InvokeMethod(e.SWEMethod,e.urlParameters),V(3,"Invoke Method"+e.SWEMethod+" for BS: "+e.SWEService))}}(p||h)&&this.ExecuteCommand({name:"SHOWSTATUSTEXT",value:e.popupErrMsg})}break;case"HASPENDINGPOPUP":if(e.urlParameters!==undefined){R(e,e.urlParameters,["SWEService","SWEMethod","SWECmd"]);if(U(e.SWEService)&&e.SWEService.length>0&&U(e.SWEMethod)&&e.SWEMethod.length>0&&U(e.SWECmd)&&e.SWECmd.toUpperCase()==="INVOKEMETHOD"){var v=X()?"TRUE":"FALSE",d=SiebelApp.S_App.GetService(e.SWEService);if(d){var m=CCFMiscUtil_CreatePropSet();m.SetProperty("HasPendingPopup",v),e.value!==undefined&&e.value!==null&&m.SetProperty("Value",e.value),d.InvokeMethod(e.SWEMethod,m),V(3,"Invoke Method"+e.SWEMethod+" for BS: "+e.SWEService+" Popup: "+v)}}}break;case"DOPUREPOPUP":if(e.url===undefined){V(2,"Invalid command : "+e);return}var b=location.protocol;SWEShowFeaturedPopup(b+"//"+e.url,e.target,e.height,e.width,e.feature);break;case"REMOVEPOPUP":if(e.target===undefined){V(2,"Invalid command : "+e);return}if(e.target.length>0){var w=e.target;window[w]!==undefined&&window[w]!==null&&window[w].close()}break;case"DONE":break;case"REVERSEORDER":break;case"TOGGLECONTROL":if(q(t,e.control)){if(e.value===undefined){V(2,"Invalid command : "+e);return}t.SetToggle(e.value)}r=!0;break;case"SHOWERRORSTATUSTEXT":case"SHOWSTATUSTEXT":if(e.value===undefined){V(2,"Invalid command : "+e);return}var E=e.value;e.noSave||this.AddMessageToQ(E),this.ShowStatusText(E,f),s=!0;break;case"PLAYSOUND":var x=e.value;if(x===undefined){V(2,"Invalid command : "+e);return}x.length>0&&this.PlaySound(x);break;case"INVOKEMETHOD":if(e.value===undefined){V(2,"Invalid command : "+e);return}if(e.value.length>0){var T=SiebelApp.S_App.GetAppExtension()+"?SWECmd=InvokeMethod&SWEService=HTML+Communication+Client&SWEMethod=";T+=e.value,SiebelApp.S_App.CommToolbarUtil.SendCommand({url:T,inputKV:{},error:function(){V(2,"Invoke method failed for: "+e.value+" of HTML Communication Client.")},needUIFProcessRP:!0})}break;case"WAITFORCMD":g=!0;var k=0;D>0&&(k=D+P),SiebelApp.S_App.CommToolbarUtil.StartPush({bPush:!0,sCmd:e.value,sStopPushString:A,iRetryBeforeStopPush:O,iPushCheckInterval:k});break;case"GETMESSAGECMD":e.polling.length>0&&e.polling>=0?SiebelApp.S_App.CommToolbarUtil.StartPush({bPush:!1,sCmd:e.value,iInterval:e.polling,sStopPushString:A,iRetryBeforeStopPush:O}):SiebelApp.S_App.CommToolbarUtil.StartPush({bPush:!1,sCmd:e.value,iInterval:2,sStopPushString:A,iRetryBeforeStopPush:O});break;case"SHOWPREVIOUSMESSAGE":this.ShowPreviousMessage(),s=!0
;break;case"SHOWNEXTMESSAGE":this.ShowNextMessage(),s=!0;break;case"AUTOANSWER":e.value!==undefined&&e.value.toUpperCase()==="TRUE"&&(y=!0);break;case"BROWSERONFOCUS":this.DrawUsersAttention(S);break;case"SERIOUSREFIDERROR":this.SeriousRefIDError();break;case"MAXREFIDERROR":e.value!==undefined&&e.message!==undefined&&this.SetMaxRefIDError(e.value,e.message);break;case"BRINGTOFRONTTITLE":if(e.value===undefined){V(2,"Invalid command : "+e);return}S=e.value;break;case"ENABLEPSRLOG":SiebelApp.S_App.CommToolbarUtil.SetEnablePSRLog();break;case"SETCLIENTPSRLOGLENGTH":isNaN(e.value)||SiebelApp.S_App.CommToolbarUtil.SetClientPSRLogLength(e.value);break;case"INITFAILED":this.HideCTIToolbar(),this.GetPModel().SetProperty("InitFailed",!0),this.ShowPreviousMessage();break;case"CALLFROMUICOMMAND":if(e.value===undefined){V(2,"Invalid command : "+e);return}N=e.value;break;case"STOPPUSHSTRING":if(e.value===undefined){V(2,"Invalid command : "+e);return}A=e.value;break;case"RETRYBEFORESTOPPUSH":if(e.value===undefined||isNaN(e.value)){V(2,"Invalid command : "+e);return}O=e.value;break;case"JAVASCRIPTLOGLEVEL":if(e.value===undefined||isNaN(e.value)){V(2,"Invalid command : "+e);return}M=e.value,V(1,"JavaScriptLogLevel : "+M),SiebelApp.S_App.CommToolbarUtil.SetLogLevel(M),initCTIClientMgr();break;case"OPENFIND":if(e.target===undefined){V(2,"Invalid command : "+e);return}K(e.target,e.findFields);break;case"DONOTUSELATESTCMDSTATUS":_=!0;break;case"EXECUTENEXTCOMMAND":SiebelApp.S_App.CommToolbarUtil.ExecuteNextCommand();break;case"PUSHKEEPALIVETIMER":if(e.value===undefined||isNaN(e.value)){V(2,"Invalid command : "+e);return}D=parseInt(e.value),V(2,"PUSHKEEPALIVETIMER : "+D);break;case"NETWORKRETRYINTERVAL":if(e.value===undefined||isNaN(e.value)){V(2,"Invalid command : "+e);return}SiebelApp.S_App.CommToolbarUtil.SetNetworkRetryInterval(e.value);break;case"PUSHCHECKDELAY":if(e.value===undefined||isNaN(e.value)){V(2,"Invalid command : "+e);return}P=parseInt(e.value);break;default:}r&&(this.BlinkParentBtn(),s=!0),s&&this.NotifyUIUpdate()},B.prototype.AddMessageToQ=function(e){c.length<10?c.push(e):(c.shift(),c.push(e)),h=c.length},B.prototype.ShowNextMessage=function(){var e;if(c.length===0)return;h<c.length-1?e=c[++h]:(h=c.length-1,e=c[c.length-1]),e=h+". "+e,this.ShowStatusText(e,f)},B.prototype.ShowPreviousMessage=function(){var e;if(c.length===0)return;h>0?e=c[--h]:e=c[0],this.GetPModel().Get("InitFailed")||(e=h+". "+e),this.ShowStatusText(e,f)},B.prototype.ShowStatusText=function(e,t){},B.prototype.ShowMessageWithAlert=function(e){},B.prototype.TriggerEvent=function(e,t){},B.prototype.UpdateHTMLControl=function(e,t,n){},B.prototype.PlaySound=function(e){},B.prototype.DrawUsersAttention=function(e){},B.prototype.BlinkParentBtn=function(){},B.prototype.GotoCTIToolbar=function(){},B.prototype.HideCTIToolbar=function(){},B.prototype.UpdateCallContactFromUI=function(e){},B.prototype.ApplySticky=function(e){var t=F(e);if(t!==undefined&&t!==null&&t.m_bSticky===!0){var i=n[t.m_iSeq];i!==undefined&&i!==null&&(r[i.m_name]=undefined,i.ReplaceInfo(t),i.SetEnabled("true"),r[i.m_name]=i)}},B.prototype.CollectFocusInfo=function(){T=z()},B.prototype.ClearFocusInfo=function(){T=null},B.prototype.IsUseCookies=function(){return d},B.prototype.GetSessionName=function(){return v},B.prototype.GetSessionId=function(){return m},B.prototype.GetSessionRN=function(){return p},B.prototype.SeriousRefIDError=function(){b++,V(1,"Serious Error <"+b+">: Ref ID is less than expected!"),w>0&&b>=w&&(SiebelApp.S_App.CommToolbarUtil.StopPush(),V(1,E),this.ExecuteCommand({name:"SHOWSTATUSTEXT",value:E}))},B.prototype.PushError=function(){H++,V(1,"Serious Error <"+H+">: Push Response Error!"),w>0&&H>=w&&(SiebelApp.S_App.CommToolbarUtil.StopPush(),V(1,E),this.ExecuteCommand({name:"SHOWSTATUSTEXT",value:E}))},B.prototype.SetMaxRefIDError=function(e,t){isNaN(e)||(w=e),E=t},B.prototype.CallContactFromUIEnabled=function(){return C},B.prototype.OpenCallContactFromUIPopup=function(e,t){},B.prototype.DisableAllButtons=function(){var e,t={};$.extend(t,r,i);for(var n in t)t.hasOwnProperty(n)&&(e=t[n],e.m_type==="button"&&e.SetEnabled("FALSE"));V(0,"Network error, disable all buttons")},B.prototype.NotifyUIUpdate=function(){var e=SiebelApp.S_App.getExtObject("CommunicationPanel");(!e||!e.Get("Show"))&&this.NotifyCommPanel()},B.prototype.NotifyCommPanel=function(){},new B}());var gbInit=!1;typeof SiebelApp.CTIClientObj=="undefined"&&(SiebelJS.Namespace("SiebelApp.CTIClientObj"),define("siebel/cticlientobj",[],function(){SiebelApp.CTIClientObj=function(){function l(){this.m_bBatchStart=!1}function c(e,n){var r=e+t.get("SC_WORK_ID_SEP_STR")+n;return r}function h(t){var n=e();return n.SetProperty("Svc",this.m_profileName),n.SetProperty("FunctionName",t),n}function p(n){var r=e();return r.SetProperty(t.get("SC_EVT_METHOD"),n),r.SetProperty(t.get("SC_EVT_MEDIA_PROFILE"),this.m_profileName),r.SetProperty(t.get("SC_EVT_MEDIA_PROFILE_ID"),this.m_profileId),r.SetProperty(t.get("SC_EVT_MEDIA_TYPE"),this.m_mediaType),r.SetProperty(t.get("SC_EVT_MEDIA_TYPE_STRING"),this.m_mediaTypeString),r.SetProperty("ProfileID",this.m_profileId),r}function d(t){var n=e();return n.SetType(t),n}function v(t){CTILog(3,"c","handlePostMessage is called");if(this.m_bBatchStart){CTILog(3,"c","batch is enabled"),n.IsEmpty(this.m_pCacheForBatch)&&(this.m_pCacheForBatch=e()),this.m_pCacheForBatch.AddChild(t);return}m.call(this,t)}function m(e){CTILog(3,"c","sendToServer: is called");if(!n.IsEmpty(e))var t=SiebelApp.S_App.GetService("Communications Client"),r=t.InvokeMethod("HandleRequestCTIClientMgr",e);else CTILog(1,"c","sendToServer has no data to send")}var e=CCFMiscUtil_CreatePropSet,t=SiebelJS.Dependency("SiebelApp.Constants"),n=SiebelJS.Dependency("SiebelApp.Utils"),r=!1,i=null,s,o,u,a,f={};return l.prototype.BeginBatch=function(){CTILog(3,"c","BeginBatch is called");if(this.m_bBatchStart)return;this.m_bBatchStart=!0,this.m_pCacheForBatch==null&&(this.m_pCacheForBatch=e())},l.prototype.EndBatch=
function(){CTILog(3,"c","EndBatch is called");if(this.m_bBatchStart){if(this.m_pCacheForBatch.GetChildCount()){var e=h.call(this,"HandleBatch");e.AddChild(this.m_pCacheForBatch),m.call(this,e),this.m_pCacheForBatch=null}this.m_bBatchStart=!1}},l.prototype.HandleEvent=function(e,n,r,i){CTILog(3,"c","	 reach to client: "+this.m_profileName),CTILog(3,"c","	 eventName: "+e),CTILog(3,"c","interested Event:"+JSON.stringify(this.m_interestEventMap));if(!this.m_interestEventMap[e]){CTILog(3,"c","	 Event is not used at CTI configuration: "+e);return}var s=p.call(this,"HandleEvent");s.SetProperty(t.get("SC_EVT_NAME"),e),s.SetProperty(t.get("SC_EVT_DRIVER_NOTIFY_DONE"),r),s.SetProperty(t.get("SC_EVT_DRIVER_TRACK_ID"),i);var o=jsMAPtoPropSet(n,t.get("SC_EVT_FIELD_TYPE"));s.AddChild(o);var u=h.call(this,"HandleEvent");u.AddChild(s),v.call(this,u)},l.prototype.ShowStatusText=function(e){CTILog(3,"c","ShowStatusText is called");var n=p.call(this,"ShowStatusText");n.SetProperty(t.get("SC_EVT_TEXT"),e);var r=h.call(this,"ShowStatusText");r.AddChild(n),v.call(this,r)},l.prototype.HandleError=function(e){CTILog(3,"c","HandleError is called");var n=p.call(this,"HandleError");n.SetProperty(t.get("SC_EVT_ERROR"),e);var r=h.call(this,"HandleError");r.AddChild(n),v.call(this,r)},l.prototype.CacheCommandInformation=function(e,n,r){CTILog(3,"c","CacheCommandInformation is called");var i=p.call(this,"CacheCommandInformation"),s=jsArraytoPropSet(e,"Field",t.get("SC_EVT_CMD_NAMES"));i.AddChild(s);var o=jsArraytoPropSet(n,"Field",t.get("SC_EVT_CMD_DESCRIPTIONS"));i.AddChild(o);var u=jsArraytoPropSet(r,"Field",t.get("SC_EVT_CMD_STATUSES"));i.AddChild(u);var a=h.call(this,"CacheCommandInformation");a.AddChild(i),v.call(this,a)},l.prototype.UpdateObjectInformation=function(e,n,r){CTILog(3,"c","UpdateObjectInformation is called");var i=p.call(this,"UpdateObjectInformation");i.SetProperty(t.get("SC_EVT_WORK_ITEM_ID"),c(this.m_profileId,e)),i.SetProperty(t.get("SC_EVT_OBJECT_ID"),n);var s=jsMAPtoPropSet(r,t.get("SC_EVT_DATA_SET"));i.AddChild(s);var o=h.call(this,"UpdateObjectInformation");o.AddChild(i),v.call(this,o)},l.prototype.IndicateNewWorkItem=function(e,n,r,i){CTILog(3,"c","IndicateNewWorkItem is called");var s=p.call(this,"IndicateNewWorkItem");s.SetProperty(t.get("SC_EVT_WORK_ITEM_ID"),c(this.m_profileId,e)),s.SetProperty(t.get("SC_EVT_OLD_WORK_ITEM_ID"),c(this.m_profileId,n)),s.SetProperty(t.get("SC_EVT_DESCRIPTION"),r),s.SetProperty(t.get("SC_EVT_WORK_ITEM_MODE"),i);var o=h.call(this,"IndicateNewWorkItem");o.AddChild(s),v.call(this,o)},l.prototype.WorkItemStarted=function(e,n,r,i,s){CTILog(3,"c","WorkItemStarted is called");var o=p.call(this,"WorkItemStarted");o.SetProperty(t.get("SC_EVT_WORK_ITEM_ID"),c(this.m_profileId,e)),o.SetProperty(t.get("SC_EVT_OLD_WORK_ITEM_ID"),c(this.m_profileId,n)),o.SetProperty(t.get("SC_EVT_DESCRIPTION"),r),o.SetProperty(t.get("SC_EVT_OBJECT_ID"),i),o.SetProperty(t.get("SC_EVT_START_TIME"),s);var u=h.call(this,"WorkItemStarted");u.AddChild(o),v.call(this,u)},l.prototype.WorkItemReleased=function(e,n){CTILog(3,"c","WorkItemReleased is called");var r=p.call(this,"WorkItemReleased");r.SetProperty(t.get("SC_EVT_WORK_ITEM_ID"),c(this.m_profileId,e)),r.SetProperty(t.get("SC_EVT_STOP_TIME"),n);var i=h.call(this,"WorkItemReleased");i.AddChild(r),v.call(this,i)},l.prototype.CleanAllWorkItem=function(){CTILog(3,"c","CleanAllWorkItem is called");var e=p.call(this,"CleanAllWorkItem"),t=h.call(this,"CleanAllWorkItem");t.AddChild(e),v.call(this,t)},l.prototype.WorkItemSuspended=function(e){CTILog(3,"c","WorkItemSuspended is called");var n=p.call(this,"WorkItemSuspended");n.SetProperty(t.get("SC_EVT_WORK_ITEM_ID"),c(this.m_profileId,e));var r=h.call(this,"WorkItemSuspended");r.AddChild(n),v.call(this,r)},l.prototype.WorkItemResumed=function(e){CTILog(3,"c","WorkItemResumed is called");var n=p.call(this,"WorkItemResumed");n.SetProperty(t.get("SC_EVT_WORK_ITEM_ID"),c(this.m_profileId,e));var r=h.call(this,"WorkItemResumed");r.AddChild(n),v.call(this,r)},l}()})),typeof SiebelApp.CTIClientMgr=="undefined"&&(SiebelJS.Namespace("SiebelApp.CTIClientMgr"),define("siebel/cticlientmgr",[],function(){SiebelApp.CTIClientMgr=function(){function l(){CTILog(1,"m","Init",!0)}function c(e){var t="Code:"+e+", Msg: ";switch(e){case r:t+="OK";break;case i:t+="Generic Error";break;case s:t+="No matched service, skip";break;case o:t+="Missing workItem";break;case u:t+="Could not locate matching command";break;default:t+="Unknown"}return t}function h(e){if(n.IsEmpty(e))return CTILog(1,"m","CTIClientMgr getWorkItem: workID is null"),null;var r={profileId:"",trackingId:""},i=e.indexOf(t.get("SC_WORK_ID_SEP_STR"));return i>=0?(r.profileId=e.substring(0,i),r.trackingId=e.substring(i+t.get("SC_WORK_ID_SEP_STR").length)):r.trackingId=e,CTILog(3,"m","CTIClientMgr getWorkItem: "+r),r}function p(e,t,n){var r={};if(e){CTILog(n,"m",t+e.GetType());var i=e.EnumProperties(!0);do i&&(r[i]=e.GetProperty(i),CTILog(n,"m",t+"	"+i+":"+e.GetProperty(i)));while(i=e.EnumProperties(!1))}return r}function d(e,r){var i={};if(!n.IsEmpty(e)){var s=e.EnumProperties(!0);do s&&(i[s]=e.GetProperty(s));while(s=e.EnumProperties(!1));var o=e.EnumChildren(!0);do if(!n.IsEmpty(o)){var u=d(o,!1);if(!n.IsEmpty(u))for(var a in u)i[a]=u[a]}while(o=e.EnumChildren(!1));r&&(delete i[t.get("SC_WH_MEDIA_TYPE")],delete i[t.get("SC_WH_MEDIA_TYPE_STRING")],delete i[t.get("SC_WH_MEDIA_PROFILE")],delete i[t.get("SC_WH_DRIVER_EVENT_NAME")],delete i[t.get("SC_WH_DRIVER_NOTIFY_DONE")],delete i[t.get("SC_WH_WORK_ITEM_ID")])}return i}var e=CCFMiscUtil_CreatePropSet,t=SiebelJS.Dependency("SiebelApp.Constants"),n=SiebelJS.Dependency("SiebelApp.Utils");const r=0,i=-1,s=-2,o=-3,u=-4;var a={m_driverMap:{},m_interestEventMap:{},getService:function(e){var t=this.getEntry(e);return n.IsEmpty(t)==0?t[2]:null},getCmdEvt:function(e){var t=this.getEntry(e);return n.IsEmpty(t)==0?t[3]:null},getEntry:function(e){var t;for(var n in this.m_driverMap)if(this.m_driverMap[n][0]==e){t=this.m_driverMap
[n];break}return t},logOff:function(){var e;for(var t in this.m_driverMap)e=this.m_driverMap[t],e&&e[2]!=null&&e[2].ReleaseISCServiceInstance(),e&&e[1]!=null&&e[1].ReleaseISCDriverInstance()},toString:function(){var e="\n drivers: ";for(var t in this.m_driverMap){e+="\n	",e+=t,e+=", ",e+=this.m_driverMap[t][0];var r=this.m_driverMap[t][3];if(n.IsEmpty(r)==0){if(n.IsEmpty(r.commandList)==0){e+=", commands: ";var i;for(i=0;i<r.commandList.length;i++)e+=r.commandList[i],e+=" "}if(n.IsEmpty(r.eventList)==0){e+=", events: ";for(i=0;i<r.eventList.length;i++)e+=r.eventList[i],e+=" "}}}e+="\n events: ";for(var t in this.m_interestEventMap)e+=t,e+=", ";return e}},f={m_data:null,isValid:function(){var e=!1;if(this.m_data!=null){var t=this.m_data.GetChildByType("Profile");n.IsEmpty(t)==0&&(e=!0)}return e},toString:function(){var e="";return this.m_data!=null&&(e=DumpPS(this.m_data,"")),e},apiVersion:function(){var e;return this.m_data!=null&&(e=this.m_data.GetProperty("APIVersion")),e},langCode:function(){var e;return this.m_data!=null&&(e=this.m_data.GetProperty("LanguageCode")),e},getData:function(e,t,r){if(n.IsEmpty(this.m_data))return;var i=this.m_data.GetChildByType(e);if(n.IsEmpty(i))return;var s,o=i.EnumChildren(!0);do if(o){var u=o.GetProperty("Name");if(u==t){s=o.GetProperty(r);break}}while(o=i.EnumChildren(!1));return s},getDataSet:function(e,t,r){if(n.IsEmpty(this.m_data))return;var i=this.m_data.GetChildByType(e);if(n.IsEmpty(i))return;var s,o=i.EnumChildren(!0);do if(o){var u=o.GetProperty("Name");if(u==t){s=o.GetChildByType(r);break}}while(o=i.EnumChildren(!1));return s}};return l.prototype.Logoff=function(){CTILog(3,"m","CTIClientMgr: Logoff"),a.logOff()},l.prototype.SetReady=function(r){CTILog(3,"m","CTIClientMgr: Ready");var i=!0;CTILog(3,"m","CTIClientMgr: get CTI configuration: ");if(n.IsEmpty(f.m_data)&&r==1){var s=e();s.SetProperty("FunctionName","GetCTIConfiguration");var o=SiebelApp.S_App.GetService("Communications Client"),u=o.InvokeMethod("HandleRequestCTIClientMgr",s);f.m_data=u.GetChildByType(t.get("SWE_PROP_RESULTSET"));if(f.isValid()==0)CTILog(1,"m","CTIClientMgr: get CTI configuration: failed"),i=!1;else{var a=f.m_data.GetProperty("SetEventList");a!=null&&(f.m_data.RemoveProperty("SetEventList"),CTILog(3,"m","CTIClientMgr: SetEventList: "+a),SiebelApp.S_App.CommToolbarUtil.HandleResponse(a))}}this.Status(),i&&(this.m_bReady=r)},l.prototype.Status=function(){CTILog(3,"m","Status: begin"),CTILog(3,"m"," CTI configuration: "+f.toString()),CTILog(3,"m"," CTI running data: "+a.toString()),CTILog(3,"m"," Status: end",!0)},l.prototype.ProcessPushData=function(l){CTILog(3,"m","CTIClientMgr ProcessPushData: "+l);var v=e();v.DecodeFromString(l);var m=i,g=v.GetProperty(t.get("SC_SRM_MEDIA_MGR_METHOD")),y=v.GetChild(0);CTILog(3,"m","CTIClientMgr ProcessPushData: "+g);if(g=="ClientDisconnect")for(var b in a.m_driverMap)a.m_driverMap[b][2]&&(m=a.m_driverMap[b][2].ReleaseISCServiceInstance());else if(g!="ReleaseISCServiceInstance")if(g=="NotifyEventHandlingFinished"){var w=y.GetProperty(t.get("SC_CMD_WORK_ITEM_ID")),E=y.GetProperty(t.get("SC_CMD_RESULT")),S=h(w);if(!n.IsEmpty(S)){var x=a.getService(S.profileId);x?m=x.NotifyEventHandlingFinished(S.trackingId,E):m=s}else m=o}else if(g=="InvokeCommand"){var T=y.GetProperty(t.get("SC_CMD_DRV_PROFILE_NAME")),N=y.GetProperty(t.get("SC_CMD_DRV_PROFILE_ID")),C=y.GetProperty(t.get("SC_CMD_CMD_TRACK_ID")),k=y.GetProperty(t.get("SC_CMD_DEV_CMD")),L=y.GetProperty(t.get("SC_CMD_STRING_PARAM")),A=p(y.GetChildByType(t.get("SC_CMD_DATA_SET")),"	",3);CTILog(3,"m","CTIClientMgr ProcessPushData: InvokeCommand: "+k),n.IsEmpty(N)&&T&&(N=f.getData("Profile",T,"Id"));var x=a.getService(N);if(x){var O=!1,M=a.getCmdEvt(N);if(n.IsEmpty(M)==0&&n.IsEmpty(M.commandList)==0){var _;for(_=0;_<M.commandList.length;_++)if(M.commandList[_]===k){O=!0;break}}O?m=x.InvokeCommand(C,k,L,A):m=u}else m=s}else if(g=="InvokeCommandEx2")CTILog(1,"m","CTIClientMgr ProcessPushData: InvokeCommandEx2: not support");else if(g=="InvokeCommandEx"){var T=y.GetProperty(t.get("SC_CMD_DRV_PROFILE_NAME")),N=y.GetProperty(t.get("SC_CMD_DRV_PROFILE_ID")),C=y.GetProperty(t.get("SC_CMD_CMD_TRACK_ID")),D=y.GetProperty(t.get("SC_CMD_CMD_TYPE"));const P=1,H=2;D!=P&&D!=H&&(CTILog(1,"m","command type is not defined with scapi.h: "+D),m=u);var A=p(y.GetChildByType(t.get("SC_CMD_DATA_SET")),"	",3);n.IsEmpty(N)&&T&&(N=f.getData("Profile",T,"Id"));var x=a.getService(N);x?m=x.InvokeCommandEx(C,D,A):m=s}else if(g=="AcceptWorkItem"){var w=y.GetProperty(t.get("SC_CMD_WORK_ITEM_ID")),S=h(w);if(!n.IsEmpty(S)){var x=a.getService(S.profileId);x?m=x.AcceptWorkItem(S.trackingId):m=s}else m=o}else if(g=="ReleaseWorkItem"){var w=y.GetProperty(t.get("SC_CMD_WORK_ITEM_ID")),S=h(w);if(!n.IsEmpty(S)){var x=a.getService(S.profileId);x?m=x.ReleaseWorkItem(S.trackingId):m=s}else m=o}else if(g=="SuspendWorkItem"){var w=y.GetProperty(t.get("SC_CMD_WORK_ITEM_ID")),S=h(w);if(!n.IsEmpty(S)){var x=a.getService(S.profileId);x?m=x.SuspendWorkItem(S.trackingId):m=s}else m=o}else if(g=="ResumeWorkItem"){var w=y.GetProperty(t.get("SC_CMD_WORK_ITEM_ID")),S=h(w);if(!n.IsEmpty(S)){var x=a.getService(S.profileId);x?m=x.ResumeWorkItem(S.trackingId):m=s}else m=o}else if(g=="HandleQueuedWorkItem"){var B=y.GetProperty(t.get("SC_WH_MEDIA_TYPE")),j=y.GetProperty(t.get("SC_WH_MEDIA_TYPE_STRING")),F=y.GetProperty(t.get("SC_WH_MEDIA_PROFILE")),I=y.GetProperty(t.get("SC_WH_DRIVER_EVENT_NAME")),q=y.GetProperty(t.get("SC_WH_DRIVER_NOTIFY_DONE")),w=y.GetProperty(t.get("SC_WH_WORK_ITEM_ID")),R=d(y,!0),S=h(w);if(!n.IsEmpty(S)){var x=a.getService(S.profileId);x?m=x.HandleQueuedWorkItem(I,R,S.trackingId):m=s}else m=o}else if(g=="RevokeQueuedWorkItem"){var w=y.GetProperty(t.get("SC_CMD_WORK_ITEM_ID")),j=y.GetProperty(t.get("SC_CMD_MEDIA_TYPE_STRING")),S=h(w);if(!n.IsEmpty(S)){var x=a.getService(S.profileId);x?m=x.RevokeQueuedWorkItem(S.trackingId):m=s}else m=o}else if(g=="SetEventList"){m=r,m_interestEventMap={};if(y){var U=y.EnumProperties(!0);do U&&(a.
m_interestEventMap[U]=U,CTILog(3,"m","SetEventList: adding "+U));while(U=y.EnumProperties(!1));this.Status()}}else CTILog(1,"m","CTIClientMgr ProcessPushData: need to handle, ToDo: "+g);m!=r&&m!=s?CTILog(1,"m","CTIClientMgr ProcessPushData: invoke: "+g+" returns "+c(m)):CTILog(3,"m","CTIClientMgr ProcessPushData: invoke: "+g+" returns "+c(m)),CTILog(3,"m","CTIClientMgr ProcessPushData: =========")},l.prototype.Register=function(e,t){CTILog(3,"m","CTIClientMgr: Register is called, 3rd party driver: "+e);if(this.m_bReady!=1)return CTILog(3,"m","CTIClientMgr: is not ready"),!1;var n=f.getData("Profile",e,"Id");if(!n){CTILog(3,"m","CTIClientMgr: CTI configuration does not have this profile: reject");return}var r=f.apiVersion(),i=t.APIVersion();CTILog(3,"m","CTIClientMgr: API version: "+r),CTILog(3,"m","CTIClientMgr: AMC version: "+i);var s=r>>16,o=r<<16>>16,u=i>>16,l=i<<16>>16,c=s==u;c&&(c=o>=l);if(c==0){CTILog(3,"m","CTIClientMgr: 3rd party driver has in-correct version: reject");return}var h,p=f.langCode(),d=f.getData("Profile",e,"MediaTypeString"),v=f.getDataSet("Profile",e,"driverParams"),m=f.getData("Profile",e,"driverConnectStr");CTILog(3,"m","call driver: GetImplementationObject: ToDo, do not know how to use this info after retrieve");var g=t.GetImplementationObject(h);CTILog(3,"m","call driver: RequestMediaTypeList: ToDo, do not know how to use this info after retrieve");var y=t.RequestMediaTypeList(),b=t.CreateISCDriverInstance(d,p,m,PStojsMAP(v)),w=new SiebelApp.CTIClientObj,E=f.getDataSet("Profile",e,"serviceParams"),S=f.getData("Profile",e,"serviceConnectStr"),x=t.RequestService(b,w,S,PStojsMAP(E)),T=t.RequestCommandEventList(d);return a.m_driverMap[e]=[n,b,x,T,e],w.m_profileName=e,w.m_profileId=n,w.m_mediaType=f.getData("Profile",e,"MediaType"),w.m_mediaTypeString=d,w.m_interestEventMap=a.m_interestEventMap,this.Status(),!0},new l}()})),typeof SiebelApp.S_App.CommToolbarUtil=="undefined"&&(Namespace("SiebelApp.S_App.CommToolbarUtil"),SiebelApp.S_App.CommToolbarUtil=function(){function t(){return this}function g(e){var t=this;t.height="600",t.width="800",t.polling="2",$.each(g.paramAttr,function(n,r){t[r]=e.attr(r);if(t[r]===undefined)return;if(r==="url"){var s=t[r].indexOf("?");if(!(s>=0))return;var o=t[r].substring(s+1);o=o.replace(new RegExp("\\+","gm")," ");var u=o.split("&"),a=i();$.each(u,function(e,t){var n=[];n=t.split("="),n.length===2&&n[0].indexOf("swe")!==0&&a.SetProperty(n[0],n[1])}),t.urlParameters=a}})}function M(t){E.bStarted=!1,SiebelApp.S_App.CommToolbar.ExecuteCommand({name:"SHOWSTATUSTEXT",value:e.GetLocalString("IDS_CTI_NETWORK_RECONNECTED"),noSave:!0});if(t){this.LogMsg(0,"Restart push channel and refresh UI"),this.SendPush();var n=CCFMiscUtil_CreatePropSet();n.SetProperty("RefreshAll","TRUE"),_.call(this,"ShellUIUpdate",n)}else this.LogMsg(1,"ShellUIExit executed at server side, need to reinitialize CTI toolbar"),this.InitShellUI(!0);d=!1}function _(e,t,n){n=n||consts.get("NAME_COMMSVC"),this.LogMsg(3,"invoke BS: "+n+" method: "+e);var r=SiebelApp.S_App.GetService(n);return r?(t||(t=CCFMiscUtil_CreatePropSet()),r.InvokeMethod(e,t)):null}function D(){SiebelApp.S_App.CommToolbar.GetPModel().Get("InitFailed")||(SiebelApp.S_App.CommToolbar.DisableAllButtons(),SiebelApp.S_App.CommToolbar.ExecuteCommand({name:"SHOWSTATUSTEXT",value:e.GetLocalString("IDS_CTI_NETWORK_ERROR"),noSave:!0}),this.LogMsg(0,"no push response in "+E.iPushCheckInterval+" seconds, reconnecting"),H.call(this))}function P(e){if(!e)return!0;var t=!1,n=!0,r;while(r=e.EnumProperties(n)){var i=e.GetProperty(r);if(r==="ERR"&&i=="1"){t=!0;break}n&&(n=!1)}return t}function H(){var t=_.call(this,"IsCommEnabled"),n=P(t);if(n===!1){this.LogMsg(0,"Connection recovered, restart push");var r=!0,i=t.GetChildByType(consts.get("SWE_PROP_RESULTSET"));i&&i.GetProperty("IsOpened")==="0"&&(r=!1),M.call(this,r)}else l<E.iRetryBeforeStopPush?(O(H,p,this),this.LogMsg(3,"retry connection")):(SiebelApp.S_App.CommToolbar.ExecuteCommand({name:"SHOWSTATUSTEXT",value:e.GetLocalString("IDS_CTI_NETWORK_LOST"),noSave:!0}),this.LogMsg(1,"Connection lost after "+l+" times retry"));++l}function B(){l=0,clearTimeout(h);var e;E.bfirstTime?e=E.iPushCheckInterval+3:e=E.iPushCheckInterval,this.LogMsg(3,"perform next push checking in "+e+" seconds"),h=O(D,e*1e3,this)}function R(){q&&q.timeoutID&&(window.clearTimeout(q.timeoutID),q.timeoutID=null)}function U(e){if(q&&!q.cancelCallback){var t="",n="";e[consts.get("WS_MSG_TYPE_IN_ERROR")]?this.LogMsg(2,"Error from DISA: unknown host."):(t=e[consts.get("WS_CTI_HOST_ADDRESS")],n=e[consts.get("WS_CTI_HOST_NAME")],this.LogMsg(0,"Got client host info from DISA: "+consts.get("WS_CTI_HOST_NAME")+" - "+n+", "+consts.get("WS_CTI_HOST_ADDRESS")+" - "+t+"."),t=t===undefined?"":t,n=n===undefined?"":n,t===""&&n===""&&this.LogMsg(2,"Invalid client host info from DISA."));var r="&Host="+n+"&Addr="+t;W.call(this,r),R.call(this)}}function z(){this.LogMsg(2,"Failed to get client host info. Send init commands without it."),W.call(this),R.call(this)}function W(e){var t=SiebelApp.S_App.CommToolbar.GetParameter("NoOfInitCommands");if(t!==undefined&&t>0)for(var n=0;n<t;n++){var r=1+n,i=SiebelApp.S_App.CommToolbar.GetParameter("InitCommand"+r);i?(e&&(i+=e),this.LogMsg(0,"Init Command is: "+i),this.SendCommand({url:i})):this.LogMsg(2,"InitCommand"+r+" parameter is missing.")}else this.LogMsg(2,"NoOfInitCommands parameter is missing.")}var e=SiebelJS.Dependency("SiebelApp.S_App.LocaleObject");"use strict";var n="",r=new t,i=CCFMiscUtil_CreatePropSet,s=!1,o=3,u=[],a=!1,f=0,l=0,c='<command name="ClientIP" value="',h=null,p=3e4,d=!1,v=function(){var e=/windows/.test(navigator.userAgent.toLowerCase()),t=/mobile/.test(navigator.userAgent.toLowerCase()),n=SiebelAppFacade.DecisionManager.IsTouch();return(!e||e&&t)&&n},m=v();g.paramAttr=["name","value","control","message","url","target","applet","startTime","serverTime","encodedCmd","viewName","position","feature","checkPopup","popupErrMsg","polling","width","height","position"
,"feature"],g.prototype.Invoke=function(){SiebelApp.S_App.CommToolbar.ExecuteCommand(this)},g.prototype.toString=function(){var e="command ["+this.name+"]: ",t=this;return $.each(g.paramAttr,function(n,r){t[r]!==undefined&&(e+="\n	"+r+":"+t[r])}),e};var y=!0,b="",w=0,E={bStarted:!1,bRun:!0,bPush:!0,iInterval:3,sCmd:"SWECmd=WaitForCmd&SWEService=Communications Client",sStopPushString:"",iRetryBeforeStopPush:0,iPushCheckInterval:0,bfirstTime:!1},S=function(e,t,n){var r=i();for(var s in e)e.hasOwnProperty(s)&&r.SetProperty(s,e[s]);var o={async:!0,cb:this.HandleResponse,opdecode:!1,scope:this};typeof t=="function"&&(o.errcb=t),o.selfbusy=!0,SiebelApp.S_App.CallServer(r,undefined,n,o)};t.prototype.getCookiesSession=function(){var e="";return e="&"+SiebelApp.S_App.CommToolbar.GetSessionName()+"="+SiebelApp.S_App.CommToolbar.GetSessionId(),e+=N(),this.LogMsg(3,"getCookiesSession: "+e),e};var x=function(e){return e.replace(new RegExp("&","gm")," __X__ ")},T=function(e){return e.replace(new RegExp(" __X__ ","gm"),"&")},N=function(){var e="&SRN="+b;return e},C=function(){return document.cookie};t.prototype.isValidCookieSession=function(){if(y===!0){if(C()!=="")return!0}else if(this.getCookiesSession()!=="")return!0;return!1};var k=function(e){var t=!1;clearTimeout(h),this.LogMsg(3,"get push response of request "+w+": "+e),e==="Error"?(SiebelApp.S_App.CommToolbar.PushError(),this.LogMsg(1,"handlePushResponse: Error: "+e)):E.sStopPushString.length>0&&e.indexOf(E.sStopPushString)>=0||e.indexOf(c)<0?(this.LogMsg(1,"invalid push response of request "+w+", retry times: "+f),f>=E.iRetryBeforeStopPush?(this.LogMsg(1,"Stop push and disable the toolbar!"),SiebelApp.S_App.CommToolbar.DisableAllButtons(),E.bRun=!1):(this.LogMsg(1,"handlePushResponse: retry"),t=!0,++f)):e!=="OK"?(f=0,s=!0,this.HandleResponse(e),s=!1):this.LogMsg(1,"handlePushResponse: else: "+e),E.bStarted=!1,E.bRun&&(E.bPush?t?(this.LogMsg(1,"handlePushResponse: push: retry"),O(this.SendPush,1e3,this)):this.SendPush():t?(this.LogMsg(1,"handlePushResponse: get: retry"),O(this.GetMsg,1e3,this)):this.GetMsg())},L=function(e){this.LogMsg(1,"sendCommand failed for push request<"+w+">"),clearTimeout(h),E.bStarted=!1,E.bRun&&(E.bPush?f<E.iRetryBeforeStopPush?(f++,O(this.SendPush,1e3,this)):(this.LogMsg(1,"Stop push after few tries at handlePushException!"),SiebelApp.S_App.CommToolbar.DisableAllButtons()):O(this.GetMsg,1e3,this))};t.prototype.HandleResponse=function(e){var t=this;s||this.LogMsg(3,"Get command response: "+e);var n=e,r=/<HTML(.|\n)*/g;n=n.replace(r,""),n="<xml>"+n+"</xml>";var i=$.parseXML(n);if(i===undefined)return;var o=$(i).find("command");$.each(o,function(){var e=new g($(this));if(e.name.toUpperCase()==="SHOWDOCUMENT")u.push([e]);else if(e.name.toUpperCase()==="RELEASECOMM"){var n=e.value,r=!1,i=CCFMiscUtil_CreatePropSet();for(var s=0;s<u.length;s++){var o=u[s],a=o[0].url,f=o[0].urlParameters;if(o&&f){var l=f.propArray,c=l.InteractionId,h=l.SWEMethod;n===c&&(u.splice(s,1),i.SetProperty(h,h),r=!0,s-=1)}}r&&_.call(t,"RemovePostCmdForReleasedItem",i,consts.get("NAME_COMMSVC"))}else{if(e.name.toUpperCase()==="OPENFIND"){var p=$(this).find("field");e.findFields=[],$.each(p,function(){e.findFields[$(this).attr("name")]=$(this).attr("value")})}e.Invoke()}});var f=SiebelApp.S_App.getExtObject("ChatPane");if(f){var l=$(i).find("chat");l.children().length>0&&(f.Notify(l),SiebelApp.S_App.CommToolbar.NotifyUIUpdate())}u.length>0&&!a&&this.ExecuteNextCommand()},t.prototype.ExecuteNextCommand=function(){var e=u.shift();a&&(SiebelApp.EventManager.removeListner("postload",this.ExecuteNextCommand,this),SiebelApp.EventManager.removeListner("posteoiload",this.ExecuteNextCommand,this),a=!1);if(e)e[0].Invoke(),a||this.ExecuteNextCommand();else{var t=SiebelApp.S_App.getExtObject("ChatPane");t&&t.ExecuteMethod("SetFocusToTextInput")}},t.prototype.GenInputPS=function(e,t){return $.each(e.split("&"),function(n,r){var i=r.split("=");if(i.length===2){var s=i[0],o=i[1];t[s]=o}}),t},t.prototype.SendCommandStr=function(e,t){var r="";r=n+e,arguments.length>=2?$.get(T(r),this.HandleResponse).error(function(e,n,r){var i={errCode:e.status,errText:r};t(i)}):$.get(T(r),this.HandleResponse)};var A=function(e){for(var t in E)E.hasOwnProperty(t)&&typeof e[t]!="undefined"&&(t==="sCmd"&&(e[t].indexOf(SiebelApp.S_App.GetAppExtension()+"?")===0&&(e[t]=e[t].substring(SiebelApp.S_App.GetAppExtension().length+1)),e[t]=e[t].replace(new RegExp("\\+","gm")," ")),E[t]=e[t])},O=function(e,t,n){var r=n,i=function(){e.call(r)};return setTimeout(i,t)};t.prototype.SendCommand=function(e){if(typeof e!="object"){this.LogMsg(1,"Invoking SendCommand, the input arg is not valid!");return}var t=e.url,n=e.inputKV,r=e.error,i={};typeof n=="object"&&(i=n),typeof t=="string"&&(t=decodeURI(t),t=t.replace(new RegExp("\\+","gm")," "),t.indexOf(SiebelApp.S_App.GetAppExtension()+"?")===0&&(t=t.substring(SiebelApp.S_App.GetAppExtension().length+1)),i=this.GenInputPS(t,i)),S.call(this,i,r,e.needUIFProcessRP)},t.prototype.CallSWEAsString=function(e){var t=App(),n="";t.CallSWEAsString(e,!1,n)},t.prototype.DoSweCmd=function(e){var t=SiebelApp.CommandManager.GetInstance();t.InvokeCommand(e)},t.prototype.ShowDocument=function(e,t,n,r){if(!this.ImplicitSave())return;SiebelApp.EventManager.addListner("postload",this.ExecuteNextCommand,this),SiebelApp.EventManager.addListner("posteoiload",this.ExecuteNextCommand,this),a=!0,r!==undefined&&r.length>0?(this.LogMsg(3,"using SiebelApp.S_App.GotoView"),this.PSRLog("[PSR] GotoView ["+r+"]"),SiebelApp.S_App.GotoView(r,"",e,t,"",!1)):t==="_sweview"&&n!==undefined&&n.length>0?(this.LogMsg(3,"using CallSWEAsString"),this.CallSWEAsString(n)):(this.LogMsg(3,"using SiebelApp.S_App.GotoView"),this.PSRLog("[PSR] GotoView"),SiebelApp.S_App.GotoView("","",e,t,"",!1))},t.prototype.GetRefId=function(){return w},t.prototype.SendPush=function(){if(E.bStarted===!0)return;E.bStarted=!0,w+=1;var e=E.sCmd+"&refID="+w,t={};t=this.GenInputPS(e,t);var n=i();for(var r in t)t.hasOwnProperty
(r)&&n.SetProperty(r,t[r]);var s=!1,o={async:!0,cb:k,errcb:L,opdecode:!1,scope:this};E.bPush===!0?this.LogMsg(3,"send a new push request: "+w):this.LogMsg(3,"Send: "+e),o.selfbusy=!0,SiebelApp.S_App.CallServer(n,undefined,s,o),E.bPush&&E.iPushCheckInterval>0&&!SiebelApp.S_App.CommToolbar.GetPModel().Get("InitFailed")&&(B.call(this),E.bfirstTime=!1)},t.prototype.ErrorWhenInvokeCommand=function(){d||(SiebelApp.S_App.CommToolbar.DisableAllButtons(),clearTimeout(h),SiebelApp.S_App.CommToolbar.ExecuteCommand({name:"SHOWSTATUSTEXT",value:e.GetLocalString("IDS_CTI_NETWORK_ERROR"),noSave:!0}),this.LogMsg(1,"Network error, reconnecting"),O(H,p,this),d=!0)},t.prototype.GetMsg=function(){O(this.SendPush,E.iInterval*1e3,this)},t.prototype.StartPush=function(e){typeof e=="object"&&A(e);if(typeof e=="object"){E.bPush===!0?(this.LogMsg(0,"Push Channel STARTED"),E.bfirstTime=!0,O(this.SendPush,1500,this)):(this.LogMsg(0,"Push Channel for RunGetMsgThread IS Started"),O(this.GetMsg,1500,this));return}},t.prototype.StopPush=function(){E.bRun=!1,this.LogMsg(0,"PushCmd stopped!")},t.prototype.DoPopup=function(e,t,n){var r=i();r.SetProperty("URL",e),r.SetProperty(consts.get("SWE_POP_HEIGHT_STR"),n),r.SetProperty(consts.get("SWE_POP_WIDTH_STR"),t),this.LogMsg(3,"doPopup: "+e),SiebelApp.S_App.GetPopupPM().ExecuteMethod("ProcessNewPopup",r)},t.prototype.UpdateCmdMgrMenu=function(e,t){var n=i(),r=SiebelApp.CommandManager.GetInstance();n.SetProperty(e,t),r.UpdateBatchMethods(n)},t.prototype.LogMsg=function(e,t){this.Log(e,"commToolbarUtil.js: "+t)},t.prototype.GetLogTime=function(){return Date.prototype.toISOString||function(){function e(e){var t=String(e);return t.length===1&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(),(new Date).toISOString()+" UTC"},t.prototype.Log=function(e,t){var n=this.GetLogTime();if(e>=o)return;e===0?SiebelJS.Log("["+n+"]:"+"INFO: "+t):e===1?SiebelJS.Log("["+n+"]:"+"ERROR: "+t):e===2?SiebelJS.Log("["+n+"]:"+"WARNING: "+t):SiebelJS.Log("["+n+"]:"+"DEBUG: "+t)};var j="",F=!1,I=10240;t.prototype.SetEnablePSRLog=function(){F=!0,this.LogMsg(0,"Enable PSR Log")},t.prototype.IsPSRLogEnabled=function(){return F},t.prototype.SetClientPSRLogLength=function(e){I=e,this.LogMsg(0,"Set Client PSR Log Length = "+e)},t.prototype.PSRLog=function(e){if(!F)return;var t=this.GetLogTime();j.length!==0&&(j+="\n"),j+="["+t+"]: "+e,j.length>I&&(j="")},t.prototype.GetPSRLog=function(){var e=j;return j="",e};var q=null;return t.prototype.InitShellUI=function(e){if(e){var t=CCFMiscUtil_CreatePropSet();_.call(this,consts.get("DASHBOARD_METHOD_CLEAR"),t,consts.get("NAME_DASHBOARDSVC")),_.call(this,consts.get("CHATUISVC_METHOD_UPDATECHATDATA"),t,consts.get("NAME_CHATUISVC"))}n=SiebelApp.S_App.GetVirtualDir(),b=SiebelApp.S_App.CommToolbar.GetSessionRN(),y=SiebelApp.S_App.CommToolbar.IsUseCookies(),q===null&&(q=SiebelApp.WebSocketManager.CreateWSHandler(consts.get("WS_COMPONENT_TYPE_CTI")),q.OnMessage=U.bind(this),q.OnFail=z.bind(this),q.SetAlertOnFail(!1),q.timeoutID=null);var r={};r[consts.get("WS_MSG_COMMAND")]=consts.get("WS_MSG_CMD_GET_CLIENT_INFO"),q.SendMessage(r),q.cancelCallback=!1,q.timeoutID=O(function(){this.LogMsg(2,"Failed to get client host info. Send init commands without it."),W.call(this),q.cancelCallback=!0},consts.get("WS_CTI_GETCLIENTINFO_TIMEOUT"),this)},t.prototype.SetLogLevel=function(e){o=e},t.prototype.SetNetworkRetryInterval=function(e){p=e*1e3},t.prototype.ImplicitSave=function(){var e=App(),t,n;if(e){t=e.GetMainView();if(t){n=t.GetActiveApplet();if(n)return n.InvokeMethod("ImplicitCommit",CCFMiscUtil_CreatePropSet())}}return this.LogMsg(2,"No active applet!"),!0},t.prototype.IsDeviceSupported=function(){return!m},r}());
