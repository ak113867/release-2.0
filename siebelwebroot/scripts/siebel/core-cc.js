/*<ORACLECOPYRIGHT>
* Copyright (C) 2008-2024
* Oracle and Java are registered trademarks of Oracle and/or its affiliates.
* Other names may be trademarks of their respective owners.
* UNIX is a registered trademark of The Open Group.
*
* This software and related documentation are provided under a license agreement
* containing restrictions on use and disclosure and are protected by intellectual property laws.
* Except as expressly permitted in your license agreement or allowed by law, you may not use, copy,
* reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish,
* or display any part, in any form, or by any means. Reverse engineering, disassembly,
* or decompilation of this software, unless required by law for interoperability, is prohibited.
*
* The information contained herein is subject to change without notice and is not warranted to be error-free.
* If you find any errors, please report them to us in writing.
*
* U.S. GOVERNMENT RIGHTS Programs, software, databases, and related documentation and technical data delivered to U.S.
* Government customers are "commercial computer software" or "commercial technical data" pursuant to the applicable
* Federal Acquisition Regulation and agency-specific supplemental regulations.
* As such, the use, duplication, disclosure, modification, and adaptation shall be subject to the restrictions and
* license terms set forth in the applicable Government contract, and, to the extent applicable by the terms of the
* Government contract, the additional rights set forth in FAR 52.227-19, Commercial Computer Software License
* (December 2007). Oracle America, Inc., 500 Oracle Parkway, Redwood City, CA 94065.
*
* This software or hardware is developed for general use in a variety of information management applications.
* It is not developed or intended for use in any inherently dangerous applications, including applications that
* may create a risk of personal injury. If you use this software or hardware in dangerous applications,
* then you shall be responsible to take all appropriate fail-safe, backup, redundancy,
* and other measures to ensure its safe use. Oracle Corporation and its affiliates disclaim any liability for any
* damages caused by use of this software or hardware in dangerous applications.
*
* This software or hardware and documentation may provide access to or information on content,
* products, and services from third parties. Oracle Corporation and its affiliates are not responsible for and
* expressly disclaim all warranties of any kind with respect to third-party content, products, and services.
* Oracle Corporation and its affiliates will not be responsible for any loss, costs,
* or damages incurred due to your access to or use of third-party content, products, or services.
</ORACLECOPYRIGHT>*/
/* 24.2.0.0SIA[2024_02] */
typeof SiebelAppFacade.MsgBrdCstPresentationModel=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.MsgBrdCstPresentationModel"),SiebelAppFacade.MsgBrdCstPresentationModel=function(){function i(e){SiebelAppFacade.MsgBrdCstPresentationModel.superclass.constructor.call(this,e)}function s(e){var t,n,r,i,s=SiebelApp.S_App.GetService("Message Bar"),o=SiebelApp.S_App.NewPropertySet(),u=SiebelApp.S_App.NewPropertySet(),a=!0;if(e!==null){var f=this.Get("MsgObjArray");for(var l=0;l<e.GetChildCount();l++){o=e.GetChild(l),o.GetProperty("Type",t),o.GetProperty("Body",r);if(r===null||t===null)SiebelJS.Log("Type Body and Id are the required fields"),a=!1;i=o.GetType(),i==="Local"&&(f.splice(0,0,this.MsgBarLocalMessage(o)),o.SetProperty("Msg Id",f[0].id),u.AddChild(o),e.RemoveChild(l),l--)}if(u.GetChildCount()>0){this.SetProperty("MsgChanged",!0);var c=f.length;return this.SetProperty("MsgCount",c),this.SetProperty("MsgObjArray",f),this.GetRenderer().UpdateMsgBar(),u}}if(a&&s){var h={};return h.async=!1,h.selfbusy=!0,h.npr=!1,h.scope=this,s.InvokeMethod("AddNotification",e,h)}}function o(e){var t,n,r,i=0,s=!0,o=SiebelApp.S_App.GetService("Message Bar"),u=SiebelApp.S_App.NewPropertySet();if(e!==null){var a=this.Get("MsgObjArray");for(var f=0;f<e.GetChildCount();f++){u=e.GetChild(f),t=u.GetProperty("Msg Id"),t===null&&(SiebelJS.Log("Row id is required"),s=!1),n=u.GetType();if(n==="Local"){for(r=0;r<a.length&&a[r].id!==t;r++);if(r<a.length&&a[r].id===t){a.splice(r,1),this.SetProperty("MsgChanged",!0);var l=a.length;this.SetProperty("MsgCount",l),this.SetProperty("MsgObjArray",a),this.GetRenderer().UpdateMsgBar()}e.RemoveChild(f),f--,e.GetChildCount()===0&&(s=!1)}}}if(s&&o){var c={};return c.async=!1,c.selfbusy=!0,c.npr=!1,c.scope=this,o.InvokeMethod("DeleteNotification",e,c)}}function u(e){var t,n=0,r=!0,i=SiebelApp.S_App.GetService("Message Bar"),s=SiebelApp.S_App.NewPropertySet();if(e!==null){var o=e.GetChildCount();for(var u=0;u<o;u++)s=e.GetChild(u),s.GetProperty("Msg Id",t),t===null&&(SiebelJS.Log("Row Id is required"),r=!1)}if(r&&i){var a={};return a.async=!1,a.npr=!1,a.selfbusy=!0,a.scope=this,i.InvokeMethod("ReadNotification",e,a)}}function a(e){var t,n,r,i=!0,s=SiebelApp.S_App.GetService("Message Bar"),o=SiebelApp.S_App.NewPropertySet();if(e!==null){var u=this.Get("MsgObjArray");for(var a=0;a<e.GetChildCount();a++){o=e.GetChild(a),t=o.GetProperty("Msg Id"),t===null&&(SiebelJS.Log("Row Id is required"),i=!1),n=o.GetType();if(n==="Local"){for(r=0;r<u.length&&u[r].id!==t;r++);if(r<u.length&&u[r].id===t){u[r]=this.MsgBarLocalMessage(o),u[r].id=t,this.SetProperty("MsgChanged",!0);var f=u.length;this.SetProperty("MsgCount",f),this.SetProperty("MsgObjArray",u),this.GetRenderer().UpdateMsgBar()}e.RemoveChild(r),a--}}}if(i&&n!=="Local"&&s){var l={};return l.async=!1,l.selfbusy=!0,l.npr=!1,l.scope=this,s.InvokeMethod("UpdateNotification",e,l)}}function f(t,n){var r=SiebelApp.S_App.GetService("Message Bar"),i=SiebelApp.S_App.NewPropertySet(),s=SiebelApp.S_App.NewPropertySet();i.SetProperty("User MsgId",t),i.SetProperty("User MsgStatus",n),i.SetProperty(e.get("SWE_BUSINESS_SERVICE"),e.get("SWE_NUMERIC_TRUE"));if(r){s=null;var o={};o.async=!0,o.npr=!1,o.selfbusy=!0,o.scope=this,r.InvokeMethod("UpdateUserMsg",i,o),s=arguments[2]}}function l(e){var t=!1,n=SiebelApp.S_App.GetService("Message Bar"),r=SiebelApp.S_App.NewPropertySet(),i=SiebelApp.S_App.NewPropertySet(),s=e.split(";");for(var o=0;o<s.length;o++){var u=s[o].indexOf(":");if(u<0)continue;var a=$.trim(s[o].substr(0,u)).toLowerCase(),f=$.trim(s[o].substr(u+1));switch(a){case"bo":r.SetProperty("BO",f);break;case"bc":r.SetProperty("BC",f);break;case"view":r.SetProperty("View",f),t=!0;break;case"field":r.SetProperty("Field",f);break;case"file ext":r.SetProperty("File Ext",f);break;case"id":r.SetProperty("Id",f);break;default:}}if(n){i=null;var l={};l.async=!0,l.npr=!1,l.selfbusy=!0,l.scope=this,l.cb=function(){t===!0&&this.GetRenderer().CloseMainDialog()},n.InvokeMethod("DownLoadReport",r,l)}}function c(){if(r){var t=window.sessionStorage.getItem(e.get("SCRIPTDEBUG_PROP_DEBUG_STATE")),n=window.sessionStorage.getItem("WFP_SIM_STATE"),i=window.sessionStorage.getItem("InDebugState"),s=typeof t!="undefined"&&t!==null&&t!==e.get("SCRIPTDEBUG_STATE_INIT"),o=typeof n!="undefined"&&n!==null&&n!=="Init",u=i==="true";if(s||o||u){SiebelJS.Debug("[UpdateMessageBar] Skip: m_bPendingUpdateMessageBar = "+r,!0);return}}var a,f,l=SiebelApp.S_App.GetService("Message Bar"),c=SiebelApp.S_App.NewPropertySet();c.SetProperty(e.get("SWE_BUSINESS_SERVICE"),e.get("SWE_NUMERIC_TRUE"));var h=SiebelApp.S_App.NewPropertySet();if(l){h=null;var p=this,v="UpdatePrefMsg",m={};m.async=!0,m.scope=this,m.npr=!1,m.selfbusy=!0,m.cb=function(){r=!1,SiebelJS.Debug("[UpdateMessageBar] Callback: m_bPendingUpdateMessageBar = "+r,!0),h=arguments[2];if(h!==null){var e=h.GetChildCount();for(var t=0;t<e;t++){var n=h.GetChild(t);if(n!==null&&n.GetType()==="ResultSet"){var i=n.GetProperty("returnVal");d.call(p,i),p.GetRenderer().UpdateMsgBar()}}}},l.InvokeMethod(v,c,m),r=!0,SiebelJS.Debug("[UpdateMessageBar] Invoke: m_bPendingUpdateMessageBar = "+r,!0)}}function h(){var t=SiebelApp.S_App.GetService("Message Bar"),n=SiebelApp.S_App.NewPropertySet();n.SetProperty(e.get("SWE_BUSINESS_SERVICE"),e.get("SWE_NUMERIC_TRUE")),n.SetProperty("IsInitiated","FALSE");var r=SiebelApp.S_App.NewPropertySet();if(t){var i="UpdatePrefMsg",s=this,o={};o.async=!0,o.scope=this,o.selfbusy=!0,o.cb=function(){r=arguments[2];if(r!==null){var e=r.GetChildCount();for(var t=0;t<e;t++){var n=r.GetChild(t);if(n!==null&&n.GetType()==="ResultSet"){var i=n.GetProperty("returnVal");d.call(s,i),s.GetRenderer().CreateMsgBar()}}var o=s.Get("MsgUserPrefObj"),u=parseInt(o.UpdateInterval,10);u!==0&&!isNaN(u)&&setInterval(function(){s.ExecuteMethod("UpdateMessageBar")},u*1e3)}},t.InvokeMethod(i,n,o)}}function p(e){var t=new Array(1);t[0]=0;var n=g(e,t);n=g(e,t);var r=this.Get("MsgUserPrefObj");r.Normal=g(e,t),r.Automation=g(e,t),r.High=g(e,t),r.Urgent=
g(e,t),r.UrgentWA=g(e,t),this.AddProperty("MsgUserPrefObj",r)}function d(e){var t=this.Get("MsgObjArray"),n=!1,r=!1,i=new Array(1);i[0]=0,i[0]=e.indexOf("-$$$-");if(i[0]>=0){if(i[0]>0){var s=e.substring(0,i[0]);p.call(this,s),n=!0}i[0]+=5}else i[0]=0;var o,u,a,f=0,l=0;o=e.indexOf("-|||-",i[0]),u=e.indexOf("--saMe--",i[0]),a=e.indexOf("--saMe--",o);if(u===-1||u>o){var c=parseInt(g(e,i),10),h=parseInt(g(e,i),10),d=parseInt(g(e,i),10),m=v(g(e,i)),y=v(g(e,i)),b=v(g(e,i)),w=v(g(e,i)),E=parseInt(g(e,i),10),S=g(e,i),x=g(e,i),T=g(e,i);if(n){var N=this.Get("MsgUserPrefObj");N.NormalColor=y,N.HighColor=b,N.UrgentColor=w;var C=this.Get("DefaultUpdateInterval");E=E>C?E:C,N.UpdateInterval=E,N.PrefixNormal=S,N.PrefixHigh=x,N.PrefixUrgent=T,this.AddProperty("MsgUserPrefObj",N)}}if(a===-1){while(l<t.length)t[l].local!=="Y"?t.splice(l,1):l++;i[0]=e.indexOf("Msg",o);while(o<i[0]&&i[0]<e.length){i[0]+=3;var k=this.MsgBarMessage(e,i);k!==null&&(t[l]=k,l++)}r=!0}this.SetProperty("MsgChanged",r);if(r){var L=t.length;this.SetProperty("MsgCount",L),this.SetProperty("MsgObjArray",t)}}function v(e){var t=0;if(e.charAt(0)==="#")return e;var n=e.split(","),r="#",i;for(t=0;t<3;t++)i=m(n[t],16),i.length===1&&(i="0"+i),r+=i;return r}function m(e,t){var n="",r=Math.floor(Math.abs(e)),i;if(!r||typeof r=="undefined")return"0";for(;;){i=r%t,n="0123456789abcdefghijklmnopqrstuvwxyz".charAt(i)+n,r=(r-i)/t;if(r===0)break}return e<0?"-"+n:n}function g(e,t){var n="*4*TRUE*",r,i,s=null;if(e.charAt(t[0])==="*"){t[0]++,r=e.indexOf("*",t[0]);if(r>0){s=parseInt(e.substring(t[0],r),10);if(s===null)return""}if(r<e.length&&e.charAt(r)==="*")return i=e.substring(r+1,s+r+1),t[0]=r+s+1,i}return""}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils"),n=0,r=!1;return SiebelJS.Extend(i,SiebelAppFacade.PresentationModel),i.prototype.Init=function(){SiebelApp.S_App.IsMsgBarEnabled()&&(this.AddProperty("DefaultUpdateInterval",30),this.AddProperty("MsgUserPrefObj",{}),this.AddProperty("MsgChanged",!1),this.AddProperty("MsgCount",0),this.AddProperty("MsgObjArray",[]),this.AddMethod("UpdateMessageBar",c),this.AddMethod("AddNotification",s),this.AddMethod("DeleteNotification",o),this.AddMethod("UpdateNotification",a),this.AddMethod("ReadNotification",u),this.AttachEventHandler("ShowMessageBar",h),this.AttachEventHandler("UpdateServer",f),this.AttachEventHandler("DownLoadFileFromServer",l))},i.prototype.Show=function(){var e=this.GetRenderer();e.ShowUI(),e.BindEvents()},i.prototype.Setup=function(e){SiebelAppFacade.MsgBrdCstPresentationModel.superclass.Setup.call(this,e)},i.prototype.MsgBarLocalMessage=function(e){var t,r={};r.local="Y",r.id="LM"+n++,t=e.GetProperty("Callback"),r.callback=typeof t=="undefined"?"":t,t=e.GetProperty("Body"),r.body=typeof t=="undefined"?"":t,t=e.GetProperty("Type"),r.type=typeof t=="undefined"?"":t,t=e.GetProperty("Abstract"),r.summary=typeof t=="undefined"?"":t,t=e.GetProperty("User Message Status"),r.status=typeof t=="undefined"?"":t,t=e.GetProperty("Allow Dismiss"),r.dismiss=typeof t=="undefined"?"":t,t=e.GetProperty("Created");if(typeof t=="undefined"){var i=new Date;t=(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"/"+(i.getDate()<10?"0"+i.getDate():i.getDate())+"/"+i.getFullYear()+" "+(i.getHours()<10?"0"+i.getHours():i.getHours())+":"+(i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes())+":"+(i.getSeconds()<10?"0"+i.getSeconds():i.getSeconds())}return r.created=SiebelApp.S_App.LocaleObject.StringToFormatted("utcdatetime",t,SiebelApp.S_App.LocaleObject.GetDatum("date").GetFormat()),r},i.prototype.MsgBarMessage=function(t,r,i,s){if(t===null)return;var o=g(t,r),u=g(t,r),a=g(t,r),f=g(t,r),l=g(t,r),c=g(t,r),h=g(t,r),p=g(t,r),d=g(t,r),v="MESSAGEBROADCASTING_SYNCNODE=",m=u.indexOf(v),y={};if(i&&i==="Y")y.id=n++,y.local="Y";else{if(m>-1&&window.localStorage){var b=localStorage.getItem(e.get("SYNC_NODE_ID"));if(!(b&&u.indexOf(b,m)>0))return null;var w="PatternStart:",E=u.indexOf(w);u=u.substring(0,E)}y.id=o}return s&&(y.callbcak=s),y.body=u,y.type=a,y.summary=c,y.status=h,y.dismiss=p,y.created=SiebelApp.S_App.LocaleObject.StringToFormatted("utcdatetime",d,SiebelApp.S_App.LocaleObject.GetDatum("date").GetFormat()),y},i}()),typeof SiebelAppFacade.MsgBrdCstPhyRenderer=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.MsgBrdCstPhyRenderer"),SiebelAppFacade.MsgBrdCstPhyRenderer=function(){function l(e){var t=e;this.GetPM=function(){return t};var n="";this.SetHTMLMessages=function(e){n=e},this.GetHTMLMessages=function(){return n};var r=0;this.SetUnreadMsgCount=function(e){r=e},this.GetUnreadMsgCount=function(){return r};var i="siebui-msgbarbkgrnd-msgread-nomsgs";this.SetMsgBarClass=function(e){i=e},this.GetMsgBarClass=function(){return i};var s=!1;this.SetBlinkFlag=function(e){s=e},this.GetBlinkFlag=function(){return s}}function c(e){var t=$(this).closest("div").parent(),n=$(t).attr("data-status");if(n!=="9"){var r=$(t).attr("id"),i=e.data.ctx;i.UpdateUserResponse("2",r),$(t).remove()}}function h(e){var t=e.data.ctx,n=t.GetUnreadMsgCount();if(n===0)return;var r=t.GetPM(),i=r.Get("MsgUserPrefObj"),s=r.Get("MsgObjArray"),o=s.length;for(var u=0;u<o;u++){var a=m(s[u],i,!0),f=s[u].id,l=s[u].status,c=s[u].type;if(l===""||l==="0"){var h=$("#"+f);h.hasClass("siebui-readmessage")!==!0&&(h.removeClass("siebui-unreadmessage"),h.addClass("siebui-readmessage")),c===i.Urgent||c===i.UrgentWA?(h.removeClass("siebui-msgbar-accordian-row-urgent"),h.hasClass("siebui-msgbar-accordian-readmessage-urgent")!==!0&&h.addClass("siebui-msgbar-accordian-readmessage-urgent")):c===i.High?(h.removeClass("siebui-msgbar-accordian-row-high"),h.hasClass("siebui-msgbar-accordian-readmessage-high")!==!0&&h.addClass("siebui-msgbar-accordian-readmessage-high")):c===i.Normal&&(h.removeClass("siebui-msgbar-accordian-row-normal"),h.hasClass("siebui-msgbar-accordian-readmessage-normal")!==!0&&h.addClass("siebui-msgbar-accordian-readmessage-normal")),h.attr("data-status","1"),t.UpdateUserResponse("1",f)}}$("#MakeAllMsgReadBtn"
).addClass("siebui-msgbar-btn-disable")}function p(){$("#Msg_Summary").dialog("close"),$("#dialog_content").length>0&&$("#dialog_content").remove(),$("#Msg_Summary").length>0&&$("#Msg_Summary").remove()}function d(e){if($(".siebui-msgbar-popup").length>0)return;var n=e.data.ctx,i=n.GetPM().Get("MsgUserPrefObj"),s=n.GetHTMLMessages(),o=n.GetUnreadMsgCount(),u=$('<div id="Msg_Summary" ></div>').html(s).dialog({title:r+"("+o+")",dialogClass:"siebui-msgbar-popup",autoOpen:!1,draggable:!1,minHeight:100,modal:!0,resizable:!1,open:function(e,t){$(this).parent().find("div.ui-dialog-titlebar").addClass("titleClass"),$(".siebui-msgbrdcst-accordian").accordion({heightStyle:"fill",active:!1,collapsible:!0,header:"div.siebui-mbar"}).show(),n.bindMessageEvents()},beforeClose:function(e,t){$("#dialog_content").length>0&&$("#dialog_content").remove(),$("#Msg_Summary").length>0&&$("#Msg_Summary").remove()}}),f=$(".siebui-msgbar-popup").find(".ui-dialog-titlebar-close");t.IsTrue(SiebelApp.S_App.IsAutoOn())?(f.attr("ot","Button"),f.attr("rn","MsgClose"),f.attr("un","MsgClose")):f.addClass("hide"),i.Automation==="TRUE"&&($("#Msg_Summary").attr("ot","NotificationSummaryButton"),$("#Msg_Summary").attr("rn","MsgBrdCstSummary"),$("#Msg_Summary").attr("un","MsgBrdCstSummary")),u.dialog("open");var l=$("div.titleClass");if($("#MakeAllMsgReadBtn").length===0){var c="<a id='MakeAllMsgReadBtn' href='javascript:void(0)' role='button' title='"+a+"'></a>";l.append(c),i.Automation==="TRUE"&&($("#MakeAllMsgReadBtn").attr("ot","Link"),$("#MakeAllMsgReadBtn").attr("rn","MsgBrdCstAllRead"),$("#MakeAllMsgReadBtn").attr("un","MsgBrdCstAllRead"))}o===0&&$("#MakeAllMsgReadBtn").addClass("siebui-msgbar-btn-disable"),$("#Msg_Summary").addClass("siebui-msgbrdcst-summary"),$("#siebui-mb-msgbrdcst-accordian .ui-accordion-header").addClass("siebui-msgbrdcst-accordionheader");var h=$("div.siebui-msgbar-div"),p=h.prevAll("div.siebui-msgbar-lhs:first");p.length!==0?$(p).addClass("siebui-msgbar-lastunread"):$(h).addClass("siebui-msgbar-allread");var d=h.nextAll("div.siebui-msgbar-lhs:first");$(d).addClass("siebui-msgbar-firstread"),$("div.titleClass > span.ui-dialog-title").attr("tabindex",0),$("div.titleClass > span.ui-dialog-title").focus()}function v(e){var t=e.keyCode?e.keyCode:e.charCode,n=$(this)[0];switch(t){case 38:$(n).prev().find("div").first().focus(),e.preventDefault();break;case 40:$(n).next().find("div").first().focus(),e.preventDefault();break;case 13:var i=this;if($(this).attr("aria-selected")===!0||$(this).attr("aria-selected")==="true"){var s=e.data.ctx;s.MakeReadMessage(i);var o=r+"("+s.GetUnreadMsgCount()+")";$("div.titleClass > span.ui-dialog-title").text(o);var u=$(this).next();u.attr("tabindex","0")}}}function m(e,n,r){var s,o="siebui-msgbar-msg-normal",u="",a="",f;if(r){s=e.summary;var l=e.body,c=e.dismiss;if(e.type===n.High)o="siebui-msgbar-msg-high";else if(e.type===n.Urgent||e.type===n.UrgentWA)o="siebui-msgbar-msg-urgent";return s.match(/\[D\]/)&&(s=s.replace(/\[D\]/g,""),a=s,l.indexOf("View")!==-1&&(f=!0),f===!0?s="<span class='siebui-msgbrdcst-drilldown-icon'></span><span class='siebui-msgbrdcst-drilldown'>"+s+"</span>":s="<span class='siebui-msgbrdcst-attachment-icon'></span><span class='siebui-msgbrdcst-drilldown'>"+s+"</span>"),t.IsEmpty(a)?c==="Y"?u+="<span class ='"+o+"' role='option' aria-label='Notification Severity :"+e.type+" Notification Summary : "+s+"'>":u+="<span class ="+o+" role='option' aria-label='Notification Severity :"+e.type+" Notification Summary : "+s+"'>":c==="Y"?u+="<span class ='"+o+"' role='option' aria-label='Notification Severity :"+e.type+" Notification Summary : "+a+" Hyperlink'>":u+="<span class ="+o+" role='option' aria-label='Notification Severity :"+e.type+" Notification Summary : "+a+" Hyperlink'>",u+=s+"</span>",u}var h="siebui-msgbar-msg-normal",p=n.PrefixNormal,d;s=e.body;var v=e.type,m=s.length+p.length;v===n.Urgent||v===n.UrgentWA?p=n.PrefixUrgent:v===n.High?p=n.PrefixHigh:v===n.Normal&&(p=n.PrefixNormal),s=s.replace(/\[N\]/g,"<span class='siebui-msgbar-msg-normal'>"+n.PrefixNormal),s=s.replace(/\[H\]/g,"<span class='siebui-msgbar-msg-normal'>"+n.PrefixHigh),s=s.replace(/\[U\]/g,"<span class='siebui-msgbar-msg-normal'>"+n.PrefixUrgent);var g=0,y="";for(;;){g=s.indexOf("<span",g);if(!(g>0))break;g+=5,y+="</span>"}return s+=y,s="<span class='"+h+"' aria-label='"+i+"' tabindex='0'>"+p+s+"</span>",s}function g(e,t,n){var r;return t!==""&&t!=="siebui-msgbarbkgrnd-msgread-nomsgs"?t==="siebui-msgbar-bkgrnd-msg-urgent"?n?r=e.UrgentWA:r=e.Urgent:t==="siebui-msgbar-bkgrnd-msg-high"?r=e.High:t==="siebui-msgbar-bkgrnd-msg-normal"&&(r=e.Normal):r=e.Normal,r}function y(e,t,n){var r="",i,s,o,u,a,f,l,c,h="",p;return i=e.id,s=e.status,o=e.type,u=e.dismiss,a=m(e,t,!1),f=e.created,l=m(e,t,!0),c=e.summary.match(/\[D\]/),s==="1"?o===t.Urgent||o===t.UrgentWA?p="siebui-msgbar-accordian-readmessage-urgent":o===t.High?p="siebui-msgbar-accordian-readmessage-high":o===t.Normal&&(p="siebui-msgbar-accordian-readmessage-normal"):o===t.Urgent||o===t.UrgentWA?p="siebui-msgbar-accordian-row-urgent":o===t.High?p="siebui-msgbar-accordian-row-high":o===t.Normal&&(p="siebui-msgbar-accordian-row-normal"),n?(u==="Y"?h+="<span class='siebui-msgbar-dismiss'><a id='DeleteMsgBtnId' href='javascript:void(0)'></a></span>":h+="<span class='siebui-msgbar-dismiss'></span>",s==="1"?c?r+="<div data-role='collapsible' id='"+i+"' class='siebui-msgbar-lhs siebui-readmessage siebui-mb-drilldown-header "+p+"' data-status='"+s+"' rn='"+i+"' un='"+i+"' ot='MsgHeaderAccordion'"+"><div class='siebui-mbar'>"+l+"<span class='siebui-msgbar-date'>"+f+"</span>"+h+"</div></div>":r+="<div data-role='collapsible' id='"+i+"' class='siebui-msgbar-lhs siebui-readmessage "+p+"' data-status='"+s+"' rn='"+i+"' un='"+i+"' ot='MsgHeaderAccordion'"+"><div class='siebui-mbar'><span class='siebui-msgbar-summary'>"+l+"</span><span class='siebui-msgbar-date'>"+f+"</span>"+h+"</div><div>"+a+"</div></div>":c?r+="<div data-role='collapsible' id='"+i+"' class='siebui-msgbar-lhs siebui-unreadmessage siebui-mb-drilldown-header "+
p+"' data-status='"+s+"' rn='"+i+"' un='"+i+"' ot='MsgHeaderAccordion'"+"><div class='siebui-mbar'>"+l+"<span class='siebui-msgbar-date'>"+f+"</span>"+h+"</div></div>":r+="<div data-role='collapsible' id='"+i+"' class='siebui-msgbar-lhs siebui-unreadmessage "+p+"' data-status='"+s+"' rn='"+i+"' un='"+i+"' ot='MsgHeaderAccordion'"+"><div class='siebui-mbar'><span class='siebui-msgbar-summary'>"+l+"</span><span class='siebui-msgbar-date'>"+f+"</span>"+h+"</div><div>"+a+"</div></div>"):(u==="Y"?h+="<span class='siebui-msgbar-dismiss'><a id='DeleteMsgBtnIdNonMobile' aria-label='Delete Notification' tabindex='0' class='siebui-deletemsgbtn ui-state-default ui-corner-all' role='button' href='javascript:void(0)'><span class='ui-icon ui-icon-circle-close'></span></a></span>":h+="<span class='siebui-msgbar-dismiss'></span>",s==="1"?c?r+="<div id='"+i+"' class='siebui-msgbar-lhs siebui-readmessage "+p+"' data-status='"+s+"' rn='"+i+"' un='"+i+"' ot='MsgHeaderAccordion'"+"><div class='siebui-mbar' role='tab' tabindex='0'>"+l+"<span class='siebui-msgbar-drilldown-date' aria-label='Notification Created :'>"+f+"</span>"+h+"</div><div aria-label='Notification Body' role='tabpanel'></div></div>":r+="<div id='"+i+"' class='siebui-msgbar-lhs siebui-readmessage "+p+"' data-status='"+s+"' rn='"+i+"' un='"+i+"' ot='MsgHeaderAccordion'"+"><div class='siebui-mbar' role='tab' tabindex='0'><span class='siebui-msgbar-summary'>"+l+"</span><span class='siebui-msgbar-date' aria-label='Notification Created :"+f+"'>"+f+"</span>"+h+"</div><div aria-label='Notification Body' role='tabpanel'>"+a+"</div></div>":c?r+="<div id='"+i+"' class='siebui-msgbar-lhs siebui-unreadmessage "+p+"' data-status='"+s+"' rn='"+i+"' un='"+i+"' ot='MsgHeaderAccordion'"+"><div class='siebui-mbar' role='tab' tabindex='0'>"+l+"<span class='siebui-msgbar-drilldown-date' aria-label='Notification Created :'>"+f+"</span>"+h+"</div><div aria-label='Notification Body' role='tabpanel'></div></div>":r+="<div id='"+i+"' class='siebui-msgbar-lhs siebui-unreadmessage "+p+"' data-status='"+s+"' rn='"+i+"' un='"+i+"' ot='MsgHeaderAccordion'"+"><div class='siebui-mbar' role='tab' tabindex='0'><span class='siebui-msgbar-summary'>"+l+"</span><span class='siebui-msgbar-date' aria-label='Notification Created :"+f+"'>"+f+"</span>"+h+"</div><div aria-label='Notification Body' role='tabpanel'>"+a+"</div></div>"),r}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils"),n=SiebelApp.S_App.LocaleObject,r=n.GetLocalString("IDS_MSG_NOTIFICATION_SUMMARY")||"Notification Summary",i=n.GetLocalString("IDS_MSG_NOTIFICATION_DETAILS")||"Notification Details",s=n.GetLocalString("IDS_MSG_NOTIFICATION")||"Notification",o=n.GetLocalString("IDS_MSG_EXPIRED")||"Message Expired",u=n.GetLocalString("IDS_MSG_PREVIOUSLY_READ")||"Previously Read",a=n.GetLocalString("IDS_MSG_MARKALL_AS_READ")||"Mark All as Read",f="";return l.prototype.ShowUI=function(){var e=document.getElementById("HTMLMessageBar");e&&(this.GetPM().OnControlEvent("ShowMessageBar"),$("div[id='HTMLMessageBar']").attr("aria-label","Notification"))},l.prototype.CreateMsgBar=function(){var e=this.GetPM(),t=e.Get("MsgUserPrefObj"),n=e.Get("MsgChanged"),r=SiebelApp.S_App.IsMobileApplication()==="true";n&&this.GenerateMsgMarkup();var i=$("#HTMLMessageBar");i.children().remove();var o=this.GetUnreadMsgCount(),u=o,a=this.GetMsgBarClass(),l=this.GetBlinkFlag();o>=100&&(u=SiebelApp.S_App.GetDirection()?"99+ &lrm;":"99+",a+=" siebui-msgbar-text-sm");var c='<a id="MsgBar" href="javascript:void(0)" class="siebui-msgbar '+a+'" role="status" aria-live="assertive"'+' aria-label="'+u+' Unread Notification"  title="'+s+'"><span>'+u+"</span></a>";i.append(c).trigger("create");if(!r){var h=$("#MsgBar").attr("aria-label"),p=g(t,a,l);h=h+" Priority :"+p,$("#MsgBar").attr("aria-label",h)}t.Automation==="TRUE"&&($("#MsgBar").attr("ot","NotificationButton"),$("#MsgBar").attr("rn","MsgBrdCstIcon"),$("#MsgBar").attr("un","MsgBrdCstIcon")),window.clearInterval(f),this.GetBlinkFlag()&&(this.blink(2e3),this.SetBlinkFlag(!1)),i=null},l.prototype.GenerateMsgMarkup=function(e,n){var r=this.GetPM(),i=r.Get("MsgUserPrefObj"),s=r.Get("MsgObjArray"),o=s.length,a=o,f=0,l,c,h,p=0,d={str:""},v={str:""},m="",g=SiebelApp.S_App.IsMobileApplication()==="true",b="siebui-msgbarbkgrnd-msgread-nomsgs",w=!1,E="<div id='MsgBrdCst_Summary' class='siebui-msgbrdcst-heading'></div><div class='siebui-msgbrdcst-accordian' role='tablist' multiselectable='true'>";for(f=0;f<o;f++)l=s[f].id,c=s[f].status,h=s[f].type,!t.IsEmpty(e)&&!t.IsEmpty(n)&&l===n&&(s[f].status=e,c=e),m=y(s[f],i,g),c==="1"?(a--,p++,v.str+=m):c==="2"?a--:c==="9"?E+=m:(d.str+=m,h===i.Urgent||h===i.UrgentWA?(h===i.UrgentWA&&(w=!0),b="siebui-msgbar-bkgrnd-msg-urgent"):h===i.High&&b!=="siebui-msgbar-bkgrnd-msg-urgent"?b="siebui-msgbar-bkgrnd-msg-high":h===i.Normal&&b!=="siebui-msgbar-bkgrnd-msg-urgent"&&b!=="siebui-msgbar-bkgrnd-msg-high"&&(b="siebui-msgbar-bkgrnd-msg-normal"));E+=d.str,p>0&&(E+="<div class='siebui-msgbar-div' aria-label='"+u+"'><span class='siebui-msgbar-div-text'>"+u+"</span></div>"),E+=v.str,E+="</div>",this.SetHTMLMessages(E),this.SetUnreadMsgCount(a),this.SetMsgBarClass(b),this.SetBlinkFlag(w)},l.prototype.UpdateUserResponse=function(e,t){var n=this.GetPM(),i=n.Get("MsgUserPrefObj"),s=SiebelApp.S_App.IsMobileApplication()==="true";this.GenerateMsgMarkup(e,t);var o=this.GetUnreadMsgCount(),u=o,a=this.GetMsgBarClass(),l=this.GetBlinkFlag(),c=o+" Unread Notification",h=r+"("+o+")";$("div.titleClass > span.ui-dialog-title").text(h),o>=100&&(u=SiebelApp.S_App.GetDirection()?"99+ &lrm;":"99+",a+=" siebui-msgbar-text-sm"),$("#MsgBar > span").text(u),$("#MsgBar").removeClass(),$("#MsgBar").addClass("siebui-msgbar "+a),$("#MsgBar").attr("aria-label",c);if(!s){var p=g(i,a,l);c=$("#MsgBar").attr("aria-label")+" Priority :"+p,$("#MsgBar").attr("aria-label",c)}this.GetBlinkFlag()||window.clearInterval(f),n.OnControlEvent("UpdateServer",t,e)},l.prototype.blink=function(e){f=
window.setInterval(function(){$("#MsgBar").addClass("msgblinkstyle"),window.setTimeout(function(){$("#MsgBar").removeClass("msgblinkstyle")},1e3)},e)},l.prototype.BindEvents=function(){var e=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");e&&(e.Manage($(document),"click",{ctx:this},h,"#MakeAllMsgReadBtn"),e.Manage($(document),"click.MsgBrdCstPhyRenderer",{},p,".ui-widget-overlay"),e.Manage($("#HTMLMessageBar"),"click",{ctx:this},d," a"),SiebelApp.S_App.IsMobileApplication()!=="true"&&e.Manage($(document),"keydown",{ctx:this},v,".siebui-mbar.ui-accordion-header"))},l.prototype.BindData=function(){},l.prototype.UpdateMsgBar=function(){var e=this.GetPM(),t=e.Get("MsgChanged");if(t){this.CreateMsgBar();if($("#Msg_Summary").length>0){var n,i,s;$("#Msg_Summary").html(this.GetHTMLMessages()),$(".siebui-msgbrdcst-accordian").accordion({heightStyle:"fill",active:!1,collapsible:!0,header:"div.siebui-mbar"}).show(),this.bindMessageEvents(),n=$("div.siebui-msgbar-div"),i=n.prevAll("div.siebui-msgbar-lhs:first"),i.length!==0?$(i).addClass("siebui-msgbar-lastunread"):$(n).addClass("siebui-msgbar-allread"),s=n.nextAll("div.siebui-msgbar-lhs:first"),$(s).addClass("siebui-msgbar-firstread");var o="<a id='MakeAllMsgReadBtn' href='javascript:void(0)' role='button' title='"+a+"'></a>",u=$("div.titleClass");$("#MakeAllMsgReadBtn").length===0&&u.append(o)}var f=this.GetUnreadMsgCount();f===0&&$("#MakeAllMsgReadBtn").addClass("siebui-msgbar-btn-disable");var l=r+"("+f+")";$("div.titleClass > span.ui-dialog-title").text(l)}},l.prototype.MessageCB=function(e){var n=this.GetPM().Get("MsgObjArray"),r=n.length,i=e.parentElement.getAttribute("Id"),s="",o,u=CCFMiscUtil_CreatePropSet();for(var a=0;a<r;a++){var f=n[a].id;f===i&&(s=n[a].callback)}if(!t.IsEmpty(s)){var l=s.split(":");l.length===3&&l[0]==="PM"&&(o=SiebelAppFacade.ComponentMgr.FindComponent({id:l[1]}).GetPM(),o.ExecuteMethod(l[2],u),$(".ui-widget-overlay").trigger("click"))}},l.prototype.MakeReadMessage=function(e){var t=this.GetPM(),n=t.Get("MsgUserPrefObj"),r=t.Get("MsgObjArray"),i=e.parentElement;i=$(i);var s=e.parentElement.getAttribute("Id"),o=e.parentElement.getAttribute("data-status"),u,a,f;for(var l=0;l<r.length;l++){var c=r[l].id;if(s===c){a=r[l].summary,u=r[l].type,f=r[l].body;break}}o!=="9"&&(i.hasClass("siebui-readmessage")!==!0&&(i.removeClass("siebui-unreadmessage"),i.addClass("siebui-readmessage")),u===n.Urgent||u===n.UrgentWA?(i.removeClass("siebui-msgbar-accordian-row-urgent"),i.hasClass("siebui-msgbar-accordian-readmessage-urgent")!==!0&&i.addClass("siebui-msgbar-accordian-readmessage-urgent")):u===n.High?(i.removeClass("siebui-msgbar-accordian-row-high"),i.hasClass("siebui-msgbar-accordian-readmessage-high")!==!0&&i.addClass("siebui-msgbar-accordian-readmessage-high")):u===n.Normal&&(i.removeClass("siebui-msgbar-accordian-row-normal"),i.hasClass("siebui-msgbar-accordian-readmessage-normal")!==!0&&i.addClass("siebui-msgbar-accordian-readmessage-normal")));var h=a.match(/\[D\]/);h&&t.OnControlEvent("DownLoadFileFromServer",f),o!=="1"&&o!=="9"&&(i.attr("data-status","1"),this.UpdateUserResponse("1",s)),this.GetUnreadMsgCount()===0&&$("#MakeAllMsgReadBtn").addClass("siebui-msgbar-btn-disable")},l.prototype.bindMessageEvents=function(){var e=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");e&&(e.Manage($(".siebui-msgbrdcst-accordian .siebui-mbar"),"click",{ctx:this},function(e){e.stopImmediatePropagation(),c.call(this,e)},"#DeleteMsgBtnId"),e.Manage($(".siebui-msgbrdcst-accordian .siebui-mbar"),["click","keydown"],{ctx:this},function(e){if(e.type==="click"||e.type==="keydown"&&e.which===13)e.stopImmediatePropagation(),c.call(this,e)},"#DeleteMsgBtnIdNonMobile"),e.Manage($(".siebui-msgbrdcst-accordian .siebui-mbar"),"click",{ctx:this},function(e){var t=this,n=e.data.ctx;n.MakeReadMessage(t)}),e.Manage($(".siebui-msgbrdcst-accordian .ui-accordion-content"),"click",{ctx:this},function(e){var t=this,n=e.data.ctx;n.MessageCB(t)}))},l.prototype.CloseMainDialog=function(){$("#Msg_Summary").length>0&&$("#Msg_Summary").remove()},l}()),typeof SiebelAppFacade.ChatPresentationModel=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.ChatPresentationModel"),define("siebel/chatpmodel",["siebel/pmodel"],function(){return SiebelAppFacade.ChatPresentationModel=function(){function o(){SiebelAppFacade.ChatPresentationModel.superclass.constructor.call(this,{GetName:function(){return"ChatObject"}})}function u(){this.SetProperty("ChatSysPref",{bEnableBlinkTab:!1,nCustomerTypeDisplayTime:n,nAgentTypeDetectInterval:n}),this.SetProperty("ChatTabMap",{}),this.SetProperty("CurrentChat",null),this.SetProperty("CurrentTabOnHold",null),this.SetProperty("NewChatMessage",null),this.SetProperty("ShowTypingMsg",null),this.SetProperty("ChatIdRemoved",null),this.SetProperty("ChatUpdated",null),this.SetProperty("ChatIdHold",null),this.SetProperty("ChatResumed",null),this.SetProperty("ChatClearLog",null),this.SetProperty("TextInput4Set",null),this.SetProperty("UrlInput4Set",null),this.SetProperty("SetFocus",null),this.SetProperty("TextAreaToBeFocusedId",null),this.SetProperty("ChatSetFocusEventList",null),this.SetProperty("SwitchDisabled",!1),this.SetProperty("SwitchTimer",null),this.SetProperty("RestoreScreenEnabled",!0),this.SetProperty("StaticFUTMap",null),this.SetProperty("FUTFieldMap",null),this.SetProperty("FUTEnabled",!1),this.SetProperty("FUTMatchField","text")}function a(n,r){var i,s=n.toUpperCase(),o,u=0;if(!r||r.IsEmpty())return;switch(n){case e.get("CHATUISVC_METHOD_INITIALIZEAX"):f.call(this,r);break;case e.get("CHATUISVC_METHOD_UPDATECHATDATA"):E.call(this,r);break;case e.get("CHATUISVC_METHOD_GETFIELDDATA"):c.call(this,r);break;case e.get("CHATUISVC_METHOD_GETSMARTSHARETEXT"):var a=r.GetPropertyAsStr(e.get("CHATUISVC_TAG_DATA_FIELD"));a&&a.length>0&&this.SetProperty("UpdateSmartShare",a);break;case e.get("CHATUISVC_EVENT_ENDCHAT"):case e.get("CHATUISVC_EVENT_WRAPUPCHAT"):d.call(this,r);var l=r.GetPropertyAsStr(e.get("CHATUISVC_TAG_EVENTCHATID"));l===
this.ExecuteMethod("GetCurrChatId");break;case e.get("CHATUISVC_EVENT_NEWMESSAGEINACTIVE"):case e.get("CHATUISVC_EVENT_UPDATECHATDISPLAYNAME"):case e.get("CHATUISVC_EVENT_ACCEPTCHATHOLD"):d.call(this,r);break;case e.get("CHATUISVC_EVENT_HOLDCHAT"):v.call(this,r);break;case e.get("CHATUISVC_EVENT_ACCEPTCHAT"):case e.get("CHATUISVC_EVENT_RESUMECHAT"):p.call(this,n,r);break;case e.get("CHATUISVC_EVENT_NEWMESSAGE"):L.call(this,r);break;case e.get("CHATUISVC_EVENT_UPDATEDATAFIELD"):var m=r.GetPropertyAsStr(e.get("CHATUISVC_TAG_CURRCHATID"));m!==this.ExecuteMethod("GetCurrChatId")&&_(1,"Current chat id does not match!");var g=r.Clone();this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_GETFIELDDATA"),g);break;case e.get("CHATUISVC_METHOD_REFRESHCHATPANEDASHBOARD"):var y=r.GetPropertyAsStr(e.get("CHATUISVC_TAG_CURRCHATID"));y!==this.ExecuteMethod("GetCurrChatId")&&_(1,"Current chat id does not match!"),S.call(this,r);var b=this.Get("ChatTabMap")[y];b&&this.SetProperty("UpdateDashboard",b);break;case e.get("CHATUISVC_EVENT_SHOWTYPINGMSG"):h.call(this,r);break;case e.get("CHATUISVC_EVENT_SWITCHDONE"):this.Get("SwitchDisabled")&&this.SetProperty("SwitchDisabled",!1);var w=this.Get("SwitchTimer");w!==null&&(clearTimeout(w),this.SetProperty("SwitchTimer",null));break;case e.get("CHATUISVC_METHOD_LOADDYNAMICFUT"):var x=r.GetChildByType("DynamicFUT"),y=r.GetPropertyAsStr(e.get("CHATUISVC_TAG_EVENTCHATID"));F.call(this,x,y);break;case e.get("CHATUISVC_EVENT_RELOADFUTONDATACHANGE"):var y=r.GetPropertyAsStr(e.get("CHATUISVC_TAG_EVENTCHATID"));z.call(this,y);break;case e.get("CHATUISVC_METHOD_RELOADFUTONDATACHANGEFROMSERVER"):var x=r.GetChildByType("DynamicFUT"),y=r.GetPropertyAsStr(e.get("CHATUISVC_TAG_EVENTCHATID"));y?F.call(this,x,y):I.call(this,x);break;case e.get("CHATUISVC_EVENT_RELOADALLFUT"):U.call(this);break;case e.get("CHATUISVC_METHOD_RELOADALLFUTFROMSERVER"):B.call(this,r);var x=r.GetChildByType("DynamicFUT");I.call(this,x);break;case e.get("CHATUISVC_METHOD_SETFUTSTATE"):var T=r.GetPropertyAsStr("IsFUTEnabled");this.SetProperty("FUTEnabled",T.toLowerCase()==="true"?!0:!1);break;case e.get("CHATUISVC_METHOD_SETFUTMATCHFIELD"):var N=r.GetPropertyAsStr("FUTMatchField");t.IsEmpty(N)||this.SetProperty("FUTMatchField",N);var C=r.GetPropertyAsStr("Language");t.IsEmpty(C)||this.SetProperty("LanguageId",C);var k=r.GetPropertyAsStr("Locale");t.IsEmpty(k)||this.SetProperty("LocaleId",k);var A=r.GetPropertyAsStr("FUTMatchFieldName"),O=r.GetPropertyAsStr("FUTMatchFieldValue");if(!t.IsEmpty(A)&&!t.IsEmpty(O)){var M=!0;O==="N"&&(M=!1),A==="locale"?this.SetProperty("FUTMatchFieldLocale",M):A==="language"&&this.SetProperty("FUTMatchFieldLanguage",M)}break;default:}i=this.Get("ChatSetFocusEventList"),u=i.length;for(o=0;o<u;o++)if(s===i[o]){this.ExecuteMethod("SetFocus");break}}function f(t){var n=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_ENABLE_BLINKTAB")),r=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_TYPEDISTIME")),i=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_TYPEDECINTERVAL")),s=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_ENABLE_RESTORESCREEN"));s===e.get("CHATUISVC_VALUE_NO")&&this.SetProperty("RestoreScreenEnabled",!1);var o=this.Get("ChatSysPref"),u=t.GetPropertyAsStr("ChatSetFocusEventList");this.SetProperty("ChatSetFocusEventList",l(u));var a;n&&n===e.get("CHATUISVC_VALUE_YES")&&(o.bEnableBlinkTab=!0),r&&(a=parseInt(r,10),a>0&&(o.nCustomerTypeDisplayTime=a*1e3)),i&&(a=parseInt(i,10),a>0&&(o.nAgentTypeDetectInterval=a*1e3)),this.Get("StaticFUTMap")===null&&(B.call(this,t),j.call(this));var f=t.GetPropertyAsStr("Locale Id");this.SetProperty("LocaleId",f);var c=t.GetPropertyAsStr("Language Code");this.SetProperty("LanguageId",c);var h=t.GetPropertyAsStr("Locales");this.SetProperty("Locales",h);var p=t.GetPropertyAsStr("Languages");this.SetProperty("Languages",p);var d=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_FUT_MATCH_FIELD_LOCALE"));this.SetProperty("FUTMatchFieldLocale",d.toLowerCase()==="true"?!0:!1);var v=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_FUT_MATCH_FIELD_LANGUAGE"));this.SetProperty("FUTMatchFieldLanguage",v.toLowerCase()==="true"?!0:!1);var m=CCFMiscUtil_CreatePropSet();m.DecodeFromString(t.GetPropertyAsStr(e.get("CHATUISVC_TAG_METADATA"))),this.SetProperty("ChatConfigPS",m);var g=CCFMiscUtil_CreatePropSet();g.SetProperty(e.get("CHATUISVC_TAG_NEEDTYPEINFO"),"TRUE"),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_UPDATECHATDATA"),g);var y=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_FUT_STATE"));this.SetProperty("FUTEnabled",y.toLowerCase()==="true"?!0:!1);var b=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_FUT_MATCH_FIELD"));this.SetProperty("FUTMatchField",b)}function l(t){var n=[],r=0,i=0;t=t.replace(/\s+/g,"");if(t.length>0){var s=t.toUpperCase();n=s.split(";"),i=n.length;for(r=0;r<i;r++)n[r].length===0&&n.splice(r,1)}else n.push(e.get("CHATUISVC_METHOD_INITIALIZEAX").toUpperCase()),n.push(e.get("CHATUISVC_EVENT_ACCEPTCHAT").toUpperCase()),n.push(e.get("CHATUISVC_EVENT_RESUMECHAT").toUpperCase());return n}function c(t){var n=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_DATA_FIELD")),r=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_APPEND"));switch(n){case e.get("CHATUISVC_TAG_TRANSCRIPT"):var i=t.GetProperty(e.get("CHATUISVC_TAG_TRANSCRIPT"));g.call(this,i);break;case e.get("CHATCC_METADATA_CTRLNAME_TEXT"):var s=t.GetProperty(e.get("CHATCC_METADATA_CTRLNAME_TEXT"));this.SetProperty("UpdateFrequentlyUsedText",s);break;case e.get("CHATCC_METADATA_CTRLNAME_URL"):var o=t.GetProperty(e.get("CHATCC_METADATA_CTRLNAME_URL"));this.SetProperty("UpdatePushUrl",o);break;case e.get("CHATCC_METADATA_CTRLNAME_KB"):var u=t.GetProperty(e.get("CHATCC_METADATA_CTRLNAME_KB"));this.SetProperty("UpdateKBVisited",u);break;default:}}function h(t){var n=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_CURRCHATID"));if(n===this.ExecuteMethod("GetCurrChatId")){var r=this.Get("ChatTabMap")[n];r&&this.SetProperty("ShowTypingMsg",r)}}function p(t,n){var r=this.Get("CurrentChat"),i="";r&&T(r)&&(i=r.Id,N.call(this,i));var s=n.GetPropertyAsStr
(e.get("CHATUISVC_TAG_CURRCHATID")),o=n.Clone();o.SetPropertyStr(e.get("CHATUISVC_TAG_EVENTCHATID"),s),t===e.get("CHATUISVC_EVENT_RESUMECHAT")&&s!==i&&o.SetProperty(e.get("CHATUISVC_TAG_NEEDTYPEINFO"),"TRUE"),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_UPDATECHATDATA"),o),C.call(this,s)}function d(t){var n=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_CURRCHATID")),r=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_EVENTCHATID")),i=t.Clone(),s=this.ExecuteMethod("GetCurrChatId");s&&(M.call(this,s,e.get("CHATCC_METADATA_CTRLNAME_TEXT"),i),M.call(this,s,e.get("CHATCC_METADATA_CTRLNAME_URL"),i)),r!==n&&i.SetProperty(e.get("CHATUISVC_TAG_EVENTCHATID"),""),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_UPDATECHATDATA"),i)}function v(t){var n=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_CURRCHATID")),r=this.Get("CurrentChat"),i=t.Clone();n&&r&&r.Id===n&&(T(r)?(i.SetProperty(e.get("CHATUISVC_TAG_EVENTCHATID"),n),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_REMOVECHATDATA"),i)):(M.call(this,n,e.get("CHATCC_METADATA_CTRLNAME_TEXT"),i),M.call(this,n,e.get("CHATCC_METADATA_CTRLNAME_URL"),i),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_SAVEINPUTFIELDS"),i)),N.call(this,n))}function m(t,n){_(3,"OnSwitchChat: "+t+", "+n);var r=CCFMiscUtil_CreatePropSet();r.SetPropertyStr(e.get("CHATUISVC_TAG_CURRCHATID"),t),r.SetPropertyStr(e.get("CHATUISVC_TAG_NEWSELECTEDCHATID"),n),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_SWITCHCHAT"),r)}function g(e,n){var r=this.Get("CurrentChat");if(!r)return;var i=r.Id,s=this.Get("ChatTabMap"),o=s[i];if(o){t.IsEmpty(n)&&(n=!0),n||this.SetProperty("ChatClearLog",{chatId:i});var u=this,a=0;$($.parseXML(e)).find("message, pushurl, system-message").each(function(){a++;if(!n||a>o.transcriptCnt){var e=$(this).prop("tagName").toUpperCase(),t=$(this).attr("userName"),r=$(this).attr("timestamp"),s=$(this).attr("from")==="agent",f=!1,l=$.trim($(this).text());switch(e){case"MESSAGE":f=!1;break;case"PUSHURL":f=!0,s=!0;break;case"SYSTEM-MESSAGE":t="System Message",s=!0,f=!1;break;default:return}var c={chatId:i,userName:t,text:l,timestamp:r,isAgent:s,isUrl:f};u.SetProperty("NewChatMessage",c)}}),o.transcriptCnt=a,a>0&&u.SetProperty("ReadLastMessage",i)}}function y(t){var n,r=t.GetChildCount();for(n=0;n<r;n++){var i=t.GetChild(n);i.GetType()===e.get("CHAT_PST_TYPE_LOCALE")&&this.AddProperty("LocaleInfo",b.call(this,i))}}function b(t){if(t.GetType()!==e.get("CHAT_PST_TYPE_LOCALE"))return;var n=!0,r,i,s={},o,u=t.GetPropertyCount();for(o=0;o<u;o++)n?(r=t.GetFirstProperty(),n=!1):r=t.GetNextProperty(),i=t.GetProperty(r),r===e.get("CHAT_PANE_CAPTION")&&(s.CAPTION=i);return s}function w(){u.call(this),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_INITIALIZEAX"))}function E(t){S.call(this,t);var n=t.GetProperty(e.get("CHATUISVC_TAG_TRANSCRIPT"));g.call(this,n,!1);var r=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_CURRCHATID")),i=this.Get("ChatTabMap")[r];i&&this.SetProperty("UpdateDashboard",i);var s=this.Get("CurrentChat");if(s){var o=s[e.get("CHATCC_METADATA_CTRLNAME_TEXT")];this.ExecuteMethod("GetTextInputValue",s.Id);var u=this.Get("TextInput4Get");u||this.SetProperty("TextInput4Set",o);var a=s[e.get("CHATCC_METADATA_CTRLNAME_URL")];this.ExecuteMethod("GetUrlInputValue",s.Id);var f=this.Get("UrlInput4Get");f||this.SetProperty("UrlInput4Set",a)}}function S(t){if(!t)return;var n=this.Get("ChatTabMap"),r=t.GetProperty(e.get("CHATUISVC_TAG_CURRCHATID")),i=t.GetProperty(e.get("CHATUISVC_TAG_CURRCHATONHOLD")),s=null,o,u=t.GetChildCount();for(o=0;o<u;o++){s=t.GetChild(o);if(s&&s.GetType()==="Tab"){var a=s.GetProperty(e.get("CHATUISVC_TAG_CHATID")),f=n[a];f||(f={Id:a,agentTypingSentTime:0,transcriptCnt:0},n[a]=f),x.call(this,f,s),T(f)&&a!==r?k.call(this,a):this.SetProperty("ChatUpdated",f),a===r&&(this.SetProperty("CurrentChat",f),i&&!T(f)&&N.call(this,a))}}this.SetProperty("ChatTabMap",n)}function x(t,n){var r=n.GetProperty(e.get("CHATUISVC_TAG_CAPTION")),i=n.GetProperty(e.get("CHATUISVC_TAG_NEWMESSAGECOUNT")),s=n.GetProperty(e.get("CHATUISVC_TAG_LASTMESSAGE")),o=n.GetProperty(e.get("CHATUISVC_TAG_CHATSTATE"));t.state=o,t.caption=r,t.newMsgCnt=i,i>0&&(t.newMsg=s);var u=n.GetChildByType(e.get("CHATUISVC_TAG_TYPE_FIELD"));if(u){var a=u.EnumProperties(!0);do t[a]=u.GetProperty(a);while(a=u.EnumProperties(!1))}if(!t.futItems){var f=CCFMiscUtil_CreatePropSet();f.SetProperty(e.get("CHATUISVC_TAG_EVENTCHATID"),t.Id),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_LOADDYNAMICFUT"),f)}}function T(t){return t.state===e.get("CHATUISVC_CHATSTATE_TERMINATE")}function N(e,t){var n=this.Get("ChatTabMap")[e];if(!n){_(1,"Holding chat info not found!");return}var r=this.Get("CurrentTabOnHold");r||(this.SetProperty("CurrentTabOnHold",n),r=n,this.SetProperty("ChatIdHold",e));var i=this.Get("CurrentChat");if(i!==r){_(1,"Holding chat is not current!");return}!t&&T(n)&&(k.call(this,e,!0),this.SetProperty("CurrentTabOnHold",null),this.SetProperty("CurrentChat",null))}function C(e){var t=this.Get("ChatTabMap")[e];if(!t){_(1,"Resuming chat info not found!");return}this.SetProperty("CurrentTabOnHold",null),this.SetProperty("CurrentChat",t),this.SetProperty("ChatResumed",t)}function k(t,n){if(t){this.SetProperty("ChatIdRemoved",t);var r=this.Get("ChatTabMap");if(r.hasOwnProperty(t)){delete r[t];if(!n){var i=CCFMiscUtil_CreatePropSet();i.SetProperty(e.get("CHATUISVC_TAG_EVENTCHATID"),t),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_REMOVECHATDATA"),i)}}}}function L(t){var n=t.GetPropertyAsStr(e.get("CHATUISVC_TAG_CURRCHATID")),r=this.Get("CurrentChat");if(!r){_(1,"Fatal error, current chat is invalid!");return}var i=r.Id;n!==i&&_(1,"Current chat id does not match!");var s=t.Clone();s.SetPropertyStr(e.get("CHATUISVC_TAG_DATA_FIELD"),e.get("CHATUISVC_TAG_TRANSCRIPT")),s.SetPropertyStr(e.get("CHATUISVC_TAG_APPEND"),e.get("CHATUISVC_VALUE_YES")),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_GETFIELDDATA"
),s)}function A(e){}function O(e){}function M(t,n,r,i){if(n===e.get("CHATCC_METADATA_CTRLNAME_TEXT")){this.ExecuteMethod("GetTextInputValue",t);var s=this.Get("TextInput4Get");r.SetPropertyStr(e.get("CHATCC_METADATA_CTRLNAME_TEXT"),s),i&&this.SetProperty("TextInput4Set","")}else if(n===e.get("CHATCC_METADATA_CTRLNAME_URL")){this.ExecuteMethod("GetUrlInputValue",t);var o=this.Get("UrlInput4Get");r.SetPropertyStr(e.get("CHATCC_METADATA_CTRLNAME_URL"),o),i&&this.SetProperty("UrlInput4Set","")}}function _(e,t){D(e,"chatpmodel.js: "+t)}function D(e,n){SiebelApp.S_App.CommToolbarUtil?SiebelApp.S_App.CommToolbarUtil.Log(e,n):e<r&&(e=e<i.length?e:i.length-1,SiebelJS.Debug("["+t.GetISODateTime(null,!0)+"]: "+i[e]+n))}function P(){var t=CCFMiscUtil_CreatePropSet();t.SetProperty(e.get("SWE_VIEW_ID_STR"),e.get("CHAT_PANE_VIEWNAME")),t.SetPropertyStr("SWEBS","1");var n=this.ExecuteMethod("GetCurrChatId");n&&(M.call(this,n,e.get("CHATCC_METADATA_CTRLNAME_TEXT"),t),M.call(this,n,e.get("CHATCC_METADATA_CTRLNAME_URL"),t)),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_TOGGLECHATPANE"),t)}function H(){var e=!0,t=App();if(t===undefined||t===null)return _(2,"App() failed!"),e;var n=App().GetMainView();if(n===undefined||n===null)return _(2,"No main view found!"),e;var r=n.GetActiveApplet();return r===undefined||r===null?(_(2,"No active applet found!"),e):(e=r.InvokeMethod("ImplicitCommit",CCFMiscUtil_CreatePropSet()),e)}function B(e){var t=e.GetChildByType("StaticFUT",!0),n=t.EnumChildren(!0);if(n){var r={};do R(n,r);while(n=t.EnumChildren(!1));this.SetProperty("StaticFUTMap",r)}}function j(){var e={};e.name=s.GetLocalString("IDS_CHAT_FUT_NAME"),e.type=s.GetLocalString("IDS_CHAT_FUT_TYPE"),e.subject=s.GetLocalString("IDS_CHAT_FUT_SUBJECT"),e.text=s.GetLocalString("IDS_CHAT_FUT_TEXT"),e.locale=s.GetLocalString("CHAT_FUT_FILTER_USER_LOCALE"),e.language=s.GetLocalString("CHAT_FUT_FILTER_USER_LANGUAGE"),this.SetProperty("FUTFieldMap",e)}function F(e,t){var n=this.Get("ChatTabMap");if(n){var r=n[t];r&&q.call(this,e,r)}}function I(e){var t=this.Get("ChatTabMap");if(t)for(var n in t){var r=t[n];q.call(this,e,r)}}function q(e,t){var n=e.GetChildByType(t.Id,!0);if(n){t.futItems={},$.extend(t.futItems,this.Get("StaticFUTMap"));var r=n.EnumChildren(!0);if(r)do R(r,t.futItems);while(r=n.EnumChildren(!1))}}function R(e,t){var n={},r=e.GetProperty("Template Name"),i=e.GetProperty("Template Text");r&&i&&(n.name=r,n.type=e.GetProperty("Section Type"),n.subject=e.GetProperty("Subject Text"),n.localeId=e.GetProperty("Locale Code"),n.langId=e.GetProperty("Language Code"),n.text=i,t[r]=n)}function U(){var t=CCFMiscUtil_CreatePropSet();this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_RELOADALLFUTFROMSERVER"),t)}function z(t){var n=CCFMiscUtil_CreatePropSet();n.SetProperty(e.get("CHATUISVC_TAG_EVENTCHATID"),t),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_RELOADFUTONDATACHANGEFROMSERVER"),n)}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils"),n=3e3,r=3,i=["INFO: ","ERROR: ","WARNING: ","DEBUG: "],s=SiebelJS.Dependency("SiebelApp.S_App.LocaleObject");return SiebelJS.Extend(o,SiebelAppFacade.BasePM),o.prototype.Init=function(){this.AddProperty("ChatSysPref",{bEnableBlinkTab:!1,nCustomerTypeDisplayTime:n,nAgentTypeDetectInterval:n}),this.AddProperty("ChatTabMap",{}),this.AddProperty("CurrentChat",null),this.AddProperty("CurrentTabOnHold",null),this.AddProperty("NewChatMessage",null),this.AddProperty("ShowTypingMsg",null),this.AddProperty("ChatIdRemoved",null),this.AddProperty("ChatUpdated",null),this.AddProperty("ChatIdHold",null),this.AddProperty("ChatResumed",null),this.AddProperty("ChatClearLog",null),this.AddProperty("TextInput4Set",null),this.AddProperty("UrlInput4Set",null),this.AddProperty("ReadLastMessage",null),this.AddProperty("SetFocus",null),this.AddProperty("TextAreaToBeFocusedId",null),this.AddProperty("ChatConfigPS",null),this.AddProperty("UpdateDashboard",null),this.AddProperty("UpdateSmartShare",null),this.AddProperty("UpdateFrequentlyUsedText",null),this.AddProperty("UpdatePushUrl",null),this.AddProperty("UpdateKBVisited",null),this.AddProperty("ChatSetFocusEventList",null),this.AddProperty("SwitchDisabled",!1),this.AddProperty("SwitchTimer",null),this.AddProperty("RestoreScreenEnabled",!0),this.AddProperty("StaticFUTMap",null),this.AddProperty("FUTFieldMap",null),this.AddProperty("FUTEnabled",!1),this.AddProperty("FUTMatchField","text"),this.AddProperty("FUTMatchFieldLocale",!1),this.AddProperty("FUTMatchFieldLanguage",!1),this.AddProperty("LocaleId",null),this.AddProperty("LanguageId",null),this.AddProperty("Languages",null),this.AddProperty("Locales",null),this.AddMethod("InvokeServiceMethod",function(t,n,r){var i=SiebelApp.S_App.GetService(e.get("NAME_CHATUISVC"));if(i){_(3,"Open UI - Chat: Invoke Chat UI Business Service Method: "+t),n||(n=CCFMiscUtil_CreatePropSet()),n.SetPropertyStr(e.get("CHATUISVC_TAG_METHOD"),t),r=i.InvokeMethod(t,n);if(r){var s=r.GetChildByType(e.get("CHATCC_PROPSET_TYPE_RESULT"));if(s){var o=s.GetProperty(e.get("CHATUISVC_TAG_METHOD"));o&&a.call(this,o,s)}}}else _(1,"Open UI - Chat: Chat UI Business Service Not Found!")}),this.AddMethod("GetCurrChatId",function(){var e=this.Get("CurrentChat");return e?e.Id:""}),this.AddMethod("AgentTyping",function(t){var n=this.Get("ChatTabMap")[t];if(n&&(new Date).getTime()-n.agentTypingSentTime>=this.Get("ChatSysPref").nAgentTypeDetectInterval){n.agentTypingSentTime=(new Date).getTime();var r=CCFMiscUtil_CreatePropSet();r.SetProperty(e.get("CHATUISVC_TAG_CURRCHATID"),t),r.SetPropertyStr("SWEBS","1"),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_SENDAGENTTYPINGMSG"),r)}}),this.AddMethod("SendMessage",function(t){if(t&&t.chatId&&t.text){var n=CCFMiscUtil_CreatePropSet(),r,i;t.isUrl?(r=e.get("CHATCC_METADATA_CTRLNAME_URL"),i=e.get("CHATUISVC_METHOD_PUSHURL")):(r=e.get("CHATCC_METADATA_CTRLNAME_TEXT"),i=e.get("CHATUISVC_METHOD_SENDMESSAGE")),n.SetProperty
(e.get("CHATUISVC_TAG_CURRCHATID"),t.chatId),n.SetProperty(r,t.text),this.ExecuteMethod("InvokeServiceMethod",i,n)}}),this.AddMethod("ImplicitSave",function(){return H()}),this.AddMethod("SwitchChat",function(e,t){m.call(this,e,t)}),this.AddMethod("LoadChatData",function(){w.call(this)}),this.AddMethod("HoldTab",function(e){N.call(this,e)}),this.AddMethod("GetTextInputValue",function(){A.call(this)}),this.AddMethod("GetUrlInputValue",function(){O.call(this)}),this.AddMethod("LogMsg",function(e,t){D.call(this,e,t)}),this.AddMethod("CloseChatPane",function(){P.call(this)}),this.AddMethod("SetFocus",function(){this.SetProperty("SetFocus",!0)}),this.AddMethod("SetFocusToTextInput",function(){this.SetProperty("SetFocusToTextInput",!0)}),this.AddMethod(e.get("CHATUISVC_METHOD_SETFUTSTATE"),function(t){var n=CCFMiscUtil_CreatePropSet();n.SetProperty("IsFUTEnabled",t?"true":"false"),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_SETFUTSTATE"),n)}),this.AttachEventHandler(e.get("CHAT_PANE_CLOSE"),function(){P.call(this),SiebelApp.S_App.UnregisterExtObject("ChatPane")}),this.AttachEventHandler(e.get("CHAT_FUT_MATCH_FIELD_CHANGED"),function(t,n,r,i){var s=CCFMiscUtil_CreatePropSet();n!==null&&t!==null&&(t==="matching"?s.SetProperty("FUTMatchField",n):t==="language"?s.SetProperty("Language",n):t==="locale"&&s.SetProperty("Locale",n)),r!==null&&i!==null&&(s.SetProperty("FUTMatchFieldName",r),s.SetProperty("FUTMatchFieldValue",i)),this.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_SETFUTMATCHFIELD"),s)})},o.prototype.Setup=function(e){e.SetProperty("SWE_OUI_RENDERER","ChatPhyRenderer"),SiebelAppFacade.ChatPresentationModel.superclass.Setup.call(this,e),y.call(this,e)},o.prototype.HandleNotify=function(e){this.AddProperty("LocaleInfo",{}),y.call(this,e)},o.prototype.Notify=function(t){var n=this;t.each(function(){var t=CCFMiscUtil_CreatePropSet();t.DecodeFromString($(this).text());var r=t.GetProperty(e.get("CHATUISVC_TAG_EVENT"));a.call(n,r,t)})},o}(),SiebelAppFacade.ChatPresentationModel})),typeof SiebelAppFacade.ChatPhyRenderer=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.ChatPhyRenderer"),define("siebel/chatprenderer",["siebel/basephyrenderer"],function(){return SiebelAppFacade.ChatPhyRenderer=function(){function s(e){SiebelAppFacade.ChatPhyRenderer.superclass.constructor.call(this,e)}function o(t){t.data.ctx.GetPM().OnControlEvent(e.get("CHAT_PANE_CLOSE")),r="CLOSED",I.call(t.data.ctx,$("#SS_ChatUI"))}function u(e){(e.which===$.ui.keyCode.ENTER||e.which===$.ui.keyCode.SPACE)&&$(this).trigger("click")}function a(e){r==="DOCK"?(r="HIDDEN",I.call(e.data.ctx,$("#SS_ChatUI"))):r==="HIDDEN"?r="DOCK":r==="FLOAT"&&(e.data.ctx.GetPM().ExecuteMethod("CloseChatPane"),r="DOCK")}function f(e){var t=$(e.target),n=t.attr("id");e.preventDefault(),n==="commPanelChatToShowMore"?ft.showMoreMode(e,t):n==="commPanelChatToShowLess"&&ft.showLessMode(e,t)}function l(e){(e.which===$.ui.keyCode.ENTER||e.which===$.ui.keyCode.SPACE)&&f(e)}function c(e){$("#CommunicationPanelContainer").length>0&&$(window).trigger("resize.commpanel",e)}function h(e,t){var n=this;t.data("uiDraggable")===undefined?t.draggable({handle:e,start:function(){r==="FLOAT"&&t.css({right:"",bottom:""})},drag:function(e,i){r==="DOCK"&&(r="FLOAT",F.call(n,t)),i.position=i.offset},stop:function(e,n){var r=n.offset.top,i=n.offset.left,s=$(window).width(),o=t.outerWidth(!0),u=50-o+parseInt(t.css("marginRight"),10),a=$(window).height()-$("#s_chatpane").find("#s_chatpaneheader").outerHeight(!0)-$("#s_chatpane").find(".siebui-chat-tab-head").outerHeight(!0)-parseInt(t.css("marginTop"),10)-5;r<0?t.css("top",0):r>a&&t.css("top",a),SiebelApp.S_App.GetDirection()?i<u?t.css("left",u):i>s-o&&t.css("left",s-o):i<5?t.css("left",5):i>s-50&&t.css("left",s-50)}}):t.draggable("option","handle",e);var i=$("#s_chatpane").find("#s_chatwrap");i.css("cursor","default")}function p(e){var t=$("#s_chatpane").find("#s_chatwrap"),n=$("#SS_ChatUI");if(r==="FLOAT")if(i===undefined||i==="MAXIMIZED")i="MINIMIZED",t.css("display","none"),n.css({top:"",bottom:5});else if(i==="MINIMIZED"){i="MAXIMIZED",t.css("display",""),n.css({top:5,bottom:""});var s=e.data.ctx.GetPM(),o=s.Get("TextAreaToBeFocusedId"),u=s.ExecuteMethod("GetCurrChatId");o&&u===o&&ft.exists(o)&&ft.setFocus(o),s.SetProperty("TextAreaToBeFocusedId",null)}}function d(e,t){e.GetPM().ExecuteMethod("AgentTyping",t)}function v(e,t,n){j.call(e,3,"OnHoldTab: "+t),e.GetPM().ExecuteMethod("HoldTab",t,n)}function m(e,t){var n=e.GetPM().ExecuteMethod("GetCurrChatId");j.call(e,3,"OnSendMessage: "+t.toString()),SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+n+"] Send Message."),e.GetPM().ExecuteMethod("SendMessage",t)}function g(e){return e.GetPM().ExecuteMethod("ImplicitSave")}function y(e,t,n){var r=e.GetPM(),i,s=r.Get("RestoreScreenEnabled");r.Get("SwitchDisabled")||(j.call(e,3,"OnSwitchTab: "+t+", "+n),SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+n+"] Switch Tab."),s&&r.SetProperty("SwitchDisabled",!0),r.ExecuteMethod("SwitchChat",t,n),s&&(i=setTimeout(function(){r.SetProperty("SwitchDisabled",!1),r.SetProperty("SwitchTimer",null),j.call(e,2,"OnSwitchChat: No SwitchDone event came in 3 seconds, force switch enabled")},3e3),r.SetProperty("SwitchTimer",i)))}function b(){var e=this.GetPM().Get("NewChatMessage");e&&(ft.hideTypingIndicator(e.chatId),ft.appendMessage(e.chatId,e.userName,e.text,e.timestamp,e.isAgent,e.isUrl))}function w(){var e=this.GetPM().Get("ShowTypingMsg");e&&(ft.showTypingIndicator(e.Id),setTimeout(function(){ft.hideTypingIndicator(e.Id)},this.GetPM().Get("ChatSysPref").nCustomerTypeDisplayTime))}function E(){var t=this.GetPM().Get("ChatResumed");if(t){var n=t.Id;t.state===e.get("CHATUISVC_CHATSTATE_ACTIVE")?ft.enableTab(n):t.state===e.get("CHATUISVC_CHATSTATE_WRAPUP")?ft.wrapupTab(n):ft.disableTab(n),ft.activeTab(n),r==="FLOAT"&&i==="MINIMIZED"&&this.GetPM().SetProperty("TextAreaToBeFocusedId",n),j.call(this,3,n+" is resumed")}}function S(){var e=this.GetPM
().Get("ChatIdHold");e&&(ft.disableTab(e),j.call(this,3,e+" is held"))}function x(){var e=this.GetPM().Get("ChatIdRemoved");e&&(ft.closeTab(e),j.call(this,3,e+" is removed"))}function T(){var t=this.GetPM().Get("ChatUpdated");if(t){var n=t.Id;ft.existTab(n)?(ft.setTabCaption(n,t.caption),j.call(this,3,n+" is updated")):(ft.newTab(n,t.caption),j.call(this,3,n+" is added")),t.state===e.get("CHATUISVC_CHATSTATE_ACTIVE")?ft.enableTab(n):t.state===e.get("CHATUISVC_CHATSTATE_WRAPUP")?ft.wrapupTab(n):ft.disableTab(n),t.newMsgCnt>0&&ft.updateUnread(n,t.newMsgCnt),ft.setTabTooltip(n,C(t))}}function N(){var e=this.GetPM().Get("CurrentChat");if(e){var t=e.Id;ft.existTab(t)&&(ft.activeTab(t),j.call(this,3,"Current chat is set to: "+t))}}function C(e){return e.newMsgCnt>0?e.newMsg:e.caption}function k(e,t){var n=this.GetPM().Get("ChatSysPref");n&&n.bEnableBlinkTab&&(t?e.addEffectForCommToolbar("blink"):e.addEffectForCommToolbar("stopblink"))}function L(){var t=this.GetPM().Get("ChatTabMap"),n;for(n in t)if(t.hasOwnProperty(n)){var r=t[n];if(!r)continue;var i=this.GetPM().ExecuteMethod("GetCurrChatId");if(r.Id===i&&r.state!==e.get("CHATUISVC_CHATSTATE_HOLDNEW"))ft.changeTabState(n,"terminate holdNew newMsg newMsgHoldNew","remove");else if(r.state===e.get("CHATUISVC_CHATSTATE_WRAPUP")||r.state===e.get("CHATUISVC_CHATSTATE_TERMINATE"))ft.changeTabState(n,"terminate holdNew newMsg newMsgHoldNew","remove"),ft.changeTabState(n,"terminate","add");else if(r.newMsgCnt>0||r.state===e.get("CHATUISVC_CHATSTATE_HOLDNEW"))r.newMsgCnt<=0?ft.changeTabState(n,"holdNew","add"):r.state!==e.get("CHATUISVC_CHATSTATE_HOLDNEW")?ft.changeTabState(n,"newMsg","add"):(ft.changeTabState(n,"holdNew","add"),ft.changeTabState(n,"newMsgHoldNew","add"))}}function A(){var e=this.GetPM().Get("ChatClearLog");e&&ft.clearMessage(e.chatId)}function O(){var e=this.GetPM().ExecuteMethod("GetCurrChatId"),t=this.GetPM().Get("TextInput4Set");ft.setInputText(e,t)}function M(){var e=this.GetPM().ExecuteMethod("GetCurrChatId"),t=this.GetPM().Get("UrlInput4Set");ft.setInputUrl(e,t)}function _(e){var t=ft.getInputText(e);this.GetPM().AddProperty("TextInput4Get",t)}function D(e){var t=ft.getInputUrl(e);this.GetPM().AddProperty("UrlInput4Get",t)}function P(){var e=this.GetPM().Get("ReadLastMessage");ft.readLastMessage(e)}function H(){if(r==="DOCK"||r==="FLOAT"){var e=this.GetPM().ExecuteMethod("GetCurrChatId");e&&ft.existTab(e)?ft.setFocus(e):B()}}function B(){$("#s_chatcaption").focus()}function j(e,t){this.GetPM().ExecuteMethod("LogMsg",e,"chatprenderer.js: "+t)}function F(e){e.css("position","fixed"),e.css("z-index","99"),$("#_sweview").removeClass("siebui-chatpane-content-indent")}function I(e){e.css("position",""),e.css("z-index","")}function q(){var e=this.GetPM(),t=e.ExecuteMethod("GetCurrChatId");t&&ft.existTab(t)&&(r==="DOCK"||r==="FLOAT"&&i!=="MINIMIZED"?ft.setFocus(t):r==="FLOAT"&&i==="MINIMIZED"&&e.SetProperty("TextAreaToBeFocusedId",t))}function R(){var n=this.GetPM().Get("ChatConfigPS"),r=[],i=$("#s_chatcaption");if(i){var s=U(e.get("CHATCC_METADATA_CTRLNAME_CHATTITLE"),n);i.html(s),i.attr({"aria-label":s,title:s})}var o=$("#s_chatpane").find("#s_chatclose");if(o){var u=U(e.get("CHATCC_METADATA_CTRLNAME_CLOSECHAT"),n),a=z(e.get("CHATCC_METADATA_CTRLNAME_CLOSECHAT"),n),f=W(e.get("CHATCC_METADATA_CTRLNAME_CLOSECHAT"),n);o.attr({"aria-label":u,title:ft.getButtonTooltip(u,a)}),f!==e.get("CHATUISVC_VALUE_YES")&&o.hide(),ft.bindHotkey(ft.$dom.chatPaneEl,a,"closeChat"),t.IsTrue(SiebelApp.S_App.IsAutoOn())&&o.attr(e.get("SWE_PROP_AUTOM_OT"),"button").attr(e.get("SWE_PROP_AUTOM_RN"),"chatClose").attr(e.get("SWE_PROP_AUTOM_UN"),u)}ft.updateDashboardSwitch({display:U(e.get("CHATCC_METADATA_CTRLNAME_SHOWDASH"),n),visible:W(e.get("CHATCC_METADATA_CTRLNAME_SHOWDASH"),n),hotkey:z(e.get("CHATCC_METADATA_CTRLNAME_SHOWDASH"),n)},{display:U(e.get("CHATCC_METADATA_CTRLNAME_HIDEDASH"),n),visible:W(e.get("CHATCC_METADATA_CTRLNAME_HIDEDASH"),n),hotkey:z(e.get("CHATCC_METADATA_CTRLNAME_HIDEDASH"),n)}),ft.updateTextLabel({display:U(e.get("CHATCC_METADATA_CTRLNAME_TEXT"),n)}),ft.updateTextLinks([{display:U(e.get("CHATCC_METADATA_CTRLNAME_PASTE"),n),hotkey:z(e.get("CHATCC_METADATA_CTRLNAME_PASTE"),n),visible:W(e.get("CHATCC_METADATA_CTRLNAME_PASTE"),n),fnName:"smartShare",fnType:"mousedown",className:"siebui-chat-toolbar-share"},{display:U(e.get("CHATCC_METADATA_CTRLNAME_FUT_CHANGEMATCHFIELD"),n),hotkey:z(e.get("CHATCC_METADATA_CTRLNAME_FUT_CHANGEMATCHFIELD"),n),fnName:"frequentlyUsedText",visible:W(e.get("CHATCC_METADATA_CTRLNAME_FUT_CHANGEMATCHFIELD"),n),fnType:"click",className:"siebui-chat-toolbar-used-txt"},{display:U(e.get("CHATCC_METADATA_CTRLNAME_FUT_TOGGLE_STATE"),n),hotkey:z(e.get("CHATCC_METADATA_CTRLNAME_FUT_TOGGLE_STATE"),n),fnName:"toggleFUTState",visible:W(e.get("CHATCC_METADATA_CTRLNAME_FUT_TOGGLE_STATE"),n),fnType:"click",className:"siebui-chat-toolbar-toggle-fut"},{display:U(e.get("CHATCC_METADATA_CTRLNAME_SEND"),n),hotkey:z(e.get("CHATCC_METADATA_CTRLNAME_SEND"),n),visible:W(e.get("CHATCC_METADATA_CTRLNAME_SEND"),n),fnName:"sendText",fnType:"click",className:"siebui-chat-toolbar-send-txt"}]),ft.updateUrlLabel({display:U(e.get("CHATCC_METADATA_CTRLNAME_URL"),n)}),ft.updateUrlLinks([{display:U(e.get("CHATCC_METADATA_CTRLNAME_URLLIB"),n),hotkey:z(e.get("CHATCC_METADATA_CTRLNAME_URLLIB"),n),visible:W(e.get("CHATCC_METADATA_CTRLNAME_URLLIB"),n),fnName:"pushUrl",fnType:"click",className:"siebui-chat-toolbar-push-url"},{display:U(e.get("CHATCC_METADATA_CTRLNAME_PUSHURL"),n),hotkey:z(e.get("CHATCC_METADATA_CTRLNAME_PUSHURL"),n),visible:W(e.get("CHATCC_METADATA_CTRLNAME_PUSHURL"),n),fnName:"sendUrl",fnType:"click",className:"siebui-chat-toolbar-send-url"}]);var l=n.GetChildByType(e.get("CHATCC_METADATA_CTRLNAME_DASHBOARDFIELDS"));if(l){r=X.call(this,l,n);var c=n.GetChildByType(e.get("CHATCC_METADATA_CTRLNAME_ACTIONLABEL"));if(c){var h=V.call(this,c,n);h&&r.push(h)}ft.createDashboard(r)}ft.setSystemMessage(U(e.get("CHATCC_METADATA_CTRLNAME_SYSTEMMESSAGE")
,n)),ft.setTypingIndicator(U(e.get("CHATCC_METADATA_CTRLNAME_CUSTOMERTYPINGMESSAGE"),n))}function U(t,n){var r=n.GetChildByType(t),i="";return r&&(i=r.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_DISPLAY"))),i}function z(t,n){var r=n.GetChildByType(t),i="";return r&&(i=r.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_HOTKEY"))),i}function W(t,n){var r=n.GetChildByType(t),i=e.get("CHATUISVC_VALUE_YES");return r&&(i=r.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_VISIBLE"))),i}function X(t,n){var r=[],i=[],s=t.GetChildCount(),o,u,a;for(o=0;o<s;++o){var f=t.GetChild(o),l=f.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_CTRLNAME")),c=f.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_LENGTH")),h=f.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_DISPLAY")),p=f.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_VISIBLE")),d=parseInt(f.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_ROW")),10),v=parseInt(f.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_COLUMN")),10),m=(d-1)*2+v-1;r[m]={name:l,length:c.toLowerCase(),visible:p,label:h.replace(":",""),field:{type:"text"}}}for(o in r)r.hasOwnProperty(o)&&i.push(r[o]);return a={display:U(e.get("CHATCC_METADATA_CTRLNAME_KBBUTTON"),n),visible:W(e.get("CHATCC_METADATA_CTRLNAME_KBBUTTON"),n),hotkey:z(e.get("CHATCC_METADATA_CTRLNAME_KBBUTTON"),n)},u=U(e.get("CHATCC_METADATA_CTRLNAME_KB"),n),i.push({name:e.get("CHATCC_METADATA_CTRLNAME_KB"),length:"full",visible:W(e.get("CHATCC_METADATA_CTRLNAME_KB"),n),label:u.replace(":",""),field:{type:"input"},button:a}),i}function V(t,n){var r,i,s,o=[],u=[],a;r=t.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_VISIBLE")),i=t.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_DISPLAY"));if(r===e.get("CHATUISVC_VALUE_YES")){var f=t.GetChildCount(),l;for(l=0;l<f;++l){var c=t.GetChild(l);c&&(r=c.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_VISIBLE")),r===e.get("CHATUISVC_VALUE_YES")&&(u.push(c.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_CTRLNAME"))),o.push(c.GetPropertyAsStr(e.get("CHATCC_METADATA_TAG_DISPLAY")))))}return a={display:U(e.get("CHATCC_METADATA_CTRLNAME_GO"),n),visible:W(e.get("CHATCC_METADATA_CTRLNAME_GO"),n),hotkey:z(e.get("CHATCC_METADATA_CTRLNAME_GO"),n)},s={name:e.get("CHATCC_METADATA_CTRLNAME_ACTIONLABEL"),length:"full",visible:e.get("CHATUISVC_VALUE_YES"),label:i.replace(":",""),field:{type:"combo",options:o.join(","),actions:u.join(",")},button:a},s}return null}function J(){var e=this.GetPM().Get("UpdateDashboard");e&&ft.updateDashboard(e)}function K(){ft.appendInputText(this.GetPM().Get("UpdateSmartShare"))}function Q(){ft.appendInputText(this.GetPM().Get("UpdateFrequentlyUsedText"))}function G(){var e=this.GetPM().Get("UpdatePushUrl"),t={text:e,chatId:ft.currChatId,userName:ft.currUserName,isUrl:!0};ft.onSendMessage(ft.renderer,t)}function Y(){var e=this.GetPM().Get("UpdateKBVisited");ft.updateKBVisited(e)}function Z(){this.GetPM().Get("SwitchDisabled")?$(".siebui-chat-tab-head-item a").addClass("siebui-chat-tab-head-item-unclickable"):$(".siebui-chat-tab-head-item a").removeClass("siebui-chat-tab-head-item-unclickable")}function et(e){e&&SiebelApp.S_App.GetService("Communications Client").InvokeMethod(e)}function tt(t,n){var r=t.GetPM(),i=r.ExecuteMethod("GetCurrChatId"),s=CCFMiscUtil_CreatePropSet();s.SetPropertyStr(e.get("CHATUISVC_TAG_CURRCHATID"),i),s.SetPropertyStr(e.get("CHATUISVC_TAG_ACTION"),n),r.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_SERVERACTION"),s)}function nt(){et("PickKBVisited")}function rt(t){var n=ot();if(n){ft.appendInputText(n);return}var r=t.GetPM(),i=r.ExecuteMethod("GetCurrChatId"),s=CCFMiscUtil_CreatePropSet();s.SetPropertyStr(e.get("CHATUISVC_TAG_CURRCHATID"),i),r.ExecuteMethod("InvokeServiceMethod",e.get("CHATUISVC_METHOD_GETSMARTSHARETEXT"),s)}function it(){et("PickFrequentlyUsedText")}function st(){et("PickURLLibrary")}function ot(){var e="";try{if(window.getSelection)if(document.activeElement&&document.activeElement.tagName&&(document.activeElement.tagName.toLowerCase()==="textarea"||document.activeElement.tagName.toLowerCase()==="input")){var t=document.activeElement.value;e=t.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var n=window.getSelection();e=n.toString()}else if(document.selection&&document.selection.createRange){var r=document.selection.createRange();e=r.text}}catch(i){SiebelApp.S_App.CommToolbarUtil.Log(3,"commToolbarprender.js: get selected text failed!")}return e}function ut(){ft.updateFUTState.call(ft)}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils"),n=SiebelJS.Dependency("SiebelApp.S_App.LocaleObject"),r,i;SiebelJS.Extend(s,SiebelAppFacade.BasePR),s.prototype.Init=function(){SiebelAppFacade.ChatPhyRenderer.superclass.Init.call(this),this.AttachPMBinding("NewChatMessage",b,{scope:this}),this.AttachPMBinding("ShowTypingMsg",w,{scope:this}),this.AttachPMBinding("ChatResumed",E,{scope:this}),this.AttachPMBinding("ChatIdHold",S,{scope:this}),this.AttachPMBinding("ChatIdRemoved",x,{scope:this}),this.AttachPMBinding("ChatUpdated",T,{scope:this}),this.AttachPMBinding("ChatClearLog",A,{scope:this}),this.AttachPMBinding("TextInput4Set",O,{scope:this}),this.AttachPMBinding("UrlInput4Set",M,{scope:this}),this.AttachPMBinding("GetTextInputValue",function(e){_.call(this,e)},{scope:this}),this.AttachPMBinding("GetUrlInputValue",function(e){D.call(this,e)},{scope:this}),this.AttachPMBinding("ChatTabMap",L,{scope:this}),this.AttachPMBinding("CurrentChat",N,{scope:this}),this.AttachPMBinding("ReadLastMessage",P,{scope:this}),this.AttachPMBinding("SetFocus",H,{scope:this}),this.AttachPMBinding("SetFocusToTextInput",q,{scope:this}),this.AttachPMBinding("ChatConfigPS",R,{scope:this}),this.AttachPMBinding("UpdateDashboard",J,{scope:this}),this.AttachPMBinding("UpdateSmartShare",K,{scope:this}),this.AttachPMBinding("UpdateFrequentlyUsedText",Q,{scope:this}),this.AttachPMBinding("UpdatePushUrl",G,{scope:this}),this.AttachPMBinding("UpdateKBVisited",Y,{scope:this}),this.AttachPMBinding("SwitchDisabled",Z,{scope:this})
,this.AttachPMBinding("FUTEnabled",ut,{scope:this})},s.prototype.ShowUI=function(){if(!SiebelApp.S_App.CommToolbarUtil.IsDeviceSupported()){var e=$("#SS_ChatUI");e.length>0&&e.addClass("hidden"),j.call(this,0,"ShowUI: Disable chat for non-windows device");return}SiebelAppFacade.ChatPhyRenderer.superclass.ShowUI.call(this),ft.init({renderer:this,onTitleBarFocus:B,onHoldTab:v,onSwitchTab:y,onAgentTyping:d,onSendMessage:m,onKBClick:nt,onActionClick:tt,onSmartShareClick:rt,onFrequentlyUsedText:it,onPushUrl:st,onImplicitSave:g}),ft.showUI();var t=$("#s_chatpane").parent(),n=t.siblings("a.next-item-applet").attr("title")+" "+SiebelApp.S_App.LocaleObject.GetLocalString("IDS_SWE_FORM_APPLET");t.attr({role:"region",title:n});var r=$("#SS_ChatUI");r&&r.attr("role","application");var i=$("#s_chatcaption");i&&i.attr({tabindex:"0",role:"label"});var s=$("#s_chatpane").find("#s_chatclose");s&&s.attr({tabindex:"0",role:"button"})},s.prototype.BindEvents=function(){if(!SiebelApp.S_App.CommToolbarUtil.IsDeviceSupported()){j.call(this,0,"BindEvents: Disable chat for non-windows device");return}SiebelAppFacade.ChatPhyRenderer.superclass.BindEvents.call(this);var e=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(e){var t=$("#SS_ChatUI");if(t){var n=$("#s_chatpane").find("#s_chatclose"),i=$("#s_toolbar").find("[name='Toggle Chat Pane']"),s=$("#s_chatpane").find("#s_chatpaneheader");n.length>0&&(e.Manage(n,"click",{ctx:this},o),e.Manage(n,"keydown",{ctx:this},u));if(i.length>0){if(r===undefined||r==="CLOSED")r="DOCK";r==="DOCK"?(I.call(this,t),t.css({top:0,right:"",bottom:"",left:0})):r==="FLOAT"&&F.call(this,t),i.off("mouseup"),e.Manage(i,"mouseup",{ctx:this},a)}s.length>0&&(h.call(this,s,t),e.Manage(s,"dblclick",{ctx:this},p));var c=$("#CommunicationPanelContainer #commPanelChatToggle");c.length>0&&(e.Manage(c,"click",{ctx:this},f),e.Manage(c,"keydown",{ctx:this},l))}}},s.prototype.BindData=function(){if(!SiebelApp.S_App.CommToolbarUtil.IsDeviceSupported()){j.call(this,0,"BindData: Disable chat for non-windows device");return}this.GetPM().ExecuteMethod("LoadChatData")};var at={tmplTabArea:'<div class="siebui-chat-tabs"><div class="siebui-chat-tab-head"><ul id="chatTabItems" class="siebui-chat-tab-head-items" role="tablist"></ul><div class="siebui-chat-toggle-area"><div class="siebui-chat-dashboard-toggle" id="chatToggleDashboard"><div class="siebui-chat-title-wrap" title=""><a href="javascript:;" id="chatToHideDashboard" class="siebui-chat-dashboard-switch-visible" data-clickFn="hideDashboard" role="button" aria-hidden="false" aria-label="" tabindex="0"></a></div><div class="siebui-chat-title-wrap" title=""><a href="javascript:;" id="chatToShowDashboard" class="siebui-chat-dashboard-switch-hidden" data-clickFn="showDashboard" role="button" aria-hidden="true" aria-label="" tabindex="0" style="display: none;"></a></div></div></div></div><div class="siebui-chat-tab-body" role="tabpanel"><div id="chatDashboard" class="siebui-chat-dashboard" role="grid"></div><div id="chatMsg" class="siebui-chat-msg"><ul id="chatMsgLog" class="siebui-chat-msg-log" role="log" tabindex="-1"></ul><div id="chatTyping" class="siebui-chat-msg-typing" role="status" aria-live="assertive"></div><div id="chatNewMsg" class="siebui-chat-msg-reading" role="status" aria-live="assertive"></div></div></div></div>',tmplTextArea:'<div id="chatTextArea"><div id="chatTextToolbar" class="siebui-chat-toolbar siebui-chat-toolbar-txt" role="toolbar"><div id="chatTextLabel" class="siebui-chat-toolbar-label"><span tabindex="0" title="" aria-label=""></span></div><div id="chatTextLinks" class="siebui-chat-toolbar-links"></div></div><div id="chatInputWrap" class="siebui-chat-in siebui-chat-text-in"><textarea id="chatTextInput" class="siebui-chat-input siebui-chat-text-input" name="chatTextInput" tabindex="0" role="textbox" aria-label=""></textarea></div></div>',tmplTextLink:'<div class="siebui-chat-title-wrap" title="{{title}}"><a href="javascript:;" class="siebui-chat-toolbar-item {{className}}" data-mousedownFn="{{mousedownFnName}}" data-clickFn="{{clickFnName}}" aria-label="{{label}}" role="button" tabindex="-1">{{text}}</a></div>',tmplUrlArea:'<div id="chatUrlArea" class="siebui-chat-url-area"><div id="chatUrlToolbar" class="siebui-chat-toolbar siebui-chat-toolbar-url" role="toolbar"><div id="chatUrlLabel" class="siebui-chat-toolbar-label"><span tabindex="0" title="" aria-label=""></span></div><div id="chatUrlLinks" class="siebui-chat-toolbar-links"></div></div><div class="siebui-chat-in siebui-chat-url-in"><input id="chatUrlInput" class="siebui-chat-input siebui-chat-url-input" name="chatUrlInput" tabindex="0" role="textbox" aria-label="" /></div></div>',tmplUrlLink:'<div class="siebui-chat-title-wrap" title="{{title}}"><a href="javascript:;" class="siebui-chat-toolbar-item {{className}}" data-mousedownFn="{{mousedownFnName}}" data-clickFn="{{clickFnName}}" aria-label="{{label}}" role="button" tabindex="-1">{{text}}</a></div>',tmplMaskArea:'<div class="siebui-chat-mask" id="chatMask"></div>',tmplTabHeadItem:'<li class="siebui-chat-tab-head-item" tabindex="-1" role="tab" aria-selected="false" aria-label="{{userName}}" data-chatId="{{chatId}}" data-userName="{{userName}}" data-clickFn="clickTab clickTabItemTabindex"><div class="siebui-chat-title-wrap" title="{{userName}}"><a href="javascript:;" tabindex="-1">{{userName}}</a></div><span class="siebui-chat-tab-head-item-count" style="display: none;"></span></li>',tmplDashboardItemShort:'<div class="siebui-chat-dashboard-item siebui-chat-dashboard-item-short" data-clickFn="clickDashboardTabindex" tabindex="-1" aria-label="{{label}}:{{text}}" title="{{label}}:{{text}}"  role="row"><div class="siebui-chat-dashboard-item-title"><span class="siebui-chat-dashboard-item-name">{{label}}</span><span class="siebui-chat-dashboard-item-colon">:</span></div><div class="siebui-chat-dashboard-item-content"><div class="siebui-chat-dashboard-item-content-wrap"><p class="siebui-chat-dashboard-item-content-txt">{{text}}</p></div></div></div>'
,tmplDashboardItemLong:'<div class="siebui-chat-dashboard-item siebui-chat-dashboard-item-long" data-clickFn="clickDashboardTabindex" tabindex="-1" aria-label="{{label}}:{{text}}" title="{{label}}:{{text}}"><div class="siebui-chat-dashboard-item-title"><span class="siebui-chat-dashboard-item-name">{{label}}</span><span class="siebui-chat-dashboard-item-colon">:</span></div><div class="siebui-chat-dashboard-item-content><div class="siebui-chat-dashboard-item-content-wrap"><p class="siebui-chat-dashboard-item-content-txt">{{text}}</p></div></div></div>',tmplDashboardItemRichInput:'<div class="siebui-chat-dashboard-item siebui-chat-dashboard-item-long"><div class="siebui-chat-dashboard-item-title"><span class="siebui-chat-dashboard-item-name" tabindex="-1" aria-label="{{label}}" title="{{label}}" data-clickFn="clickDashboardTabindex">{{label}}</span><span class="siebui-chat-dashboard-item-colon">:</span></div><div class="siebui-chat-dashboard-item-content"><div class="siebui-chat-dashboard-item-content-wrap"><input id="chatKBVisited" class="siebui-chat-dashboard-item-content-rich" type="text" value="{{text}}" aria-label="{{text}}" title="{{text}}" data-clickFn="clickDashboardTabindex" tabindex="-1" role="textbox" readonly /><div class="siebui-chat-title-wrap" title="{{buttonTooltip}}"><a href="javascript:;" data-clickFn="clickKB clickDashboardTabindex" class="siebui-chat-dashboard-item-content-btn siebui-chat-dashboard-kb-btn" tabindex="-1" role="button" aria-label="{{buttonLabel}}">{{buttonLabel}}</a></div></div></div></div>',tmplDashboardItemRichSelect:'<div class="siebui-chat-dashboard-item siebui-chat-dashboard-item-long {{className}}"><div class="siebui-chat-dashboard-item-title"><span class="siebui-chat-dashboard-item-name" tabindex="-1" aria-label="{{label}}" data-clickFn="clickDashboardTabindex" title="{{label}}">{{label}}</span><span class="siebui-chat-dashboard-item-colon">:</span></div><div class="siebui-chat-dashboard-item-content"><div class="siebui-chat-dashboard-item-content-wrap"><select id="chatAction" class="siebui-chat-dashboard-item-content-rich" data-clickFn="clickDashboardTabindex" tabindex="-1" role="combobox">{{options}}</select><div class="siebui-chat-title-wrap" title="{{buttonTooltip}}"><a href="javascript:;" data-clickFn="clickAction clickDashboardTabindex" class="siebui-chat-dashboard-item-content-btn siebui-chat-dashboard-action-btn" tabindex="-1" role="button" aria-label="{{buttonLabel}}">{{buttonLabel}}</a></div></div></div></div>',tmplOption:'<option data-action="{{action}}" {{isSelect}} role="option" aria-label="{{option}}">{{option}}</option>',tmplMsgLogItem:'<li class="siebui-chat-msg-log-item {{agentClassName}}" tabindex="-1" aria-label="{{userName}} {{time}} {{msg}}" data-clickFn="clickTabindex"><span class="siebui-chat-msg-log-item-name" title="{{userName}}">{{userName}}</span><span class="siebui-chat-msg-log-item-date" title="{{time}}">({{time}})</span><span class="siebui-chat-msg-log-item-colon">:</span><p class="siebui-chat-msg-log-item-content" title="{{msg}}">{{msg}}</p></li>',tmplMsgLogUrlItem:'<li class="siebui-chat-msg-log-item {{agentClassName}} siebui-chat-msg-log-item-push-url" tabindex="-1" aria-label="{{userName}} {{time}} {{msg}}" data-clickFn="clickTabindex"><span class="siebui-chat-msg-log-item-name" title="{{userName}}">{{userName}}</span><span class="siebui-chat-msg-log-item-date" title="{{time}}">({{time}})</span><span class="siebui-chat-msg-log-item-colon">:</span><a href="{{url}}" title="{{msg}}" class="siebui-chat-msg-log-item-content" target="_blank">{{msg}}</a></li>',tmplFUTFieldOption:'<option {{isSelect}} role="option" value="{{name}}" aria-label="{{label}}">{{label}}</option>',tmplFUTFieldCheck:'<input type="checkbox" id="{{name}}" name="{{name}}" aria-label="{{name}}" value="{{isCheck_Y}}" aria-checked="{{isCheck_true}}"> {{label}}',tmplFUTMatchFieldelectMenu:'<div class="siebui-chat-fut-popup"><ul><li><select class="siebui-chat-fut-popup-select" role="combobox">{{options}}</select></li><li><div class="siebui-chat-fut-popup-locale">{{locale}}</div><select class="siebui-chat-fut-popup-select-l" id="localeCombobox" disabled role="combobox">{{localeOptions}}</select></li><li><div class="siebui-chat-fut-popup-language">{{language}}</div><select class="siebui-chat-fut-popup-select-l" id="languageCombobox" disabled role="combobox">{{languageOptions}}</select></li></ul></div>'},ft={empty:function(){},getTotalHeight:function(e){if(!e||!e.length)return;var t=parseInt(e.css("margin-top")||0,10)+parseInt(e.css("margin-bottom")||0,10),n=parseInt(e.css("padding-top")||0,10)+parseInt(e.css("padding-bottom")||0,10),r=parseInt(e.css("border-top")||0,10)+parseInt(e.css("border-bottom")||0,10),i=t+n+r+(e.height()||0);return i},getCursorPosition:function(e){var t=0,n=null;if(document.selection)n=document.selection.createRange(),n.moveStart("character",-e.value.length),t=n.text.length;else if(e.selectionStart||e.selectionStart==="0")t=e.selectionStart;return t},setCursorPosition:function(e,t){var n=null;e.setSelectionRange?(e.focus(),e.setSelectionRange(t,t)):e.createTextRange&&(n=e.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select())},isKeysEqual:function(e,t){return e.sort().join("")===t.sort().join("")},isKeyExist:function(e,t){if(e===""||e===undefined)return!0;var n=0,r=0,i=null;for(n=0,r=t.length;n<r;n++){i=t[n];if(i.key===e)return!0}return!1},compileTMPL:function(e,t,n){var r="",i=null,s="",o=e;for(r in t)t.hasOwnProperty(r)&&(s="{{\\s*"+r+"\\s*}}",i=new RegExp(s,"g"),o=o.replace(i,t[r]));return o},adaptSize:function(){var e=$("#SS_ChatUI");e.length&&this.$dom.chatEl.width(e.width())},initEl:function(){this.$dom.chatUI=$("#CommunicationPanelContainer #SS_ChatUI"),this.$dom.chatPaneEl=$("#s_chatpane"),this.$dom.chatCloseEl=$("#s_chatclose"),this.$dom.chatTabItems=$("#chatTabItems"),this.$dom.chatDashboard=$("#chatDashboard"),this.$dom.commPanelChatToggle=$("#commPanelChatToggle"),this.$dom.commPanelChatToShowLess=
$("#commPanelChatToShowLess"),this.$dom.commPanelChatToShowMore=$("#commPanelChatToShowMore"),this.$dom.chatToggleDashboard=$("#chatToggleDashboard"),this.$dom.chatToShowDashboard=$("#chatToShowDashboard"),this.$dom.chatToHideDashboard=$("#chatToHideDashboard"),this.$dom.chatMsg=$("#chatMsg"),this.$dom.chatMsgLog=$("#chatMsgLog"),this.$dom.chatMask=$("#chatMask"),this.$dom.chatTyping=$("#chatTyping"),this.$dom.chatNewMsg=$("#chatNewMsg"),this.$dom.chatTextArea=$("#chatTextArea"),this.$dom.chatTextToolbar=$("#chatTextToolbar"),this.$dom.chatTextLabel=$("#chatTextLabel"),this.$dom.chatTextLinks=$("#chatTextLinks"),this.$dom.chatInputWrap=$("#chatInputWrap"),this.$dom.chatTextInput=$("#chatTextInput"),this.$dom.chatUrlArea=$("#chatUrlArea"),this.$dom.chatUrlToolbar=$("#chatUrlToolbar"),this.$dom.chatUrlLabel=$("#chatUrlLabel"),this.$dom.chatUrlLinks=$("#chatUrlLinks"),this.$dom.chatUrlInput=$("#chatUrlInput")},bindHotkey:function(e,t,n,r){if(t===""||n==="")return;r?r="enabled "+r:r="enabled";var i=this.keyFnArr,s=this.isKeyExist,o=t.split(";"),u=0,a=0,f="",l=!1;for(u=0,a=o.length;u<a;u++)f=o[u].toLowerCase().replace(/\s/g,""),l=s(f,i),l||i.push({key:f,fnName:n,triggerStatus:r.split(" ")})},bindListener:function(){this.eventHelper.Manage(this.$dom.chatPaneEl,"keydown",{ctx:this},this.chatKeyDown),this.eventHelper.Manage(this.$dom.chatEl,"click",{ctx:this},this.chatClick),this.eventHelper.Manage(this.$dom.chatEl,"mousedown",{ctx:this},this.chatMouseDown),this.eventHelper.Manage(this.$dom.chatTabItems,"keydown",{ctx:this},this.chatTabItemsKeyDown),this.eventHelper.Manage(this.$dom.chatDashboard,"keydown",{ctx:this},this.chatDashboardKeyDown),this.eventHelper.Manage(this.$dom.chatMsgLog,"keydown",{ctx:this},this.chatMsgLogKeyDown),this.eventHelper.Manage(this.$dom.chatTextLinks,"keydown",{ctx:this},this.chatTextLinksKeyDown),this.eventHelper.Manage(this.$dom.chatTextInput,"input",{ctx:this},this.chatTextInputChange),this.eventHelper.Manage(this.$dom.chatTextInput,"keyup",{ctx:this},this.chatTextInputKeyUp),this.eventHelper.Manage(this.$dom.chatTextInput,"click",{ctx:this},this.chatTextInputClick),this.eventHelper.Manage(this.$dom.chatTextInput,"keydown",{ctx:this},this.chatTextInputKeyDown),this.eventHelper.Manage(this.$dom.chatTextInput,"keypress",{ctx:this},this.chatTextInputKeyPress),this.eventHelper.Manage(this.$dom.chatUrlLinks,"keydown",{ctx:this},this.chatUrlLinksKeyDown),this.eventHelper.Manage(this.$dom.chatUrlInput,"input",{ctx:this},this.chatUrlInputChange),this.eventHelper.Manage(this.$dom.chatUrlInput,"keydown",{ctx:this},this.chatUrlInputKeyDown),this.eventHelper.Manage(this.$dom.chatUrlInput,"keypress",{ctx:this},this.chatUrlInputKeyPress),this.eventHelper.Manage(this.$dom.chatMsg,"resize",{ctx:this,child:this.$dom.chatMsgLog,diff:this.$dom.chatMsg.height()-this.$dom.chatMsgLog.height()},this.onChatControlResize),this.eventHelper.Manage(this.$dom.chatInputWrap,"resize",{ctx:this,child:this.$dom.chatTextInput,diff:this.$dom.chatInputWrap.height()-this.$dom.chatTextInput.height()},this.onChatControlResize)},futPanelResize:function(e){var t=e.data.ctx;t.$dom.chatTextInput.autocomplete("close"),$(window).off("resize.futpanel"),$("#CommunicationPanelContainer").off("scroll.futpanel")},chatKeyDown:function(e){var t=e.data.ctx;(e.keyCode===$.ui.keyCode.ENTER||e.keyCode===$.ui.keyCode.SPACE)&&t.chatKeyDownFn(e),t.hotKeyFn(e),t.preventTabFn(e)},hotKeyFn:function(e){var t=e.data.ctx,n=t.keyFnArr,r=null,i=null,s="",o=-1,u=null,a,f=n.length,l=t.storedMap[t.currChatId].status;for(a=0;a<f;a++)r=n[a],i=r.key.toLowerCase().split("+"),s=i[i.length-1],o=s.toUpperCase().charCodeAt(0),u=[s],e.keyCode===o&&(e.ctrlKey&&u.push("ctrl"),e.shiftKey&&u.push("shift"),e.altKey&&u.push("alt"),t.isKeysEqual(i,u)&&(r.triggerStatus.indexOf(l)!==-1&&t[r.fnName]&&t[r.fnName](e),e.preventDefault(),e.stopPropagation()))},preventTabFn:function(e){var t=e.data.ctx,n=$(e.target),r=n.parent().attr("id");r==="chatTextLinks"&&!e.shiftKey&&e.keyCode===$.ui.keyCode.TAB&&(e.preventDefault(),t.setChatTextInputFocus()),r==="chatUrlLabel"&&e.shiftKey&&e.keyCode===$.ui.keyCode.TAB&&(e.preventDefault(),t.setChatTextInputFocus())},chatClick:function(e){var t=e.data.ctx,n=$(e.target),r="";while(n.attr("id")!=="s_chatwrap")r=n&&n.attr("data-clickFn"),r&&t.clickFn(e,n),n=n.parent()},chatMouseDown:function(e){var t=e.data.ctx,n=$(e.target),r="";while(n.attr("id")!=="s_chatwrap")r=n&&n.attr("data-mousedownFn"),r&&t.mousedownFn(e,n),n=n.parent()},clickFn:function(e,t){var n=t.attr("data-clickFn"),r=n.split(" "),i,s=r.length;for(i=0;i<s;i++)switch(r[i]){case"showDashboard":this.showDashboard(e,t);break;case"hideDashboard":this.hideDashboard(e,t);break;case"showLessMode":this.showLessMode(e,t);break;case"showMoreMode":this.showMoreMode(e,t);break;case"sendText":if(this.isDisabled()||this.isWrapup())break;this.sendText(e,t);break;case"frequentlyUsedText":if(this.isDisabled()||this.isWrapup())break;this.frequentlyUsedText(e,t);break;case"toggleFUTState":if(this.isDisabled()||this.isWrapup())break;this.toggleFUTState(e,t);break;case"pushUrl":if(this.isDisabled()||this.isWrapup())break;this.pushUrl(e,t);break;case"sendUrl":if(this.isDisabled()||this.isWrapup())break;this.sendUrl(e,t);break;case"clickTab":this.clickTab(e,t);break;case"clickKB":if(this.isDisabled()||this.isWrapup())break;this.clickKB(e,t);break;case"clickAction":if(this.isDisabled())break;this.clickAction(e,t);break;case"clickTabindex":this.setTabindex(t);break;case"clickDashboardTabindex":this.setTabindexByArea(t,this.$dom.chatDashboard);break;case"clickTabItemTabindex":this.setTabindexByArea(t,this.$dom.chatTabItems)}},mousedownFn:function(e,t){var n=t.attr("data-mousedownFn"),r=n.split(" "),i,s=r.length;for(i=0;i<s;i++)switch(r[i]){case"smartShare":if(this.isDisabled()||this.isWrapup())break;this.smartShare(e,t)}},chatKeyDownFn:function(e){var t=e.data.ctx,n=$(e.target),r="",i="";r=n&&n.attr("data-clickFn"),i=n&&n.attr("data-mousedownFn"),r&&(e.preventDefault(),setTimeout(function(
){t.clickFn(e,n)},1)),i&&(t.mousedownFn(e,n),e.preventDefault())},onLeftRightFn:function(e,t,n,r){var i=null;if(e.keyCode===$.ui.keyCode.LEFT||e.ctrlKey&&e.shiftKey&&e.keyCode===$.ui.keyCode.TAB)this.isRtl?i=r===undefined?t.next():r:i=n===undefined?t.prev():n;else if(e.keyCode===$.ui.keyCode.RIGHT||e.ctrlKey&&e.keyCode===$.ui.keyCode.TAB)this.isRtl?i=n===undefined?t.prev():n:i=r===undefined?t.next():r;i&&i.length===1&&(t.attr("tabindex","-1"),t.attr("aria-selected","false"),i.attr("tabindex","0"),i.attr("aria-selected","true"),i.focus(),e.preventDefault(),e.stopPropagation())},beforeLeftRightFn:function(e,t){var n=null,r=null,i=null,s,o=t.length;for(s=0;s<o;s++)if($(t[s]).attr("tabindex")==="0"){n=$(t[s]),r=$(t[s-1]),i=$(t[s+1]);break}this.onLeftRightFn(e,n,r,i)},setTabindex:function(e){if(!e||e.length===0)return;e.attr("aria-selected","true").attr("tabindex",0),e.siblings().attr("aria-selected",!1).attr("tabindex","-1")},setTabindexByArea:function(e,t){if(!e||e.length===0||!t||t.length===0)return;var n=t.find("[tabindex=0]");n.attr("aria-selected","false").attr("tabindex",-1),e.attr("aria-selected","true").attr("tabindex",0)},setDefaultTabindex:function(e){var t=null,n=null,r=null;switch(e){case"tabs":t=this.$dom.chatTabItems,n=t.find("li[tabindex=0]"),r=t.find("li[tabindex]").first();break;case"dashboard":t=this.$dom.chatDashboard,n=t.find("[tabindex=0]"),r=t.find("[tabindex]").first();break;case"msgLog":t=this.$dom.chatMsgLog,n=t.find("li[tabindex=0]"),r=t.find("li[tabindex]").last();break;case"textToolbar":t=this.$dom.chatTextLinks,n=t.find("a[tabindex=0]"),r=t.find("a[tabindex]").first();break;case"urlToolbar":t=this.$dom.chatUrlLinks,n=t.find("a[tabindex=0]"),r=t.find("a[tabindex]").first()}n&&n.length===0&&r&&r.length===1&&(r.attr("tabindex","0"),r.attr("aria-selected","true"))},chatTabItemsKeyDown:function(e){var t=e.data.ctx,n=t.$dom.chatTabItems.find("li[tabindex]");t.beforeLeftRightFn(e,n)},chatDashboardKeyDown:function(e){var t=e.data.ctx,n=t.$dom.chatDashboard.find("[tabindex]");t.beforeLeftRightFn(e,n)},chatMsgLogKeyDown:function(e){var t=e.data.ctx,n=t.$dom.chatMsgLog,r=n.children("li[tabindex=0]"),i=null;e.keyCode===$.ui.keyCode.UP?i=r.prev():e.keyCode===$.ui.keyCode.DOWN?i=r.next():e.keyCode===$.ui.keyCode.HOME?i=n.children("li").first():e.keyCode===$.ui.keyCode.END&&(i=n.children("li").last()),i&&i.length===1&&(r.attr("tabindex","-1"),r.attr("aria-selected","false"),i.attr("tabindex","0"),i.attr("aria-selected","true"),i.focus(),e.preventDefault(),e.stopPropagation())},chatTextLinksKeyDown:function(e){var t=e.data.ctx,n=t.$dom.chatTextLinks.find("[tabindex]");t.beforeLeftRightFn(e,n)},chatTextInputChange:function(e){var t=e?e.data.ctx:this;if(t.$dom.chatEl.length===0)return;var n=t.$dom.chatTextInput.val(),r=n.replace(/\s/g,"").length,i=t.$dom.chatTextLinks;r?i.removeClass("siebui-chat-toolbar-links-send-disabled"):i.addClass("siebui-chat-toolbar-links-send-disabled"),n.length>t.MESSAGE_COUNT&&t.$dom.chatTextInput.val(n.substring(0,t.MESSAGE_COUNT)),t.doMatchWhileTyping.call(t,t.$dom.chatTextInput)},doMatchWhileTyping:function(e){var t=this;if(t.renderer.GetPM().Get("FUTEnabled")){var n=t.getCursorPosition(e[0]),r=e.val();if(t.isFUTListOpen&&n>t.matchStartIndex){var i=r.substr(t.matchStartIndex,n-t.matchStartIndex);e.autocomplete("search",i),!this.isFUTListOpen&&i.search(/[\s\n]/)>=0&&t.doMatchBeforeCursor.call(t,e)}else t.doMatchBeforeCursor.call(t,e)}},chatTextInputClick:function(e){var t=e.data.ctx;t.chatTextInputKeyUp(e)},chatTextInputKeyUp:function(e){var t=e.data.ctx,n=t.$dom.chatTextInput,r=t.getCursorPosition(n[0]);t.storedMap[t.currChatId].toSendPos=r,((e.which===$.ui.keyCode.UP||e.which===$.ui.keyCode.DOWN)&&!t.isFUTListOpen||e.which===$.ui.keyCode.LEFT||e.which===$.ui.keyCode.RIGHT||e.which===1)&&t.doMatchWhileTyping.call(t,n)},chatTextInputKeyDown:function(e){var t=e.data.ctx,n=!1;if(t.isDisabled()||t.isWrapup())return;$(".siebui-chat-fut-autocomplete-list > .ui-state-focus").length>0&&(n=!0),!e.shiftKey&&e.keyCode===$.ui.keyCode.ENTER&&(!t.isFUTListOpen||!n)&&(e.preventDefault(),e.stopPropagation(),setTimeout(function(){t.sendText(e)},1))},setChatTextInputFocus:function(){var e=this,t=e.$dom.chatTextInput,n=e.storedMap[e.currChatId].toSendPos||-1;n===-1&&(n=t.val().length),e.setCursorPosition(t[0],n)},chatTextInputKeyPress:function(e){var t=e.data.ctx;if(t.isDisabled()||t.isWrapup())return;t.onTyping(t.renderer,t.currChatId)},chatUrlLinksKeyDown:function(e){var t=e.data.ctx,n=t.$dom.chatUrlLinks.find("[tabindex]");t.beforeLeftRightFn(e,n)},chatUrlInputKeyDown:function(e){var t=e.data.ctx;if(t.isDisabled()||t.isWrapup())return;e.keyCode===13&&(e.preventDefault(),e.stopPropagation(),t.sendUrl(e))},chatUrlInputChange:function(e){var t=e?e.data.ctx:this;if(t.$dom.chatEl.length===0)return;var n=t.$dom.chatUrlInput.val().replace(/\s/g,"").length,r=t.$dom.chatUrlLinks;n?r.removeClass("siebui-chat-toolbar-links-send-disabled"):r.addClass("siebui-chat-toolbar-links-send-disabled")},chatUrlInputKeyPress:function(e){var t=e.data.ctx;if(t.isDisabled()||t.isWrapup())return;t.onTyping(t.renderer,t.currChatId)},showDashboard:function(e,t){var n=this.$dom.chatToHideDashboard.css("display")!=="none";if(n)return;this.$dom.chatToHideDashboard.show().attr("aria-hidden",!1),this.$dom.chatToShowDashboard.hide().attr("aria-hidden",!0),e&&t&&this.$dom.chatToHideDashboard.focus(),this.toggleDashboardArea("show")},hideDashboard:function(e,t){var n=this.$dom.chatToShowDashboard.css("display")!=="none";if(n)return;this.$dom.chatToShowDashboard.show().attr("aria-hidden",!1),this.$dom.chatToHideDashboard.hide().attr("aria-hidden",!0),e&&t&&this.$dom.chatToShowDashboard.focus(),this.toggleDashboardArea("hide")},toggleDashboardArea:function(e){var t=this.$dom.chatDashboard,n=this.$dom.chatMsgLog,r=this.getTotalHeight(t);e==="show"?(n.height(n.height()-r),t.show()):e==="hide"&&(n.height(n.height()+r),t.hide())},showLessMode:function(e,t){if(this.$dom.commPanelChatToShowMore.length===0||this
.$dom.commPanelChatToShowLess.length===0)return;var n=this.$dom.commPanelChatToShowMore.css("display")!=="none";if(n)return;this.$dom.commPanelChatToShowMore.show().attr("aria-hidden",!1),this.$dom.commPanelChatToShowLess.hide().attr("aria-hidden",!0),e&&t&&this.$dom.commPanelChatToShowMore.focus(),this.toggleModeArea(e)},showMoreMode:function(e,t){if(this.$dom.commPanelChatToShowMore.length===0||this.$dom.commPanelChatToShowLess.length===0)return;var n=this.$dom.commPanelChatToShowLess.css("display")!=="none";if(n)return;this.$dom.commPanelChatToShowLess.show().attr("aria-hidden",!1),this.$dom.commPanelChatToShowMore.hide().attr("aria-hidden",!0),e&&t&&this.$dom.commPanelChatToShowLess.focus(),this.toggleModeArea(e)},toggleModeArea:function(e){var t=this.$dom.chatUI,n="enable";t.toggleClass("siebui-comm-panel-less"),t.hasClass("siebui-comm-panel-less")&&(n="disable"),this.$dom.chatMsg.resizable(n),this.$dom.chatInputWrap.resizable(n),c.call(e.data.ctx,"Chat: Toggle")},closeChat:function(e,t){this.$dom.chatCloseEl.trigger("click")},sendText:function(e,t){var n=this,r=n.$dom.chatTextInput.val(),i={text:r,chatId:n.currChatId,userName:n.currUserName,isUrl:!1};n.$dom.chatTextInput.val(""),n.chatTextInputChange(),n.matchStartIndex=0,n.$dom.chatTextInput.autocomplete("close"),r.replace(/\s/g,"")!==""&&n.onSendMessage(n.renderer,i)},smartShare:function(e,t){this.onSmartShareClick(this.renderer)},frequentlyUsedText:function(e,t){var n=e.data.ctx;n.renderer.GetPM().Get("FUTEnabled")&&this.openFUTPopup.call(n)},sendUrl:function(e,t){var n=this,r=n.$dom.chatUrlInput.val(),i={text:r,chatId:n.currChatId,userName:n.currUserName,isUrl:!0};n.$dom.chatUrlInput.val(""),n.chatUrlInputChange(),r.replace(/\s/g,"")!==""&&n.onSendMessage(n.renderer,i)},pushUrl:function(e,t){this.onPushUrl(this.renderer)},clickTab:function(e,t){var n=this,r=t.attr("data-chatId"),i=t.attr("data-userName");n.switchTab(r,i)},clickKB:function(e,t){var n=this,r=n.$dom.chatKBVisited,i=r.val();n.onKBClick()},clickAction:function(e,t){var n=this,r=n.$dom.chatAction,i=r.find("option:selected").attr("data-action");n.onActionClick(n.renderer,i)},updateUnread:function(e,t){var n=this.storedMap[e],r=n.tabEl;n.unread=t||1,r.addClass("siebui-chat-tab-head-item-blink"),r.children("span:first").text(n.unread).show()},clearUnread:function(e){var t=this.storedMap[e],n=t.tabEl;t.unread=0,n.removeClass("siebui-chat-tab-head-item-blink"),n.children("span:first").text("").hide()},createDashboard:function(t){this.currDashboard=t,this.renderDashboard(t);var n=0,r=t.length,i=null;for(n=0;n<r;n++)i=t[n],i.length==="full"&&i.visible===e.get("CHATUISVC_VALUE_YES")&&(i.field.type==="input"?this.bindHotkey(this.$dom.chatEl,i.button.hotkey,"clickKB"):i.field.type==="combo"&&this.bindHotkey(this.$dom.chatEl,i.button.hotkey,"clickAction","wrapup"))},updateDashboard:function(e){var t=this.currDashboard,n=null,r,i=t.length;for(r=0;r<i;r++)n=t[r],n.text=e[n.name];this.renderDashboard(t)},updateKBVisited:function(e){e=e||"",this.$dom.chatKBVisited&&this.$dom.chatKBVisited.val(e).attr("aria-label",e).attr("title",e)},updateTextLabel:function(e){this.renderTextLabel(e)},updateTextLinks:function(e){this.renderTextLinks(e)},updateUrlLabel:function(e){this.renderUrlLabel(e)},updateUrlLinks:function(e){this.renderUrlLinks(e)},updateDashboardSwitch:function(e,t){this.renderToggleDashboard(e,t)},renderDashboard:function(t){var n=this.$dom.chatDashboard,r=null,i="",s=null,o=null,u=null,a="",f,l=t.length,c,h=0,p,d=0;for(f=0;f<l;f++){r=t[f];if(r.visible!==e.get("CHATUISVC_VALUE_YES"))continue;r.text=r.text||"";if(r.length==="half")a+=this.compileTMPL(at.tmplDashboardItemShort,r);else if(r.length==="full"){r.image=r.button&&r.button.image;if(r.field.type==="input")p=r.button||{},r.buttonTooltip=this.getButtonTooltip(p.display,p.hotkey),r.buttonLabel=p.display||"",a+=this.compileTMPL(at.tmplDashboardItemRichInput,r);else if(r.field.type==="combo"){o=r.field.options.split(","),u=r.field.actions.split(","),d=this.storedMap[this.currChatId]&&this.storedMap[this.currChatId].actionIndex||0;for(c=0,h=o.length;c<h;c++)s={},s.isSelect=c===d?"selected":"",s.option=o[c],s.action=u[c],i+=this.compileTMPL(at.tmplOption,s);r.options=i,r.className="siebui-chat-dashboard-action",p=r.button||{},r.buttonTooltip=this.getButtonTooltip(p.display,p.hotkey),r.buttonLabel=p.display||"",a+=this.compileTMPL(at.tmplDashboardItemRichSelect,r)}else a+=this.compileTMPL(at.tmplDashboardItemLong,r)}}n.html(a),this.$dom.chatKBVisited=$("#chatKBVisited",n),this.$dom.chatAction=$("#chatAction",n),this.setDefaultTabindex("dashboard"),this.eventHelper.Manage(this.$dom.chatAction,"change",{ctx:this},this.onChatActionChange)},renderMsgLog:function(e){var t=this.storedMap[e].msgLog,n=this.$dom.chatMsgLog,r=t.length,i=0,s="",o=null,u,a=null;if(r){for(u=0;u<r;u++)a=t[u],a.isAgent?a.agentClassName="siebui-chat-msg-log-item-agent":a.agentClassName="",a.isUrl?(a.url=a.msg,/^[a-z]+:.+/ig.test(a.url)||(a.url=a.url.replace(/^([:\/]+)/g,""),a.url="http://"+a.url),s+=this.compileTMPL(at.tmplMsgLogUrlItem,a)):s+=this.compileTMPL(at.tmplMsgLogItem,a);n.html(s),this.setDefaultTabindex("msgLog"),i=n[0]&&n[0].scrollHeight||0,n.scrollTop(i)}else n.html("")},renderTextLabel:function(e){var t=this.$dom.chatTextLabel.children("span")[0],n=$(t),r=e.display||"";n.text(r).attr("aria-label",r).attr("title",r)},renderTextLinks:function(n){var r=null,i=null,s="",o="",u,a=n.length,f="";for(u=0;u<a;u++)r=n[u],o=r.display||"",f=this.getButtonTooltip(o,r.hotkey),i={title:f,label:o,text:o,className:r.className,mousedownFnName:r.fnType==="mousedown"?r.fnName:"",clickFnName:r.fnType==="click"?r.fnName+" clickTabindex":"clickTabindex"},r.visible===e.get("CHATUISVC_VALUE_YES")&&(s+=this.compileTMPL(at.tmplTextLink,i)),r.hotkey&&this.bindHotkey(this.$dom.chatEl,r.hotkey,r.fnName);this.$dom.chatTextLinks.html(s),this.setDefaultTabindex("textToolbar");if(t.IsTrue(SiebelApp.S_App.IsAutoOn())){var l=e.get("SWE_PROP_AUTOM_OT"),c=e.get("SWE_PROP_AUTOM_RN"),
h=e.get("SWE_PROP_AUTOM_UN");for(u=0;u<a;u++){var r=n[u],p=$("."+r.className);p.length&&p.attr(l,"button").attr(c,r.fnName).attr(h,r.display)}}},renderFUTMatchFieldSelectMenu:function(){var e={},n="",r="",i="",s=this.renderer.GetPM(),o=s.Get("FUTFieldMap");for(var u in o)o.hasOwnProperty(u)&&(u==="locale"?(e.name=u,e.label=o[u],s.Get("FUTMatchFieldLocale")===!0?(e.isCheck_Y="Y",e.isCheck_true="true"):(e.isCheck_Y="N",e.isCheck_true="false"),i+=this.compileTMPL(at.tmplFUTFieldCheck,e)):u==="language"?(e.name=u,e.label=o[u],s.Get("FUTMatchFieldLanguage")===!0?(e.isCheck_Y="Y",e.isCheck_true="true"):(e.isCheck_Y="N",e.isCheck_true="false"),r+=this.compileTMPL(at.tmplFUTFieldCheck,e)):(e.name=u,e.label=o[u],e.isSelect=u===s.Get("FUTMatchField")?"selected":"",n+=this.compileTMPL(at.tmplFUTFieldOption,e)));var a=s.Get("Languages"),f=s.Get("Locales"),l,c,h=0,p=a.split(",");for(h=0;h<p.length;h++)t.IsEmpty(p[h])===!1&&(e.name=p[h],e.label=p[h],e.isSelect=p[h]===s.Get("LanguageId")?"selected":"",c+=this.compileTMPL(at.tmplFUTFieldOption,e));var p=f.split(",");for(h=0;h<p.length-1;h++)t.IsEmpty(p[h])===!1&&(e.name=p[h],e.label=p[h],e.isSelect=p[h]===s.Get("LocaleId")?"selected":"",l+=this.compileTMPL(at.tmplFUTFieldOption,e));var d={options:n,locale:i,language:r,localeOptions:l,languageOptions:c};return this.compileTMPL(at.tmplFUTMatchFieldelectMenu,d)},renderUrlLabel:function(e){var t=this.$dom.chatUrlLabel.children("span")[0],n=$(t),r=e.display||"";n.text(r).attr("aria-label",r).attr("title",r)},renderUrlLinks:function(n){var r=null,i=null,s="",o="",u,a=n.length,f="";for(u=0;u<a;u++)r=n[u],o=r.display||"",f=this.getButtonTooltip(o,r.hotkey),i={title:f,label:o,text:o,className:r.className,mousedownFnName:r.fnType==="mousedown"?r.fnName:"",clickFnName:r.fnType==="click"?r.fnName+" clickTabindex":"clickTabindex"},r.visible===e.get("CHATUISVC_VALUE_YES")&&(s+=this.compileTMPL(at.tmplUrlLink,i)),r.hotkey&&this.bindHotkey(this.$dom.chatEl,r.hotkey,r.fnName);this.$dom.chatUrlLinks.html(s),this.setDefaultTabindex("urlToolbar");if(t.IsTrue(SiebelApp.S_App.IsAutoOn())){var l=e.get("SWE_PROP_AUTOM_OT"),c=e.get("SWE_PROP_AUTOM_RN"),h=e.get("SWE_PROP_AUTOM_UN");for(u=0;u<a;u++){var r=n[u],p=$("."+r.className);p.length&&p.attr(l,"button").attr(c,r.fnName).attr(h,r.display)}}},renderInput:function(e){var t=this.storedMap[e],n="",r="";t&&(n=t.toSendText||"",r=t.toSendUrl||"",this.$dom.chatTextInput.val(n),this.$dom.chatTextInput.attr("aria-label",n),this.$dom.chatUrlInput.val(r),this.$dom.chatUrlInput.attr("aria-label",r)),this.chatTextInputChange(),this.chatUrlInputChange()},renderToggleMode:function(){if(this.$dom.chatEl.length===0)return;var r=n.GetLocalString("IDS_COMM_PANEL_TOGGLE_SHOW_MORE"),i=n.GetLocalString("IDS_COMM_PANEL_TOGGLE_SHOW_LESS");this.$dom.commPanelChatToShowLess.parent("div").attr("title",i),this.$dom.commPanelChatToShowLess.attr("aria-label",i),this.$dom.commPanelChatToShowMore.parent("div").attr("title",r),this.$dom.commPanelChatToShowMore.attr("aria-label",r),t.IsTrue(SiebelApp.S_App.IsAutoOn())&&(this.$dom.commPanelChatToShowMore.attr(e.get("SWE_PROP_AUTOM_OT"),"button").attr(e.get("SWE_PROP_AUTOM_RN"),"commPanelChatToShowMore").attr(e.get("SWE_PROP_AUTOM_UN"),r),this.$dom.commPanelChatToShowLess.attr(e.get("SWE_PROP_AUTOM_OT"),"button").attr(e.get("SWE_PROP_AUTOM_RN"),"commPanelChatToShowLess").attr(e.get("SWE_PROP_AUTOM_UN"),i))},renderToggleDashboard:function(n,r){var i=n.display||"",s=r.display||"",o=this.getButtonTooltip(n.display,n.hotkey),u=this.getButtonTooltip(r.display,r.hotkey);this.bindHotkey(this.$dom.chatEl,n.hotkey,"showDashboard","disabled"),this.bindHotkey(this.$dom.chatEl,r.hotkey,"hideDashboard","disabled"),this.$dom.chatToShowDashboard.attr("aria-label",i).text("+"),this.$dom.chatToShowDashboard.parent("div").attr("title",o),this.$dom.chatToHideDashboard.attr("aria-label",s).text("-"),this.$dom.chatToHideDashboard.parent("div").attr("title",u),n.visible!==e.get("CHATUISVC_VALUE_YES")&&r.visible!==e.get("CHATUISVC_VALUE_YES")&&this.$dom.chatToggleDashboard.hide(),t.IsTrue(SiebelApp.S_App.IsAutoOn())&&(this.$dom.chatToShowDashboard.attr(e.get("SWE_PROP_AUTOM_OT"),"button").attr(e.get("SWE_PROP_AUTOM_RN"),"chatToShowDashboard").attr(e.get("SWE_PROP_AUTOM_UN"),i),this.$dom.chatToHideDashboard.attr(e.get("SWE_PROP_AUTOM_OT"),"button").attr(e.get("SWE_PROP_AUTOM_RN"),"chatToHideDashboard").attr(e.get("SWE_PROP_AUTOM_UN"),s))},changeTabStatus:function(e,t){var n=this.storedMap[e].tabEl;t=t||this.storedMap[e].status,t==="enabled"?n.removeClass("siebui-chat-tab-head-item-disabled"):(t==="disabled"||t==="wrapup")&&n.addClass("siebui-chat-tab-head-item-disabled")},changeDasboardStatus:function(e,t){var n=this.$dom.chatDashboard;t=t||this.storedMap[e].status,n.removeClass().addClass("siebui-chat-dashboard"),t==="disabled"?n.addClass("siebui-chat-dashboard-disabled"):t==="wrapup"&&n.addClass("siebui-chat-dashboard-wrapup")},changeMsgLogStatus:function(e,t){var n=this.$dom.chatMsgLog;t=t||this.storedMap[e].status,t==="enabled"?n.removeClass("siebui-chat-msg-log-disabled"):(t==="disabled"||t==="wrapup")&&n.addClass("siebui-chat-msg-log-disabled")},changeTextToolbarStatus:function(e,t){var n=this.$dom.chatTextToolbar;t=t||this.storedMap[e].status,t==="enabled"?n.removeClass("siebui-chat-toolbar-disabled"):(t==="disabled"||t==="wrapup")&&n.addClass("siebui-chat-toolbar-disabled")},changeTextInputStatus:function(e,t){var n=this.$dom.chatTextInput;t=t||this.storedMap[e].status;if(t==="enabled")n.removeClass("siebui-chat-input-disabled"),n.attr("readonly",!1);else if(t==="disabled"||t==="wrapup")n.addClass("siebui-chat-input-disabled"),n.attr("readonly",!0)},changeUrlToolbarStatus:function(e,t){var n=this.$dom.chatUrlToolbar;t=t||this.storedMap[e].status,t==="enabled"?n.removeClass("siebui-chat-toolbar-disabled"):(t==="disabled"||t==="wrapup")&&n.addClass("siebui-chat-toolbar-disabled")},changeUrlInputStatus:function(e,t){var n=this.$dom.chatUrlInput;t=t||this.storedMap[e].status;if(t==="enabled"
)n.removeClass("siebui-chat-input-disabled"),n.attr("readonly",!1);else if(t==="disabled"||t==="wrapup")n.addClass("siebui-chat-input-disabled"),n.attr("readonly",!0)},isDisabled:function(){return this.storedMap[this.currChatId].status==="disabled"},isWrapup:function(){return this.storedMap[this.currChatId].status==="wrapup"},changeStatus:function(e,t){if(!this.storedMap[e])return;t&&(this.storedMap[e].status=t);if(e!==this.currChatId)return;this.changeTabStatus(e,t),this.changeDasboardStatus(e,t),this.changeMsgLogStatus(e,t),this.changeTextToolbarStatus(e,t),this.changeTextInputStatus(e,t),this.changeUrlToolbarStatus(e,t),this.changeUrlInputStatus(e,t)},setDefault:function(){this.currChatId="",this.currUserName="",this.lastReadMessage="",this.lastReadLogCount=-1,this.MESSAGE_COUNT=1023,this.currDashboard=[],this.isRtl=!1,this.typingIndicator="Customer is typing...",this.systemMessage="System Message",this.matchStartIndex=0,this.queryField="text",this.isFUTListOpen=!1,this.closeFUTtimer=null,this.storedMap={},this.keyFnArr=[],this.$dom={},this.renderer=null,this.onTyping=this.empty,this.onSendMessage=this.empty,this.onSwitchTab=this.empty,this.onKBClick=this.empty,this.onActionClick=this.empty,this.onImplicitSave=this.empty,this.onSmartShareClick=this.empty,this.eventHelper=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper")},init:function(e){this.setDefault(),e&&(this.renderer=e.renderer||null,this.onTyping=e.onAgentTyping||this.empty,this.onSendMessage=e.onSendMessage||this.empty,this.onSwitchTab=e.onSwitchTab||this.empty,this.onKBClick=e.onKBClick||this.empty,this.onActionClick=e.onActionClick||this.empty,this.onImplicitSave=e.onImplicitSave||this.empty,this.onSmartShareClick=e.onSmartShareClick||this.empty,this.onFrequentlyUsedText=e.onFrequentlyUsedText||this.empty,this.onPushUrl=e.onPushUrl||this.empty)},showUI:function(){this.$dom.chatEl=$("#s_chatwrap"),this.$dom.chatEl.html(at.tmplTabArea+at.tmplTextArea+at.tmplUrlArea+at.tmplMaskArea),this.initEl(),this.isRtl=window.SiebelApp&&SiebelApp.S_App.GetDirection()||!1,this.$dom.chatMsg.resizable({handles:"s"}),this.$dom.chatInputWrap.resizable({handles:"s"}),this.renderToggleMode(),this.bindListener();var n=this;this.$dom.chatTextInput.length&&(this.$dom.chatTextInput.autocomplete({source:function(e,t){n.listMatch(e,t)},disabled:this.renderer.GetPM().Get("FUTEnabled"),open:function(e,t){n.listOpened(e,t),n.eventHelper.Manage($(window),"resize.futpanel",{ctx:n,child:n.$dom.chatTextInput},n.futPanelResize),n.eventHelper.Manage($("#CommunicationPanelContainer"),"scroll.futpanel",{ctx:n,child:n.$dom.chatTextInput},n.futPanelResize)},close:function(e,t){n.listClosed(e,t)},select:function(e,t){n.listSelected(e,t)},focus:function(e,t){n.listChanged(e,t)}}),this.$dom.chatTextInput.data("ui-autocomplete")._renderItem=function(e,t){return n.renderItem(e,t,n)},this.$dom.chatTextInput.data("ui-autocomplete")._renderMenu=function(e,t){var n=this;$.each(t,function(t,r){n._renderItemData(e,r)}),$(e).addClass("siebui-chat-fut-autocomplete-list")});if(t.IsTrue(SiebelApp.S_App.IsAutoOn())){var r=$(".siebui-chat-text-input");r.length&&r.attr(e.get("SWE_PROP_AUTOM_OT"),r.attr("role")).attr(e.get("SWE_PROP_AUTOM_RN"),r.attr("name")).attr(e.get("SWE_PROP_AUTOM_UN"),r.attr("name"));var i=$(".siebui-chat-url-input");i.length&&i.attr(e.get("SWE_PROP_AUTOM_OT"),i.attr("role")).attr(e.get("SWE_PROP_AUTOM_RN"),i.attr("name")).attr(e.get("SWE_PROP_AUTOM_UN"),i.attr("name"))}},setTabCaption:function(e,t){if(!this.storedMap[e])return;var n=this.storedMap[e].tabEl;n.length&&t&&(n.find("a").text(t),n.attr("aria-label",t))},setFocus:function(e){if(!this.storedMap[e])return;var t=this.storedMap[e].tabEl;t.length&&(this.setTabindexByArea(t,this.$dom.chatTabItems),this.setChatTextInputFocus())},setTabTooltip:function(e,t){if(!this.storedMap[e])return;var n=this.storedMap[e].tabEl;n.length&&t&&n.children("div").attr("title",t)},setTypingIndicator:function(e){this.typingIndicator=e},setSystemMessage:function(e){this.systemMessage=e},showTypingIndicator:function(e){var t="";e===this.currChatId&&(t=this.$dom.chatTyping.text(),t===""&&this.$dom.chatTyping.text(this.typingIndicator))},hideTypingIndicator:function(e){e===this.currChatId&&this.$dom.chatTyping.text("")},newTab:function(n,r){var i={chatId:n,userName:r},s=null,o="",u=null;SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+n+"] Initial chat."),this.storedMap[n]||(this.storedMap[n]={}),s=this.$dom.chatTabItems,o=this.compileTMPL(at.tmplTabHeadItem,i),s.append(o),this.$dom.chatMask.removeClass("siebui-chat-mask"),u=s.children("li").last(),this.setDefaultTabindex("tabs"),t.IsTrue(SiebelApp.S_App.IsAutoOn())&&u.attr(e.get("SWE_PROP_AUTOM_OT"),"SiebViewLink").attr(e.get("SWE_PROP_AUTOM_RN"),r).attr(e.get("SWE_PROP_AUTOM_UN"),r),this.storedMap[n].tabEl=u,this.storedMap[n].userName=r,this.storedMap[n].msgLog=[],this.storedMap[n].unread=0,this.storedMap[n].status="enabled"},existTab:function(e){return this.storedMap[e]},closeTab:function(e){if(!this.storedMap[e])return;var t=this.$dom.chatTabItems,n=this.storedMap[e].tabEl;SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+e+"] Close chat."),n&&n.remove(),n=null,delete this.storedMap[e],this.currChatId="",this.currUserName="",this.setDefaultTabindex("tabs")},activeTab:function(e){if(!this.storedMap[e])return;var t=this.currChatId,n="",r=null,i=null;if(e===t)return;t&&(this.storedMap[t].toSendText=this.$dom.chatTextInput.val(),this.storedMap[t].toSendUrl=this.$dom.chatUrlInput.val()),n=this.storedMap[e].userName,r=this.storedMap[e].tabEl,i=this.$dom.chatTabItems,i.children("li").removeClass("siebui-chat-tab-head-item-curr siebui-chat-tab-state-terminate siebui-chat-tab-state-new-msg siebui-chat-tab-state-hold-new siebui-chat-tab-state-new-msg-hold-new"),r.addClass("siebui-chat-tab-head-item-curr"),this.currChatId=e,this.currUserName=n,this.clearUnread(e),this.renderMsgLog(e),this.renderInput(e),this.changeStatus(e),this.hideTypingIndicator(e)},enableTab:function(
e){this.changeStatus(e,"enabled")},disableTab:function(e){this.changeStatus(e,"disabled")},wrapupTab:function(e){this.changeStatus(e,"wrapup")},switchTab:function(e,t){if(!this.storedMap[e])return;var n=this.currChatId,r=null,i=null;if(e===n)return;if(!this.onImplicitSave(this.renderer))return;if(this.renderer.GetPM().Get("SwitchDisabled"))return;r=this.storedMap[e].tabEl,i=this.storedMap[n].tabEl,this.onSwitchTab(this.renderer,n,e),this.storedMap[n].toSendText=this.$dom.chatTextInput.val(),this.storedMap[n].toSendUrl=this.$dom.chatUrlInput.val(),this.clearUnread(e),this.currChatId=e,this.currUserName=t,this.renderMsgLog(e),this.renderInput(e),this.changeStatus(e),i.removeClass("siebui-chat-tab-head-item-curr"),r.addClass("siebui-chat-tab-head-item-curr").removeClass("siebui-chat-tab-state-terminate siebui-chat-tab-state-new-msg siebui-chat-tab-state-hold-new siebui-chat-tab-state-new-msg-hold-new"),this.hideTypingIndicator(e)},changeTabState:function(e,t,n){if(!this.storedMap[e])return;var r={terminate:"siebui-chat-tab-state-terminate",holdNew:"siebui-chat-tab-state-hold-new",newMsg:"siebui-chat-tab-state-new-msg",newMsgHoldNew:"siebui-chat-tab-state-new-msg-hold-new"},i=t.split(" "),s=[],o=null,u=null,a,f=i.length;for(a=0;a<f;a++)s.push(r[i[a]]||"");o=s.join(" "),u=this.storedMap[e].tabEl,n==="add"?u.addClass(o):n==="remove"&&u.removeClass(o)},appendMessage:function(e,t,n,r,i,s){if(!this.storedMap[e])return;n=SiebelApp.Utils.replaceAll(n,"&","&amp;"),n=SiebelApp.Utils.replaceAll(n," ","&nbsp;"),n=SiebelApp.Utils.replaceAll(n,'"',"&quot;"),n=SiebelApp.Utils.replaceAll(n,"'","&#39;"),n=SiebelApp.Utils.replaceAll(n,"<","&lt;"),n=SiebelApp.Utils.replaceAll(n,">","&gt;");var o={chatId:e,userName:t,msg:n,time:r,isAgent:i,isUrl:s};SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+e+"] Append Message."),t==="System Message"&&(t=this.systemMessage),this.storedMap[e].msgLog.push(o),e===this.currChatId&&this.renderMsgLog(e)},readLastMessage:function(e){if(!this.storedMap[e])return;var t=this.storedMap[e].msgLog,n=t.length,r=t[n-1];if(!r)return;var i=JSON.stringify(r);if(n===this.lastReadLogCount&&i===this.lastReadMessage)return;var s=r.userName+" "+r.time+" "+r.msg;this.lastReadLogCount=n,this.lastReadMessage=i,this.readMessage(s)},readMessage:function(e){var t=this.$dom.chatNewMsg;t.html(e),setTimeout(function(){t.html("")},100)},clearMessage:function(e){if(!this.storedMap[e])return;this.storedMap[e].msgLog=[],e===this.currChatId&&this.renderMsgLog(e)},getInputText:function(e){if(!this.storedMap[e])return;var t="";return SiebelApp.S_App.CommToolbarUtil.PSRLog("[PSR] [Chat Id = "+e+"] Get input text from chat."),e===this.currChatId?t=this.$dom.chatTextInput.val():t=this.storedMap[e].toSendText,t},setInputText:function(e,t){e&&e===this.currChatId&&this.$dom.chatTextInput.val(t),this.chatTextInputChange()},appendInputText:function(e){var t=this.$dom.chatTextInput.val(),n=t.length,r=this,i="";n>0&&t[n-1]!=="\n"&&(t+="\n"),i=t+e,r.$dom.chatTextInput.val(i),r.storedMap[r.currChatId].toSendPos=i.length,setTimeout(function(){r.setChatTextInputFocus()},1),this.chatTextInputChange()},getInputUrl:function(e){if(!this.storedMap[e])return;var t="";return e===this.currChatId?t=this.$dom.chatUrlInput.val():t=this.storedMap[e].toSendUrl,t},setInputUrl:function(e,t){e&&e===this.currChatId&&this.$dom.chatUrlInput.val(t),this.chatUrlInputChange()},onChatControlResize:function(e,t){var n=t.size.height-e.data.diff;e.data.child.height(n>80?n:80),t.element.removeAttr("style")},onChatActionChange:function(e){var t=e.data.ctx,n=$(e.target),r=n[0].selectedIndex;t.storedMap[t.currChatId].actionIndex=r},getButtonTooltip:function(e,t){return e=e||"",t?e+" ["+t+"]":e},onFUTQueryFieldChange:function(t){var n=$(this).find("option:selected").attr("value");$(this).siblings().hasClass("siebui-chat-fut-popup-locale")?t.data.ctx.renderer.GetPM().OnControlEvent(e.get("CHAT_FUT_MATCH_FIELD_CHANGED"),"locale",n,null,null):$(this).siblings().hasClass("siebui-chat-fut-popup-language")?t.data.ctx.renderer.GetPM().OnControlEvent(e.get("CHAT_FUT_MATCH_FIELD_CHANGED"),"language",n,null,null):t.data.ctx.renderer.GetPM().OnControlEvent(e.get("CHAT_FUT_MATCH_FIELD_CHANGED"),"matching",n,null,null)},onFUTQueryInputFieldChange:function(t){t.target.type==="checkbox"&&($(t.target).attr("checked",t.target.checked).attr("aria-checked",t.target.checked).attr("value",t.target.checked?"Y":"N"),t.target.checked?$(t.target).parent().siblings().removeAttr("disabled"):$(t.target).parent().siblings().attr("disabled","disabled"));var n=$(this),r=n.children(0).attr("value"),i=n.children(0).attr("name");t.data.ctx.renderer.GetPM().OnControlEvent(e.get("CHAT_FUT_MATCH_FIELD_CHANGED"),null,null,i,r)},listMatch:function(e,t){var n=this.renderer.GetPM(),r=e.term.toLowerCase(),i=n.Get("CurrentChat"),s=n.Get("LocaleId"),o=n.Get("LanguageId"),u=n.Get("FUTMatchFieldLocale"),a=n.Get("FUTMatchFieldLanguage"),f=[];if(i&&r){var l=i.futItems;if(this.matchStartIndex<this.$dom.chatTextInput.val().length){for(name in l)if(l.hasOwnProperty(name)){var c=l[name],h=n.Get("FUTMatchField");if(c[h].toLowerCase().replace(/[\r\n]+/g," ").indexOf(r)>=0){var p=!0;u===!0&&c.localeId!==s&&(p=!1),a===!0&&c.langId!==o&&(p=!1),p===!0&&f.push({label:c[h],value:c.text})}}f.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0})}}t(f)},listClosed:function(e,t){this.isFUTListOpen=!1},listSelected:function(e,t){this.insertFUT.call(this,t.item.value,this.$dom.chatTextInput),e.preventDefault()},listOpened:function(e,t){var n=$(this.$dom.chatTextInput.autocomplete("instance").menu.element),r=n.offset().top,i=r-n.height()-this.$dom.chatTextInput.height()-8;n.css("top",i),this.isFUTListOpen=!0},listChanged:function(e,t){e.which!==0&&(this.insertFUT.call(this,t.item.value,this.$dom.chatTextInput),e.preventDefault())},renderItem:function(e,t){var r=t.label.replace(/[\r\n]+/g," "),i=r.toLowerCase(),s=t.value,o="",u=this.$dom.chatTextInput,a=this.getCursorPosition(u[0]),f=this.$dom.chatTextInput
.val().substr(this.matchStartIndex,a-this.matchStartIndex).toLowerCase(),l=0;for(;;){var c=i.indexOf(f,l);if(c<0){o+=r.substr(l);break}o+=r.substr(l,c-l)+"<b>"+r.substr(c,f.length)+"</b>",l=c+f.length}var h=this.renderer.GetPM().Get("FUTMatchField");return h.toLowerCase()===n.GetLocalString("IDS_CHAT_FUT_TYPE").toLowerCase()&&(o+=" ("+s.substr(0,30),s.length>30&&(o+="..."),o+=")"),$("<li>").attr("data-value",s).append(o).appendTo(e)},insertFUT:function(e,t){var n=t.val(),r=this.getCursorPosition(t[0]),i=n.substr(0,this.matchStartIndex)+e.replace(/\r\n/g,"\n");t.val(i+n.substr(r)),this.setCursorPosition(t[0],i.length)},getLastWord:function(e){var t=e.length,n=e.lastIndexOf(" "),r=e.lastIndexOf("\n"),i="";return n=n>r?n:r,n!==t-1&&(i=e.substr(n+1)),this.matchStartIndex=n+1,i},toggleFUTState:function(t,n){var r=this.renderer.GetPM().Get("FUTEnabled");this.renderer.GetPM().ExecuteMethod(e.get("CHATUISVC_METHOD_SETFUTSTATE"),!r)},openFUTPopup:function(){if($(".siebui-chat-fut-popup").length<=0){var e=$(this.renderFUTMatchFieldSelectMenu()),t;this.isRtl?t="right bottom":t="left bottom",e.dialog({position:{my:"left top",at:t,of:$(".siebui-chat-toolbar-used-txt").parent()},title:n.GetLocalString("IDS_CHAT_FUT_POPUP_TITLE"),dialogClass:"siebui-chat-fut-popup-dialog"});var r=this.renderer.GetPM().Get("FUTMatchFieldLocale");$(".siebui-chat-fut-popup").find("#localeCombobox").prop("disabled",!r),$(".siebui-chat-fut-popup").find("#locale").prop("checked",r),r=this.renderer.GetPM().Get("FUTMatchFieldLanguage"),$(".siebui-chat-fut-popup").find("#languageCombobox").prop("disabled",!r),$(".siebui-chat-fut-popup").find("#language").prop("checked",r),this.eventHelper.Manage($(".siebui-chat-fut-popup-select"),"change",{ctx:this},this.onFUTQueryFieldChange),this.eventHelper.Manage($(".siebui-chat-fut-popup-select-l"),"change",{ctx:this},this.onFUTQueryFieldChange),this.eventHelper.Manage($(".siebui-chat-fut-popup-locale"),"change",{ctx:this},this.onFUTQueryInputFieldChange),this.eventHelper.Manage($(".siebui-chat-fut-popup-language"),"change",{ctx:this},this.onFUTQueryInputFieldChange)}else $(".siebui-chat-fut-popup").dialog("open")},updateFUTState:function(){var e=this.renderer.GetPM().Get("FUTEnabled"),t=this.$dom.chatTextInput;e?($(".siebui-chat-toolbar-used-txt").removeClass("siebui-chat-toolbar-fut-disabled"),$(".siebui-chat-toolbar-toggle-fut").removeClass("siebui-chat-toolbar-fut-disabled"),t.length>0&&t.autocomplete("instance")&&(t.autocomplete("enable"),this.doMatchBeforeCursor.call(this,t))):($(".siebui-chat-toolbar-used-txt").addClass("siebui-chat-toolbar-fut-disabled"),$(".siebui-chat-toolbar-toggle-fut").addClass("siebui-chat-toolbar-fut-disabled"),t.length>0&&t.autocomplete("instance")&&t.autocomplete("close").autocomplete("disable"))},doMatchBeforeCursor:function(e){var t=this.getCursorPosition(e[0]),n=e.val(),r=this.getLastWord(n.substr(0,t));r?(clearTimeout(this.closeFUTtimer),e.autocomplete("search",r)):this.closeFUTtimer=setTimeout(function(){e.autocomplete("close")},300)}};return s}(),SiebelAppFacade.ChatPhyRenderer})),typeof SiebelAppFacade.DashboardPM=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.DashboardPM"),define("siebel/dashboardpmodel",["siebel/pmodel"],function(){return SiebelAppFacade.DashboardPM=function(){function n(){SiebelAppFacade.DashboardPM.superclass.constructor.call(this,{GetName:function(){return"DashboardObj"}})}function r(){var t=SiebelApp.S_App.getExtObject("CommunicationPanel");if(!t||!t.Get("Show")){var n=SiebelApp.S_App.GetService(e.get("NAME_COMM_PANEL_UISVC"));if(n){var r=CCFMiscUtil_CreatePropSet();r.SetProperty(e.get("SWE_VIEW_ID_STR"),e.get("COMM_PANEL_VIEWNAME")),n.InvokeMethod(e.get("COMM_PANEL_METHOD_OPEN"),r)}}}function i(e){if(!e)return;var t=e.GetProperty("UIControlInfo");if(t){var n=CCFMiscUtil_CreatePropSet();n.DecodeFromString(t),this.SetProperty("UIControlInfo",n)}var r=e.GetProperty("UICustomerControlInfo");if(r){var i=CCFMiscUtil_CreatePropSet();i.DecodeFromString(r),this.SetProperty("UICustomerControlInfo",i)}var s=e.GetProperty("AppletName");s&&this.SetProperty("DashboardAppletName",s);var o=e.GetChildByType("QuickNavigateList");if(o){var u=CCFMiscUtil_CreatePropSet();u.DeepCopy(o),this.SetProperty("QuickNavigateList",u)}var a=e.GetChildByType("UpdatedCtrlData");if(a){var f=CCFMiscUtil_CreatePropSet();f.DeepCopy(a),this.SetProperty("UpdatedCtrlData",f)}}function s(){var t=CCFMiscUtil_CreatePropSet();this.ExecuteMethod("InvokeServiceMethod",e.get("DASHBOARD_METHOD_INIT"),this.Get("RequiredFields"),t)&&i.call(this,t)}function o(){var t=CCFMiscUtil_CreatePropSet();this.ExecuteMethod("InvokeServiceMethod",e.get("DASHBOARD_METHOD_PUSH"),this.Get("RequiredFields"),t)&&i.call(this,t)}function u(){this.ExecuteMethod("InvokeServiceMethod",e.get("DASHBOARD_METHOD_CLEAR"))}function a(){var e=CCFMiscUtil_CreatePropSet();this.ExecuteMethod("InvokeServiceMethod","PopulateDashboardfromSS",this.Get("RequiredFields"),e)&&i.call(this,e)}function f(){this.ExecuteMethod("InvokeServiceMethod",e.get("DASHBOARD_METHOD_CLOSE")),SiebelApp.S_App.UnregisterExtObject("Dashboard")}function l(){var t=CCFMiscUtil_CreatePropSet();this.ExecuteMethod("InvokeServiceMethod",e.get("DASHBOARD_METHOD_PREVIOUS"),this.Get("RequiredFields"),t)&&i.call(this,t)}function c(){var t=CCFMiscUtil_CreatePropSet();this.ExecuteMethod("InvokeServiceMethod",e.get("DASHBOARD_METHOD_NEXT"),this.Get("RequiredFields"),t)&&i.call(this,t)}function h(t){var n=CCFMiscUtil_CreatePropSet();n.SetProperty("SelectedNavigation",t),this.ExecuteMethod("InvokeServiceMethod",e.get("DASHBOARD_METHOD_QUICKNAV"),n)}function p(t){var n=CCFMiscUtil_CreatePropSet();this.ExecuteMethod("InvokeServiceMethod",e.get("DASHBOARD_METHOD_GETCUSTOMERCONTROLINFO"),t,n),i.call(this,n)}function d(t){var n=this.Get("CustomerControlMethods");if(n[t]){var r=n[t],i=CCFMiscUtil_CreatePropSet();i.SetProperty("SWECmd","InvokeMethod"),i.SetProperty("SWEMethod",r),i.SetProperty("SWEVI","Dashboard"),i.SetProperty("SWETF","Dashboard"),i.SetProperty
("SWEView",e.get("DASHBOARD_VIEW")),i.SetProperty("SWEApplet",this.Get("DashboardAppletName")),SiebelApp.S_App.CallServer(i,undefined,!0,undefined),SiebelJS.Debug("[Customer Dashboard].INFO: invoke customer control method "+r+" .")}else SiebelJS.Debug("[Customer Dashboard].INFO: there is no invoke method for control "+t+" .")}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils");return SiebelJS.Extend(n,SiebelAppFacade.BasePM),n.prototype.Init=function(){this.AddProperty("RequiredFields",null),this.AddProperty("UIControlInfo",null),this.AddProperty("UICustomerControlInfo",null),this.AddProperty("QuickNavigateList",null),this.AddProperty("UpdatedCtrlData",null),this.AddProperty("CommPanelEnabled",!1),this.AddProperty("CustomerControlMethods",null),this.AddProperty("DashboardAppletName",null),this.AddMethod("InvokeServiceMethod",function(n,r,i){var s=SiebelApp.S_App.GetService(e.get("NAME_DASHBOARDSVC"));if(s){r=r||CCFMiscUtil_CreatePropSet();var o=s.InvokeMethod(n,r),u=o.GetProperty(e.get("SWE_RPC_PROP_RETURN_STATUS"));if(u!==e.get("SWE_RPC_PROP_STATUS_ERROR")&&!t.IsEmpty(u)){if(i){var a=o.GetChildByType("ResultSet");a&&i.DeepCopy(a)}return!0}}return!1}),this.AddMethod(e.get("DASHBOARD_METHOD_INIT"),s),this.AddMethod("PopulateDashboardfromSS",a),this.AddMethod(e.get("DASHBOARD_METHOD_GETCUSTOMERCONTROLINFO"),p),this.AddMethod(e.get("DASHBOARD_METHOD_SHOWINCOMMPANEL"),r),this.AttachEventHandler(e.get("DASHBOARD_METHOD_UPDATE"),o),this.AttachEventHandler(e.get("DASHBOARD_METHOD_CLEAR"),u),this.AttachEventHandler(e.get("DASHBOARD_METHOD_CLOSE"),f),this.AttachEventHandler(e.get("DASHBOARD_METHOD_PREVIOUS"),l),this.AttachEventHandler(e.get("DASHBOARD_METHOD_NEXT"),c),this.AttachEventHandler(e.get("DASHBOARD_METHOD_GOTONAV"),h),this.AttachEventHandler(e.get("DASHBOARD_METHOD_GETCUSTOMERCONTROLCLICK"),d)},n.prototype.Setup=function(t){t.SetProperty("SWE_OUI_RENDERER","DashboardPR"),SiebelAppFacade.DashboardPM.superclass.Setup.call(this,t),t.PropertyExists(e.get("COMM_PANEL_METHOD_ISENABLED"))&&this.SetProperty("CommPanelEnabled",t.GetProperty(e.get("COMM_PANEL_METHOD_ISENABLED")).toUpperCase()==="TRUE"),i.call(this,t)},n.prototype.HandleNotify=function(e){e.GetProperty("DashboardNeedsUpdate")==="TRUE"&&a.call(this),i.call(this,e)},n.prototype.Show=function(){SiebelAppFacade.DashboardPM.superclass.Show.call(this)},n}(),SiebelAppFacade.DashboardPM})),typeof SiebelAppFacade.CommunicationPanelPM=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.CommunicationPanelPM"),define("siebel/commpanelpmodel",["siebel/pmodel"],function(){return SiebelAppFacade.CommunicationPanelPM=function(){function n(){SiebelAppFacade.CommunicationPanelPM.superclass.constructor.call(this,{GetName:function(){return"CommunicationPanel"}})}function r(e){if(!e)return;e.PropertyExists("CanCommPanelDockPosUserOverride")&&this.SetProperty("CanDockPosUserOverride",e.GetProperty("CanCommPanelDockPosUserOverride")==="1"),e.PropertyExists("IsCommPanelDockPosOverridden")&&this.SetProperty("IsDockPosOverridden",e.GetProperty("IsCommPanelDockPosOverridden")==="1"),e.PropertyExists("CommPanelDockPos")&&this.SetProperty("DockPos",e.GetProperty("CommPanelDockPos"))}function i(){if(this.Get("Show")){var t=SiebelApp.S_App.getExtObject("Dashboard");t&&t.OnControlEvent(e.get("DASHBOARD_METHOD_CLOSE")),this.SetProperty("Show",!1)}}function s(e){if(e==="NoChangeDockPos")return;if(!this.Get("IsDockPosOverridden")&&e==="Reset")return;if(this.Get("DockPos")!==e){var t=CCFMiscUtil_CreatePropSet(),n=CCFMiscUtil_CreatePropSet();t.SetProperty("SetCommPanelDockPos",e),this.ExecuteMethod("InvokeServiceMethod","SetCommPanelDockPos",t,n),r.call(this,n)}}function o(){var t=SiebelApp.S_App.getExtObject("Dashboard");t&&t.OnControlEvent(e.get("DASHBOARD_METHOD_CLOSE")),this.SetProperty("Show",!1);var n=CCFMiscUtil_CreatePropSet();n.SetProperty(e.get("SWE_VIEW_ID_STR"),e.get("COMM_PANEL_VIEWNAME")),this.ExecuteMethod("InvokeServiceMethod",e.get("COMM_PANEL_METHOD_TOGGLE"),n),SiebelApp.S_App.UnregisterExtObject(e.get("COMM_PANEL_OBJ_ID"))}function u(){this.ExecuteMethod("InvokeServiceMethod",e.get("COMM_PANEL_CTI_RESET_SESSION_COUNT"),null,null,"Communications Client")}function a(){l.call(this,!0)}function f(){l.call(this,!1)}function l(t){var n=CCFMiscUtil_CreatePropSet(),r=CCFMiscUtil_CreatePropSet(),i=t?e.get("COMM_PANEL_MSG_CTI_PREV"):e.get("COMM_PANEL_MSG_CTI_NEXT");this.ExecuteMethod("InvokeServiceMethod",i,n,r,"Communications Client")}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils");return SiebelJS.Extend(n,SiebelAppFacade.BasePM),n.prototype.Init=function(){this.AddProperty("Show",!1),this.AddProperty("DockPos","Default"),this.AddProperty("CanDockPosUserOverride",!1),this.AddProperty("IsDockPosOverridden",!1),this.AddMethod("InvokeServiceMethod",function(n,r,i,s){s=s||e.get("NAME_COMM_PANEL_UISVC");var o=SiebelApp.S_App.GetService(s);if(o){r=r||CCFMiscUtil_CreatePropSet();var u=o.InvokeMethod(n,r),a=u.GetProperty(e.get("SWE_RPC_PROP_RETURN_STATUS"));if(a!==e.get("SWE_RPC_PROP_STATUS_ERROR")&&!t.IsEmpty(a)){if(i){var f=u.GetChildByType("ResultSet");f&&i.DeepCopy(f)}return!0}}return!1}),this.AddMethod("Hide",i),this.AddMethod("SetCommPanelDockPos",s),this.AttachEventHandler(e.get("COMM_PANEL_CLOSE"),o),this.AttachEventHandler(e.get("COMM_PANEL_CTI_RESET_SESSION_COUNT"),u),this.AttachEventHandler(e.get("COMM_PANEL_MSG_CTI_PREV"),a),this.AttachEventHandler(e.get("COMM_PANEL_MSG_CTI_NEXT"),f)},n.prototype.Setup=function(e){e.SetProperty("SWE_OUI_RENDERER","CommunicationPanelPR"),SiebelAppFacade.CommunicationPanelPM.superclass.Setup.call(this,e),r.call(this,e)},n.prototype.HandleNotify=function(e){r.call(this,e)},n.prototype.Show=function(){SiebelAppFacade.CommunicationPanelPM.superclass.Show.call(this);if(!this.Get("Show")){this.SetProperty("Show",!0);var t=CCFMiscUtil_CreatePropSet(),n,r=!1,i=null;SiebelApp.S_App.getExtObject("Dashboard")||(r=!0),r&&(t.SetProperty("CallFromClient","TRUE"
),this.ExecuteMethod("InvokeServiceMethod",e.get("DASHBOARD_METHOD_OPEN"),t,null,e.get("NAME_DASHBOARDSVC")),t.Reset()),i=SiebelAppFacade.ComponentMgr.FindComponent({id:e.get("SWE_PST_COMM_TOOLBAR")});if(!i||!i.Get("InitFailed")){n=CCFMiscUtil_CreatePropSet(),this.ExecuteMethod("InvokeServiceMethod","IsChatEnabled",t,n,e.get("NAME_CHATUISVC"));if(n.GetProperty("IsChatEnabled")==="1"){r=!1;if(SiebelApp.S_App.getExtObject("ChatPane")){n=CCFMiscUtil_CreatePropSet(),this.ExecuteMethod("InvokeServiceMethod","IsChatPaneOpened",t,n,e.get("NAME_CHATUISVC"));var s=n.GetProperty("IsChatPaneOpened");if(!s||s!=="1")r=!0}else r=!0;r&&this.ExecuteMethod("InvokeServiceMethod","ToggleChatPane",t,null,e.get("NAME_CHATUISVC"))}}}},n}(),SiebelAppFacade.CommunicationPanelPM})),typeof SiebelAppFacade.DashboardPR=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.DashboardPR"),define("siebel/dashboardprenderer",["siebel/basephyrenderer"],function(){return SiebelAppFacade.DashboardPR=function(){function i(e){SiebelAppFacade.DashboardPR.superclass.constructor.call(this,e)}function s(){if($(".siebui-dashboard-container").length>0)this.GetPM().ExecuteMethod(e.get("DASHBOARD_METHOD_INIT"));else{var t=CCFMiscUtil_CreatePropSet();t.SetProperty("CallFromClient","TRUE"),this.GetPM().ExecuteMethod("InvokeServiceMethod",e.get("DASHBOARD_METHOD_OPEN"),t)}}function o(t){t.data.ctx.GetPM().OnControlEvent(e.get("DASHBOARD_METHOD_CLOSE"))}function u(t){t.keyCode===$.ui.keyCode.ENTER&&t.data.ctx.GetPM().OnControlEvent(e.get("DASHBOARD_METHOD_CLOSE"))}function a(t){var n=t.currentTarget.name;t.data.ctx.GetPM().OnControlEvent(e.get("DASHBOARD_METHOD_GETCUSTOMERCONTROLCLICK"),n)}function f(t){var n=CCFMiscUtil_CreatePropSet();SiebelApp.S_App.GetMainView().GetActiveApplet().InvokeMethod("ImplicitCommit",n),t.data.ctx.GetPM().OnControlEvent(e.get("DASHBOARD_METHOD_UPDATE"))}function l(t){t.data.ctx.GetPM().OnControlEvent(e.get("DASHBOARD_METHOD_CLEAR"))}function c(t){t.data.ctx.GetPM().OnControlEvent(e.get("DASHBOARD_METHOD_PREVIOUS"))}function h(t){t.keyCode===$.ui.keyCode.ENTER&&t.data.ctx.GetPM().OnControlEvent(e.get("DASHBOARD_METHOD_PREVIOUS"))}function p(t){t.data.ctx.GetPM().OnControlEvent(e.get("DASHBOARD_METHOD_NEXT"))}function d(t){t.keyCode===$.ui.keyCode.ENTER&&t.data.ctx.GetPM().OnControlEvent(e.get("DASHBOARD_METHOD_NEXT"))}function v(n){var r=$("#s_dshbd_Quick_Navigation").val();t.IsEmpty(r)||n.data.ctx.GetPM().OnControlEvent(e.get("DASHBOARD_METHOD_GOTONAV"),r)}function m(e){var t=$(e.target),n=t.attr("id");e.preventDefault(),n==="commPanelDashboardToShowMore"?b(e,t):n==="commPanelDashboardToShowLess"&&y(e,t)}function g(e){(e.which===$.ui.keyCode.ENTER||e.which===$.ui.keyCode.SPACE)&&m(e)}function y(e,t){var n=$("#CommunicationPanelContainer #commPanelDashboardToShowMore"),r=$("#CommunicationPanelContainer #commPanelDashboardToShowLess");if(n.length===0||r.length===0)return;var i=n.css("display")!=="none";if(i)return;n.show().attr("aria-hidden",!1),r.hide().attr("aria-hidden",!0),e&&t&&n.focus(),w(e)}function b(e,t){var n=$("#CommunicationPanelContainer #commPanelDashboardToShowMore"),r=$("#CommunicationPanelContainer #commPanelDashboardToShowLess");if(n.length===0||r.length===0)return;var i=r.css("display")!=="none";if(i)return;r.show().attr("aria-hidden",!1),n.hide().attr("aria-hidden",!0),e&&t&&r.focus(),w(e)}function w(e){var t=$("#CommunicationPanelContainer #Dashboard");t.length>0&&t.toggleClass("siebui-comm-panel-less"),E.call(e.data.ctx,"Dashboard: Toggle")}function E(e){$("#CommunicationPanelContainer").length>0&&$(window).trigger("resize.commpanel",e)}function S(){x.call(this,this.GetPM().Get("UICustomerControlInfo"))}function x(t){if(t){SiebelJS.Debug("[Customer Dashboard].INFO: Updating Customer control info...");var n={},i=t.EnumChildren(!0);do if(i){var s=i.GetProperty("visible");if(s&&s===e.get("DASHBOARD_VALUE_YES")){var o=i.GetProperty("name"),u=i.GetProperty("type"),a=i.GetProperty("value"),f=i.GetProperty("InvokeMethod"),l='name="'+o+'"',c=i.GetProperty("id"),h="#"+r.GetProperty(c);f&&f!==e.get("DASHBOARD_VALUE_NO")&&(n[o]=f);if(u&&u==="Button"){var p=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:u,value:a,className:"appletButton",attrs:l}),d=$(h);d.empty(),d.append(p)}else if(u&&u==="Text"){var v=$("input[name='"+r.GetProperty(c)+"']");if(v.length>0){var m=$(v[0]);m.addClass("siebui-dashboard-element"),m.attr("id",r.GetProperty(c)),m.attr("name",o)}}}}while(i=t.EnumChildren(!1));this.GetPM().SetProperty("CustomerControlMethods",n)}var g=$("span[id^='Label_']");if(g&&g.length>0)for(var y=0;y<g.length;y++){var b=g[y],w=$(b).text(),p=SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({type:"Label",value:w});$(b).empty(),$(b).append(p)}}function T(){C.call(this,this.GetPM().Get("UIControlInfo"))}function N(){C.call(this,this.GetPM().Get("UpdatedCtrlData"))}function C(n){if(n){SiebelJS.Debug("[Customer Dashboard].INFO: Updating control info...");var r=n.EnumChildren(!0);do if(r){var i=r.GetProperty("CtrlName"),s=r.GetProperty("CtrlType"),o=r.GetProperty("Visible"),u=r.GetProperty("DisplayName"),a=r.GetProperty("FieldValue"),f=r.GetProperty("CanInvokeMethod"),l=$('.siebui-dashboard-container [name="'+i+'"]');if(l.length>0){switch(s){case"FieldLabel":i=="Label QuickNavigation"?(t.IsEmpty(u)&&(u="",SiebelJS.Debug("[Customer Dashboard].UNDEFINED: Caption property of "+i+" control is not defined in Tools!")),l.text(u?u+" : ":u)):(t.IsEmpty(a)&&(a="",SiebelJS.Debug("[Customer Dashboard].UNDEFINED: "+i+" is not mapped properly!")),l.text(a?a+" : ":a));break;case"Field":l.val(a).attr("aria-label",a).attr("title",a);break;case"MiniButton":t.IsEmpty(u)&&(u="",SiebelJS.Debug("[Customer Dashboard].UNDEFINED: Caption property of "+i+" control is not defined in Tools!")),l.html(u),l.attr("title",u);break;case"RecNavPrv":case"RecNavNxt":l.removeClass("siebui-btn-icon-e siebui-btn-icon-d"),f==e.get("DASHBOARD_VALUE_NO")?l.addClass("siebui-btn-icon-d").attr("tabindex","-1"):f==e.get("DASHBOARD_VALUE_YES")&&
l.addClass("siebui-btn-icon-e").attr("tabindex","0");break;default:}f==e.get("DASHBOARD_VALUE_NO")?l.attr("disabled","disabled").attr("tabindex","-1"):f==e.get("DASHBOARD_VALUE_YES")&&l.removeAttr("disabled").attr("tabindex","0"),o==e.get("DASHBOARD_VALUE_NO")?(l.addClass("siebui-invisible"),SiebelJS.Debug("[Customer Dashboard].INVISIBLE: "+i+" is hidden due to Visible property set FALSE in Tools!")):l.removeClass("siebui-invisible"),t.IsTrue(SiebelApp.S_App.IsAutoOn())&&l.attr(e.get("SWE_PROP_AUTOM_OT"),s).attr(e.get("SWE_PROP_AUTOM_RN"),i).attr(e.get("SWE_PROP_AUTOM_UN"),u)}}while(r=n.EnumChildren(!1));$(".siebui-dashboard-container label[name!='Label QuickNavigation']").each(function(){var e=$("#"+$(this).attr("for"));(!$(this).text()||$(this).hasClass("siebui-invisible"))&&(!e.val()||e.hasClass("siebui-invisible"))?($(this).parent(".siebui-dashboard-cell").addClass("siebui-no-display siebui-invisible"),SiebelJS.Debug("[Customer Dashboard].HIDE: "+$(this).attr("name")+" and its paired field"+" are hidden as they both are either empty or Visible set FALSE in Tools!")):$(this).parent(".siebui-dashboard-cell").removeClass("siebui-no-display siebui-invisible")});var c=$(".siebui-dashboard-container input[name='Label Time']"),h=$(".siebui-dashboard-container input[name='Field Time']");(!c.val()||c.hasClass("siebui-invisible"))&&(!h.val()||h.hasClass("siebui-invisible"))?($(".siebui-dashboard-time-label").parent(".siebui-dashboard-cell").addClass("siebui-no-display siebui-invisible"),SiebelJS.Debug("[Customer Dashboard].HIDE: Time label and field are hidden as they both are either empty or Visible set FALSE in Tools!")):$(".siebui-dashboard-time-label").parent(".siebui-dashboard-cell").removeClass("siebui-no-display siebui-invisible"),SiebelJS.Debug("[Customer Dashboard].INFO: Control info updated!")}}function k(){var e=this.GetPM().Get("QuickNavigateList");if(e){var t=$("#s_dshbd_Quick_Navigation");t.empty();var n=e.EnumChildren(!0);do n&&t.append('<option value="'+n.GetProperty("FieldValue")+'">'+n.GetProperty("DisplayName")+"</option>");while(n=e.EnumChildren(!1));if(e.GetChildCount()==0){var r=$("#s_dshbd_Link_Goto");r.length&&r.attr("disabled","disabled").attr("tabindex","-1")}}}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils"),n=SiebelJS.Dependency("SiebelApp.S_App.LocaleObject"),r=CCFMiscUtil_CreatePropSet();return SiebelJS.Extend(i,SiebelAppFacade.BasePR),i.prototype.Init=function(){SiebelAppFacade.DashboardPR.superclass.Init.call(this),this.AttachPMBinding("UIControlInfo",T,{scope:this}),this.AttachPMBinding("QuickNavigateList",k,{scope:this}),this.AttachPMBinding("UpdatedCtrlData",N,{scope:this}),this.AttachPMBinding("UICustomerControlInfo",S,{scope:this})},i.prototype.ShowUI=function(){this.GetPM().Get("CommPanelEnabled")&&$(".siebui-comm-panel-header").length===0&&this.GetPM().ExecuteMethod(e.get("DASHBOARD_METHOD_SHOWINCOMMPANEL")),SiebelAppFacade.DashboardPR.superclass.ShowUI.call(this);var i=$("#CommunicationPanelContainer #Dashboard"),s=null,o=null,u=null,a="",f="",l=!1,c=t.IsTrue(SiebelApp.S_App.IsAutoOn()),h=e.get("SWE_PROP_AUTOM_OT"),p=e.get("SWE_PROP_AUTOM_RN"),d=e.get("SWE_PROP_AUTOM_UN");i.length>0&&(i.addClass("siebui-dashboard-frame"),s=i.find("#commPanelDashboardToggle"),l=i.hasClass("siebui-comm-panel-less"),s.length>0&&(u=s.find("#commPanelDashboardToShowMore"),o=s.find("#commPanelDashboardToShowLess"),u.length>0&&(a=n.GetLocalString("IDS_COMM_PANEL_TOGGLE_SHOW_MORE"),u.parent("div").attr("title",a),u.attr("aria-label",a),c&&u.attr(h,"button").attr(p,"commPanelDashboardShowMore").attr(d,a),l?u.show().attr("aria-hidden",!1):u.hide().attr("aria-hidden",!0)),o.length>0&&(f=n.GetLocalString("IDS_COMM_PANEL_TOGGLE_SHOW_LESS"),o.parent("div").attr("title",f),o.attr("aria-label",f),c&&o.attr(h,"button").attr(p,"commPanelDashboardShowLess").attr(d,f),l?o.hide().attr("aria-hidden",!0):o.show().attr("aria-hidden",!1))));var v=$("span[id^='s_Dashboard_'][id$='_0']");if(v&&v.length>0)for(var m=0;m<v.length;m++){var g=v[m],y=$(g).attr("id"),b=y.split("_");r.SetProperty(b[b.length-2],y)}var w=$("input[name^='s_Dashboard_'][name$='_0']");if(w&&w.length>0)for(var m=0;m<w.length;m++){var S=w[m],y=$(S).attr("name"),b=y.split("_");r.SetProperty(b[b.length-2],y)}r.GetPropertiesSize()>0&&this.GetPM().ExecuteMethod(e.get("DASHBOARD_METHOD_GETCUSTOMERCONTROLINFO"),r);var x=CCFMiscUtil_CreatePropSet();x.SetType("RequiredFields");var T=$(".siebui-dashboard-element"),N=0;for(var C=0,N=T.length;C<N;C++){var k=T[C];x.SetProperty(parseInt(C+1),$(k).attr("name"))}this.GetPM().SetProperty("RequiredFields",x);var L=$(".siebui-dashboard-container").parent(),A=L.siblings("a.next-item-applet").attr("title")+" "+n.GetLocalString("IDS_SWE_FORM_APPLET");L.attr({role:"region",title:A}),$("#s_dashboardclose").attr("role","button").attr("tabindex","0").attr("aria-label",n.GetLocalString("IDS_MSG_CLOSE")).attr("title",n.GetLocalString("IDS_MSG_CLOSE")),$("#s_dshbd_Link_Goto").addClass("siebui-ctrl-btn"),$("#s_dshbd_PushToDashboard").addClass("siebui-ctrl-btn"),$("#s_dshbd_ClearDashboard").addClass("siebui-ctrl-btn"),$(".siebui-dashboard-container input").attr("readOnly",!0).attr("aria-readonly",!0).attr("tabindex","0").addClass("siebui-ctrl-input"),$("#s_dshbd_GoToPreviousRecord").attr("title",n.GetLocalString("PrevRecToolTip")),$("#s_dshbd_GoToNextRecord").attr("title",n.GetLocalString("NextRecToolTip")),c&&($("#s_dashboardclose").attr(h,"button").attr(p,"DashboardClose").attr(d,n.GetLocalString("IDS_MSG_CLOSE")),$("#s_dshbd_GoToPreviousRecord").attr(d,n.GetLocalString("PrevRecToolTip")),$("#s_dshbd_GoToNextRecord").attr(d,n.GetLocalString("NextRecToolTip"))),E.call(this,"Dashboard: ShowUI")},i.prototype.BindEvents=function(){SiebelAppFacade.DashboardPR.superclass.BindEvents.call(this);var e=$("#s_dashboardclose"),t=$("#s_dshbd_PushToDashboard"),n=$("#s_dshbd_ClearDashboard"),r=$("#s_dshbd_GoToPreviousRecord"),i=$("#s_dshbd_GoToNextRecord"),s=$("#s_dshbd_Link_Goto")
,y=$("span[id^='s_Dashboard_'][id$='_0'] button"),b=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(b){e.length>0&&(b.Manage(e,"click",{ctx:this},o),b.Manage(e,"keydown",{ctx:this},u));if(y&&y.length>0)for(var w=0;w<y.length;w++){var E=y[w];b.Manage($(E),"click",{ctx:this},a)}t.length>0&&b.Manage(t,"click",{ctx:this},f),n.length>0&&b.Manage(n,"click",{ctx:this},l),r.length>0&&(b.Manage(r,"click",{ctx:this},c),b.Manage(r,"keydown",{ctx:this},h)),i.length>0&&(b.Manage(i,"click",{ctx:this},p),b.Manage(i,"keydown",{ctx:this},d)),s.length>0&&b.Manage(s,"click",{ctx:this},v);var S=$("#CommunicationPanelContainer #commPanelDashboardToggle");S.length>0&&(b.Manage(S,"click",{ctx:this},m),b.Manage(S,"keydown",{ctx:this},g))}},i.prototype.BindData=function(){SiebelAppFacade.DashboardPR.superclass.BindData.call(this),s.call(this)},i.prototype.EndLife=function(){SiebelAppFacade.DashboardPR.superclass.EndLife.call(this)},i}(),SiebelAppFacade.DashboardPR})),typeof SiebelAppFacade.CommunicationPanelPR=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.CommunicationPanelPR"),define("siebel/commpanelprenderer",["siebel/basephyrenderer"],function(){return SiebelAppFacade.CommunicationPanelPR=function(){function o(e){SiebelAppFacade.CommunicationPanelPR.superclass.constructor.call(this,e)}function u(){var e=$("#CommunicationPanelContainer"),t=e.find($("#CommPanelHeader"));e.length>0&&t.length>0&&(e.data("uiDraggable")===undefined&&(e.draggable({handle:t,start:function(){e.css({right:"",bottom:"",width:"",height:""})},stop:a}),e.off("dragstop.commpanel").on("dragstop.commpanel",a)),r==="DOCK"?e.draggable("option","disabled",!0):e.draggable("option","disabled",!1),e.css("cursor","default"),e.css("position",""))}function a(e,t){var n=$("#CommunicationPanelContainer"),r=n.find($("#CommPanelHeader"));if(n.length>0&&r.length>0){var i=t?t.offset.top:n.offset().top,s=t?t.offset.left:n.offset().left,o=$(window).width(),u=n.outerWidth(!0),a=50-u+parseInt(n.css("marginRight"),10),f=$(window).height()-parseInt(n.css("marginTop"),10)-r.height()-5,l=$(document).scrollTop();i<l?n.css("top",0):i>f+l&&n.css("top",f),SiebelApp.S_App.GetDirection()?s<a?n.css("left",a):s>o-u&&n.css("left",o-u):s<5?n.css("left",5):s>o-50&&n.css("left",o-50),n.css({right:"",bottom:"",width:"",height:""}),A()}}function f(t){t.preventDefault(),t.data.ctx.GetPM().OnControlEvent(e.get("COMM_PANEL_CLOSE"))}function l(e){(e.which===$.ui.keyCode.ENTER||e.which===$.ui.keyCode.SPACE)&&f(e)}function c(t){t.preventDefault(),t.data.ctx.GetPM().OnControlEvent(e.get("COMM_PANEL_CTI_RESET_SESSION_COUNT"))}function h(e){(e.which===$.ui.keyCode.ENTER||e.which===$.ui.keyCode.SPACE)&&c(e)}function p(t){t.preventDefault(),t.data.ctx.GetPM().OnControlEvent(e.get("COMM_PANEL_MSG_CTI_PREV"))}function d(e){(e.which===$.ui.keyCode.ENTER||e.which===$.ui.keyCode.SPACE)&&p(e)}function v(t){t.preventDefault(),t.data.ctx.GetPM().OnControlEvent(e.get("COMM_PANEL_MSG_CTI_NEXT"))}function m(e){(e.which===$.ui.keyCode.ENTER||e.which===$.ui.keyCode.SPACE)&&v(e)}function g(e){var t=$(e.target),n=t.attr("id");e.preventDefault(),n==="commPanelSideToShowWide"?b(e,t):n==="commPanelSideToShowNarrow"&&w(e,t)}function y(e){(e.which===$.ui.keyCode.ENTER||e.which===$.ui.keyCode.SPACE)&&g(e)}function b(e,t){var n=$("#CommunicationPanelContainer"),r=n.find("#commPanelSideToShowWide"),i=n.find("#commPanelSideToShowNarrow"),s=i.css("display")!=="none";if(s)return;i.show().attr("aria-hidden",!1),r.hide().attr("aria-hidden",!0),e&&t&&i.focus(),E(e)}function w(e,t){var n=$("#CommunicationPanelContainer"),r=n.find("#commPanelSideToShowWide"),i=n.find("#commPanelSideToShowNarrow"),s=r.css("display")!=="none";if(s)return;r.show().attr("aria-hidden",!1),i.hide().attr("aria-hidden",!0),e&&t&&r.focus(),E(e)}function E(e){var t=$("#CommunicationPanelContainer");t.length>0&&t.toggleClass("siebui-comm-panel-narrow"),k.call(e.data.ctx,"CommPanel: Wide/Narrow"),r==="DOCK"&&SiebelApp.EventManager.fireEvent("forceResize")}function S(e){var t=$(e.target),n=t.attr("id"),r,i;e.preventDefault();switch(n){case"commPanelDockToShowPin":r="Dock",$("#CommunicationPanelContainer #commPanelDockToShowLeft").is(":visible")?i="Reset":i="NoChangeDockPos";break;case"commPanelDockToShowLeft":r="Dock",i="Left";break;case"commPanelDockToShowRight":r="Dock",i="Right";break;case"commPanelDockToShowUnpin":r="Undock"}r==="Dock"?(e.data.ctx.GetPM().ExecuteMethod("SetCommPanelDockPos",i),T(e,t)):r==="Undock"&&N(e,t)}function x(e){(e.which===$.ui.keyCode.ENTER||e.which===$.ui.keyCode.SPACE)&&S(e)}function T(e,t){var n=$("#CommunicationPanelContainer"),r=n.find("#commPanelDockToShowPin"),i=n.find("#commPanelDockToShowLeft"),s=n.find("#commPanelDockToShowRight"),o=n.find("#commPanelDockToShowUnpin"),u=o.css("display")!=="none";if(u)return;o.show().attr("aria-hidden",!1),r.hide().attr("aria-hidden",!0),i.hide().attr("aria-hidden",!0),s.hide().attr("aria-hidden",!0),e&&t&&o.focus(),C(e)}function N(e,t){var n=$("#CommunicationPanelContainer"),r=n.find("#commPanelDockToShowPin"),i=n.find("#commPanelDockToShowLeft"),s=n.find("#commPanelDockToShowRight"),o=n.find("#commPanelDockToShowUnpin"),u=r.css("display")!=="none",a=e.data.ctx.GetPM(),f;if(u)return;if(!a.Get("CanDockPosUserOverride"))r.show().attr("aria-hidden",!1),f=r;else{i.show().attr("aria-hidden",!1),s.show().attr("aria-hidden",!1);switch(a.Get("DockPos")){case"Left":f=i;break;case"Right":f=s;break;case"LTR-Left/RTL-Right":SiebelApp.S_App.GetDirection()?f=s:f=i;break;default:SiebelApp.S_App.GetDirection()?f=i:f=s}}o.hide().attr("aria-hidden",!0),e&&t&&f&&f.focus(),C(e)}function C(e){var t=$("#CommunicationPanelContainer");t.length>0&&(t.toggleClass("siebui-comm-panel-float"),r==="FLOAT"?r="DOCK":r==="DOCK"&&(r="FLOAT"),u(),k.call(e.data.ctx,"CommPanel: Dock/UnDock"),SiebelApp.EventManager.fireEvent("forceResize"))}function k(e){$("#CommunicationPanelContainer").length>0&&$(window).trigger("resize.commpanel",e)}function L(e,n){var s=$("#CommunicationPanelContainer");if(s.length>0
){var o=r==="FLOAT"?$("#_sweclient").height():$("#_swecontent").height(),u=s.height(),a=s.find($("#CommunicationPanel")).height(),f=s.find($("#CTIToolbar")).length===0?0:s.find($("#CTIToolbar")).height(),l=s.find($("#Dashboard")).length===0?0:s.find($("#Dashboard")).height(),c=s.find($("#SS_ChatUI")).length===0?0:s.find($("#SS_ChatUI")).height(),h=a+f+l+c;3<i&&(!t.IsEmpty(e)&&t.IsEmpty(e.namespace)?n=n||"Window":n=n||"Unknown",_.call(this,3,"Resize triggered from "+n+"\n  CommPanel Height Limit:     "+o+"\n  CommPanel Container Height: "+u+"\n  Sub Panels Height:          "+h+"\n    CommPanel: "+a+"\n    CTI:       "+f+"\n    Dashboard: "+l+"\n    Chat:      "+c)),r==="FLOAT"&&e.namespace===undefined?s.trigger("dragstop.commpanel"):A()}}function A(){var e=$("#CommunicationPanelContainer");if(e.length>0){e.height("");var t=$(window).height(),n=e.offset().top,r=$(document).scrollTop(),i;n+e.height()-r>t-5?i=t+r-n-5:i="",e.height(i)}}function O(){var e=$("#CommunicationPanelContainer"),t,n;e.length>0&&(this.GetPM().Get("Show")?($("#_swecontent").addClass("siebui-comm-panel-shown"),e.removeClass("forcehide"),e.find($("#CTIToolbar")).removeClass("forcehide"),n=$("#siebui-toolbar-toggle-communication-panel .siebui-toolbar-toggle-communication-panel-notification"),n.length>0&&(t=n.attr("data-initial-title")||"",n.removeClass("siebui-toolbar-toggle-communication-panel-notification").attr("aria-label",t).attr("title",t)),k.call(this,"CommPanel: Post Show")):($("#_swecontent").removeClass("siebui-comm-panel-shown"),$(window).off("resize.commpanel"),e.addClass("forcehide"),e.find($("#CTIToolbar")).addClass("forcehide"),e.data("uiDraggable")!==undefined&&e.draggable("destroy")))}function M(){var e=$("#CommunicationPanelContainer");if(e.length>0){e.removeClass("siebui-comm-panel-dock-left siebui-comm-panel-dock-right siebui-comm-panel-dock-ltr-left-rtl-right");switch(this.GetPM().Get("DockPos")){case"Left":e.addClass("siebui-comm-panel-dock-left");break;case"Right":e.addClass("siebui-comm-panel-dock-right");break;case"LTR-Left/RTL-Right":e.addClass("siebui-comm-panel-dock-ltr-left-rtl-right");break;default:}}}function _(e,n){e<i&&(e=e<s.length?e:s.length-1,SiebelJS.Debug("["+t.GetISODateTime(null,!0)+"]: "+s[e]+n))}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils"),n=SiebelJS.Dependency("SiebelApp.S_App.LocaleObject"),r="DOCK",i=3,s=["INFO: ","ERROR: ","WARNING: ","DEBUG: "];return SiebelJS.Extend(o,SiebelAppFacade.BasePR),o.prototype.Init=function(){SiebelAppFacade.CommunicationPanelPR.superclass.Init.call(this),this.AttachPMBinding("Show",O,{scope:this}),this.AttachPMBinding("DockPos",M,{scope:this})},o.prototype.ShowUI=function(){SiebelAppFacade.CommunicationPanelPR.superclass.ShowUI.call(this);var r=$("#CommunicationPanelContainer"),i=null,s=null,o=null,u=null,a=null,f=null,l=null,c=null,h=null,p=null,d=null,v=null,m=null,g=null,y="",b="",w="",E="",S="",x="",T="",N="",C="",k=!1,L=!1,A=!1,O=t.IsTrue(SiebelApp.S_App.IsAutoOn()),M=e.get("SWE_PROP_AUTOM_OT"),_=e.get("SWE_PROP_AUTOM_RN"),D=e.get("SWE_PROP_AUTOM_UN");if(r.length>0){i=r.find("#commPanelCaption"),i.length>0&&(y=n.GetLocalString("IDS_COMM_PANEL_CAPTION"),i.parent("div").attr("title",y),i.attr("aria-label",y),i.text(y)),s=r.find("#commPanelSideToggle"),s.length>0&&(o=s.find("#commPanelSideToShowWide"),u=s.find("#commPanelSideToShowNarrow"),A=r.hasClass("siebui-comm-panel-narrow"),o.length>0&&(b=n.GetLocalString("IDS_COMM_PANEL_SIDE_SHOW_WIDE"),o.parent("div").attr("title",b),o.attr("aria-label",b),O&&o.attr(M,"button").attr(_,"commPanelShowWide").attr(D,b),A?o.show().attr("aria-hidden",!1):o.hide().attr("aria-hidden",!0)),u.length>0&&(w=n.GetLocalString("IDS_COMM_PANEL_SIDE_SHOW_NARROW"),u.parent("div").attr("title",w),u.attr("aria-label",w),O&&u.attr(M,"button").attr(_,"commPanelShowNarrow").attr(D,w),A?u.hide().attr("aria-hidden",!0):u.show().attr("aria-hidden",!1))),a=r.find("#commPanelDockToggle"),a.length>0&&(f=a.find("#commPanelDockToShowPin"),l=a.find("#commPanelDockToShowLeft"),c=a.find("#commPanelDockToShowRight"),h=a.find("#commPanelDockToShowUnpin"),k=r.hasClass("siebui-comm-panel-float"),L=this.GetPM().Get("CanDockPosUserOverride"),f.length>0&&(E=n.GetLocalString("IDS_COMM_PANEL_DOCK_TO_DOCK"),f.parent("div").attr("title",E),f.attr("aria-label",E),O&&f.attr(M,"button").attr(_,"commPanelDockPin").attr(D,E),k&&!L&&f.show().attr("aria-hidden",!1)),l.length>0&&(E=n.GetLocalString("IDS_COMM_PANEL_DOCK_TO_LEFT"),l.parent("div").attr("title",E),l.attr("aria-label",E),O&&l.attr(M,"button").attr(_,"commPanelDockLeft").attr(D,E),k&&L&&l.show().attr("aria-hidden",!1)),c.length>0&&(E=n.GetLocalString("IDS_COMM_PANEL_DOCK_TO_RIGHT"),c.parent("div").attr("title",E),c.attr("aria-label",E),O&&c.attr(M,"button").attr(_,"commPanelDockRight").attr(D,E),k&&L&&c.show().attr("aria-hidden",!1)),h.length>0&&(S=n.GetLocalString("IDS_COMM_PANEL_DOCK_TO_FLOAT"),h.parent("div").attr("title",S),h.attr("aria-label",S),O&&h.attr(M,"button").attr(_,"commPanelDockUnpin").attr(D,S),k&&h.hide().attr("aria-hidden",!0))),p=r.find("#commPanelCloseToggle"),p.length>0&&(d=p.find("#commPanelClose"),d.length>0&&(x=n.GetLocalString("IDS_COMM_PANEL_CLOSE"),d.parent("div").attr("title",x),d.attr("aria-label",x),O&&d.attr(M,"button").attr(_,"commPanelClose").attr(D,x))),v=r.find("#CommPanelCTIResetSessionCount"),v.length>0&&(T=n.GetLocalString("IDS_COMM_PANEL_CTI_RESET_SESSION_COUNT"),v.attr("title",T).attr("aria-label",T),O&&v.attr(M,"button").attr(_,"commPanelCTIResetSessionCount").attr(D,T)),m=r.find("#CommPanelMessageCTIPrev"),m.length>0&&(N=n.GetLocalString("IDS_COMM_PANEL_MESSAGE_CTI_PREV"),m.attr("title",N).attr("aria-label",N),O&&m.attr(M,"button").attr(_,"commPanelPrevMessage").attr(D,N)),g=r.find("#CommPanelMessageCTINext"),g.length>0&&(C=n.GetLocalString("IDS_COMM_PANEL_MESSAGE_CTI_NEXT"),g.attr("title",C).attr("aria-label",C),O&&g.attr(M,"button").attr(_,"commPanelNextMessage").attr(D,C));var P=SiebelAppFacade.ComponentMgr.
FindComponent({id:e.get("SWE_PST_COMM_TOOLBAR")});P&&P.Get("InitFailed")&&(r.find("#CommPanelHeaderCTI").addClass("forcehide"),P.ExecuteMethod("ShowPreviousMessage"))}},o.prototype.BindEvents=function(){SiebelAppFacade.CommunicationPanelPR.superclass.BindEvents.call(this),u.call(this);var e=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(e){var t=$("#CommunicationPanelContainer");if(t.length>0){var n=t.find("#commPanelClose");n.length>0&&(e.Manage(n,"click",{ctx:this},f),e.Manage(n,"keydown",{ctx:this},l));var r=t.find("#commPanelSideToggle");r.length>0&&(e.Manage(r,"click",{ctx:this},g),e.Manage(r,"keydown",{ctx:this},y));var i=t.find("#commPanelDockToggle");i.length>0&&(e.Manage(i,"click",{ctx:this},S),e.Manage(i,"keydown",{ctx:this},x));var s=this,o;$(window).off("resize.commpanel").on("resize.commpanel",function(e,t){clearTimeout(o),o=setTimeout(function(){e.preventDefault(),e.stopPropagation(),L.call(s,e,t)},100)});var a=t.find("#CommPanelCTIResetSessionCount");a.length>0&&(e.Manage(a,"click",{ctx:this},c),e.Manage(a,"keydown",{ctx:this},h));var b=t.find("#CommPanelMessageCTIPrev");b.length>0&&(e.Manage(b,"click",{ctx:this},p),e.Manage(b,"keydown",{ctx:this},d));var w=t.find("#CommPanelMessageCTINext");w.length>0&&(e.Manage(w,"click",{ctx:this},v),e.Manage(w,"keydown",{ctx:this},m)),n=null,r=null,i=null,a=null,b=null,w=null}t=null}e=null},o.prototype.BindData=function(){SiebelAppFacade.CommunicationPanelPR.superclass.BindData.call(this)},o}(),SiebelAppFacade.CommunicationPanelPR})),typeof SiebelAppFacade.EmailPModel=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.EmailPModel"),define("siebel/emailpmodel",["siebel/pmodel"],function(){return SiebelAppFacade.EmailPModel=function(){function o(e){SiebelAppFacade.EmailPModel.superclass.constructor.call(this,e)}function u(){return n===null&&(n=SiebelApp.WebSocketManager.CreateWSHandler(e.get("WS_COMPONENT_TYPE_EMAIL")),n.timeoutID=null,n.OnClose=w,n.OnFail=b,n.OnMessage=y),n}function a(e){i=e}function f(){return i}function l(e){s=e}function c(){return s}function h(e){i!==null&&(i.CompletedCount=e)}function p(){return i.CurrentFileSequence}function d(e){i!==null&&(i.CurrentFileSequence=e)}function v(){var t=f();t&&t.CompletedCount!==0&&h(t.CompletedCount-1);if(t&&t.CompletedCount===0){var n=u();setTimeout(function(){var e=SiebelAppFacade.ComponentMgr.FindComponent({id:"Send External Communication Applet"}).GetPM(),t=e.ExecuteMethod("getEmailHandler"),n=e.ExecuteMethod("getMailInfoJSON");t.SendMessage(n)},2e3),n.timeoutID=setTimeout(function(){var e=SiebelAppFacade.ComponentMgr.FindComponent({id:"Send External Communication Applet"}).GetPM();SiebelJS.Debug("[DISA][Warning] Sending email from DISA time out."),SiebelApp.S_App.uiStatus.Free(),e.ExecuteMethod("closePopup")},e.get("WS_EMAIL_SEND_TIMEOUT"))}else if(t&&t.CompletedCount!==0){var r=SiebelApp.S_App.GetService("Communications Client");if(r){var i=p();d(i+1);var s=CCFMiscUtil_CreatePropSet();s.SetProperty("File",t.MailInfo.AttachmentsInfo[i+1].DispFileName),s.SetProperty("FullPath",t.MailInfo.AttachmentsInfo[i+1].FilePath),l(!0);var o=r.InvokeMethod("DownloadFile",s)}}}function m(e,t){var n=e[1]+"&postMthd=OutlookSendMail",r=$.ajax({url:t,data:n,type:"GET",xhrFields:{responseType:"blob"},success:function(e){if(r.getResponseHeader("Content-Disposition")!==null){var t=r.getResponseHeader("Content-Disposition").split("filename=")[1].split('"')[1];if(typeof window.chrome!="undefined"){var n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=t,n.click()}else if(typeof window.navigator.msSaveBlob!="undefined"){var i=new Blob([e],{type:"application/force-download"});window.navigator.msSaveBlob(i,t)}else{var s=new File([e],t,{type:"application/force-download"});window.open(URL.createObjectURL(s))}v.call(this)}},error:function(e,t){t==="timeout"&&alert("Failed from timeout")}})}function g(){n&&(n.Unregister(),n=null)}function y(n){var i=n[e.get("WS_EMAIL_MAIL_INFO_PROCESSED")];if(i!==undefined){SiebelApp.S_App.uiStatus.Free(),S();if(i===!1){var s=SiebelApp.S_App.LocaleObject.GetLocalString("IDS_EMAIL_SEND_EXT_FAILED");s=s.replace("%1",r),SiebelJS.Debug("[DISA][Error] "+s),t.Alert(s)}x()}}function b(){E()}function w(){SiebelJS.Debug("[DISA][Warning] DISA was closed during sending email from DISA."),E()}function E(){SiebelApp.S_App.uiStatus.Free(),S(),x()}function S(){n&&n.timeoutID&&(window.clearTimeout(n.timeoutID),n.timeoutID=null)}function x(){SiebelApp.S_App.GetPopupPM().OnControlEvent("ClosePopupByX",document.createEvent("Event"))}function T(t){if(!t)return;var n=e.get("WS_EMAIL_MAIL_INFO"),i=t.GetChildByType(n);if(i){var s=e.get("WS_EMAIL_MAIL_CLIENT_TYPE"),o=e.get("WS_EMAIL_MAIL_INFO_TO"),u=e.get("WS_EMAIL_MAIL_INFO_CC"),f=e.get("WS_EMAIL_MAIL_INFO_BCC"),c=e.get("WS_EMAIL_MAIL_INFO_SUBJECT"),p=e.get("WS_EMAIL_MAIL_INFO_BODY");r=i.GetProperty(s);var m=i.GetProperty(o),g=i.GetProperty(u),y=i.GetProperty(f),b=i.GetProperty(c),w=i.GetProperty(p);if(r===e.get("WS_EMAIL_EXT_MAIL_CLIENT")){var E="mailto:"+m+"?";g&&(E+="cc="+g+"&"),y&&(E+="bcc="+y+"&"),b&&(E+="subject="+b+"&"),w&&(E+="body="+w);var S=document.createElement("a");$(S).attr("href",E).appendTo("div[name=popup]"),S.click(),setTimeout(x,100)}else{SiebelApp.S_App.uiStatus.Busy({mask:!0});var T=e.get("WS_EMAIL_MAIL_INFO_LANGUAGE_CODE"),N=e.get("WS_EMAIL_MAIL_INFO_HTMLBODY"),C=e.get("WS_EMAIL_MAIL_INFO_CONNECT"),k=e.get("WS_EMAIL_MAIL_INFO_ATTACHMENTS"),L=i.GetProperty(T),A=i.GetProperty(N),O={};O[s]=r,O[T]=L,O[o]=m,O[u]=g,O[f]=y,O[c]=b,A?O[N]=A:w&&(O[p]=w);var M=i.GetChildByType(C);if(M){var _=e.get("WS_EMAIL_MAIL_INFO_CONNECT_URL"),D=e.get("WS_EMAIL_MAIL_INFO_CONNECT_CMD"),P=e.get("WS_EMAIL_MAIL_INFO_CONNECT_SECURE"),H=e.get("WS_EMAIL_MAIL_INFO_CONNECT_USER_NAME"),B=e.get("WS_EMAIL_MAIL_INFO_CONNECT_PASSWORD"),j={};j[_]=M.GetProperty(_),j[D]=M.GetProperty(D),j[P]=M.GetProperty(P),j[H]=M.GetProperty(H),j[B]=M.GetProperty(B),O[C]=j}var F=i.GetChildByType(k);if(F){var I=e.get("WS_EMAIL_MAIL_INFO_ATTS_FILE_PATH"
),q=e.get("WS_EMAIL_MAIL_INFO_ATTS_FILE_NAME"),R=e.get("WS_EMAIL_MAIL_INFO_ATTS_DISP_FILE_NAME"),U=F.EnumChildren(!0);if(U){var z=[];do{var W={};W[I]=U.GetProperty(I),W[q]=U.GetProperty(q),W[R]=U.GetProperty(R),z.push(W)}while(U=F.EnumChildren(!1));O[k]=z}}var X={};X[n]=O,a(X);if(X.MailInfo.AttachmentsInfo!==undefined){h(X.MailInfo.AttachmentsInfo.length),d(0);var V=SiebelApp.S_App.GetService("Communications Client");if(V){var J=CCFMiscUtil_CreatePropSet();J.SetProperty("File",X.MailInfo.AttachmentsInfo[0].DispFileName),J.SetProperty("FullPath",X.MailInfo.AttachmentsInfo[0].FilePath),l(!0);var K=V.InvokeMethod("DownloadFile",J)}}else h(0),v.call(this)}}}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils"),n=null,r="",i=null,s=!1;return SiebelJS.Extend(o,SiebelAppFacade.PresentationModel),o.prototype.Init=function(){this.AddMethod("getMailInfoJSON",f),this.AddMethod("setInDISASendMail",l),this.AddMethod("getInDISASendMail",c),this.AddMethod("getEmailHandler",u),this.AddMethod("setDownLoadStatus",h),this.AddMethod("setCurrentFileSequence",d),this.AddMethod("getCurrentFileSequence",p),this.AddMethod("HandleFilesDownload",v),this.AddMethod("DownloadFiles",m),this.AddMethod("closePopup",x),SiebelAppFacade.EmailPModel.superclass.Init.call(this),this.AddProperty("CcCaption","Cc"),this.AddProperty("BccCaption","Bcc")},o.prototype.Setup=function(e){e.SetProperty("SWE_OUI_RENDERER","EmailRenderer"),SiebelAppFacade.EmailPModel.superclass.Setup.call(this,e),T.call(this,e)},o.prototype.EndLife=function(){g.call(this),SiebelAppFacade.EmailPModel.superclass.EndLife.call(this)},o}(),SiebelAppFacade.EmailPModel})),typeof SiebelAppFacade.EmailRenderer=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.EmailRenderer"),define("siebel/emailprenderer",["siebel/phyrenderer"],function(){return SiebelAppFacade.EmailRenderer=function(){function n(e){SiebelAppFacade.EmailRenderer.superclass.constructor.call(this,e)}function r(e){a(),l()}function i(e){f(),l()}function s(t){if(t.which===e.get("SWE_F2_KEY")){var n=t.data.ctrl.GetMethodPropSet().Clone();t.data.ctx.GetPM().OnControlEvent(e.get("PHYEVENT_INVOKE_CONTROL"),t.data.ctrl.GetMethodName(),n),t.stopImmediatePropagation()}}function o(){var e=$(".siebui-email-show-cc a");e.length>0&&(e.text(this.GetPM().Get("CcCaption")),$(".siebui-email-show-cc").width(e.width()))}function u(){var e=$(".siebui-email-show-bcc a");e.length>0&&(e.text(this.GetPM().Get("BccCaption")),$(".siebui-email-show-bcc").width(e.width()))}function a(){var e=$(".siebui-email-cc-row");e.length>0&&e.show().attr("aria-hidden",!1);var t=$(".siebui-email-show-cc");t.length>0&&t.hide().attr("aria-hidden",!0)}function f(){var e=$(".siebui-email-bcc-row");e.length>0&&e.show().attr("aria-hidden",!1);var t=$(".siebui-email-show-bcc");t.length>0&&t.hide().attr("aria-hidden",!0)}function l(){$("div[name=popup]").parent().height("auto")}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils");return SiebelJS.Extend(n,SiebelAppFacade.PhysicalRenderer),n.prototype.Init=function(){SiebelAppFacade.EmailRenderer.superclass.Init.call(this),this.AttachPMBinding("CcCaption",o,{scope:this}),this.AttachPMBinding("BccCaption",u,{scope:this})},n.prototype.ShowUI=function(){SiebelAppFacade.EmailRenderer.superclass.ShowUI.call(this);var n=$(".siebui-email-to input");n.length>0&&n.addClass("siebui-ctrl-pick siebui-input-popup");var r=$(".siebui-email-cc input");r.length>0&&r.addClass("siebui-ctrl-pick siebui-input-popup");var i=$(".siebui-email-bcc input");i.length>0&&i.addClass("siebui-ctrl-pick siebui-input-popup");var s=this.GetPM().Get("GetControls");for(var o in s)if(s.hasOwnProperty(o)){var u=s[o];if(o==="HTML Address Book"){var a=$("[name="+u.GetInputName()+"]");a.length>0&&a.text("").addClass("siebui-icon-pick applet-form-pick applet-list-pick").attr("aria-label","Selection Field")}else if(o==="HTML Label3")this.GetPM().SetProperty("CcCaption",u.GetDisplayName());else if(o==="HTML Label4")this.GetPM().SetProperty("BccCaption",u.GetDisplayName());else if(o==="HTML Button2"||o==="HTML Button"){var f=$("[name="+u.GetInputName()+"]");f.children("a").attr("title",u.GetDisplayName())}}s=null;var l=$(".siebui-email-show-bcc a"),c=$(".siebui-email-show-cc a");t.IsTrue(SiebelApp.S_App.IsAutoOn())&&(l.attr(e.get("SWE_PROP_AUTOM_OT"),e.get("SWE_CTRL_LINK")).attr(e.get("SWE_PROP_AUTOM_RN"),"EmailShowBccLine").attr(e.get("SWE_PROP_AUTOM_UN"),this.GetPM().Get("BccCaption")),c.attr(e.get("SWE_PROP_AUTOM_OT"),e.get("SWE_CTRL_LINK")).attr(e.get("SWE_PROP_AUTOM_RN"),"EmailShowCcLine").attr(e.get("SWE_PROP_AUTOM_UN"),this.GetPM().Get("CcCaption")));var h=$(".siebui-email-cc-row");h.length>0&&h.hide().attr("aria-hidden",!0);var p=$(".siebui-email-bcc-row");p.length>0&&p.hide().attr("aria-hidden",!0);var d=$("div[name=popup]");if(d.length>0){var v=d.find(".siebui-email-popup-buttons"),m=d.find(".siebui-send-email");if(v.length>0&&m.length>0){var g=v.width()+m.outerWidth(!0)-m.width();d.parent(".ui-dialog").css({minWidth:g})}}},n.prototype.BindEvents=function(){var e=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper"),t=this.GetPM().Get("GetControls");for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];if(n==="HTML Address Book"){var u=$("[name="+o.GetInputName()+"]").siblings("input");u.length>0&&e&&e.Manage(u,"keydown",{ctx:this,ctrl:o},s)}}var a=$(".siebui-email-show-bcc a"),f=$(".siebui-email-show-cc a");a.length>0&&f.length>0&&e&&(e.Manage(f,"click",{ctx:this},r),e.Manage(a,"click",{ctx:this},i)),SiebelAppFacade.EmailRenderer.superclass.BindEvents.call(this)},n.prototype.BindData=function(){SiebelAppFacade.EmailRenderer.superclass.BindData.call(this)},n.prototype.EndLife=function(){SiebelAppFacade.EmailRenderer.superclass.EndLife.call(this)},n.prototype.SetControlValue=function(e,n,r){e.GetFieldName()==="Email CC Line"&&!t.IsEmpty(n)&&a(),e.GetFieldName()==="Email BCC Line"&&!t.IsEmpty(n)&&f(),SiebelAppFacade.EmailRenderer.superclass.SetControlValue.call(this
,e,n,r)},n}(),SiebelAppFacade.EmailRenderer})),typeof SiebelAppFacade.PIMSIListAppletPR=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.PIMSIListAppletPR"),define("siebel/pimsilistappletpr",["siebel/jqgridrenderer"],function(){return SiebelAppFacade.PIMSIListAppletPR=function(){function r(){SiebelAppFacade.PIMSIListAppletPR.superclass.constructor.apply(this,arguments)}function i(){var e=this.GetPM(),t=$("#s_"+e.Get("GetFullId")+"_div").find("#pimsi_upload_btn");if(t.length===0)return;var n=!1,r=e.Get("GetBusComp").GetParentBusComp();if(r){var i=r.GetRecordSet(),s=i[r.GetSelection()];s&&s["Profile Name"]==="Exchange Web Service"&&!r.IsInQueryState()&&!e.Get("IsInQueryMode")&&(n=!0)}n?t.removeClass("appletButtonDis").addClass("appletButton").removeAttr("disabled"):t.removeClass("appletButton").addClass("appletButtonDis").attr("disabled","disabled")}function s(){function t(t){var n=t.target.files[0],r=new FileReader(n);r.onload=function(t){var n=r.result,i=CCFMiscUtil_CreatePropSet(),s=SiebelApp.S_App.GetService("SSSE Azure UI Business Service");if(s){var o={};o.async=!0,o.scope=this,o.npr=!0,o.selfbusy=!0,o.cb=function(){e.remove()},i.SetProperty("Key",n),s.InvokeMethod("Upload",i,o)}},r.readAsText(n)}var e=$(document.createElement("input"));return e.attr("type","file"),e.on("change",t),e.trigger("click"),!1}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils"),n=SiebelJS.Dependency("SiebelApp.S_App.LocaleObject");return SiebelJS.Extend(r,SiebelAppFacade.JQGridRenderer),r.prototype.Init=function(){SiebelAppFacade.PIMSIListAppletPR.superclass.Init.call(this),this.AttachPMBinding("ShowSelection",i),this.AttachPMBinding("InvokeStateChange",i)},r.prototype.ShowUI=function(){SiebelAppFacade.PIMSIListAppletPR.superclass.ShowUI.apply(this,arguments);var t=$("#s_"+this.GetPM().Get("GetFullId")+"_div").find(".siebui-applet-buttons > .siebui-btn-grp-search"),r="pimsi_upload_btn",i=e.get("SWE_PST_BUTTON_CTRL"),o="Upload",u=n.GetLocalString("IDS_ATT_FILE_UPLOAD"),a=$(SiebelAppFacade.HTMLTemplateManager.GenerateMarkup({attrs:"ot='"+i+"' un='"+o+"' rn='"+o+"' alt= '"+u+"' title='"+u+"'",className:"appletButton",id:r,type:i,value:u}));if($(t).length>0){$(t[0]).append(a);var f=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");f&&f.Manage(a,["click","tap"],s)}},r}(),SiebelAppFacade.PIMSIListAppletPR})),typeof SiebelAppFacade.TaskAssistPlayerPM=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.TaskAssistPlayerPM"),define("siebel/taskassistplayerpmodel",["siebel/pmodel"],function(){return SiebelAppFacade.TaskAssistPlayerPM=function(){function n(){SiebelAppFacade.TaskAssistPlayerPM.superclass.constructor.call(this,{GetName:function(){return"TaskAssistantPlayer"}})}function r(){this.Get("Show")&&this.SetProperty("Show",!1)}function i(e){if(!e)return;var t=e.GetProperty("Type");switch(t){case"TASK_LIST_ALL":s.call(this,e);break;case"TASK_PLAYER_ALL":h.call(this,e);break;case"TASK_DETAIL_UPDATE":o.call(this,e);break;default:}}function s(e){var t=this.Get("TaskMap"),n=this.Get("Tasks"),r=e.GetProperty("PlayerMode");this.SetProperty("PlayerMode",r);var i=e.GetProperty("ClearTaskList");i==="TRUE"&&(t={},n=[]),this.SetProperty("TaskListName",e.GetProperty("TaskListName"));var s=e.GetProperty("LocaleStrings");u.call(this,s);var o=e.EnumChildren(!0);if(o)do{var a={};a.taskId=o.GetProperty("Buf"),a.taskRowId=o.GetProperty("TaskId"),a.taskName=o.GetProperty("TaskName"),a.viewName=o.GetProperty("ViewName"),n.push(a),t[a.taskRowId]=a;var f={},l=o.GetChildByType("SubTask");l&&(f.taskId=l.GetProperty("Buf"),f.taskRowId=l.GetProperty("TaskId"),f.taskName=l.GetProperty("TaskName"),a.subTask=f)}while(o=e.EnumChildren(!1));this.SetProperty("Tasks",n),this.SetProperty("TaskMap",t)}function o(e){this.SetProperty("ReturnLinkName",e.GetProperty("ReturnLinkName")),this.SetProperty("HighlightStep",e.GetProperty("HighlightStep"))}function u(e){var t=this.Get("LocaleStringMap"),n=e.split("|");for(var r=0,i=n.length;r<i;r++){var s=n[r].split("@");t[s[0]]=s[1]}this.SetProperty("LocaleStringMap",t)}function a(e){if(e){var n=e.GetProperty("ErrString");return n?(t.Alert(n),!0):!1}return!1}function f(){this.SetProperty("Show",!1);var t=CCFMiscUtil_CreatePropSet();t.SetProperty(e.get("SWE_VIEW_ID_STR"),e.get("TASKASSIST_PANE_VIEWNAME")),this.ExecuteMethod("InvokeServiceMethod",e.get("TASKASSISTUISVC_METHOD_TOGGLEIHELP"),t),SiebelApp.S_App.UnregisterExtObject("TaskAssistant")}function l(t){var n=CCFMiscUtil_CreatePropSet(),r=CCFMiscUtil_CreatePropSet();this.ExecuteMethod("InvokeServiceMethod","IsTaskAssistantOn",n,r);var i=r.GetProperty("IsTaskAssistantOn");i==="0"&&(n.SetProperty(e.get("SWE_VIEW_ID_STR"),e.get("TASKASSIST_PANE_VIEWNAME")),this.ExecuteMethod("InvokeServiceMethod",e.get("TASKASSISTUISVC_METHOD_TOGGLEIHELP"),n)),c.call(this,t)}function c(e){this.SetProperty("ClearCurrentStepControlsHighlight",!0);var t=CCFMiscUtil_CreatePropSet(),n=CCFMiscUtil_CreatePropSet();t.SetProperty("Task Id",e),this.ExecuteMethod("InvokeServiceMethod","LaunchTaskFromList",t,n)&&h.call(this,n)}function h(e){var t=this.Get("TaskDetail"),n=e.GetProperty("ClearTask");n==="TRUE"&&(t={},this.SetProperty("TaskAdditionalItemMap",{})),this.SetProperty("TaskListName",e.GetProperty("TaskListName")),t.displayName=e.GetProperty("TaskDisplayName"),t.taskId=e.GetProperty("TaskId"),this.SetProperty("CurrentStepId","1"),this.SetProperty("ReturnLinkName",e.GetProperty("ReturnLinkName"));var r=e.GetProperty("PlayerMode");this.SetProperty("PlayerMode",r);var i=e.GetProperty("LocaleStrings");u.call(this,i),t.branchStepIdArray=[],t.stepArray=[];var s=Number(e.GetProperty("ClearStepsAfter"));s?t.hasDoneStep=!1:e.GetProperty("HasDoneStep")==="TRUE"&&(t.hasDoneStep=!0);var o=e.GetChildByType("Step",!0),a=o.EnumChildren(!0);if(a)do{var f={};f.number=a.GetProperty("StepNum");if(s&&Number(f.number)>s)continue;f.displayText=a.GetProperty("DisplayText"),f.isRequired=a.GetProperty("IsRequired"),f.viewName=a.GetProperty("ViewName"),f.sectionLabel=
a.GetProperty("SectionLabel"),f.isExpanded=a.GetProperty("StepState"),f.highlightData=a.GetProperty("Highlights"),t.stepArray.push(f);var l=a.EnumChildren(!0);if(l){var c=[];do{var h={};h.subStepId=l.GetProperty("Buf"),h.displayText=l.GetProperty("DisplayText"),h.isRequired=l.GetProperty("IsRequired"),c.push(h)}while(l=a.EnumChildren(!1));f.subStepArray=c}}while(a=o.EnumChildren(!1));var p=e.GetChildByType("ShowMeMore");p&&(t.showMeObj={displayText:p.GetProperty("DisplayText"),location:p.GetProperty("Location")});var d={},v=e.GetProperty("AdditionalHelpHeading");if(v){var m=e.GetChildByType("AdditionalHelpItem",!0);if(m){var g=m.EnumChildren(!0);if(g){var y=[];do{var b={};b.name=g.GetProperty("Name"),b.rowId=g.GetProperty("RowId"),y.push(b),d[b.rowId]=b}while(g=m.EnumChildren(!1));t.addItemArray=y,t.addItemsHeader=v}}this.SetProperty("TaskAdditionalItemMap",d)}var w=e.GetProperty("BranchStepIdArray");w&&(t.branchStepIdArray=w.split(",")),this.SetProperty("CurrentStepId",e.GetProperty("CurrentStep")),t.highlightStepAction=e.GetProperty("HighlightStepAction"),this.SetProperty("TaskDetail",t)}function p(e,t){var n=this.Get("TaskMap"),r=n[t];if(r){var i=r.subTask;if(e===i.taskRowId){var s=CCFMiscUtil_CreatePropSet(),o=CCFMiscUtil_CreatePropSet();s.SetProperty("TaskName",i.taskName),this.ExecuteMethod("InvokeServiceMethod","StartTask",s,o,"Task UI Service (SWE)")}}}function d(e){var t=this.Get("TaskDetail");if(!t.hasDoneStep){var n=CCFMiscUtil_CreatePropSet(),r=CCFMiscUtil_CreatePropSet();n.SetProperty("Step Num",e),this.ExecuteMethod("InvokeServiceMethod","DoNext",n,r)&&(r.SetProperty("ClearTask","FALSE"),h.call(this,r))}}function v(e){var t=this.Get("TaskDetail"),n=t.branchStepIdArray.length;if(n===0)return!1;for(var r=0,i=Number(e);r<n;++r)if(i<=Number(t.branchStepIdArray[r])){t.hasDoneStep=!1,this.SetProperty("CurrentStepId",e);var s=t.branchStepIdArray[r],o=t.stepArray.length;for(var u=Number(s);u<o;++u)t.stepArray.pop();for(var u=r;u<n;++u)t.branchStepIdArray.pop();return this.SetProperty("TaskDetail",t),!0}return!1}function m(e){this.SetProperty("CurrentStepId",e)}function g(){this.SetProperty("ClearCurrentStepControlsHighlight",!0);var e=CCFMiscUtil_CreatePropSet(),t=CCFMiscUtil_CreatePropSet();this.ExecuteMethod("InvokeServiceMethod","Done",e,t)&&s.call(this,t)}function y(){var e=CCFMiscUtil_CreatePropSet(),t=CCFMiscUtil_CreatePropSet();this.ExecuteMethod("InvokeServiceMethod","LoadAllData",e,t)&&i.call(this,t)}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils");return SiebelJS.Extend(n,SiebelAppFacade.BasePM),n.prototype.Init=function(){this.AddProperty("Show",!1),this.AddProperty("PlayerMode",null),this.AddProperty("TaskListName",""),this.AddProperty("LocaleStringMap",{}),this.AddProperty("Tasks",[]),this.AddProperty("TaskMap",{}),this.AddProperty("TaskDetail",{}),this.AddProperty("TaskAdditionalItemMap",{}),this.AddProperty("ReturnLinkName",""),this.AddProperty("ClearCurrentStepControlsHighlight",!1),this.AddProperty("CurrentStepId",""),this.AddProperty("HighlightStep",""),this.AddProperty("TaskListContainer","taskListPane"),this.AddProperty("TaskContainer","taskPlayerMain"),this.AddMethod("InvokeServiceMethod",function(n,r,i,s){s||(s=e.get("NAME_TASKASSISTUISVC"));var o=SiebelApp.S_App.GetService(s);if(o){r||(r=CCFMiscUtil_CreatePropSet());var u=o.InvokeMethod(n,r),a=u.GetProperty(e.get("SWE_RPC_PROP_RETURN_STATUS"));if(a!==e.get("SWE_RPC_PROP_STATUS_ERROR")&&!t.IsEmpty(a)){if(i){var f=u.GetChildByType("ResultSet");f&&i.DeepCopy(f)}return!0}}return!1}),this.AddMethod("LoadAllData",y),this.AddMethod("LaunchTaskFromView",l),this.AddMethod("Hide",r),this.AttachEventHandler(e.get("TASKASSIST_PANE_CLOSE"),f),this.AttachEventHandler("LaunchTaskFromList",c),this.AttachEventHandler("LaunchSubTaskFromList",p),this.AttachEventHandler("ExpandBranch",d),this.AttachEventHandler("ClearBranchAfter",v),this.AttachEventHandler("SetCurrentStepId",m),this.AttachEventHandler(e.get("TASKASSIST_PANE_DONE"),g)},n.prototype.Setup=function(e){e.SetProperty("SWE_OUI_RENDERER","TaskAssistPlayerPR"),SiebelAppFacade.TaskAssistPlayerPM.superclass.Setup.call(this,e),i.call(this,e)},n.prototype.HandleNotify=function(e){i.call(this,e)},n.prototype.Show=function(){SiebelAppFacade.TaskAssistPlayerPM.superclass.Show.call(this),this.Get("Show")||this.SetProperty("Show",!0)},n}(),SiebelAppFacade.TaskAssistPlayerPM})),typeof SiebelAppFacade.TaskAssistPlayerPR=="undefined"&&(SiebelJS.Namespace("SiebelAppFacade.TaskAssistPlayerPR"),define("siebel/taskassistplayerprenderer",["siebel/basephyrenderer","3rdParty/fancytree/dist/jquery.fancytree.min.js"],function(){return SiebelAppFacade.TaskAssistPlayerPR=function(){function o(e){SiebelAppFacade.TaskAssistPlayerPR.superclass.constructor.call(this,e)}function u(t){t.data.ctx.GetPM().OnControlEvent(e.get("TASKASSIST_PANE_CLOSE"))}function a(t){t.keyCode===$.ui.keyCode.ENTER&&t.data.ctx.GetPM().OnControlEvent(e.get("TASKASSIST_PANE_CLOSE"))}function f(t){s=undefined,t.data.ctx.GetPM().OnControlEvent(e.get("TASKASSIST_PANE_DONE"))}function l(t){t.keyCode===$.ui.keyCode.ENTER&&(s=undefined,t.data.ctx.GetPM().OnControlEvent(e.get("TASKASSIST_PANE_DONE")))}function c(){this.GetPM().Get("Show")?(y.call(this,!0),n||(SiebelApp.EventManager.addListner("postload",this.HighlightControls,this),n=!0)):(y.call(this,!1),n&&(SiebelApp.EventManager.removeListner("postload",this.HighlightControls,this),n=!1))}function h(){var e=this.GetPM().Get("TaskListName");$("#taskTitle_list").text(e)}function p(n){try{$.ui.fancytree.getTree(n).getRootNode().removeChildren()}catch(r){}var i=this,o=t.IsTrue(SiebelApp.S_App.IsAutoOn());return n.fancytree({source:[],nodata:!1,title:i.GetPM().Get("TaskDetail").displayName,imagePath:"",click:function(e,t){var n=t.node;return e.target.className==="fancytree-expander"||n.isExpanded()?(n.setExpanded(!n.expanded),!1):d.call(i,n,e)},renderNode:function(t,n){var r=n.node;r.data.addClass&&$(r.span).addClass(r.data.addClass),o&&$(r.span
).attr(e.get("SWE_PROP_AUTOM_OT"),"iHelpNode").attr(e.get("SWE_PROP_AUTOM_RN"),"iHelpItem").attr(e.get("SWE_PROP_AUTOM_UN"),"iHelpItem")}}),s=$.ui.fancytree.getTree(n),s.getRootNode()}function d(e,t){var n=this.GetPM(),r=e.getLevel(),o=e.key;if(r===1)return w.call(this,o,!0),!1;if(r===2)return o==="ShowMe"&&e.data.href?window.open(e.data.href,e.data.target):o!=="ShowMe"&&w.call(this,o,!0),!1;if(r===3&&n.Get("TaskAdditionalItemMap")[o])return s=undefined,n.OnControlEvent("LaunchTaskFromList",o),!1;if(r===3||r===4){var u=r===3?e:e.parent,a=u.key,f=Number(a),l=this.GetPM().Get("CurrentStepId"),c=Number(l),h=$(t.originalEvent.target);if(f!=c||!e.isExpanded()){var p=!1;if(f===i)return n.OnControlEvent("ExpandBranch",l),!1;f<c&&n.OnControlEvent("ClearBranchAfter",a)&&(p=!0),p||(n.OnControlEvent("SetCurrentStepId",a),w.call(this,l,!1),w.call(this,a,!0))}if(h.prop("tagName")==="A"){var d=h.attr("target")?h.attr("target"):"_blank";window.open(h.attr("href"),d)}else{var m=n.Get("TaskDetail").stepArray;v.call(this,m[f-1],m[c-1])}return!1}}function v(e,t){var n=SiebelApp.S_App.GetActiveView().GetName();e&&e.viewName&&e.viewName!==n?(r=!0,SiebelApp.S_App.GotoView(e.viewName)):(g.call(this,t,!1),g.call(this,e,!0))}function m(e,t,n,r){var i=SiebelAppFacade.ComponentMgr.FindComponent({id:e});if(i){var s=i.Get("GetControls"),o=s[t];if(o){var u=i.GetPR();if(u){var a=u.GetUIWrapper(o).GetEl();r?$(a).addClass(n):$(a).removeClass(n)}}}}function g(e,n){if(e&&!t.IsEmpty(e.highlightData)){var r=SiebelApp.S_App.GetActiveView().GetName();if(e.viewName===r){var i=e.highlightData.split("|");for(var s=0,o=i.length;s<o;s++){var u=i[s].split("@");m.call(this,u[0],u[1],"siebui-task-assist-control-highlight",n)}}}}function y(e){if(this.GetPM().Get("PlayerMode")==="1"){var t=Number(this.GetPM().Get("CurrentStepId"));if(t>=1){var n=this.GetPM().Get("TaskDetail").stepArray;n&&t<=n.length&&g.call(this,n[t-1],e)}}}function b(){var e=this.GetPM().Get("ClearCurrentStepControlsHighlight");e&&(this.GetPM().SetProperty("ClearCurrentStepControlsHighlight",!1),y.call(this,!1))}function w(e,t){if(s&&e){var n=s.getNodeByKey(e);if(n){var r=$(n.parent.li).children("ul:first");t?(r.removeClass().addClass("siebui-task-assist-step-selected"),n.setExpanded(!0)):r.removeClass("siebui-task-assist-step-selected")}}}function E(e){try{$.ui.fancytree.getTree(e).getRootNode().removeChildren()}catch(t){}var n=this;return e.fancytree({source:[],nodata:!1,title:n.GetPM().Get("TaskListName"),imagePath:"",click:function(e,t){return S.call(n,t.node,e)}}),$.ui.fancytree.getTree(e).getRootNode()}function S(e,t){var n=e.getLevel(),r=e.key;return n===1?this.GetPM().OnControlEvent("LaunchTaskFromList",r):n===2&&e.getParent()&&this.GetPM().OnControlEvent("LaunchSubTaskFromList",r,e.getParent().key),!1}function x(e){var t=$("#"+e);if(!t.length)return;return t.fancytree("getRootNode")}function T(){var e=$("#"+this.GetPM().Get("TaskListContainer"));if(!e.length)return;var t=E.call(this,e),n=this.GetPM().Get("Tasks");if(n&&n.length&&t)for(var r=0,i=n.length;r<i;++r)N.call(this,n[r],t);var s=$(t.ul);s.find("a").attr("tabindex","-1"),s.attr("role","tree").attr("tabindex","-1").attr("aria-labelledby",j(taskTitle_list)),P(s)}function N(e,t){var n=t.addChildren({title:e.taskName,folder:!0,icon:"images/bullet_green.gif",expanded:!0,key:e.taskRowId,noLink:!1});$(n.li).attr("role","treeitem").attr("tabindex","-1").attr("aria-label",j(e.taskName));var r=e.subTask;r&&n.addChildren({title:r.taskName,key:r.taskRowId,noLink:!1})}function C(){var t=this.GetPM().Get("TaskDetail"),n=t.stepArray,r=n.length;try{if(s){var i,o=0;while(o<r){i=s.getNodeByKey(o+1);if(!i)break;n[o].isExpanded=i.expanded,++o}}}catch(u){}var a=$("#"+this.GetPM().Get("TaskContainer"));if(!a.length)return;var f=p.call(this,a),l=f.addChildren({title:t.displayName,folder:!0,icon:!1,expanded:!0,key:t.taskId,noLink:!0,extraClasses:"siebui-task-assist-task-name"}),c=SiebelApp.S_App.GetVirtualDir()+e.get("ICON_EXPANDICON");if(n)for(var h=0,d=n.length;h<d;++h)k.call(this,l,n[h]);t.hasDoneStep===!1&&L.call(this,l),t.showMeObj&&A.call(this,l,t.showMeObj),t.addItemArray&&O.call(this,l,t.addItemsHeader,t.addItemArray),D.call(this),w.call(this,this.GetPM().Get("CurrentStepId"),!0);var v=$(l.li);v.find("a").attr("tabindex","-1"),v.attr("role","tree").attr("tabindex","-1").attr("aria-label",j(t.displayName)),P(v),$("#taskListName").attr("role","link").attr("tabindex","0")}function k(e,t){if(!t)return;var n=t.sectionLabel?"siebui-task-assist-section-label":"siebui-task-assist-no-section-label",r=e.addChildren({title:t.sectionLabel,folder:!0,icon:!1,expanded:!0,noLink:!0,extraClasses:n}),i=t.subStepArray,s=r.addChildren({title:t.number+". "+t.displayText,folder:!0,icon:!1,expanded:t.isExpanded,key:t.number,noLink:!0,extraClasses:i?"siebui-task-assist-has-substep":null}),o=t.sectionLabel+". "+t.number+". "+$(s.li).text();if(i)for(var u=0,a=i.length;u<a;u++){var f=i[u];s.addChildren({title:f.displayText,icon:"images/task_bullet.gif",key:"sub"+f.subStepId,noLink:!0}),o+=". "+(u+1)+". "+$("<div>"+f.displayText+"</div>").text()}$(s.li).attr("role","treeitem").attr("tabindex","-1").attr("aria-label",j(o))}function L(e){var t=e.addChildren({title:"",folder:!0,icon:!1,expanded:!0,noLink:!0,extraClasses:"siebui-task-assist-no-section-label"}),n=t.addChildren({title:this.GetPM().Get("LocaleStringMap").IDS_TASKASST_BRANCH,icon:"images/arw_branch.gif",noLink:!1,key:i,extraClasses:"siebui-task-assist-branch-step"});$(n.li).attr("role","treeitem").attr("tabindex","-1").attr("aria-label",this.GetPM().Get("LocaleStringMap").IDS_TASKASST_BRANCH)}function A(e,t){if(!t)return;var n=e.addChildren({title:t.displayText,href:t.location,target:"_blank",icon:!1,noLink:!0,key:"ShowMe",extraClasses:"siebui-task-assist-show-me"});$(n.li).attr("role","treeitem").attr("tabindex","-1").attr("aria-label",j(t.displayText))}function O(e,t,n){var r=e.addChildren({title:t,folder:!0,icon:!1,expanded:!0,noLink:!0,extraClasses:"siebui-task-assist-additional-items"
});$(r.li).attr("role","treeitem").attr("tabindex","-1").attr("aria-label",j(t));for(var i=0,s=n.length;i<s;i++){var o=n[i],u=r.addChildren({title:o.name,icon:"images/bullet_green.gif",key:o.rowId,noLink:!1});$(u.li).attr("role","treeitem").attr("tabindex","-1").attr("aria-label",j(o.name))}}function M(){var e=this.GetPM().Get("PlayerMode")==="1"?!0:!1;$("#tasklistUI").removeClass().addClass(e?"siebui-task-assist-hide":"siebui-task-assist-list"),$("#taskPlayerUI").removeClass().addClass(e?"siebui-task-assist-player":"siebui-task-assist-hide"),$("#titleBox_list").removeClass().addClass(e?"siebui-task-assist-hide":"siebui-task-assist-title"),$("#titleBox_player").removeClass().addClass(e?"siebui-task-assist-title":"siebui-task-assist-hide")}function _(){var e=this.GetPM().Get("LocaleStringMap");for(var t in e)if(e.hasOwnProperty(t)){var n=e[t],r=$("#"+t);r&&r.length&&r.text(n)}}function D(){$("#taskListName").text(this.GetPM().Get("ReturnLinkName"))}function P(e){var t=e.find("li[role=treeitem]");t.keydown(function(t){return H(e,$(this),t)}),t.off("focus").focus(function(t){return B(e,$(this),t)}),s?e.find(".siebui-task-assist-step-selected>li").focus():e.find("li:visible[role=treeitem]").first().focus()}function H(e,t,n){var r=e.find("li:visible[role=treeitem]"),i=r.index(t);e.find("a").attr("tabindex","-1");if(n.altKey||n.ctrlKey||n.shiftKey&&n.keyCode!=$.ui.keyCode.TAB)return!0;switch(n.keyCode){case $.ui.keyCode.UP:if(i>0){var s=r.eq(i-1);s.focus()}return n.stopPropagation(),!1;case $.ui.keyCode.DOWN:if(i<r.length-1){var o=r.eq(i+1);o.focus()}return n.stopPropagation(),!1;case $.ui.keyCode.ENTER:return t.click(),n.stopPropagation(),!1}return!0}function B(e,t,n){return e.find("li").attr("tabindex","-1"),t.attr("tabindex","0"),!0}function j(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""}var e=SiebelJS.Dependency("SiebelApp.Constants"),t=SiebelJS.Dependency("SiebelApp.Utils"),n=!1,r=!1,i=-1,s;return SiebelJS.Extend(o,SiebelAppFacade.BasePR),o.prototype.Init=function(){SiebelAppFacade.TaskAssistPlayerPR.superclass.Init.call(this),this.AttachPMBinding("Show",c,{scope:this}),this.AttachPMBinding("PlayerMode",M,{scope:this}),this.AttachPMBinding("TaskListName",h,{scope:this}),this.AttachPMBinding("LocaleStringMap",_,{scope:this}),this.AttachPMBinding("Tasks",T,{scope:this}),this.AttachPMBinding("TaskDetail",C,{scope:this}),this.AttachPMBinding("ReturnLinkName",D,{scope:this}),this.AttachPMBinding("ClearCurrentStepControlsHighlight",b,{scope:this})},o.prototype.ShowUI=function(){SiebelAppFacade.TaskAssistPlayerPR.superclass.ShowUI.call(this);var n=$("#s_TaskAssistant").parent(),r=n.siblings("a.next-item-applet").attr("title")+" "+SiebelApp.S_App.LocaleObject.GetLocalString("IDS_SWE_FORM_APPLET");n.attr({role:"region",title:r}),$("#s_taclose").attr("role","button").attr("tabindex","0").attr("aria-label",this.GetPM().Get("LocaleStringMap").IDS_TASKASST_CLOSE),t.IsTrue(SiebelApp.S_App.IsAutoOn())&&($("#s_taclose").attr(e.get("SWE_PROP_AUTOM_OT"),"button").attr(e.get("SWE_PROP_AUTOM_RN"),"taclose").attr(e.get("SWE_PROP_AUTOM_UN"),this.GetPM().Get("LocaleStringMap").IDS_TASKASST_CLOSE),$("#s_tadone").attr(e.get("SWE_PROP_AUTOM_OT"),"link").attr(e.get("SWE_PROP_AUTOM_RN"),"tadone").attr(e.get("SWE_PROP_AUTOM_UN"),"tadone")),$("#TaskAssistant").attr("role","application")},o.prototype.BindEvents=function(){SiebelAppFacade.TaskAssistPlayerPR.superclass.BindEvents.call(this);var e=SiebelApp.S_App.PluginBuilder.GetHoByName("EventHelper");if(e){var t=$("#TaskAssistant #s_taclose"),n=$("#TaskAssistant #s_tadone");t.length&&(e.Manage(t,"click",{ctx:this},u),e.Manage(t,"keydown",{ctx:this},a)),n.length&&(e.Manage(n,"click",{ctx:this},f),e.Manage(n,"keydown",{ctx:this},l))}},o.prototype.BindData=function(){SiebelAppFacade.TaskAssistPlayerPR.superclass.BindData.call(this),this.GetPM().Get("PlayerMode")===null?this.GetPM().ExecuteMethod("LoadAllData"):(M.call(this),h.call(this),_.call(this),this.GetPM().Get("PlayerMode")==="0"?T.call(this):C.call(this))},o.prototype.EndLife=function(){n&&(y.call(this,!1),SiebelApp.EventManager.removeListner("postload",this.HighlightControls,this),n=!1),SiebelAppFacade.TaskAssistPlayerPR.superclass.EndLife.call(this)},o.prototype.HighlightControls=function(){y.call(this,!0),r&&s&&$(s.getRootNode().ul).find(".siebui-task-assist-step-selected>li").focus(),r=!1},o}(),SiebelAppFacade.TaskAssistPlayerPR}));
