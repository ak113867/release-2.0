if(typeof(SiebelAppFacade.VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR");define("siebel/custom/VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR",["siebel/phyrenderer"],function(){SiebelAppFacade.VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR=(function(){function VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR(pm){SiebelAppFacade.VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR.superclass.constructor.apply(this,arguments)}SiebelJS.Extend(VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR,SiebelAppFacade.PhysicalRenderer);VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR.prototype.Init=function(){SiebelAppFacade.VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR.superclass.Init.apply(this,arguments);this.GetPM().AttachPMBinding("FieldChange",VFPPOUIFieldChange);this.GetPM().AttachPMBinding("RefreshData",function(value){console.log("RefreshData"+value)})};VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR.prototype.ShowUI=function(){SiebelAppFacade.VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR.superclass.ShowUI.apply(this,arguments);var pm=this.GetPM();var controls=pm.Get("GetControls");var CaptureCreditCheckBtn=controls["VFCaptureCreditCard"];$("#"+CaptureCreditCheckBtn.GetInputName()+"_Ctrl").after("<button class='VFPPOUICaptureCreditCard appletButton'>Capture Credit Card</button>").addClass("VFDisplayNone");var ActiveApplet=pm.Get("GetName");var BillProfileApplet=SiebelApp.S_App.GetActiveView().GetApplet(ActiveApplet);if(BillProfileApplet.CanInvokeMethod("VFCaptureCreditCard")){}else{$(".VFPPOUICaptureCreditCard").addClass("VFDisplayNone")}};function VFPPOUIFieldChange(control,field_value){var BillProfileApplet=SiebelApp.S_App.GetActiveView().GetApplet(this.Get("GetName"));var CaptureInvoke=BillProfileApplet.CanInvokeMethod("VFCaptureCreditCard");var pm=BillProfileApplet.GetPModel();var controls=pm.Get("GetControls");var CaptureCreditCheckBtn=controls["VFCaptureCreditCard"];$("#"+CaptureCreditCheckBtn.GetInputName()+"_Ctrl").addClass("VFDisplayNone");switch(control.GetName()){case ("Payment Type"):if(field_value=="Credit Card"){if(CaptureInvoke){$(".VFPPOUICaptureCreditCard").removeClass("VFDisplayNone")}else{$(".VFPPOUICaptureCreditCard").addClass("VFDisplayNone")}}else{$(".VFPPOUICaptureCreditCard").addClass("VFDisplayNone")}break;default:}}VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR.prototype.BindEvents=function(){SiebelAppFacade.VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR.superclass.BindEvents.apply(this,arguments);var pm=this.GetPM();$("#s_"+pm.Get("GetFullId")+"_div").delegate(".VFPPOUICaptureCreditCard","click",{ctx:this},VFPPOUICaptureCreditCard)};function VFPPOUICaptureCreditCard(e){if($("#VFPPOUIPayCorpIFrame").length){alert("There is a Pay Corp form open");return}var pm=e.data.ctx.GetPM();var BusComp=pm.Get("GetBusComp");var BillRowId=BusComp.GetIdValue();var ser=SiebelApp.S_App.GetService("Workflow Process Manager");var BAN=SiebelApp.S_App.GetProfileAttr("BAN");BAN="BAN:"+BAN;var Inputs=SiebelApp.S_App.NewPropertySet();Inputs.SetProperty("ProcessName","VF PCI INIT Workflow");Inputs.SetProperty("CompName","VFBillProfUpdate");Inputs.SetProperty("Identifier",BillRowId);Inputs.SetProperty("ClientRef",BAN);console.log("ROw Id :"+BillRowId);try{var out=ser.InvokeMethod("RunProcess",Inputs);var ResultSet=out.GetChildByType("ResultSet");var CreditCardApplet=SiebelApp.S_App.GetActiveView().GetApplet("CUT Credit Card Payment Form Applet");var CCApm=CreditCardApplet.GetPModel();var CCAppId=CCApm.Get("GetFullId");var PayCorpURL=ResultSet.GetProperty("Paycorp URL");var ErrorMessage=ResultSet.GetProperty("Error Message");if(ErrorMessage!=""){alert("Integration error with external system EAI.Please Contact the System Administrator")}else{$("#s_"+CCAppId+"_div div.siebui-collapsible-applet-content").hide();$("#s_"+CCAppId+"_div td.AppletHIFormBorder").append("<div id='VFPPOUIPayCorpIFrame' style='height:430px;'><iframe src='"+PayCorpURL+"' class='VFPayCorpiFrameheight'></iframe></div>")}}catch(e){alert(e.message)}finally{}}VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR.prototype.EndLife=function(){SiebelAppFacade.VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR.superclass.EndLife.apply(this,arguments)};return VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR}());return"SiebelAppFacade.VFPPOPENUIComInvoiceProfileFormToggleAppletPersonalAUPR"})};