if(typeof(SiebelAppFacade.VFSPSPostLoad)=="undefined"){Namespace("SiebelAppFacade.VFSPSPostLoad");(function(){SiebelApp.EventManager.addListner("postload",OnPostload,this);function OnPostload(){try{$(window).unbind();$(window).bind("message",function(e){console.log("Working PCI");console.log(e.originalEvent.data);var data=JSON.parse(e.originalEvent.data);if(data.form_submitted){var ActiveView=SiebelApp.S_App.GetActiveView().GetName();console.log("Card Details Submitted !!!");$(".VFPPOUIPayCorpIFramePar").addClass("VFSubmitComplete");setTimeout(function(){if($(".VFPPOUIPayCorpIFramePar").length){}},10000)}else{if(data.form_success){console.log("Success");$(".VFPPOUIPayCorpIFramePar").addClass("VFFormSuccess");if(data.reqid&&data.reqid.length>0){var ActiveView=SiebelApp.S_App.GetActiveView().GetName();var CompName="";switch(ActiveView){case ("VF SPS UNISIM Capture Identification TBUI View"):CompName="";PostPorecessDetails(CompName,data.reqid);break;case ("VF SPS Connection Wizard View Billing Detail"):CompName="VF Billing Account List Applet – TBUI";PostPorecessDetails(CompName,data.reqid);break;default:console.log("View Did not match")}}else{if(data.error&&data.error.length>0){}}}else{if(data.Enable_Button==true){EnableSaveButton()}else{if(data.Enable_Button==false){DisableSaveButton()}else{if(data.form_invalid==true){EnableInvalidMessage()}}}}}});function EnableSaveButton(){var ActiveView=SiebelApp.S_App.GetActiveView().GetName();if(ActiveView=="VF SPS Connection Wizard View Billing Detail"){var App=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Billing Account List Applet");var pm=App.GetPModel();var pr=pm.GetRenderer();var rowId=pr.GetData("rowId");$(".VFSPSBillingForm"+rowId+">.VFSPSBillingTypeCredit .VFPPOUIPayCorpSubmit").addClass("Active").removeClass("InActive")}}function DisableSaveButton(){var ActiveView=SiebelApp.S_App.GetActiveView().GetName();if(ActiveView=="VF SPS Connection Wizard View Billing Detail"){var App=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Billing Account List Applet");var pm=App.GetPModel();var pr=pm.GetRenderer();var rowId=pr.GetData("rowId");$(".VFSPSBillingForm"+rowId+">.VFSPSBillingTypeCredit .VFPPOUIPayCorpSubmit").removeClass("Active").addClass("InActive")}}function EnableInvalidMessage(){var ActiveView=SiebelApp.S_App.GetActiveView().GetName()}function GetCardType(Type){var sType=Type.toUpperCase();var retVal="";switch(Type){case ("DINERS CLUB"):retVal="VFSPSDINERS-TOKEN.png";break;case ("VISA"):retVal="VFSPSVISA-TOKEN.png";break;case ("AMEX"):case ("AMERICAN EXPRESS"):retVal="VFSPSAMEX-TOKEN.png";break;case ("MASTERCARD"):retVal="VFSPSMC-TOKEN.png";break;default:}return retVal}function PostPorecessDetails(CompName,reqId){var ActiveView=SiebelApp.S_App.GetActiveView().GetName();if(ActiveView=="VF SPS Connection Wizard View Billing Detail"){VFSPSUdateUIFrameWork.VFSPSBlockUI("");setTimeout(function(){var App=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Billing Account List Applet");var pm=App.GetPModel();var pr=pm.GetRenderer();var rowId=pr.GetData("rowId");var BillRowId=$(".VFSPSBillingForm"+rowId+">.VFSPSProfileId>input").val();var ser=SiebelApp.S_App.GetService("Workflow Process Manager");var Inputs=SiebelApp.S_App.NewPropertySet();Inputs.SetProperty("Identifier",BillRowId);Inputs.SetProperty("ReqId",reqId);console.log("Req Id :"+reqId);Inputs.SetProperty("ProcessName","VF PCI Async Response Workflow");try{var out=ser.InvokeMethod("RunProcess",Inputs)}catch(e){alert(e.message)}finally{}var ser=SiebelApp.S_App.GetService("Workflow Process Manager");var Inputs=SiebelApp.S_App.NewPropertySet();Inputs.SetProperty("ProcessName","VF PCI Token Complete Workflow");Inputs.SetProperty("Identifier",BillRowId);Inputs.SetProperty("ReqId",reqId);console.log("Row Id :"+BillRowId);try{var out=ser.InvokeMethod("RunProcess",Inputs);var ResultSet=out.GetChildByType("ResultSet");if(ResultSet.GetProperty("ErrorStatus")=="FAILED"){alert(ResultSet.GetProperty("Error Message"))}else{var ccType=ResultSet.GetProperty("CCType");var ccNum=ResultSet.GetProperty("CCToken");var ccName=ResultSet.GetProperty("CCHolder");var strCCMon=ResultSet.GetProperty("CCExpMon");var strCCYear=ResultSet.GetProperty("CCExpYr")}}catch(e){alert(e.message)}finally{}var Expiry=strCCMon+"/"+strCCYear;$(".VFSPSBillingForm"+rowId+">.VFSPSBillingTypeCredit .VFSPSBillProdCCHolderName").html(ccName);$(".VFSPSBillingForm"+rowId+">.VFSPSBillingTypeCredit .VFSPSBillProfCCNumber").html(ccNum);$(".VFSPSBillingForm"+rowId+">.VFSPSBillingTypeCredit .VFSPSBillProfCCReacOnlyExpiryDate").html(Expiry);$(".VFSPSBillingForm"+rowId+">.VFSPSBillingTypeCredit .VFSPBillProfCCMaskedCCCNum").html("XXXXXXXXXXXX"+ccNum.substr(ccNum.length-4));$(".VFSPSBillingForm"+rowId+">.VFSPSBillingTypeCredit .VFSPSBillProfCCType").html(ccType);$(".VFSPSBillingForm"+rowId+">.VFSPSBillingTypeCredit .VFSPSBillProfCCTypeImgDiv img").attr("src","images/"+GetCardType(ccType));$(".VFSPSBillingForm"+rowId+" .VFSPSSavebutton").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");$(".VFSPSBillingForm"+rowId+" .VFSPSBillingDetailsPayCorpiFrame").addClass("VFSPSDisplayNone");$(".VFSPSBillingForm"+rowId+" .VFSPSBillingDetailsPaycorpReadOnly").removeClass("VFSPSDisplayNone");SiebelApp.EventManager.fireEvent("VFSPSBillingSaveEnable");VFSPSUdateUIFrameWork.VFSPSUnblockUI()},1000)}else{if(ActiveView=="UniSIM Id capture"){$(".VFSPSUSIMIdCaptureReadOnlyCC").removeClass("VFSPSDisplayNone");$(".VFSPSUSIMCCEdit").addClass("VFSPSDisplayNone");$(".VFSPSUSIMIdChooseDifferentIDDLValidatedCC").removeClass("VFSPSDisplayNone");$(".VFSPSUSIMIdValidateIDCC,.VFSPSUSIMIdChooseDifferentIDCC,.VFSPSUSIMIdChooseDifferentIDDLInValidatedError1CC,.VFSPSUSIMIdChooseDifferentIDDLInValidatedError2CC").addClass("VFSPSDisplayNone");$(".VFSPSUSIMCCErrorDetails").addClass("VFSPSDisplayNone")}}}function GetCompName(){var ActiveView=SiebelApp.S_App.GetActiveView().GetName();CompName="";switch(ActiveView){case ("VF Connection Wizard View - Billing Detail - TBUI"):case ("VF Billing Details View - TBUI"):case ("VF Connection View - Billing Detail"):case ("VF Billing Account Profile View - Extended"):CompName="VFBillProfUpdate";break;case ("VF My Requested Service Request List View"):case ("VF My Service Request List View"):case ("VF Detail Service Request List View"):case ("VF Admin Service Request List View"):case ("VF Personal Service Request List View"):case ("VF All Service Request List View"):CompName="VFSRUpdate";break;case ("VF Credit Card View - AU"):CompName="VFCreditCardReg";break;default:alert("View Name Not Found.")}return CompName}function GetActiveAppletName(){var ActiveView=SiebelApp.S_App.GetActiveView().GetName();CompName="";switch(ActiveView){case ("VF Connection View - Billing Detail"):CompName="VF Com Invoice Profile Form Toggle Applet - Connection - AU";break;case ("VF Connection Wizard View - Billing Detail - TBUI"):case ("VF Billing Details View - TBUI"):CompName="VF Com Invoice Profile Toggle Form Applet – TBUI - Credit";break;case ("VF Billing Account Profile View - Extended"):CompName="CUT Credit Card Payment Form Applet";break;case ("VF My Requested Service Request List View"):case ("VF My Service Request List View"):case ("VF Detail Service Request List View"):case ("VF Admin Service Request List View"):case ("VF Personal Service Request List View"):case ("VF All Service Request List View"):CompName="VF Credit Card Refund Form Applet";break;case ("VF Credit Card View - AU"):CompName="VFCreditCardReg";break;default:alert("View Name Not Found.")}return CompName}}catch(error){}}}())};