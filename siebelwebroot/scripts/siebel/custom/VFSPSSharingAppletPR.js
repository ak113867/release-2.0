if(typeof(SiebelAppFacade.VFSPSSharingAppletPR)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.VFSPSSharingAppletPR");define("siebel/custom/VFSPSSharingAppletPR",["siebel/jqgridrenderer"],function(){SiebelAppFacade.VFSPSSharingAppletPR=(function(){function VFSPSSharingAppletPR(pm){SiebelAppFacade.VFSPSSharingAppletPR.superclass.constructor.apply(this,arguments)}SiebelJS.Extend(VFSPSSharingAppletPR,SiebelAppFacade.JQGridRenderer);VFSPSSharingAppletPR.prototype.Init=function(){SiebelAppFacade.VFSPSSharingAppletPR.superclass.Init.apply(this,arguments);SiebelApp.EventManager.cleanListners("VFSPSSharingSelCusShowSharingParents");SiebelApp.EventManager.addListner("VFSPSSharingSelCusShowSharingParents",VFSPSSharingSelCusShowSharingParents,this);this.Data={"InFlight":"","Provisioned":"","InFlightLoaded":false,"ProvisionedLoaded":false};this.SetData=function(Category,data){this.Data[Category]=data};this.GetData=function(Category){return this.Data[Category]}};VFSPSSharingAppletPR.prototype.ShowUI=function(){SiebelAppFacade.VFSPSSharingAppletPR.superclass.ShowUI.apply(this,arguments);$(".VFSPSSharingSelCusChildCount").html(VFTabletIntegrationConstants.GetConstants("VFSPSSharingConstant")+" ");var BS="VF SPS TBUI Utilities";var Method="GetPrimarySharingMSISDN";var inps=SiebelApp.S_App.NewPropertySet();inps.SetProperty("OrderId",VFSPSGetOrderId());var out=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});if(out.GetProperty("RecordFound")=="Yes"){$(".VFSPSSharingSelCusPrimaryServiceDetails").removeClass("VFSPSDisplayNone");console.log("Rate Plan : "+out.GetProperty("SharingPrimaryRatePlan"));console.log("MSISDN : "+out.GetProperty("SharingPrimaryMSISDN"));$(".VFSPSSharingSelCusPlanDetails .VFSPSSharingSelCusPrimaryServiceTextValue").html(out.GetProperty("SharingPrimaryRatePlan"));$(".VFSPSSharingSelCusMSISDNDetails .VFSPSSharingSelCusPrimaryServiceTextValue").html(out.GetProperty("SharingPrimaryMSISDN"))}else{$(".VFSPSSharingSelCusPrimaryServiceDetails").addClass("VFSPSDisplayNone")}};VFSPSSharingAppletPR.prototype.BindEvents=function(){SiebelAppFacade.VFSPSSharingAppletPR.superclass.BindEvents.apply(this,arguments);$(".VFSPSSharingSelCusFormParent").delegate(".VFSPSSharingSelCusChoosePlanImg ","click",{ctx:this},VFSPSSharingSelCusChooseFilter);$(".VFSPSSharingSelCusNavigation").delegate(".VFSPSSharingSelCusTaskNavCreateOrderBtn.VFSPSTaskNavActive","click",{ctx:this},VFSPSSharePlan);$(".VFSPSSharingSelCusNavigation").delegate(".VFSPSSharingSelCusTaskNavCancelOrderBtn","click",{ctx:this},VFSPSCancleOrder);$(".VFSPSSharingSelCusFormParent").delegate("#VFSPSSleCusSharingFilter","click",{ctx:this},VFSPSSleCusSharingContextHelp)};function VFSPSSleCusSharingContextHelp(e){var Context=$(this).attr("id");switch(Context){case ("VFSPSSleCusSharingFilter"):VFSPSUdateUIFrameWork.VFSPSSelectContextualMessage("SharingFilterInfo");break;case ("VFSPSSleCusSharingRemainingServices"):VFSPSUdateUIFrameWork.VFSPSSelectContextualMessage("SharingRemainingService");break;default:}}function VFSPSSharePlan(e){var FilterType=$(".VFSPSSharingSelCusChoosePlanValue").val();switch(FilterType){case ("Provisioned services"):SetSharingParentProvisionedOrder();break;case ("In progress services"):SetSharingParentInflightOrder();break;default:}}function SetSharingParentProvisionedOrder(){var index=$("#VFSPSSharingSelCusProvisionedJQGridTable").getGridParam("selrow");var rowData=$("#VFSPSSharingSelCusProvisionedJQGridTable").getRowData(index);var ParMSISDN=rowData["MSISDN"];VFSPSUdateUIFrameWork.VFSPSBlockUI("");setTimeout(function(){try{var BS="VF SPS TBUI Utilities";var Method="SetSharingParentMSISDN";var inps=SiebelApp.S_App.NewPropertySet();if(ParMSISDN==""){alert("There is no MSISDN available for the selected parent.")}else{inps.SetProperty("ParMSISDN",ParMSISDN);var out=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});if(out.GetProperty("Record Found")=="No"){alert("The Selected MSISDN was not found")}else{var App=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Task Playbar Applet SelectCutomize - Top");if(App.CanInvokeMethod("NavigatePrev")){App.InvokeMethod("NavigatePrev")}}}VFSPSUdateUIFrameWork.VFSPSUnblockUI()}catch(e){console.log(e.message)}finally{VFSPSUdateUIFrameWork.VFSPSUnblockUI()}},1000)}function SetSharingParentInflightOrder(){var index=$("#VFSPSSharingSelCusInflightJQGridTable").getGridParam("selrow");var rowData=$("#VFSPSSharingSelCusInflightJQGridTable").getRowData(index);var OrderLineItemId=rowData["Root Order Item Id"];VFSPSUdateUIFrameWork.VFSPSBlockUI("");setTimeout(function(){try{var BS="VF OM Order Toolkit Service";var Method="GetSharingIndicator";var inps=SiebelApp.S_App.NewPropertySet();inps.SetProperty("ServiceOrderId",OrderLineItemId);var out=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});if(out.GetProperty("SharingIndicator")!="Parent Connection"){alert("This Parent Order/MSISDN is not part of a sharing rate plan. Please select a valid Parent connection.")}else{var BS="VF SPS TBUI Utilities";var Method="SetSharingParentServiceId";var inps=SiebelApp.S_App.NewPropertySet();inps.SetProperty("ServiceOrderId",OrderLineItemId);var out=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});if(out.GetProperty("Record Found")=="No"){alert("The Selected In progress service was not found")}else{var App=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Task Playbar Applet SelectCutomize - Top");if(App.CanInvokeMethod("NavigatePrev")){App.InvokeMethod("NavigatePrev")}}}VFSPSUdateUIFrameWork.VFSPSUnblockUI()}catch(e){console.log(e.message)}finally{VFSPSUdateUIFrameWork.VFSPSUnblockUI()}},1000)}function VFSPSCancleOrder(e){var App=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Task Playbar Applet SelectCutomize - Top");if(App.CanInvokeMethod("CancelTask")){App.InvokeMethod("CancelTask")}}function VFSPSSharingSelCusChooseFilter(e){var selector=".VFSPSSharingSelCusChoosePlanValue";var LOVList="";var SearchString="[List Of Values.Type] = 'VF_SPS_SHARING_FILTER' AND [List Of Values.Active] = 'Y'";VFSPSUdateUIFrameWork.VFSPSShowPicklistValues(selector,"","LOV","VF_SPS_SHARING_FILTER",SearchString,"HTML","VFSPSSharingSelCusShowSharingParents")}function VFSPSSharingSelCusShowSharingParents(){var FilterType=$(".VFSPSSharingSelCusChoosePlanValue").val();$(".VFSPSSharingSelCusTaskNavCreateOrderBtn").removeClass("VFSPSTaskNavActive").addClass("VFSPSTaskNavInActive");switch(FilterType){case ("Provisioned services"):$(".VFSPSSharingSelCusProvisionedPar").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusInflightPar").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock");VFSPSSharingSelCusProvisionedService();break;case ("In progress services"):$(".VFSPSSharingSelCusInflightPar").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusProvisionedPar").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock");VFSPSSharingSelCusInflightService();break;default:}}function VFSPSSharingSelCusProvisionedService(){var sActiveView=SiebelApp.S_App.GetActiveView();var app=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Sharing Applet");var pm=app.GetPModel();var pr=pm.GetRenderer();if(!pr.GetData("ProvisionedLoaded")){var BS="VF SPS TBUI Utilities";var Method="GetSharingMSISDN";var inps=SiebelApp.S_App.NewPropertySet();var OrderId=VFSPSGetOrderId();inps.SetProperty("OrderId",OrderId);var out=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});var RecordFound=out.GetProperty("RecordFound");var dealerData=VFCustomSiebelInterface.SiebelMessageToArray(out);pr.SetData("Provisioned",dealerData);pr.SetData("ProvisionedLoaded",true)}else{var dealerData=pr.GetData("Provisioned");pr.SetData("ProvisionedLoaded",false)}if(dealerData.length){$(".VFSPSSharingSelCusProvisionedPar").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusNoDataMessageProvisioned").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusInflightPar").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusNoDataMessageInflight").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");var recCount=dealerData.length>=10?10:dealerData.length;$("#VFSPSSharingSelCusProvisionedJQGridTable").jqGrid({datatype:"local",data:dealerData,height:"100%",colNames:["VF Rate Plan","MSISDN","Id"],colModel:[{name:"VF Rate Plan",index:"VF Rate Plan",width:500,height:200,sorttype:false},{name:"MSISDN",index:"MSISDN",width:100,height:200,sortable:false},{name:"Id",index:"Id",hidden:true}],search:true,multiselect:false,width:"100%",rowNum:recCount,pager:"#VFSPSSharingSelCusProvisionedGridPager",onSelectRow:VFSPSSharingSelCusRowSelect,onPaging:VFSPSSharingOnPaging});if(dealerData.length>11){$("#VFSPSSharingSelCusProvisionedGridPager").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone")}else{$("#VFSPSSharingSelCusProvisionedGridPager").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock")}}else{$(".VFSPSSharingSelCusNoDataMessageProvisioned").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");$(".VFSPSSharingSelCusProvisionedPar").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusInflightPar").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusNoDataMessageInflight").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone")}}function VFSPSSharingOnPaging(pg){var FilterType=$(".VFSPSSharingSelCusChoosePlanValue").val();switch(FilterType){case ("Provisioned services"):$(".VFSPSSharingSelCusRemainingServices").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$("#VFSPSSharingSelCusProvisionedJQGridTable").resetSelection();break;case ("In progress services"):$("#VFSPSSharingSelCusInflightJQGridTable").resetSelection();break;default:}}function VFSPSSharingSelCusInflightService(){var sActiveView=SiebelApp.S_App.GetActiveView();var app=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Sharing Applet");var pm=app.GetPModel();var pr=pm.GetRenderer();if(!pr.GetData("InFlightLoaded")){var BS="VF SPS TBUI Utilities";var Method="GetSharingServiceId";var inps=SiebelApp.S_App.NewPropertySet();var OrderId=VFSPSGetOrderId();inps.SetProperty("OrderId",OrderId);var out=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});var RecordFound=out.GetProperty("RecordFound");var dealerData=VFCustomSiebelInterface.SiebelMessageToArray(out);pr.SetData("InFlight",dealerData);pr.SetData("InFlightLoaded",true)}else{var dealerData=pr.GetData("InFlight");pr.SetData("InFlightLoaded",true)}if(dealerData.length){$(".VFSPSSharingSelCusInflightPar").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusNoDataMessageInflight").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusNoDataMessageProvisioned").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusProvisionedPar").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");var recCount=dealerData.length>=10?10:dealerData.length;$("#VFSPSSharingSelCusInflightJQGridTable").jqGrid({datatype:"local",data:dealerData,height:"100%",colNames:["Product","VF Root MSISDN","Id","Root Order Item Id"],colModel:[{name:"Product",index:"Product",width:500,height:200,sorttype:false},{name:"VF Root MSISDN",index:"VF Root MSISDN",width:100,height:200,sortable:false},{name:"Id",index:"Id",hidden:true},{name:"Root Order Item Id",index:"Id",hidden:true}],search:true,multiselect:false,width:"100%",rowNum:recCount,pager:"#VFSPSSharingSelCusInflightGridPager",onSelectRow:VFSPSSharingSelCusRowSelect,onPaging:VFSPSSharingOnPaging});if(dealerData.length>11){$("#VFSPSSharingSelCusInflightGridPager").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone")}else{$("#VFSPSSharingSelCusInflightGridPager").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock")}}else{$(".VFSPSSharingSelCusNoDataMessageInflight").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");$(".VFSPSSharingSelCusInflightPar").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock");$(".VFSPSSharingSelCusNoDataMessageProvisioned").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$(".VFSPSSharingSelCusProvisionedPar").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone")}}function VFSPSSharingSelCusRowSelect(rowId,status,e){var FilterType=$(".VFSPSSharingSelCusChoosePlanValue").val();switch(FilterType){case ("Provisioned services"):VFSPSUdateUIFrameWork.VFSPSBlockUI("");setTimeout(function(){try{var BS="VF SPS TBUI Utilities";var Method="GetAssetChildCount";var rowData=$("#VFSPSSharingSelCusProvisionedJQGridTable").getRowData(rowId);var AssetRowId=rowData["Id"];var inps=SiebelApp.S_App.NewPropertySet();inps.SetProperty("AssetRowId",AssetRowId);var out=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});var Message="You can <span class='VFSPSSharingSelCusRemainingServicesCount'>add 4 </span>														Secondary services to this Primary service.";if(out.GetProperty("Record Found")=="Yes"){var MaxCount=Number(VFTabletIntegrationConstants.GetConstants("VFSPSSharingConstant"));var CurrentChild=Number(out.GetProperty("ChildCount"));var Remaining=MaxCount-CurrentChild;if(Remaining){$(".VFSPSSharingSelCusTaskNavCreateOrderBtn").addClass("VFSPSTaskNavActive").removeClass("VFSPSTaskNavInActive");$(".VFSPSSharingSelCusRemainingServicesText span").html(Message);Message=" add "+Remaining+" ";$(".VFSPSSharingSelCusRemainingServicesCount").html(Message)}else{$(".VFSPSSharingSelCusTaskNavCreateOrderBtn").removeClass("VFSPSTaskNavActive").addClass("VFSPSTaskNavInActive");$(".VFSPSSharingSelCusRemainingServicesText span").html("This primary service <b>is full</b>,																					please select another one.")}}else{$(".VFSPSSharingSelCusRemainingServicesText span").html("")}$(".VFSPSSharingSelCusRemainingServices").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");VFSPSUdateUIFrameWork.VFSPSUnblockUI()}catch(e){console.log(e.message)}finally{VFSPSUdateUIFrameWork.VFSPSUnblockUI()}},1000);break;case ("In progress services"):$(".VFSPSSharingSelCusTaskNavCreateOrderBtn").addClass("VFSPSTaskNavActive").removeClass("VFSPSTaskNavInActive");break;default:}}function VFSPSGetOrderId(){var BO=SiebelApp.S_App.GetActiveBusObj();var OrderBC=BO.GetBusCompByName("Order Entry - Orders");return OrderBC.GetIdValue()}VFSPSSharingAppletPR.prototype.EndLife=function(){SiebelAppFacade.VFSPSSharingAppletPR.superclass.EndLife.apply(this,arguments)};return VFSPSSharingAppletPR}());return"SiebelAppFacade.VFSPSSharingAppletPR"})};