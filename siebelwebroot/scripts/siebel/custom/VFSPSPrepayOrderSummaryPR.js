if(typeof(SiebelAppFacade.VFSPSPrepayOrderSummaryPR)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.VFSPSPrepayOrderSummaryPR");define("siebel/custom/VFSPSPrepayOrderSummaryPR",["order!siebel/phyrenderer"],function(){SiebelAppFacade.VFSPSPrepayOrderSummaryPR=(function(){function VFSPSPrepayOrderSummaryPR(pm){SiebelAppFacade.VFSPSPrepayOrderSummaryPR.superclass.constructor.call(this,pm)}SiebelJS.Extend(VFSPSPrepayOrderSummaryPR,SiebelAppFacade.PhysicalRenderer);SiebelJS.Extend(VFSPSPrepayOrderSummaryPR,SiebelAppFacade.PhysicalRenderer);VFSPSPrepayOrderSummaryPR.prototype.Init=function(){SiebelAppFacade.VFSPSPrepayOrderSummaryPR.superclass.Init.apply(this,arguments);this.ResponseData={};this.Data={"ResponseData":this.ResponseData};this.SetData=function(Category,data){this.Data[Category]=data};this.GetData=function(Category){return this.Data[Category]};SiebelApp.EventManager.cleanListners("VFSPSGenerateCAFormSuccess");SiebelApp.EventManager.cleanListners("VFSPSGenerateCAFormFailure");SiebelApp.EventManager.addListner("VFSPSGenerateCAFormSuccess",VFSPSGenerateCAFormSuccess,this);SiebelApp.EventManager.addListner("VFSPSGenerateCAFormFailure",VFSPSGenerateCAFormFailure,this)};VFSPSPrepayOrderSummaryPR.prototype.ShowUI=function(){SiebelAppFacade.VFSPSPrepayOrderSummaryPR.superclass.ShowUI.call(this);var bo=SiebelApp.S_App.GetActiveBusObj();var bc=bo.GetBusCompByName("VF SPS New Account Contact PrePay TBC");var sName=bc.GetFieldValue("Account Name");var sMSIDIN=bc.GetFieldValue("New MSISDN");var sIMEI=bc.GetFieldValue("New IMEI");var sDevice=VFTabletIntegrationConstants.GetConstants("VFSPSPrepayDevice");var sConnectionType=bc.GetFieldValue("Connection Type");var sCustomerType=bc.GetFieldValue("Customer Type");var sProposition=bc.GetFieldValue("New Propostion");if(sCustomerType=="Person"){$(".VFSPSPrepaidOrderFullName").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");$("#VFSPSPrepaidOrderDetailsFullName").html(sName)}else{$(".VFSPSPrepaidOrderCompanyName").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");$("#VFSPSPrepaidOrderDetailsCompanyName").html(sName)}sMSIDIN!=""?$("#VFSPSPrepaidOrderDetailsMobile").html(sMSIDIN):$("#VFSPSPrepaidOrderDetailsMobile").html("NA");sIMEI!=""?$("#VFSPSPrepaidOrderDetailsIMEI").html(sIMEI):$("#VFSPSPrepaidOrderDetailsIMEI").html("NA");sProposition!=""?$("#VFSPSPrepaidOrderDetailsProposition").html(sProposition):$("#VFSPSPrepaidOrderDetailsProposition").html("NA");if(sConnectionType=="Port In from other carrier"){$(".VFSPSPrepaidOrderPlanDetailsButton").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");$(".VFSPSSubmitClick").addClass("VFSPSPlaybarNextBtnDisabled").removeClass("VFSPSPlaybarNextBtnEnabled")}else{$(".VFSPSPrepaidOrderPlanDetailsButton").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock");$(".VFSPSSubmitClick").addClass("VFSPSPlaybarNextBtnEnabled").removeClass("VFSPSPlaybarNextBtnDisabled")}var iSCAFormSigned=VFTabletIntegrationConstants.GetConstants("VFSPSCAFFormSigned");if(iSCAFormSigned=="Y"){$(".VFSPSPrepaidOrderPlanDetailsGenerate").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock");$(".VFSPSPrepaidOrderPlanDetailsSigned").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");$(".VFSPSPrepaidOrderPlanDetailsFailed").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock");$(".VFSPSSubmitClick").addClass("VFSPSPlaybarNextBtnEnabled").removeClass("VFSPSPlaybarNextBtnDisabled")}};VFSPSPrepayOrderSummaryPR.prototype.BindEvents=function(){SiebelAppFacade.VFSPSPrepayOrderSummaryPR.superclass.BindEvents.apply(this,arguments);$(".VFSPSPrepaidOrderPlanTileParDiv").delegate(".VFSPSPrepaidOrderPlanTileTitleDiv","click",{ctx:this},VFSPSExpandPlanDetails);$(".VFSPSPrepaidOrderPlanDetailsButton").delegate("#VFSPSPrepaidOrderTileGenerate","click",{ctx:this},VFSPSGenerateCAForm);$(".VFSPSPlaybarButton").delegate(".VFSPSCancelClick","click",{ctx:this},VFSPSCancel);$(".VFSPSPlaybarButton").delegate(".VFSPSSubmitClick","click",{ctx:this},VFSPSSubmit)};function VFSPSOrderClose(){$(".VFSPSPrepayOrderOverlay").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock")}function VFSPSCancel(){var view=SiebelApp.S_App.GetActiveView();var applet=view.GetApplet("VF SPS Prepay Task Playbar Applet - Top");applet.InvokeMethod("CancelTask")}function VFSPSSaveOrder(){}function VFSPSSubmitOrder(){var view=SiebelApp.S_App.GetActiveView();var applet=view.GetApplet("VF SPS Prepay Task Playbar Applet - Top");applet.InvokeMethod("SubmitTask");$(".VFSPSPrepayOrderOverlay").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock")}function VFSPSExpandPlanDetails(e){if($(this).parent().hasClass("VFSPSPrepaidOrderPlanTileInActive")){$(this).parent().removeClass("VFSPSPrepaidOrderPlanTileInActive").addClass("VFSPSPrepaidOrderPlanTileActive");if($(".VFSPSPrepaidOrderPlanDetailsButton").hasClass("VFSPSDisplayBlock")){$(".VFSPSPrepaidOrderPlanTileDetails").attr("style","min-height:750px;")}else{$(".VFSPSPrepaidOrderPlanTileDetails").attr("style","min-height:450px;")}}else{$(this).parent().removeClass("VFSPSPrepaidOrderPlanTileActive").addClass("VFSPSPrepaidOrderPlanTileInActive")}}function VFSPSGenerateCAForm(e){var bo1=SiebelApp.S_App.GetActiveBusObj();var bc1=bo1.GetBusCompByName("VF SPS New Account Contact PrePay TBC");var CustAccountId=bc1.GetFieldValue("VF SPS Customer Id");var AssetId=SiebelApp.S_App.GetProfileAttr("TBUIExtAssetId");var ExtDOB=bc1.GetFieldValue("External DOB");var ExtRefNum=bc1.GetFieldValue("Ext Account Ref");var PortMSISDN=bc1.GetFieldValue("Ported Mobile Number");var PrepayMSISDN=bc1.GetFieldValue("New MSISDN");var Scenario=bc1.GetFieldValue("Scenario");var Postpay=bc1.GetFieldValue("Post Pay");var Inputs=SiebelApp.S_App.NewPropertySet();var Outputs=SiebelApp.S_App.NewPropertySet();Inputs.SetProperty("Object Id",CustAccountId);Inputs.SetProperty("CustAccountId",CustAccountId);Inputs.SetProperty("AssetId",AssetId);Inputs.SetProperty("ExtDOB",ExtDOB);Inputs.SetProperty("ExtRefNum",ExtRefNum);Inputs.SetProperty("PortMSISDN",PortMSISDN);Inputs.SetProperty("PrepayMSISDN",PrepayMSISDN);Inputs.SetProperty("Scenario",Scenario);Outputs=VFCustomSiebelInterface.CallWorkflow("VF SPS Prepay CA Form Data Fetch",Inputs,{"Type":"JSON"});var sOutString=JSON.stringify(Outputs);var MetaData=JSON.parse(sOutString);var DealerCode=MetaData["DealerCode"];var CustomerID=MetaData["CustomerID"];var ClientID=MetaData["ClientID"];var ContractID=MetaData["ContractID"];var DealerGroup=MetaData["DealerGroup"];var UniqueID=MetaData["UniqueID"];var ContactID=MetaData["ContactID"];var StorePersonName=MetaData["SalesPersonName"];var StoreName=MetaData["StoreName"];var CustomerFirstName=MetaData["CustomerFirstName"];var CustomerLastName=MetaData["CustomerLastName"];var CustomerTBCFirstName=MetaData["CustomerTBCFirstName"];var CustomerTBCLastName=MetaData["CustomerTBCLastName"];var CustomerDOB=MetaData["CustomerDOB"];var CustomerEmail=MetaData["CustomerEmail"];var RequestType=MetaData["RequestType"];var CustMName=MetaData["CustomerMiddleName"];var NewMSISDN=MetaData["NewMSISDN"];var AccRefNoDOB=MetaData["AccRefDOB"];var AddressLine1=MetaData["AddressLine1"];var Suburb=MetaData["Suburb"];var State=MetaData["State"];var PostCode=MetaData["PostCode"];var BillingAccId=MetaData["BillingAccId"];var RequestDate=MetaData["RequestDate"];var IdRefNum=MetaData["IdDocRef"];var FileName=MetaData["FileName"];var SessionID=MetaData["SessionID"];var MetadataVersion=MetaData["MetadataVersion"];var UserName=MetaData["UserName"];var Password=MetaData["Password"];var PdfURL=MetaData["PdfURL"];var AgentFirstName=MetaData["AgentFirstName"];var AgentLastName=MetaData["AgentLastName"];var SIM=MetaData["SIM"];CustomerDOB=VFCustomSiebelInterface.VFSPSConvertDateFormat(CustomerDOB);RequestDate=VFCustomSiebelInterface.VFSPSConvertDateFormat(RequestDate);if(Postpay=="N"){AccRefNoDOB=VFCustomSiebelInterface.VFSPSConvertDateFormat(AccRefNoDOB)}MetaData={"DealerCode":DealerCode,"CustomerID":CustomerID,"ContractID":ContractID,"IdDocRef":IdRefNum,"DealerGroup":DealerGroup,"UniqueID":UniqueID,"MetadataVersion":MetadataVersion,"CustomerFirstName":CustomerTBCFirstName,"CustomerLastName":CustomerTBCLastName,"CustomerMiddleName":CustMName,"CustomerEmail":CustomerEmail,"SessionID":SessionID,"CustomerDOB":CustomerDOB,"ClientID":ClientID,"RequestType":RequestType,"UserName":UserName,"ContactID":ContactID,"Password":Password,"StoreName":StoreName,"SalesPersonName":StorePersonName};var RequestParam={"FirstMiddleName":CustomerTBCFirstName,"LastName":CustomerTBCLastName,"NewMSISDN":NewMSISDN,"AddressLine1":AddressLine1,"Suburb":Suburb,"State":State,"PostCode":PostCode,"AccRefNoDOB":AccRefNoDOB,"CustomerAccountId":CustomerID,"BillingAccountId":BillingAccId,"MSISDN":NewMSISDN,"SalesDealerCode":DealerCode,"DocumentType":"35","CAContactLastName":CustomerTBCLastName,"CAContactFirstName":CustomerTBCFirstName,"OrderNumber":UniqueID,"Today":RequestDate,"DocumentClassification":"ACTIVATION","SalesBranch":StoreName,"Filename":FileName,"SalesPerson":StorePersonName,"ContactId":ContactID,"IdRefNum":IdRefNum,"BillingRowId":BillingAccId,"SalesDealerGroup":DealerGroup,"PdfURL":PdfURL,"AgentFirstMiddleName":AgentFirstName,"AgentLastName":AgentLastName,"AllocateSIMNo":SIM,"RequestDate":RequestDate,"AuthSignDt":RequestDate,"AckSignDt":RequestDate,"StaffSignDate":RequestDate};var SettingsData=VFTabletIntegrationConstants.GetSettingData("JSON");var requestData={"Key":"CAForm","SettingsData":SettingsData,"MetaData":MetaData,"RequestParam":RequestParam};console.log(JSON.stringify(requestData));if(typeof(VHAWrapper)=="undefined"){var retVal=VHAWrapperSTUB?VHAWrapperSTUB.signCAForm(JSON.stringify(requestData),"VFTabletIntegration.Success","VFTabletIntegration.Failure"):0;retVal=1}else{var retVal=VHAWrapper.signContract(JSON.stringify(requestData),"VFTabletIntegration.Success","VFTabletIntegration.Failure",false)}if(retVal){}else{console.log("Failed to Generate Contract")}}function VFSPSSubmit(e){var template="<div class='VFSPSPrepayOrderOverlay VFSPSDisplayBlock'>						<div class='VFSPSPrepayOrderPopup'>							<span title='Close' class='VFSPSPrepayOrderClose'><img src='images/vfspsclose.jpg'></span>							<h2 class='VFSPSPrepayOrderFinalize'><span>This Order has now been finalised</span></h2>							<div class='VFSPSPrepayOrderDetails VFSPSFloatLeft'>								<div class='VFSPSPrepayOrdernumber'><span>To complete your order and activate the service tap OK</span></div>								<div class='VFSPSPrepayOrderOkButton'>OK</div>							</div>					</div>";$("body").append(template);$(".VFSPSPrepayOrderDetails").delegate(".VFSPSPrepayOrderOkButton","click",{ctx:this},VFSPSSubmitOrder);$(".VFSPSPrepayOrderPopup").delegate(".VFSPSPrepayOrderClose","click",{ctx:this},VFSPSOrderClose)}function VFSPSGenerateCAFormFailure(){var app=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Prepay Order Summary Applet");var pm=app.GetPModel();var pr=pm.GetRenderer();console.log(pr.GetData("ResponseData"));$(".VFSPSPrepaidOrderPlanDetailsSigned").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock");$(".VFSPSPrepaidOrderPlanDetailsFailed").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");$(".VFSPSSubmitClick").addClass("VFSPSPlaybarNextBtnDisabled").removeClass("VFSPSPlaybarNextBtnEnabled")}function VFSPSGenerateCAFormSuccess(){var app=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Prepay Order Summary Applet");var pm=app.GetPModel();var pr=pm.GetRenderer();console.log(pr.GetData("ResponseData"));var oResponse=pr.GetData("ResponseData");if(oResponse["isCancelled"]=="true"){}else{if(oResponse["isUploaded"]=="true"||oResponse["isPrinted"]=="true"){$(".VFSPSPrepaidOrderPlanDetailsGenerate").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock");$(".VFSPSPrepaidOrderPlanDetailsSigned").addClass("VFSPSDisplayBlock").removeClass("VFSPSDisplayNone");$(".VFSPSPrepaidOrderPlanDetailsFailed").addClass("VFSPSDisplayNone").removeClass("VFSPSDisplayBlock");$(".VFSPSSubmitClick").addClass("VFSPSPlaybarNextBtnEnabled").removeClass("VFSPSPlaybarNextBtnDisabled");VFTabletIntegrationConstants.SetConstants("VFSPSCAFFormSigned","Y")}else{VFSPSGenerateCAFormFailure()}}}return VFSPSPrepayOrderSummaryPR}());return"SiebelAppFacade.VFSPSPrepayOrderSummaryPR"})};