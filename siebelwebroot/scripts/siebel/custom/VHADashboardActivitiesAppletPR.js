if(typeof(SiebelAppFacade.VHADashboardActivitiesAppletPR)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.VHADashboardActivitiesAppletPR");define("siebel/custom/VHADashboardActivitiesAppletPR",["order!siebel/jqgridrenderer"],function(){SiebelAppFacade.VHADashboardActivitiesAppletPR=(function(){function VHADashboardActivitiesAppletPR(pm){SiebelAppFacade.VHADashboardActivitiesAppletPR.superclass.constructor.call(this,pm);SiebelApp.EventManager.cleanListners("VHADashboardActivitiesIC");SiebelApp.EventManager.addListner("VHADashboardActivitiesIC",VHADashboardActivitiesIc,this)}SiebelJS.Extend(VHADashboardActivitiesAppletPR,SiebelAppFacade.JQGridRenderer);VHADashboardActivitiesAppletPR.prototype.ShowUI=function(){SiebelAppFacade.VHADashboardActivitiesAppletPR.superclass.ShowUI.call(this);VHADashboardActivitiesIc();var assetid=SiebelApp.S_App.GetProfileAttr("VHADashboardAssetId");var data={ParentRef:assetid,Type:"MSISDN"};VHASmartAgentPopup.AppendCreateActivityButton("#VHAActivitiesbuttons",data)};function VHADashboardActivitiesIc(e){var ParentIC=VHAAppUtilities.GetConstants("VHADashboardParentIC");if(!ParentIC){VHADashboardCommon.VHADasboardGetICProp("AssetHeader");ParentIC=VHAAppUtilities.GetConstants("VHADashboardParentIC")}var ActivitiesIC=ParentIC.GetChildByType("ListOfActivities");var childcount=ActivitiesIC.GetChildCount();var ArrayDAta=new Array();for(i=0;i<childcount;i++){var Propset=ActivitiesIC.GetChild(i);var tempArray=Propset.propArray;var tempArray1=new Array();tempArray1["Created"]=tempArray["Creation Date"];tempArray1["Description"]="<b>"+tempArray["Activity Category"]+"</b>"+"<br />"+tempArray["Description"];tempArray1["Type"]=tempArray["VHAAccountType"];ArrayDAta.push(tempArray1)}$("#VHAActivitiesTable").jqGrid({datatype:"local",height:"100%",autowidth:true,shrinktofit:true,data:ArrayDAta,pager:"#ActivitiesPager",autoencode:true,ignoreCase:true,toolbar:[true,"top"],gridview:true,rowNum:5,loadonce:true,viewrecords:true,colModel:[{name:"Created",index:"Created",sorttype:"date",width:20,formatter:"date",formatoptions:{srcformat:"m-d-Y H:i:s",newformat:"d M Y"},search:true},{name:"Description",index:"Description",formatter:DescFmatter,width:60,search:true},{name:"Type",index:"Type",width:20,search:true}]});$("#VHAActivitiesTable").jqGrid("sortGrid","Created",true,"desc");function DescFmatter(cellvalue,options,rowObject){return""+cellvalue}}VHADashboardActivitiesAppletPR.prototype.BindEvents=function(){SiebelAppFacade.VHADashboardActivitiesAppletPR.superclass.BindEvents.call(this);$("#ActivitiesSearch").on("keyup",function(){grid=$("#VHAActivitiesTable");var searchFiler=$("#ActivitiesSearch").val(),f;if(searchFiler.length===0){grid[0].p.search=false;$.extend(grid[0].p.postData,{filters:""})}f={groupOp:"OR",rules:[]};f.rules.push({field:"CreatedDate",op:"cn",data:searchFiler});f.rules.push({field:"ActivityCategory",op:"cn",data:searchFiler});f.rules.push({field:"Description",op:"cn",data:searchFiler});f.rules.push({field:"Type",op:"cn",data:searchFiler});grid[0].p.search=true;$.extend(grid[0].p.postData,{filters:JSON.stringify(f)});grid.trigger("reloadGrid",[{page:1,current:true}])});var view=SiebelApp.S_App.GetActiveView();var appletMap=view.GetAppletMap();var myApplet=appletMap["VHA Generic Dashboard Activities List Applet"];var pm=myApplet.GetPModel();var CDAppletId=pm.Get("GetFullId");$("#VHAActivitiesDiv").on("click","#VHAActivitiesExpandCollapse",{ctx:this},function(t){$("#VHAActivitiesCard").addClass("VHADisplayNone");$("#VHAActivitiesExpandCollapse").replaceWith('<img src="images/custom/Group_246.svg" id="VHAActivitiesExpand">')});$("#VHAActivitiesbuttons").on("click","#VHAGotoActivitiesView",{ctx:this},function(t){var Inputs=SiebelApp.S_App.NewPropertySet();var Output=SiebelApp.S_App.NewPropertySet();var ser=SiebelApp.S_App.GetService("VF BS Process Manager");Inputs.SetProperty("Service Name","VHA MSISDN GotoView BS");Inputs.SetProperty("Method Name","GotoView");Inputs.SetProperty("BusObjName","VF Asset");Inputs.SetProperty("BusCompName","Asset Mgmt - Asset - Header");var ParentIC=VHAAppUtilities.GetConstants("VHADashboardParentIC");var RecordId=ParentIC.GetProperty("Installed Asset Id");Inputs.SetProperty("RowId",RecordId);Inputs.SetProperty("ViewName","VF Asset Activities View");var Output=ser.InvokeMethod("Run Process",Inputs)});$("#VHAActivitiesDiv").on("click","#VHAActivitiesExpand",{ctx:this},function(t){$("#VHAActivitiesTable").jqGrid("setGridWidth",parseInt($("#VHAActivitiesTable").closest(".siebel-SmallCards-Side").width()-5),true);if($("#srchpanecontainer.forcehide").length==1){$(".siebel-InnerContainer.Right .siebel-SmallCards-Side").width(parseInt($("#VHAActivitiesTable").width()+5));$(".siebel-InnerContainer.Right").css("max-width",parseInt($("#VHAActivitiesTable").width()+16))}$("#VHAActivitiesCard").removeClass("VHADisplayNone");$("#VHAActivitiesExpand").replaceWith('<img src="images/custom/Group_252.svg" id="VHAActivitiesExpandCollapse">');setTimeout(function(){var gridName="VHAActivitiesTable";var objHeader=$("table[aria-labelledby='gbox_"+gridName+"'] tr[role=rowheader] th");for(var i=0;i<objHeader.length;i++){var col=$("table[id='"+gridName+"'] td[aria-describedby='"+objHeader[i].id+"']");var width=col.outerWidth()-1;$(objHeader[i]).css("width",width)}$("#gview_VHAActivitiesTable").addClass("HdrWdthAdded")},100)})};return VHADashboardActivitiesAppletPR}());return"SiebelAppFacade.VHADashboardActivitiesAppletPR"})};