if(typeof(SiebelAppFacade.VFSPSSubmitOrderCompleteAppletPR)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.VFSPSSubmitOrderCompleteAppletPR");define("siebel/custom/VFSPSSubmitOrderCompleteAppletPR",["order!3rdParty/jqGrid/current/js/i18n/grid.locale-en","order!3rdParty/jqGrid/current/js/jquery.jqGrid.min","order!3rdParty/jqgrid-ext","order!siebel/phyrenderer"],function(){SiebelAppFacade.VFSPSSubmitOrderCompleteAppletPR=(function(){function VFSPSSubmitOrderCompleteAppletPR(pm){SiebelAppFacade.VFSPSSubmitOrderCompleteAppletPR.superclass.constructor.call(this,pm)}SiebelJS.Extend(VFSPSSubmitOrderCompleteAppletPR,SiebelAppFacade.PhysicalRenderer);VFSPSSubmitOrderCompleteAppletPR.prototype.ShowUI=function(){SiebelAppFacade.VFSPSSubmitOrderCompleteAppletPR.superclass.ShowUI.call(this);VFSPSOrderDetailsReloadGrid()};VFSPSSubmitOrderCompleteAppletPR.prototype.BindEvents=function(){SiebelAppFacade.VFSPSSubmitOrderCompleteAppletPR.superclass.BindEvents.apply(this,arguments);$(".VFSPSSubOrdUpdStrCode").delegate(".VFSPSCustomNextButton","click",{ctx:this},VFSPSGoToHomePage)};function VFSPSGoToHomePage(e){SiebelApp.S_App.GotoView("VF SPS Home Page View","VF SPS Home Page BO")}function VFSPSOrderDetailsReloadGrid(e){var BS="VF SPS Order Summary BS";var Method="GetOrderLineItemDetails";var inps=SiebelApp.S_App.NewPropertySet();var OrderId=SiebelApp.S_App.GetProfileAttr("VFSPSSubmittedOrderId");inps.SetProperty("OrderId",OrderId);var out=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});var RecordFound=out.GetProperty("OrderFound");var OrderNumber=out.GetProperty("OrderNumber");var dealerData=VFCustomSiebelInterface.SiebelMessageToArray(out);var recCount=dealerData.length>=10?10:dealerData.length;$(".VFSPSSubOrdUpdStrCodeJQGrid").jqGrid({datatype:"local",data:dealerData,height:"100%",colNames:["Service Order Id","Mobile Number","Plan Name","Id"],colModel:[{name:"Order Item Id",index:"Order Item Id",width:100,height:200,sortable:false},{name:"New MSISDN",index:"New MSISDN",width:500,height:200,sorttype:false},{name:"VF SPS Plan Name",index:"VF SPS Plan Name",width:500,height:200,sorttype:false},{name:"Order Header Id",index:"Order Header Id",hidden:true}],search:true,multiselect:false,width:"100%",rowNum:recCount});$("#VFSPSSubOrdUpdStrCodeCurrentDealerCode").html(OrderNumber);SendEmailAfterSubmit()}function SendEmailAfterSubmit(){var OrderId=SiebelApp.S_App.GetProfileAttr("VFSPSSubmittedOrderId");var sessionId=SiebelApp.S_App.GetProfileAttr("VFSPSSubmittedOrderSessionId");var SettingsData=VFTabletIntegrationConstants.GetSettingData("JSON");var inp=SiebelApp.S_App.NewPropertySet();inp.SetProperty("Object Id",OrderId);inp.SetProperty("Method Name","RunProcess");var out=VFCustomSiebelInterface.CallWorkflow("VF SPS Query Order Metadata",inp,{"Type":"JSON"});var sOutString=JSON.stringify(out);var emailMetaData=JSON.parse(sOutString);var DealerCode=emailMetaData["SalesDealerCode"];var CustomerID=emailMetaData["CustomerID"];var ClientID=emailMetaData["ClientID"];var ContractID=emailMetaData["ContractID"];var DealerGroup=emailMetaData["SalesDealerGroup"];var UniqueID=OrderId;var ContactID=emailMetaData["ContactId"];var StorePersonName=emailMetaData["SalesPerson"];var StoreName=emailMetaData["SalesBranch"];var CustomerFirstName=emailMetaData["CustFName"];var CustomerLastName=emailMetaData["CustLName"];var CustomerDOB=emailMetaData["CustDOB"];var CustomerEmail=emailMetaData["CustEmail"];var RequestType=emailMetaData["RequestType"];var CustMName=emailMetaData["CustMName"];emailMetaData={"DealerCode":DealerCode,"CustomerID":CustomerID,"ContractID":ContractID,"DealerGroup":DealerGroup,"UniqueID":UniqueID,"CustomerFirstName":CustomerFirstName,"CustomerLastName":CustomerLastName,"CustomerMiddleName":CustMName,"CustomerEmail":CustomerEmail,"SessionID":sessionId,"CustomerDOB":CustomerDOB,"ClientID":ClientID,"RequestType":RequestType,"ContactID":ContactID,"StoreName":StoreName,"SalesPersonName":StorePersonName};var requestData={"Key":"BulkEmail","SettingsData":SettingsData,"MetaData":emailMetaData,"RequestParam":{"SyncType":"sync","AdditionalEmail":""}};if(typeof(VHAWrapper)=="undefined"){console.log("wrapper call failed")}else{VHAWrapper.sendBulkEmailContract(JSON.stringify(requestData),"VFTabletIntegration.Success","VFTabletIntegration.Failure")}}return VFSPSSubmitOrderCompleteAppletPR}());return"SiebelAppFacade.VFSPSSubmitOrderCompleteAppletPR"})};