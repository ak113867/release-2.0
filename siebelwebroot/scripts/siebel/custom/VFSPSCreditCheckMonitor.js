if(typeof(VFSPSCreditCheckMonitor)==="undefined"){var VFSPSCreditCheckMonitor={};VFSPSCreditCheckMonitor.sessionTimerInterval=1;VFSPSCreditCheckMonitor.sessionTimerToMilliSecs=((VFSPSCreditCheckMonitor.sessionTimerInterval*60)*1000);VFSPSCreditCheckMonitor.intervalObj=null;VFSPSCreditCheckMonitor.retainSession=false;VFSPSCreditCheckMonitor.timerCount=1;VFSPSCreditCheckMonitor.startInterval=function(){try{clearInterval(VFSPSCreditCheckMonitor.intervalObj)}catch(e){}VFSPSCreditCheckMonitor.intervalObj=setInterval(function(){VFSPSCreditCheckMonitor.sessionTimerInterval=1;VFSPSCreditCheckMonitor.sessionTimerToMilliSecs=((VFSPSCreditCheckMonitor.sessionTimerInterval*60)*1000);VFSPSCreditCheckMonitor.retainSession=false;VFSPSCreditCheckMonitor.resetInterval();var BroadCastMsg=VFSPSCreditCheckMonitor.GetNotificationMessage();if($("#VFSPSApplicationNotifyImg").attr("state")!="CreditOpen"){if(BroadCastMsg.count==0){$("#VFSPSCreditCheckNotifyCountDiv").hide();$("#VFSPSApplicationNotifyImg").attr("src","images/VFSPSNotifyBell.png").attr("state","CreditNone")}else{if(BroadCastMsg.UnreadMsgCount){$("#VFSPSCreditCheckNotifyCountDiv").show();$("#VFSPSApplicationNotifyImg").attr("src","images/VFSPSWithNotificationBell.png").attr("state","CreditClose")}else{$("#VFSPSCreditCheckNotifyCountDiv").hide();$("#VFSPSApplicationNotifyImg").attr("src","images/VFSPSWithNotificationBell.png").attr("state","CreditClose")}}}$("#VFSPSCreditCheckNotifyCountSpan").html(BroadCastMsg.UnreadMsgCount)},(VFSPSCreditCheckMonitor.sessionTimerToMilliSecs))};VFSPSCreditCheckMonitor.GetNotificationMessage=function(){var BS="VF SPS Credit Check Notificaion BS";var Method="PullNotifications";var inps=SiebelApp.S_App.NewPropertySet();var outs=SiebelApp.S_App.NewPropertySet();outs=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});var RawMessage=VFCustomSiebelInterface.SiebelMessageToArray(outs);var MsgLength=RawMessage.length;var BroadCastMsg=[];for(var i=0;i<MsgLength;i++){BroadCastMsg[BroadCastMsg.length]=VFSPSCreditCheckMonitor.ConvertMessageStingToObject(RawMessage[i])}var BCMlength=BroadCastMsg.length;var TotalMessageUnread=0;var BCMSorted=[];for(var i=0;i<BCMlength;i++){if(BroadCastMsg[i]["Unread"]==0){TotalMessageUnread++;BCMSorted[BCMSorted.length]=BroadCastMsg[i]}}for(var i=0;i<BCMlength;i++){if(BroadCastMsg[i]["Unread"]==1){BCMSorted[BCMSorted.length]=BroadCastMsg[i]}}return{"count":BroadCastMsg.length,"UnreadMsgCount":TotalMessageUnread,"MessageArray":BCMSorted}};VFSPSCreditCheckMonitor.ConvertMessageStingToObject=function(MessageList){var Message={};Message.RowID=MessageList["Id"];Message.Message=MessageList["Body"];Message.Priority=MessageList["Comments"];Message.Abstract=MessageList["Abstract"];Message.Unread=MessageList["User Message Status"];return Message};VFSPSCreditCheckMonitor.resetInterval=function(){VFSPSCreditCheckMonitor.timerCount=1;clearInterval(VFSPSCreditCheckMonitor.intervalObj);VFSPSCreditCheckMonitor.startInterval()};VFSPSCreditCheckMonitor.MarkMessageRead=function(MessageID){var Service="Message Bar";var Method="UpdateUserMsg";var Inp=SiebelApp.S_App.NewPropertySet();Inp.SetProperty("User MsgId",MessageID);Inp.SetProperty("User MsgStatus","1");var I={};I.async=true;I.npr=false;I.selfbusy=true;I.scope=this;var G=VFCustomSiebelInterface.CallBS(Service,Method,Inp,I)}}$(function(){VFSPSCreditCheckMonitor.resetInterval()});