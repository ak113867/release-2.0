if(typeof(SiebelAppFacade.VFSPSPublicNotesPR)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.VFSPSPublicNotesPR");define("siebel/custom/VFSPSPublicNotesPR",["order!siebel/jqgridrenderer"],function(){SiebelAppFacade.VFSPSPublicNotesPR=(function(){function VFSPSPublicNotesPR(pm){SiebelAppFacade.VFSPSPublicNotesPR.superclass.constructor.call(this,pm);var data;SiebelApp.EventManager.addListner("VFSPSFilterAssetsList",VFSPSFilterAssets,this)}SiebelJS.Extend(VFSPSPublicNotesPR,SiebelAppFacade.JQGridRenderer);VFSPSPublicNotesPR.prototype.ShowUI=function(){SiebelAppFacade.VFSPSPublicNotesPR.superclass.ShowUI.apply(this,arguments);var pm=this.GetPM();var Input=SiebelApp.S_App.NewPropertySet();Input.SetProperty("Profile Attribute Name","TBUIScenario");Input.SetProperty("Profile Attribute Value","");var Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});var ActiveView=SiebelApp.S_App.GetActiveView();var SessionOrderApplet=ActiveView.GetApplet("VF Sales Home Page Previous Orders List Applet");var OrderInput=SiebelApp.S_App.NewPropertySet();var OrderOutput=SiebelApp.S_App.NewPropertySet();OrderOutput=VFCustomSiebelInterface.CallBS("VF SPS TBUI Utilities","GetCustomerSessionOrders",OrderInput,{});OrderRecordList=VFCustomSiebelInterface.SiebelMessageToArray(OrderOutput);$(".VFSPSSessionOrder").append('<table id="Orderlist" width="100%" border="0px" cellpadding="0px" cellspacing="0px"></table>');$("#Orderlist").jqGrid({datatype:"local",height:"100%",colNames:["Order","Date","Status","Type"],colModel:[{name:"OrderNumber",index:"OrderNumber",width:300,height:200,sortable:false},{name:"OrderDate",index:"OrderDate",width:300,height:200,sorttype:false},{name:"Status",index:"Status",width:300,height:200,sorttype:false},{name:"OrderSubType",index:"OrderSubType",width:300,height:200,sorttype:false}],multiselect:false,width:"100%"});var RecordListLen=OrderRecordList.length;if(RecordListLen){for(var index=0;index<RecordListLen;index++){var mydata=[{OrderNumber:OrderRecordList[index]["Order Number"],OrderDate:OrderRecordList[index]["Order Date"],OrderSubType:OrderRecordList[index]["Order Sub Type"],Status:OrderRecordList[index]["Status"]}];$("#Orderlist").jqGrid("addRowData",index+1,mydata)}}else{$(".VFSPSSessionOrder").addClass("VFSPSDisplayNone")}var InstalledAssetApplet=ActiveView.GetApplet("VF SPS NBA MSISDN List - SHP");var AssetInput=SiebelApp.S_App.NewPropertySet();var AssetOutput=SiebelApp.S_App.NewPropertySet();AssetOutput=VFCustomSiebelInterface.CallBS("VF SPS TBUI Utilities","GetInstalledAssets",AssetInput,{});AssetRecordList=VFCustomSiebelInterface.SiebelMessageToArray(AssetOutput);$("#VFSPSAssetDetails").append('<table id="InstalledAssetlist" width="100%" border="0px" cellpadding="0px" cellspacing="0px"></table>');$("#InstalledAssetlist").jqGrid({datatype:"local",height:"100%",search:true,colModel:[{name:"MSISDN",index:"MSISDN",caption:"",width:200,height:200,sortable:false},{name:"Type",index:"Type",caption:"",width:200,height:200,sorttype:false},{name:"BillingAccNumber",index:"BillingAccNumber",width:200,height:200,sorttype:false},{name:"Product",index:"Product",width:200,height:200,sorttype:false}],multiselect:false,width:"100%"});var AssetListLen=AssetRecordList.length;if(AssetListLen){for(var index=0;index<AssetListLen;index++){var mydata=[{MSISDN:AssetRecordList[index]["MSISDN2"],Type:AssetRecordList[index]["Payment Method"],BillingAccNumber:AssetRecordList[index]["Billing Account Number"],Product:AssetRecordList[index]["Product Name"]}];$("#InstalledAssetlist").jqGrid("addRowData",index+1,mydata)}}else{$("#VFSPSAssetDetails").addClass("VFSPSDisplayNone")}var BaseGrid=$("#InstalledAssetlist");data=BaseGrid.getRowData();var recordSet=pm.Get("GetRecordSet");var recordLength=recordSet.length;if(recordLength){for(var index=0;index<recordLength;index++){$(".VFSPSPublicNotesParDiv").append(GetParentTileContainer(index));PopulateTileData(index,recordSet[index])}}else{$(".VFSPSPublicNotes").addClass("VFSPSDisplayNone")}$("#VFSPSAssetType").attr("disabled","true")};function PopulateTileData(index,recordSet){var showChar=500;var template=$(".VFSPSPublicNotesContentDiv").html();if(index>1){$("#VFSPSPublicNotesTileParId"+index).append('<div class="VFSPSSeeAllDivContent VFSPSDisplayNone"></div>');$("#VFSPSPublicNotesTileParId"+index+" .VFSPSSeeAllDivContent").append(template)}else{$("#VFSPSPublicNotesTileParId"+index).append(template)}$("#VFSPSPublicNotesTileParId"+index+" .VFSPSNotes").html(recordSet["Note"]);$("#VFSPSPublicNotesTileParId"+index+" .VFSPSNotesCreatedDate").html(recordSet["Created Date"]);$("#VFSPSPublicNotesTileParId"+index+" .VFSPSNotesUpdatedDate").html(recordSet["Updated Date"]);var content=$("#VFSPSPublicNotesTileParId"+index+" .VFSPSNotes").text();if(content.length>showChar){var c=content.substr(0,showChar);var h=content.substr(showChar-1,content.length-showChar);var html='<span class="VFSPSContentLess VFSPSDisplayBlock">'+c+'<span class="VFSPSDotted">...</span></span><span class="VFSPSContentMore VFSPSDisplayNone">'+content+"</span></span>";$("#VFSPSPublicNotesTileParId"+index+" .VFSPSNotes").html(html);$("#VFSPSPublicNotesTileParId"+index+" .VFSPSShowMore").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock")}else{$("#VFSPSPublicNotesTileParId"+index+" .VFSPSShowMore").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone")}}function GetParentTileContainer(index){return"<div id='VFSPSPublicNotesTileParId"+index+"' class='VFSPSPublicNotesTileParDynDiv'></div>"}function VFSPSFilterAssets(){var searchFiler="Prepay";var servicetype;var gridData=$("#InstalledAssetlist");var f;var AssetType=$("#VFSPSAssetType").val();switch(AssetType){case ("Connect new Postpaid"):servicetype="Postpaid";$("#VFSPSAssetDetails").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");break;case ("Connect new Prepaid"):servicetype="Prepaid";$("#VFSPSAssetDetails").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");break;case ("Show all assets"):gridData.clearGridData();for(var i=0;i<=data.length;i++){gridData.jqGrid("addRowData",i+1,data[i])}$("#VFSPSAssetDetails").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");break;case ("Connect Pre to Post"):servicetype="Pre to Post";$("#VFSPSAssetDetails").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");if(searchFiler.length===0){gridData[0].p.search=false;$.extend(gridData[0].p.postData,{filters:""})}f={groupOp:"OR",rules:[]};f.rules.push({field:"Type",op:"cn",data:searchFiler});gridData[0].p.search=true;$.extend(gridData[0].p.postData,{filters:JSON.stringify(f)});gridData.trigger("reloadGrid",[{page:1,current:true}]);if(gridData.getGridParam("reccount")==0){$("#VFSPSAssetDetails").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone")}break;case ("Add a member plan"):servicetype="Postpaid";$("#VFSPSAssetDetails").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");var grid=jQuery("#InstalledAssetlist");var postdata=grid.jqGrid("getGridParam","postData");var FilterCol="MSISDN";var filterVal="";jQuery.extend(postdata,{filters:"",searchField:FilterCol,searchOper:"eq",searchString:filterVal});grid.jqGrid("setGridParam",{postData:postdata});grid.trigger("reloadGrid");if(gridData.getGridParam("reccount")==0){$("#VFSPSAssetDetails").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone")}break}var Input=SiebelApp.S_App.NewPropertySet();var Output=SiebelApp.S_App.NewPropertySet();Input.SetProperty("Profile Attribute Name","ExistingServiceType");Input.SetProperty("Profile Attribute Value",servicetype);Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});ButtonEnableHandler()}VFSPSPublicNotesPR.prototype.BindEvents=function(){SiebelAppFacade.VFSPSPublicNotesPR.superclass.BindEvents.apply(this,arguments);$(".VFSPSPublicNotesParDiv").delegate(".VFSPSNotesButton","click",{ctx:this},VFSPSExpandPublicNotes);$(".VFSPSPublicNotesMain").delegate("#VFSPSSeeAllButton","click",{ctx:this},VFSPSSeeAllPublicNotesList);$(".VFSPSPlaybarButton").delegate(".VFSPSCustomCancelButton","click",function(){SiebelApp.S_App.GotoView("VF SPS Home Page View")});$(".VFSPSPlaybarButton").delegate(".VFSPSCustomNextButton","click",function(){var SoleTrader=SiebelApp.S_App.GetProfileAttr("SoleTrader");var CustomerType=SiebelApp.S_App.GetProfileAttr("Type");var CAPIN=SiebelApp.S_App.GetProfileAttr("CAPIN");if($(this).hasClass("VFSPSPlaybarNextBtnEnabled")==true){var sAssetTypeVal=$("#VFSPSAssetType").val();if(sAssetTypeVal=="Connect Pre to Post"){var rowID=$("#InstalledAssetlist").jqGrid("getGridParam","selrow");var MSISDN=$("#InstalledAssetlist").jqGrid("getCell",rowID,"MSISDN");var Input=SiebelApp.S_App.NewPropertySet();Input.SetProperty("Profile Attribute Name","TBUIScenario");Input.SetProperty("Profile Attribute Value","PretoPost");var Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});Input.SetProperty("Profile Attribute Name","TBUIMSISDNPTP");Input.SetProperty("Profile Attribute Value",MSISDN);var Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{})}if(CustomerType=="Person"&&(SoleTrader=="Y"||SoleTrader=="N"||SoleTrader=="")){SiebelApp.S_App.GotoView("VF SPS Consumer Service Type View")}else{if(CustomerType=="Local Registered Company"||CustomerType=="Sole Trader"||CustomerType=="Corporate"){SiebelApp.S_App.GotoView("VF SPS Business Service Type View")}else{alert("CustomerType not supported in this Application")}}}});$("#VFSPSAssetType").bind("change",function(){ButtonEnableHandler()});$(".VFSPSInstalledAssets").delegate("#VFSPSChooseAssetTypeIcon","click",function(){var SearchString="[List Of Values.Type] = 'VF_ASSET_TYPE' AND [List Of Values.Active] = 'Y'";var PicklistValues=VFCustomSiebelInterface.GetPickListValues("",SearchString);var selector="#VFSPSAssetType";VFSPSUdateUIFrameWork.VFSPSShowPicklistValues(selector,"",PicklistValues,"","","HTML","VFSPSFilterAssetsList")});$(".VFSPSInstalledAssets").delegate("#InstalledAssetlist","click",function(){rowID=$(this).jqGrid("getGridParam","selrow"),value=$(this).jqGrid("getCell",rowID,"MSISDN");$(this).addClass("VFSPSAssetTypeSelected");ButtonEnableHandler()})};function ButtonEnableHandler(){var sAssetTypeVal=$("#VFSPSAssetType").val();var AssetTypeSelected=$("#InstalledAssetlist").hasClass("VFSPSAssetTypeSelected");if(sAssetTypeVal=="Show all assets"||((sAssetTypeVal=="Connect Pre to Post"||sAssetTypeVal=="Add a member plan")&&AssetTypeSelected==false)||sAssetTypeVal==""){$(".VFSPSCustomNextButton").removeClass("VFSPSPlaybarNextBtnEnabled").addClass("VFSPSPlaybarNextBtnDisabled")}else{$(".VFSPSCustomNextButton").removeClass("VFSPSPlaybarNextBtnDisabled").addClass("VFSPSPlaybarNextBtnEnabled")}}function VFSPSExpandPublicNotes(e){if($(this).hasClass("VFSPSShowMore")){$(this).removeClass("VFSPSShowMore").addClass("VFSPSShowLess").html("Less");$(this).parent().prev().find(".VFSPSContentLess").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$(this).parent().prev().find(".VFSPSContentMore").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock")}else{$(this).removeClass("VFSPSShowLess").addClass("VFSPSShowMore").html("More");$(this).parent().prev().find(".VFSPSContentLess").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");$(this).parent().prev().find(".VFSPSContentMore").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone")}}function VFSPSSeeAllPublicNotesList(e){if($(this).hasClass("VFSPSSeeAll")){$(this).removeClass("VFSPSSeeAll").addClass("VFSPSHide").html("Hide");$(".VFSPSSeeAllDivContent").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock")}else{$(this).removeClass("VFSPSHide").addClass("VFSPSSeeAll").html("See All");$(".VFSPSSeeAllDivContent").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone")}}return VFSPSPublicNotesPR}());return"SiebelAppFacade.VFSPSPublicNotesPR"})};