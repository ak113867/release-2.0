if(typeof(SiebelAppFacade.VFAccountPaymentListAppletAUPrepayPR)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.VFAccountPaymentListAppletAUPrepayPR");define("siebel/custom/VFAccountPaymentListAppletAUPrepayPR",["siebel/jqgridrenderer"],function(){SiebelAppFacade.VFAccountPaymentListAppletAUPrepayPR=(function(){function VFAccountPaymentListAppletAUPrepayPR(pm){SiebelAppFacade.VFAccountPaymentListAppletAUPrepayPR.superclass.constructor.apply(this,arguments)}SiebelJS.Extend(VFAccountPaymentListAppletAUPrepayPR,SiebelAppFacade.JQGridRenderer);VFAccountPaymentListAppletAUPrepayPR.prototype.Init=function(){SiebelAppFacade.VFAccountPaymentListAppletAUPrepayPR.superclass.Init.apply(this,arguments)};VFAccountPaymentListAppletAUPrepayPR.prototype.ShowUI=function(){SiebelAppFacade.VFAccountPaymentListAppletAUPrepayPR.superclass.ShowUI.apply(this,arguments);var pm=this.GetPM();var appletId=pm.Get("GetId");appendButton(appletId)};function appendButton(appletId){$(".VHAViewPayment").remove();$("#a_"+appletId+" .siebui-btn-grp-applet").append("<div class='siebui-ctrl-btn appletButtonDi VHAViewPayment'>View Payments Graph</div>")}function DisplayChart(e){appendDialogTemplate();var pm=e.data.ctx.GetPM();var recordSet=pm.Get("GetRecordSet");var Data=prepareData(recordSet);$("#openModal").toggleClass("VHADisplayNone");try{plot1=$.jqplot("VHAPaymentChart",[Data.Amount],{animate:true,height:400,width:600,title:"Payment History",seriesDefaults:{renderer:$.jqplot.BarRenderer,barwidth:20,pointLabels:{show:true}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:Data.Month,label:"Month/Year"},yaxis:{label:"Amount ($)",tickOptions:{formatString:"$%d"}}},highlighter:{show:false}})}catch(e){console.log(e)}$(".VHACloseModalDialogue").click(function(e){plot1.destroy();$("#openModal").toggleClass("VHADisplayNone")})}function prepareData(recordSet){var newRecordSet={"Month":[],"Amount":[]};var recordSetLen=recordSet.length;console.log(recordSet);for(i=0;i<recordSetLen;i++){var temp=recordSet[i];for(j=0;j<recordSetLen;j++){if(temp["PaymentDate"]<recordSet[j]["PaymentDate"]){recordSet[i]=recordSet[j];recordSet[j]=temp;temp=recordSet[i]}}}console.log(recordSet);for(var i=0;i<recordSetLen;i++){console.log("Record:");console.log(recordSet[i]);var paymentDate=recordSet[i]["PaymentDate"];var mon=paymentDate.substr(3,7);var index=newRecordSet.Month.indexOf(mon);if(index<0){newRecordSet.Month[newRecordSet.Month.length]=paymentDate.substr(3,7);var amount=recordSet[i]["Amount"];newRecordSet.Amount[newRecordSet.Amount.length]=Number(amount)}else{var amount=recordSet[i]["Amount"];newRecordSet.Amount[index]=Number(amount)+newRecordSet.Amount[index]}}return newRecordSet}function appendDialogTemplate(){var Template='<div id = "openModal" class = "modalDialog VHADisplayNone">                            <div class="VHACloseModalDialogue">X</div>                           <div id="VHAChartPanel">                               <div id="VHAPaymentChart" class="VHAChart" style="height:400px;width:600px;"></div>                           </div>                       </div>';$("#openModal").remove();$("body").append(Template)}VFAccountPaymentListAppletAUPrepayPR.prototype.BindData=function(bRefresh){SiebelAppFacade.VFAccountPaymentListAppletAUPrepayPR.superclass.BindData.apply(this,arguments)};VFAccountPaymentListAppletAUPrepayPR.prototype.BindEvents=function(){SiebelAppFacade.VFAccountPaymentListAppletAUPrepayPR.superclass.BindEvents.apply(this,arguments);console.log("BindEvents");var pm=this.GetPM();var appletId=pm.Get("GetId");$("#a_"+appletId).delegate(".VHAViewPayment","click",{ctx:this},DisplayChart)};VFAccountPaymentListAppletAUPrepayPR.prototype.EndLife=function(){SiebelAppFacade.VFAccountPaymentListAppletAUPrepayPR.superclass.EndLife.apply(this,arguments)};return VFAccountPaymentListAppletAUPrepayPR}());return"SiebelAppFacade.VFAccountPaymentListAppletAUPrepayPR"})};