if(typeof(SiebelAppFacade.RecycleBinPModel)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.RecycleBinPModel");define("siebel/custom/recyclebinpmodel",[],function(){SiebelAppFacade.RecycleBinPModel=(function(){var consts=SiebelJS.Dependency("SiebelApp.Constants");function RecycleBinPModel(){SiebelAppFacade.RecycleBinPModel.superclass.constructor.apply(this,arguments)}SiebelJS.Extend(RecycleBinPModel,SiebelAppFacade.ListPresentationModel);RecycleBinPModel.prototype.Init=function(){SiebelAppFacade.RecycleBinPModel.superclass.Init.call(this);this.AddProperty("DeletionPendingSet",[]);this.AddProperty("DeletionCompleteSet",[]);this.AddProperty("restorationIndex",-1);this.AddProperty("ObjectsUnderDeletion",[]);this.AddMethod("RefreshList",function(){});this.AttachEventHandler("RESTORE",OnClickRestore);this.AddMethod("GetFormattedFieldValue",PreGetFormattedFieldValue,{sequence:true,scope:this});this.AddMethod("LeaveField",PreLeaveField,{sequence:true,scope:this});this.AttachNotificationHandler(consts.get("SWE_PROP_BC_NOTI_DELETE_RECORD"),HandleDeleteNotification);this.AddMethod("InvokeMethod",PreInvokeMethod,{sequence:true,scope:this});this.AttachPreProxyExecuteBinding("WriteRecord",function(methodName,inputPS,outputPS){});this.AttachPostProxyExecuteBinding("WriteRecord",PostWriteRecord)};RecycleBinPModel.prototype.Setup=function(propSet){var mycontrol=SiebelApp.S_App.GetAppletControlInstance("Client_Select",consts.get("SWE_CTRL_CHECKBOX"),"Select","50");this.Get("GetListOfColumns")["Client_Select"]=mycontrol;SiebelAppFacade.RecycleBinPModel.superclass.Setup.call(this,propSet)};function PreGetFormattedFieldValue(control,bUseWS,recIndex,returnStructure){if(control.GetName()==="Client_Select"){returnStructure["CancelOperation"]=true;returnStructure["ReturnValue"]=""}}function PreLeaveField(control,value,notLeave,returnStructure){if(control.GetName()==="Client_Select"){this.ExecuteMethod("SetActiveControl",null);var delObj=this.Get("DeletionPendingSet");var currentSelection=this.Get("GetSelection");if(value==="Y"){delObj[currentSelection]=this.Get("GetRecordSet")[currentSelection]}else{delObj[currentSelection]=null}returnStructure["CancelOperation"]=true;returnStructure["ReturnValue"]=true}}function PreInvokeMethod(methodName,psInputArgs,lp,returnStructure){if(methodName==="DeleteRecord"&&!this.Get("InDeletion")){this.SetProperty("InDeletion",true);var deletionPending=this.Get("DeletionPendingSet");if(deletionPending.length>0){for(var counter=deletionPending.length-1;counter>=0;counter--){var currentObj=deletionPending[counter];if(currentObj){this.ExecuteMethod("SetActiveControl",null);this.ExecuteMethod("HandleRowSelect",counter,false,false);if(this.ExecuteMethod("CanInvokeMethod","DeleteRecord")){this.Get("ObjectsUnderDeletion")[this.Get("GetSelection")]=currentObj;var inputPS=SiebelApp.S_App.NewPropertySet();this.ExecuteMethod("InvokeMethod","DeleteRecord",inputPS)}}}this.SetProperty("DeletionPendingSet",[]);returnStructure["CancelOperation"]=true;SiebelApp.S_App.uiStatus.Free()}this.SetProperty("InDeletion",false)}else{if(methodName==="WriteRecord"&&this.Get("inRestoration")){var recordSet=this.Get("DeletionCompleteSet");var record=recordSet[this.Get("restorationIndex")];var listOfColumns=this.Get("ListOfColumns");var controls=this.Get("GetControls");for(var i=0,len=listOfColumns.length;i<len;i++){var control=controls[listOfColumns[i].name];if(control){this.ExecuteMethod("LeaveField",control,record[control.GetFieldName()],true)}}}}}function HandleDeleteNotification(propSet){var objectsUnderDeletion=this.Get("ObjectsUnderDeletion");if(objectsUnderDeletion.length>0){var activeRow=propSet.GetProperty(consts.get("SWE_PROP_BC_NOTI_ACTIVE_ROW"));if(activeRow==this.Get("GetSelection")&&objectsUnderDeletion[activeRow]){this.Get("DeletionCompleteSet").push(objectsUnderDeletion[activeRow]);objectsUnderDeletion[activeRow]=null;this.ExecuteMethod("RefreshList")}}}function PostWriteRecord(methodName,inputPS,outputPS){if(this.Get("inRestoration")){this.Get("DeletionCompleteSet")[this.Get("restorationIndex")]=null;this.ExecuteMethod("RefreshList");this.SetProperty("inRestoration",false)}}function OnClickRestore(index){if(this.ExecuteMethod("CanInvokeMethod","NewRecord")){this.SetProperty("inRestoration",true);this.SetProperty("restorationIndex",index);this.ExecuteMethod("InvokeMethod","NewRecord",null,false);this.ExecuteMethod("InvokeMethod","WriteRecord",null,false)}}return RecycleBinPModel}());return"SiebelAppFacade.RecycleBinPModel"})};