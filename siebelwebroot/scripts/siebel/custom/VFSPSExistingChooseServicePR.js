if(typeof(SiebelAppFacade.VFSPSExistingChooseServicePR)==="undefined"){var controls;var sPlan;SiebelJS.Namespace("SiebelAppFacade.VFSPSExistingChooseServicePR");define("siebel/custom/VFSPSExistingChooseServicePR",["order!siebel/phyrenderer"],function(){SiebelAppFacade.VFSPSExistingChooseServicePR=(function(){function VFSPSExistingChooseServicePR(pm){SiebelAppFacade.VFSPSExistingChooseServicePR.superclass.constructor.call(this,pm);var sActiveView;var pm}SiebelJS.Extend(VFSPSExistingChooseServicePR,SiebelAppFacade.PhysicalRenderer);VFSPSExistingChooseServicePR.prototype.ShowUI=function(){SiebelAppFacade.VFSPSExistingChooseServicePR.superclass.ShowUI.call(this);sActiveView=SiebelApp.S_App.GetActiveView();pm=this.GetPM();controls=this.GetPM().Get("GetControls");var appletId=pm.Get("GetFullId");var getCustomerType=SiebelApp.S_App.GetProfileAttr("Type");setTimeout(function(){applet=sActiveView.GetApplet("VF SPS Sales Home Page Action Bar");appId=applet.GetFullId();$("#s_"+appId+"_div").hide();$("input[name='"+controls["VF No Of Employees"].GetInputName()+"']").attr("disabled",true);$("input[name='"+controls["VF No Of Employees"].GetInputName()+"']").attr("placeholder","--Select--").after('<img id="VFSPSExistingEmployeeDropDown" class="VFSPSDropDownIcon" src="images/VFSPSdropdown-arrow.png">');$("input[name='"+controls["VF No Of Employees"].GetInputName()+"']").parent().addClass("VFSPSNoOfEmployeeswidth").removeClass("VFSPSExistingServiceField");var bo=SiebelApp.S_App.GetActiveBusObj();var bc=bo.GetBusCompByName("VF SPS Flow Select VBC");sPlan=bc.GetFieldValue("VF SPS Flow Type");custType=bc.GetFieldValue("VF SPS Customer Type");if(sPlan=="Prepaid"){VFSPSPrepaidRegisterShow(controls);VFSPSValidateNext(e);var buisnessTypeCtrl=controls["Business Type"].GetInputName();$("input[name='"+buisnessTypeCtrl+"']").parent().parent().parent().hide();$("input[name='"+controls["Customer Type"].GetInputName()+"']").parent("div").addClass("VFSPSDisplayNone");$("input[name='"+controls["Customer Type"].GetInputName()+"']").parent("div").after('<div class="VFSPSExistingServiceField"><input type="text" value="'+custType+'" disabled="disabled"></input></div>')}else{VFSPSPrepaidRegisterHide(controls)}if(sActiveView.GetName()=="VF SPS Consumer Service Type View"){}var CSegment=SiebelApp.S_App.GetProfileAttr("CustomerSegmenet");if(SiebelApp.S_App.GetProfileAttr("CustomerSegmenet")){var CType=SiebelApp.S_App.GetProfileAttr("Type");VFSPSToggleBuisnessTypeField(CType)}},50);$("input[name='"+controls["Activation Key"].GetInputName()+"']").addClass("VFSPSChooseFlowActivationInput");$(".VFSPSExistingServiceField>#Register_your_Pack_Label").hide();$(".VFSPSChooseFlowActivationInput").parent().removeClass("VFSPSExistingServiceField").addClass("VFSPSExisitingActivationKey");$(".VFSPSChooseFlowActivationInput").attr("style","height: 40px !important;");VFSPSSetActivationKeyImage(controls);VFTabletIntegrationConstants.SetConstants("VFSPSExisValidActivationKey","N")};VFSPSExistingChooseServicePR.prototype.PostBindata=function(){SiebelAppFacade.VFSPSExistingChooseServicePR.superclass.PostBindData.call(this);var pm=this.GetPM();$("input[name='"+controls["Activation Key"].GetInputName()+"']").next().after('<div class="VFSPSScanKeyButton VFSPSScanKeyBtnEnabled VFSPSDisplayBlock style="display:block !important;"">Scan Key</div>')};VFSPSExistingChooseServicePR.prototype.BindEvents=function(){SiebelAppFacade.VFSPSExistingChooseServicePR.superclass.BindEvents.call(this);var pm=this.GetPM();var appletId=pm.Get("GetFullId");var PinCtrl=controls["CA Pin"].GetInputName();var sActivationKey=controls["Activation Key"].GetInputName();var sServicePIN=controls["Service PIN"].GetInputName();var iNoOfEmp=controls["VF No Of Employees"].GetInputName();$("#s_"+pm.Get("GetFullId")+"_div").delegate("input[name='"+PinCtrl+"']","keyup",{ctx:this},VFSPSValidateNext);$("#s_"+pm.Get("GetFullId")+"_div").delegate("input[name='"+PinCtrl+"']","keydown",{ctx:this},VFSPSCheckLengthFour);$("#s_"+pm.Get("GetFullId")+"_div").delegate("input[name='"+sServicePIN+"']","keyup",{ctx:this},VFSPSValidateNext);$("#s_"+pm.Get("GetFullId")+"_div").delegate("input[name='"+sActivationKey+"']","keyup",{ctx:this},VFSPSValidateNext);$("#s_"+pm.Get("GetFullId")+"_div").delegate("input[name='"+sServicePIN+"']","keydown",{ctx:this},VFSPSCheckLengthFour);$(".VFSPSExisitingActivationKey").delegate("#VFSPSValidateActivationKey","click",{ctx:this},VFSPSExistingValidateActivationKey);$("#s_"+pm.Get("GetFullId")+"_div").delegate("#VFSPSExistingEmployeeDropDown","click",{ctx:this},VFSPSEmployeeDropDown);$(".VFSPSExisitingActivationKey").delegate(".VFSPSScanKeyButton","click",{ctx:this},VFSPSExistingScanKeyClick);$("#s_"+pm.Get("GetFullId")+"_div").delegate("input[type='radio']","click",function(){var SelectedValue=$(this).val();VFSPSToggleBuisnessTypeField(SelectedValue)});$(".VFSPSPlaybarButton").delegate(".VFSPSCustomCancelButton","click",function(){SiebelApp.S_App.GotoView("VF SPS Home Page View")});$(".VFSPSPlaybarButton").delegate(".VFSPSCustomNextButton","click",function(){var bo=SiebelApp.S_App.GetActiveBusObj();var bc=bo.GetBusCompByName("VF SPS Flow Select VBC");var CAPIN=bc.GetFieldValue("CA PIN");var CType=bc.GetFieldValue("VF SPS Customer Type");var CSegment;var BusinessType=bc.GetFieldValue("Business Type");var NoOfEmp=bc.GetFieldValue("VF Number of Employees");if(CType=="Personal Use"){CType="Person";BusinessType="N";CSegment="Consumer"}else{if((CType=="Business Use")&&(BusinessType=="Y")){CType="Sole Trader";BusinessType="Y";CSegment="Business"}else{if((CType=="Business Use")&&(BusinessType=="Local Registered Company")){CType="Local Registered Company";BusinessType="N";CSegment="Business"}else{if((CType=="Business Use")&&(BusinessType=="Corporate")){CType="Corporate";BusinessType="N";CSegment="Business"}}}}var Input=SiebelApp.S_App.NewPropertySet();var Output=SiebelApp.S_App.NewPropertySet();Input.SetProperty("Profile Attribute Name","NewCAPIN");Input.SetProperty("Profile Attribute Value",CAPIN);Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});Input.SetProperty("Profile Attribute Name","CType");Input.SetProperty("Profile Attribute Value",CType);Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});Input.SetProperty("Profile Attribute Name","NewSoleTrader");Input.SetProperty("Profile Attribute Value",BusinessType);Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});Input.SetProperty("Profile Attribute Name","ConnectionType");Input.SetProperty("Profile Attribute Value","ExistingCustomer");Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});Input.SetProperty("Profile Attribute Name","sCustomerSegment");Input.SetProperty("Profile Attribute Value",CSegment);Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});Input.SetProperty("Profile Attribute Name","iNoOfEmp");Input.SetProperty("Profile Attribute Value",NoOfEmp);Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});var ExtAcctIDProfAttr=SiebelApp.S_App.GetProfileAttr("VFSPSExtAccountId");var ExtAcctIDConstant;var sScenario=SiebelApp.S_App.GetProfileAttr("TBUIScenario");if(ExtAcctIDProfAttr!=""&&sScenario=="PretoPost"){VFTabletIntegrationConstants.SetConstants("ExtAcctIDConstant",ExtAcctIDProfAttr);VFTabletNavigation.StartTask("VF SPS Prepaid - Postpay Connection")}else{if(sPlan=="Prepaid"){if(VFTabletIntegrationConstants.GetConstants("VFSPSExisValidActivationKey")=="Y"){Input.SetProperty("Profile Attribute Name","TBUIPrepayAccountId");Input.SetProperty("Profile Attribute Value",ExtAcctIDProfAttr);Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});Input.SetProperty("Profile Attribute Name","sScenario");Input.SetProperty("Profile Attribute Value","Prepay");Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});VFTabletNavigation.StartTask("VF SPS New PrePay Connect Task")}}else{if(ExtAcctIDProfAttr!=""){VFTabletIntegrationConstants.SetConstants("ExtAcctIDConstant",ExtAcctIDProfAttr);VFTabletNavigation.StartTask("VF SPS Postpay Task")}else{ExtAcctIDConstant=VFTabletIntegrationConstants.GetConstants("ExtAcctIDConstant");Input.SetProperty("Profile Attribute Name","VFSPSExtAccountId");Input.SetProperty("Profile Attribute Value",ExtAcctIDConstant);Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});VFTabletNavigation.StartTask("VF SPS Postpay Task")}}}})};function VFSPSEmployeeDropDown(e){var SearchString="[List Of Values.Type] = 'VF_EMP_RANGE' AND [List Of Values.Active] = 'Y' AND [List Of Values.Value] <> 'VGE'";VFSPSUdateUIFrameWork.VFSPSShowPicklistValues("VF SPS Flow Select VBC","VF Number of Employees","LOV","",SearchString,"Siebel","")}function VFSPSSetActivationKeyImage(controls){var bo=SiebelApp.S_App.GetActiveBusObj();var bc=bo.GetBusCompByName("VF SPS Flow Select VBC");var sAactivationKey=$("input[name='"+controls["Activation Key"].GetInputName()+"']").val();var sServicePIN=$("input[name='"+controls["Service PIN"].GetInputName()+"']").val();$("input[name='"+controls["Activation Key"].GetInputName()+"']").attr("type","number");if(sAactivationKey!=""&&sServicePIN!=""){$("input[name='"+controls["Activation Key"].GetInputName()+"']").after('<img id = "VFSPSValidateActivationKey" class="VFSSPSAddressvalidationicon VFSPSExistingActivationCross VFSPSClearSearch" src="images/VFSPScross.png"></img>')}else{$("input[name='"+controls["Activation Key"].GetInputName()+"']").after('<img id = "VFSPSValidateActivationKey" class="VFSPSExistingActivationSearchImg" src="images/VFSPSSearchICON.png"></img>')}$("input[name='"+controls["Service PIN"].GetInputName()+"']").attr("placeholder","Must be 4 digits").attr("type","number")}function VFSPSExistingScanKeyClick(e){var requestData={"Key":"ActivationKey"};if(typeof(VHAWrapper)=="undefined"){var retVal=VHAWrapperSTUB?VHAWrapperSTUB.scanBarcode(JSON.stringify(requestData),"VFTabletIntegration.Success","VFTabletIntegration.Failure"):0;retVal="1"}else{var retVal=VHAWrapper?VHAWrapper.scanBarcode(JSON.stringify(requestData),"VFTabletIntegration.Success","VFTabletIntegration.Failure"):0}if(retVal){}else{alert("Could not start Bar code scanner, please proceed with manual entry.")}}function VFSPSToggleBuisnessTypeField(SelectedValue){var buisnessTypeCtrl=controls["Business Type"].GetInputName();var NoOfEmpCtrl=controls["VF No Of Employees"].GetInputName();var bo=SiebelApp.S_App.GetActiveBusObj();var bc=bo.GetBusCompByName("VF SPS Flow Select VBC");$("input[name='"+buisnessTypeCtrl+"']").parent().parent().parent().hide();if(SelectedValue=="Person"||SelectedValue=="Personal Use"){bc.SetFieldValue("Business Type","N");$("input[name='"+NoOfEmpCtrl+"']").parent().parent().parent().hide()}else{if(SelectedValue=="Sole Trader"||SelectedValue=="Business Use"){bc.SetFieldValue("Business Type","Y");if(sPlan!="Prepaid"){$("input[name='"+NoOfEmpCtrl+"']").parent().parent().parent().show()}}else{if(SelectedValue=="Local registered Company"||SelectedValue=="Business Use"){bc.SetFieldValue("Business Type","Local Registered Company");if(sPlan!="Prepaid"){$("input[name='"+NoOfEmpCtrl+"']").parent().parent().parent().show()}}else{if(SelectedValue=="Corporate"||SelectedValue=="Business Use"){bc.SetFieldValue("Business Type","Corporate");if(sPlan!="Prepaid"){$("input[name='"+NoOfEmpCtrl+"']").parent().parent().parent().show()}}}}}}function VFSPSCheckLengthFour(e){if((event.which!=8)&&(event.which!=46)){var val=$(this).val();if(val.length==4){event.preventDefault();event.stopPropagation()}}}function VFSPSValidateNext(e){var input=$("input[name='"+controls["CA Pin"].GetInputName()+"']");var sActivationKey=$("input[name='"+controls["Activation Key"].GetInputName()+"']").val();var sServicePIN=$("input[name='"+controls["Service PIN"].GetInputName()+"']").val();var sValidate=VFTabletIntegrationConstants.GetConstants("VFSPSExisValidActivationKey");var sNoOFEmployees=$("input[name='"+controls["VF No Of Employees"].GetInputName()+"']");var bo=SiebelApp.S_App.GetActiveBusObj();var bc=bo.GetBusCompByName("VF SPS Flow Select VBC");var CType=bc.GetFieldValue("VF SPS Customer Type");if(sPlan=="Prepaid"){if(input.val()==""||sActivationKey==""||sServicePIN==""||sValidate!="Y"){$(".VFSPSCustomNextButton").removeClass("VFSPSPlaybarNextBtnEnabled").addClass("VFSPSPlaybarNextBtnDisabled")}else{$(".VFSPSCustomNextButton").removeClass("VFSPSPlaybarNextBtnDisabled").addClass("VFSPSPlaybarNextBtnEnabled")}}else{if(input.val()==""){$(".VFSPSCustomNextButton").removeClass("VFSPSPlaybarNextBtnEnabled").addClass("VFSPSPlaybarNextBtnDisabled")}else{$(".VFSPSCustomNextButton").removeClass("VFSPSPlaybarNextBtnDisabled").addClass("VFSPSPlaybarNextBtnEnabled")}}}function VFSPSExistingValidateActivationKey(e){if($(this).hasClass("VFSPSClearSearch")){$(".VFSPSChooseFlowActivationInput").val("");$(".VFSPSServicePIN").val("");$("#VFSPSValidateActivationKey").attr("src","images/VFSPSSearchICON.png");$("#VFSPSValidateActivationKey").removeClass("VFSPSClearSearch").addClass("VFSPSScanImg");$("#VFSPSValidateActivationKey").addClass("VFSPSExistingActivationSearchImg").removeClass("VFSPSExistingActivationCross");VFTabletIntegrationConstants.SetConstants("VFSPSExisValidActivationKey","N");VFSPSValidateNext()}else{var sActivationKey=$("input[name='"+controls["Activation Key"].GetInputName()+"']").val();var sServicePIN=$("input[name='"+controls["Service PIN"].GetInputName()+"']").val();if(sActivationKey!=""&&sServicePIN!=""){var Input=SiebelApp.S_App.NewPropertySet();var Output=SiebelApp.S_App.NewPropertySet();Input.SetProperty("MSISDN",sActivationKey);Input.SetProperty("PIN",sServicePIN);Output=VFCustomSiebelInterface.CallBS("VF SPS Prepaid Utilities","Authenticate",Input,{});Output=Output.GetProperty("Success");if(Output=="true"){VFTabletIntegrationConstants.SetConstants("VFSPSExisValidActivationKey","Y");var Input=SiebelApp.S_App.NewPropertySet();var Output=SiebelApp.S_App.NewPropertySet();Input.SetProperty("Profile Attribute Name","VFSPSActivationKey");Input.SetProperty("Profile Attribute Value",sActivationKey);Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});Input.SetProperty("Profile Attribute Name","VFSPSServicePIN");Input.SetProperty("Profile Attribute Value",sServicePIN);Output=VFCustomSiebelInterface.CallBS("SIS OM PMT Service","Set Profile Attribute",Input,{});$("#VFSPSValidateActivationKey").attr("src","images/VFSPScross.png");$("#VFSPSValidateActivationKey").addClass("VFSPSClearSearch").removeClass("VFSPSScanImg");$("#VFSPSValidateActivationKey").addClass("VFSPSExistingActivationCross").removeClass("VFSPSExistingActivationSearchImg");VFSPSValidateNext()}else{alert("Please enter a valid Activation Key")}}else{alert("Please enter both Activation Key and Service PIN before authenticating")}}}function VFSPSPrepaidRegisterHide(controls){$("#Activation_Key_Label").parent().removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$("#Service_PIN_Label").parent().removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$("#Register_your_Pack_Label").parent().removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$("input[name='"+controls["Activation Key"].GetInputName()+"']").parent().removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$("input[name='"+controls["Service PIN"].GetInputName()+"']").parent().removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$("#VFSPSLine4").removeClass("VFSPSDisplayBlock").addClass("VFSPSDisplayNone");$("#Service_PIN_Label").parent().parent().parent().hide();$("#Activation_Key_Label").parent().parent().parent().hide();$("#Register_your_Pack_Label").parent().parent().parent().hide();$("input[name='"+controls["Activation Key"].GetInputName()+"']").parent().parent().parent().hide();$("input[name='"+controls["Service PIN"].GetInputName()+"']").parent().parent().parent().hide()}function VFSPSPrepaidRegisterShow(controls){var NoOfEmpCtrl=controls["VF No Of Employees"].GetInputName();$("input[name='"+NoOfEmpCtrl+"']").parent().parent().parent().hide();$("#Activation_Key_Label").parent().removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");$("#Service_PIN_Label").parent().removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");$("#Service_PIN_Label").parent().attr("style","margin-top:50px;");$("#Register_your_Pack_Label").parent().removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");$("input[name='"+controls["Activation Key"].GetInputName()+"']").parent().removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");$("input[name='"+controls["Service PIN"].GetInputName()+"']").parent().removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");$("#VFSPSLine4").removeClass("VFSPSDisplayNone").addClass("VFSPSDisplayBlock");$("#Service_PIN_Label").parent().parent().parent().show();$("#Activation_Key_Label").parent().parent().parent().show();$("#Register_your_Pack_Label").parent().parent().parent().show();$("input[name='"+controls["Activation Key"].GetInputName()+"']").parent().parent().parent().show();$("input[name='"+controls["Service PIN"].GetInputName()+"']").parent().parent().parent().show();$("input[name='"+controls["Activation Key"].GetInputName()+"']").next().after('<div class="VFSPSScanKeyButton VFSPSScanKeyBtnEnabled" style="display:block !important;">Scan Key</div>');$(".VFSPSChooseFlowActivationInput").parent().removeClass("VFSPSExistingServiceField").addClass("VFSPSExisitingActivationKey");$(".VFSPSChooseFlowActivationInput").attr("style","height: 40px !important;");$("#Activation_Key_Label").addClass("VFSPSExistingServiceSubLabel");$("#Service_PIN_Label").addClass("VFSPSExistingServiceSubLabel");$("#Register_your_Pack_Label").parent().next().next().remove();$("#Activation_Key_Label").parent().next().next().remove();$("#VFSPSValidateActivationKey").addClass("VFSPSExistingActivationSearchImg")}return VFSPSExistingChooseServicePR}());return"SiebelAppFacade.VFSPSExistingChooseServicePR"})};