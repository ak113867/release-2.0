if(typeof(VHACreateActivityPopup)==="undefined"){var VHACreateActivityPopup={};VHACreateActivityPopup.GetCretActMSNContainer=function(){return'<div class="VHACretActMSNContainer VHADisplayNone" >                <div class="VHACretActMSNForm">                    <div class="VHACretActMSNNotesSection">                        <div>                            <div>MSISDN</div><input type="number" value="61" id="MSISDN_Input">                        </div>                    </div>                </div>            </div>'};VHACreateActivityPopup.GetCretActContainer=function(data){return'<div class="VHACretActContainer VHADisplayNone">            <div class="VHACretActForm">                <div class="VHACretActNotesSection">                    <div class="VHACretActSection1">                        <div class="VHACretActSection">                            <span>Activity Category</span>                            <div class="mceGridField mceField">                                <input id="ActivityCategory">                                <span class="siebui-icon-dropdown applet-form-combo applet-list-combo" id="ActivityCategoryDropDown" data-allowdblclick="true"></span>                            </div>                        </div>                        <div class="VHACretActSection">                            <span>Activity Type</span>                            <div class="mceGridField mceField">                                <input id="ActivityType">                                <span class="siebui-icon-dropdown applet-form-combo applet-list-combo" id="ActivityTypeDropDown" data-allowdblclick="true"></span>                            </div>                        </div>                    </div>                    <div class="VHACretActSection2 VHADisplayNone">                        <div class="VHACretActReadSection">                            <div class="VHACretActEditIcon">Edit</div>                            <div class="VHACretActSection">                                <span>Activity Category: </span>                                <span id="ActivityCategoryValue" class="VHACretActReadonly"></span>                            </div>                            <div class="VHACretActSection">                                <span>Activity Type: </span>                                <span id="ActivityTypeValue" class="VHACretActReadonly"></span>                            </div>                        </div>                        <div>                            <span class="VHACretActLabel">Activity Description</span>                            <div class="mceGridField mceField">                                <textarea maxlength="150" class="VHACretActDescription" AssetId='+data.AssetId+" AccountId="+data.AccountId+" MSISDN="+data.MSISDN+'></textarea>                            </div>                            <div class="VHACretActCounter">                                <span id="VHACretActDescriptionCounter">0/150</span>                            </div>                        </div>                        <div>                            <span class="VHACretActLabel">Activity Comments</span>                            <div class="mceGridField mceField">                                <textarea maxlength="1500" class="VHACretActComments" AssetId='+data.AssetId+" AccountId="+data.AccountId+" MSISDN="+data.MSISDN+'></textarea>                            </div>                            <div class="VHACretActCounter">                                <span id="VHACretActCommentsCounter">0/1500</span>                            </div>                        </div>                        <a href="javascript:void(0);" class="VHACretActTempalteLink drilldown" >Select Activity Template</a>                    </div>                    <div>                        <div class="VHACretActSection3 VHADisplayNone">                            <div class="VHACretActTemplateSection">                                <h3>Select Activity Template</h3>                                <ol id="VHACretActTemplateList">                                </ol>                            </div>                        </div>                    </div>                </div>            </div>        </div>'};VHACreateActivityPopup.AppendCreateActivityButton=function(parentElement,data){if($("#CreateActivityButton").length===0){var buttonHtml="<button id='CreateActivityButton' class='VHACretActButton'>Create Activity</button>";$(parentElement).append(buttonHtml)}if($(".VHACretActContainer").length===0){intializeActivityForm(parentElement,data)}else{if($(".VHACretActContainer").hasClass("ui-dialog-content")){if(!$(".VHACretActContainer").dialog("isOpen")){intializeActivityForm(parentElement,data)}}}};function intializeActivityForm(parentElement,data){$(".VHACretActContainer").remove();$("body").append(VHACreateActivityPopup.GetCretActContainer(data));$(parentElement).on("click","#CreateActivityButton",{ctx:{MSISDN:data.MSISDN}},VHACreateActivityPopup.DisplayActivityForm);$(".VHACretActEditIcon").click(ToggleSections);$(".VHACretActNotesSection").delegate("textarea","keyup",{},countCharacter);$("#ActivityCategoryDropDown").click(function(e){$("#ActivityCategory").autocomplete("search","")});$("#ActivityTypeDropDown").click(function(e){$("#ActivityType").autocomplete("search","")});$(".VHACretActTempalteLink").click(function(e){getActivityTemplateList(SiebelApp.S_App.GetProfileAttr("VHA Role Name"));$(".VHACretActSection3").toggleClass("VHADisplayNone");$(".VHACretActSection2").toggleClass("VHADisplayNone");$("#VHACretActTemplateList").selectable({selected:updateSelectedTemplate})})}function updateSelectedTemplate(e,ui){$(".VHACretActSection3").toggleClass("VHADisplayNone");$(".VHACretActSection2").toggleClass("VHADisplayNone");var SelectedTemplate=VHAAppUtilities.GetConstants("VHACreateActivity_ActivityTemplate").filter(function(a){return $(ui.selected).html()===a.TemplateName});$(".VHACretActComments").val(SelectedTemplate[0]["Description"])}function countCharacter(e){var maxlength=0;var id="";if($(this).hasClass("VHACretActDescription")){maxlength=$(this).attr("maxlength");id="VHACretActDescriptionCounter"}else{maxlength=$(this).attr("maxlength");id="VHACretActCommentsCounter"}$("#"+id).html($(this).val().length+"/"+maxlength)}function getActivityCategory(){var SearchString="[List Of Values.Type] = 'TODO_TYPE' AND [List Of Values.Active] = 'Y' "+"AND [List Of Values.Parent Id] IS NULL AND ([List Of Values.Order By] < 2000 OR [List Of Values.Order By] IS NULL)";var RawData=VHAAppUtilities.GetPickListValues("",SearchString,{All:true});VHAAppUtilities.SetConstants("VHACreateActivity_ActivityCategory",RawData);return RawData.map(function(a){return a["Value"]})}function getActivityType(ActivityCategory){var ParentCategory=VHAAppUtilities.GetConstants("VHACreateActivity_ActivityCategory").filter(function(a){return a.Value===ActivityCategory});var SearchString="[List Of Values.Type] = 'TODO_TYPE' AND [List Of Values.Active] = 'Y' "+"AND [List Of Values.Parent Id] = '"+ParentCategory[0]["Id"]+"'";return VHAAppUtilities.GetPickListValues("",SearchString)}VHACreateActivityPopup.CreateActivity=function(data){var Inputs=SiebelApp.S_App.NewPropertySet();Inputs.SetProperty("Account Object Id",data.AccountId);Inputs.SetProperty("Asset Object Id",data.AssetId);Inputs.SetProperty("Category",data.Category);Inputs.SetProperty("Type",data.Type);Inputs.SetProperty("Status","Completed");Inputs.SetProperty("Description",data.ActivityDescription);Inputs.SetProperty("Comment",data.ActivityComment);VHAAppUtilities.CallBS("VF Generate Activity Service","GenerateActivity",Inputs,{})};function resetActivityCreateForm(){$(".VHACretActSection3").addClass("VHADisplayNone");$(".VHACretActSection2").addClass("VHADisplayNone");$(".VHACretActSection1").removeClass("VHADisplayNone");$(".VHACretActDescription").val("");$(".VHACretActComments").val("");$("#ActivityCategory").val("");$("#ActivityType").val("")}VHACreateActivityPopup.DisplayActivityForm=function(e){resetActivityCreateForm();var data=e.data.ctx;$(".VHACretActContainer").dialog({resizable:true,title:"Create Activity Notes for "+data.MSISDN,height:"auto",width:400,modal:false,buttons:{Cancel:function(){$(this).dialog("close")},"Create Activity":function(){data={};data["AccountId"]=$(".VHACretActDescription").attr("AccountId");data["AssetId"]=$(".VHACretActDescription").attr("AssetId");data["ActivityDescription"]=$(".VHACretActDescription").val();data["ActivityComment"]=$(".VHACretActComments").val();data["Category"]=$("#ActivityCategory").val();data["Type"]=$("#ActivityType").val();VHACreateActivityPopup.CreateActivity(data);resetActivityCreateForm();$(this).dialog("close")}}});$("#ActivityCategory").autocomplete({source:getActivityCategory(),minLength:0,select:OnActivityCategorySelect})};function OnActivityCategorySelect(e,ui){$("#ActivityCategoryValue").html(ui.item.value);if($("#ActivityType").autocomplete("instance")){$("#ActivityType").autocomplete("destroy").val("")}$("#ActivityType").autocomplete({source:getActivityType(ui.item.value),minLength:0,select:OnActivityTypeSelect})}function getActivityTemplateList(RoleName){if(VHAAppUtilities.GetConstants("VHACreateActivity_ActivityTemplate")){}else{var SearchSpec="[VHA Configuration List.Type]='VHA_ACTIVITY_TEMPLATE' AND "+"[VHA Configuration List.Active Flg]='Y' AND "+"([VHA Configuration List.String 16]='"+RoleName+"' OR "+"[VHA Configuration List.String 16] IS NULL)";var TemplateList=VHAAppUtilities.GetConfigList(SearchSpec);if(TemplateList){var TemplateListX=TemplateList.map(function(e){return{"TemplateName":e["Value"],"Description":e["String 28"]}})}var tempLength=TemplateListX.length;for(var i=0;i<tempLength;i++){$("#VHACretActTemplateList").append('<li class="ui-widget-content">'+TemplateListX[i]["TemplateName"]+"</li>")}VHAAppUtilities.SetConstants("VHACreateActivity_ActivityTemplate",TemplateListX)}}function OnActivityTypeSelect(e,ui){$("#ActivityTypeValue").html(ui.item.value);ToggleSections()}function ToggleSections(){$(".VHACretActSection2").toggleClass("VHADisplayNone");$(".VHACretActSection1").toggleClass("VHADisplayNone")}VHACreateActivityPopup.ShowMSISDNSearchPopup=function(){$(".VHACretActMSNContainer").dialog({resizable:true,title:"Create Activity Notes",height:"auto",width:400,modal:true,buttons:{Cancel:function(){$(this).dialog("close")},"Search MSISDN":function(){var MSISDN=$("#MSISDN_Input").val();var data={MSISDN:MSISDN};DisplayActivityForm(data);$(this).dialog("close")}}})}};