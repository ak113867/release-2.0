if(typeof(SiebelAppFacade.VFUNISIMCaptureIDCreditCardDetailsAppletPR)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.VFUNISIMCaptureIDCreditCardDetailsAppletPR");define("siebel/custom/VFUNISIMCaptureIDCreditCardDetailsAppletPR",["siebel/phyrenderer"],function(){SiebelAppFacade.VFUNISIMCaptureIDCreditCardDetailsAppletPR=(function(){function VFUNISIMCaptureIDCreditCardDetailsAppletPR(pm){SiebelAppFacade.VFUNISIMCaptureIDCreditCardDetailsAppletPR.superclass.constructor.apply(this,arguments)}SiebelJS.Extend(VFUNISIMCaptureIDCreditCardDetailsAppletPR,SiebelAppFacade.PhysicalRenderer);VFUNISIMCaptureIDCreditCardDetailsAppletPR.prototype.Init=function(){SiebelAppFacade.VFUNISIMCaptureIDCreditCardDetailsAppletPR.superclass.Init.apply(this,arguments)};VFUNISIMCaptureIDCreditCardDetailsAppletPR.prototype.ShowUI=function(){SiebelAppFacade.VFUNISIMCaptureIDCreditCardDetailsAppletPR.superclass.ShowUI.apply(this,arguments);var pm=this.GetPM();var Controls=pm.Get("GetControls");var CCButton=Controls["VFCaptureCC"];var RefreshBusson=Controls["VFRefresh"];$("#"+RefreshBusson.GetInputName()+"_Ctrl").addClass("VFDisplayNone");$("#"+CCButton.GetInputName()+"_Ctrl").after("<button class='VFPPOUICaptureCreditCard appletButton'>Capture Credit Card</button>").addClass("VFDisplayNone")};VFUNISIMCaptureIDCreditCardDetailsAppletPR.prototype.BindEvents=function(){SiebelAppFacade.VFUNISIMCaptureIDCreditCardDetailsAppletPR.superclass.BindEvents.apply(this,arguments);var pm=this.GetPM();$("#s_"+pm.Get("GetFullId")+"_div").delegate(".VFPPOUIPayCorpSubmit","click",{ctx:this},VFPPOUIPayCorpSubmit);$("#s_"+pm.Get("GetFullId")+"_div").delegate(".VFPPOUIPayCorpCancle","click",{ctx:this},VFPPOUIPayCorpCancle);$("#s_"+pm.Get("GetFullId")+"_div").delegate(".VFPPOUICaptureCreditCard","click",{ctx:this},VFPPOUICaptureCreditCard)};function VFPPOUICaptureCreditCard(e){if($("#VFPPOUIPayCorpIFrame").length){alert("There is a Pay Corp form open");return}var ser=SiebelApp.S_App.GetService("VF BS Process Manager");var Inputs=SiebelApp.S_App.NewPropertySet();Inputs.SetProperty("Service Name","VF UNISIM Prepay Utilities TBUI");Inputs.SetProperty("Method Name","CheckForDVSId");Inputs.SetProperty("ContactId",GetContactId());var out=ser.InvokeMethod("Run Process",Inputs);var result=out.GetChildByType("ResultSet");if(result.GetProperty("CCExists")=="Found"){alert("Only One Credit Card Record can be added.");return}var ser=SiebelApp.S_App.GetService("VF BS Process Manager");var Inputs=SiebelApp.S_App.NewPropertySet();Inputs.SetProperty("Service Name","VF UNISIM Prepay Utilities TBUI");Inputs.SetProperty("Method Name","CheckCCCountforId");Inputs.SetProperty("ContactId",GetContactId());var out=ser.InvokeMethod("Run Process",Inputs);var result=out.GetChildByType("ResultSet");if(result.GetProperty("CCExists")=="Found"){alert("Only One Credit Card Record can be added.");return}var pm=e.data.ctx.GetPM();var BillRowId=GetUniqueIdValue();var ser=SiebelApp.S_App.GetService("Workflow Process Manager");var Inputs=SiebelApp.S_App.NewPropertySet();var AddrDetails=GetAddressDetails();var AddrDetailsId=AddrDetails;if(SiebelApp.S_App.GetActiveView().GetName()=="VF Connection View - Customer Detail"){var sActKey=AddrDetailsId.GetProperty("Activation_Key");var sSegment=AddrDetailsId.GetProperty("Cust_Segment");var sEmail=AddrDetailsId.GetProperty("Cust_Email");var sCountry=AddrDetailsId.GetProperty("Cust_Country");var sCity=AddrDetailsId.GetProperty("Cust_City");var sPCode=AddrDetailsId.GetProperty("Cust_PostalCode");var sState=AddrDetailsId.GetProperty("Cust_State");var StreetName=AddrDetailsId.GetProperty("Cust_StreetName");var StreetType=AddrDetailsId.GetProperty("Cust_StreetType");var StreetNumber=AddrDetailsId.GetProperty("Cust_StreetNum");var DPID=AddrDetailsId.GetProperty("Cust_DPID")}else{var sActKey=AddrDetails.GetProperty("ActivationKey");var sSegment=AddrDetails.GetProperty("CustomerSegment");var sEmail=AddrDetails.GetProperty("CustomerEmail");var sCountry=AddrDetails.GetProperty("CustomerCountry");var sCity=AddrDetails.GetProperty("CustomerCity");var sPCode=AddrDetails.GetProperty("PostalCode");var sState=AddrDetails.GetProperty("CustomerState");var StreetName=AddrDetails.GetProperty("StreetName");var StreetType=AddrDetails.GetProperty("StreetType");var StreetNumber=AddrDetails.GetProperty("StreetNumber");var DPID=AddrDetails.GetProperty("DPID")}Inputs.SetProperty("Activation_Key",sActKey);Inputs.SetProperty("Cust_Segment",sSegment);Inputs.SetProperty("Cust_Email",sEmail);Inputs.SetProperty("Cust_Country",sCountry);Inputs.SetProperty("Cust_City",sCity);Inputs.SetProperty("Cust_State",sState);Inputs.SetProperty("Cust_PostalCode",sPCode);Inputs.SetProperty("Cust_StreetName",StreetName);Inputs.SetProperty("Cust_StreetNum",StreetNumber);Inputs.SetProperty("Cust_StreetType",StreetType);Inputs.SetProperty("Cust_DPID",DPID);Inputs.SetProperty("ProcessName","VF PCI INIT Workflow");Inputs.SetProperty("ClientRef","MSISDN:0"+sActKey.substr(2,sActKey.length));Inputs.SetProperty("CompName",GetCompName());Inputs.SetProperty("Identifier",BillRowId);console.log("ROw Id :"+BillRowId);try{var out=ser.InvokeMethod("RunProcess",Inputs);var ResultSet=out.GetChildByType("ResultSet");if(ResultSet.GetProperty("Error Message")=="CUST_ERROR_1"){var PayCorpURL=ResultSet.GetProperty("Old Paycorp URL")}else{var PayCorpURL=ResultSet.GetProperty("Paycorp URL")}var ActiveApplet=pm.Get("GetName");var CreditCardApplet=SiebelApp.S_App.GetActiveView().GetApplet(ActiveApplet);var CCApm=CreditCardApplet.GetPModel();var CCAppId=CCApm.Get("GetFullId");$("#s_"+CCAppId+"_div .AppletHIFormBorder table").hide();$("#s_"+CCAppId+"_div td.AppletHIFormBorder").append("<div class='VFPPOUIPayCorpIFramePar'><div id='VFPPOUIPayCorpIFrame' style='height:430px;'><iframe id='VFPPOUIPayCorpIFrameID' src='"+PayCorpURL+"' class='VFPayCorpiFrameheight'></iframe></div><div class='VFPPOUIPayCorpSubmit appletButton'>Submit</div><div class='VFPPOUIPayCorpCancle appletButton'>Cancel</div></div>")}catch(e){alert(e.message)}finally{}}function GetUniqueIdValue(){if(SiebelApp.S_App.GetActiveView().GetName()=="VF Connection View - Customer Detail"){var bo=SiebelApp.S_App.GetActiveBusObj();var bc=bo.GetBusCompByName("Contact");return bc.GetIdValue()}else{var app=SiebelApp.S_App.GetActiveView().GetApplet("VF Task Session Form Applet UniSIM TBUI");var pm=app.GetPModel();var Data=pm.Get("GetRecordSet");return Data[0]["Session Id"]}}function GetAddressDetails(){if(SiebelApp.S_App.GetActiveView().GetName()=="VF Connection View - Customer Detail"){var ser=SiebelApp.S_App.GetService("VF BS Process Manager");var Inputs=SiebelApp.S_App.NewPropertySet();Inputs.SetProperty("Service Name","VF UNISIM Get PCI Data for Core BS");Inputs.SetProperty("Method Name","VFCaptureCC");var out=ser.InvokeMethod("Run Process",Inputs);return out.GetChildByType("ResultSet")}else{var BO=SiebelApp.S_App.GetActiveBusObj();var BC=BO.GetBusCompByName("Order Entry - Orders");var OrderId=BC.GetIdValue();var ser=SiebelApp.S_App.GetService("VF BS Process Manager");var Inputs=SiebelApp.S_App.NewPropertySet();Inputs.SetProperty("Service Name","VF UNISIM Prepay Utilities TBUI");Inputs.SetProperty("Method Name","GetCCMetadata");Inputs.SetProperty("OrderId",OrderId);var out=ser.InvokeMethod("Run Process",Inputs);return out.GetChildByType("ResultSet")}}function GetContactId(){var BO=SiebelApp.S_App.GetActiveBusObj();var BC=BO.GetBusCompByName("Contact");var ContactId=BC.GetIdValue();return ContactId}function GetCompName(){var ActiveView=SiebelApp.S_App.GetActiveView().GetName();CompName="";switch(ActiveView){case ("VF Connection View - Billing Detail"):case ("VF Connection Wizard View - Billing Detail - TBUI"):case ("VF Billing Details View - TBUI"):case ("VF Billing Account Profile View - Extended"):case ("VF Billing Account Profile View"):CompName="VFBillProfUpdate";break;case ("VF My Requested Service Request List View"):case ("VF My Service Request List View"):case ("VF Detail Service Request List View"):case ("VF Admin Service Request List View"):case ("VF Personal Service Request List View"):case ("VF All Service Request List View"):CompName="VFSRUpdate";break;case ("VF Credit Card View - AU"):CompName="VFCreditCardReg";break;case ("VF Connection View - Customer Detail"):case ("VF UNISIM Capture Identification TBUI View"):CompName="VFUNISIMCC";break;default:alert("View Name Not Found.")}return CompName}VFUNISIMCaptureIDCreditCardDetailsAppletPR.prototype.BindData=function(bRefresh){SiebelAppFacade.VFUNISIMCaptureIDCreditCardDetailsAppletPR.superclass.BindData.apply(this,arguments)};function VFPPOUIPayCorpSubmit(e){var paymentFrame=document.getElementById("VFPPOUIPayCorpIFrameID").contentWindow;paymentFrame.postMessage(JSON.stringify({type:"SUBMIT"}),"*")}function VFPPOUIPayCorpCancle(e){var pm=e.data.ctx.GetPM();var CCAppId=pm.Get("GetFullId");$("#s_"+CCAppId+"_div .AppletHIFormBorder table").show();$(".VFPPOUIPayCorpIFramePar").remove()}VFUNISIMCaptureIDCreditCardDetailsAppletPR.prototype.EndLife=function(){SiebelAppFacade.VFUNISIMCaptureIDCreditCardDetailsAppletPR.superclass.EndLife.apply(this,arguments)};return VFUNISIMCaptureIDCreditCardDetailsAppletPR}());return"SiebelAppFacade.VFUNISIMCaptureIDCreditCardDetailsAppletPR"})};