if(typeof(SiebelAppFacade.VFSPSBusinessGrowSelectCustomizeAppletPR)==="undefined"){SiebelJS.Namespace("SiebelAppFacade.VFSPSBusinessGrowSelectCustomizeAppletPR");define("siebel/custom/VFSPSBusinessGrowSelectCustomizeAppletPR",["siebel/jqgridrenderer"],function(){SiebelAppFacade.VFSPSBusinessGrowSelectCustomizeAppletPR=(function(){function VFSPSBusinessGrowSelectCustomizeAppletPR(pm){SiebelAppFacade.VFSPSBusinessGrowSelectCustomizeAppletPR.superclass.constructor.apply(this,arguments)}SiebelJS.Extend(VFSPSBusinessGrowSelectCustomizeAppletPR,SiebelAppFacade.JQGridRenderer);VFSPSBusinessGrowSelectCustomizeAppletPR.prototype.Init=function(){SiebelAppFacade.VFSPSBusinessGrowSelectCustomizeAppletPR.superclass.Init.apply(this,arguments);this.gPropList=new Array();this.Data={"gPropList":this.gPropList};this.SetData=function(Category,data){this.Data[Category]=data};this.GetData=function(Category){return this.Data[Category]};SiebelApp.EventManager.cleanListners("EnableSaveButton");SiebelApp.EventManager.addListner("EnableSaveButton",VFSPSCheckEnableEnableSaveButton,this)};VFSPSBusinessGrowSelectCustomizeAppletPR.prototype.ShowUI=function(){SiebelAppFacade.VFSPSBusinessGrowSelectCustomizeAppletPR.superclass.ShowUI.apply(this,arguments)};VFSPSBusinessGrowSelectCustomizeAppletPR.prototype.BindEvents=function(){SiebelAppFacade.VFSPSBusinessGrowSelectCustomizeAppletPR.superclass.BindEvents.apply(this,arguments);$(".VFSPSBusGrowSelCusParentDiv").delegate(".VFSPSBusGrowSelCusChoosePlanImg","click",{ctx:this},VFSPSQueryPlanList);$(".VFSPSBusGrowSelCusNavigation").delegate(".VFSPSBusGrowSelCusTaskNavCreateOrderBtn.VFSPSTaskNavActive","click",{ctx:this},VFSPSCreateOrder);$(".VFSPSBusGrowSelCusNavigation").delegate(".VFSPSBusGrowSelCusTaskNavCancelOrderBtn","click",{ctx:this},VFSPSCancleOrder)};VFSPSBusinessGrowSelectCustomizeAppletPR.prototype.EndLife=function(){SiebelAppFacade.VFSPSBusinessGrowSelectCustomizeAppletPR.superclass.EndLife.apply(this,arguments)};function VFSPSGetCustomerType(){var BS="VF SPS TBUI Utilities";var Method="GetCustomerType";var inps=SiebelApp.S_App.NewPropertySet();inps.SetProperty("OrderId",VFSPSGetOrderId());var outs=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});var CustomerType=outs.GetProperty("CustomerType");var SoleTrader=outs.GetProperty("CustomerSOHOType");var retVal="Business";if(SoleTrader=="N"&&CustomerType=="Person"){retVal="Consumer"}return retVal}function VFSPSQueryPlanList(e){var BS="VF SPS TBUI Utilities";var Method="GetBizGList";var inps=SiebelApp.S_App.NewPropertySet();inps.SetProperty("CustType",VFSPSGetCustomerType());VFSPSUdateUIFrameWork.VFSPSBlockUI("");setTimeout(function(){var outs=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});var NumCount=outs.GetChildCount();if(NumCount){var planList={};var LOVList=new Array();for(var i=0;i<NumCount;i++){var Plan={};var CurrChild=outs.GetChild(i);Plan.PropositionName=CurrChild.GetProperty("PropName");Plan.PropositionId=CurrChild.GetProperty("PropId");planList[Plan.PropositionName]=Plan;LOVList[LOVList.length]=CurrChild.GetProperty("PropName")}e.data.ctx.SetData("gPropList",planList);var selector=".VFSPSBusGrowSelCusChoosePlanValue";VFSPSUdateUIFrameWork.VFSPSShowPicklistValues(selector,"",LOVList,"","","HTML","EnableSaveButton");VFSPSUdateUIFrameWork.VFSPSUnblockUI()}else{}VFSPSUdateUIFrameWork.VFSPSUnblockUI()},1000)}function VFSPSCheckEnableEnableSaveButton(){var PropName=$(".VFSPSBusGrowSelCusChoosePlanValue").val();if(PropName==""){}else{$(".VFSPSBusGrowSelCusTaskNavCreateOrderBtn").removeClass("VFSPSTaskNavInActive").addClass("VFSPSTaskNavActive")}}function VFSPSGetOrderMetaData(){var BS="VF SPS TBUI Utilities";var Method="GetOrderDetails";var inps=SiebelApp.S_App.NewPropertySet();var OrderId=VFSPSGetOrderId();inps.SetProperty("OrderId",OrderId);var outs=VFCustomSiebelInterface.CallBS(BS,Method,inps,{});var data={};if(outs.GetProperty("RecordFound")=="Yes"){data.OrderAcctId=outs.GetProperty("OrderAcctId");data.BillingAcctId=outs.GetProperty("BillingAcctId");data.OrderId=OrderId}return data}function VFSPSCreateOrder(e){var PropName=$(".VFSPSBusGrowSelCusChoosePlanValue").val();var PropList=e.data.ctx.GetData("gPropList");var PropDetail=PropList[PropName];var WF="VF SPS Save Plan Workflow";var inps=SiebelApp.S_App.NewPropertySet();var Order_Data=VFSPSGetOrderMetaData();inps.SetProperty("BillingAccountId",Order_Data.BillingAcctId);inps.SetProperty("CustomerAccountId",Order_Data.OrderAcctId);inps.SetProperty("OrderId",Order_Data.OrderId);inps.SetProperty("ProductId",PropDetail.PropositionId);inps.SetProperty("ProductName",PropDetail.PropositionName);inps.SetProperty("Object Id",VFSPSGetOrderId());inps.SetProperty("Proposition Id",PropDetail.PropositionId);inps.SetProperty("OrdType","Account Level Proposition");inps.SetProperty("Connection Type","Account Level Proposition");VFSPSUdateUIFrameWork.VFSPSBlockUI("");setTimeout(function(){var outs=VFCustomSiebelInterface.CallWorkflow(WF,inps,{});VFSPSUdateUIFrameWork.VFSPSUnblockUI();var RoodOrderLineItemId=outs.GetProperty("Root Order Item Id");var ErrCode=outs.GetProperty("Error Code");var ErrMess=outs.GetProperty("Error Message");if(ErrCode!=""&&ErrMess!=""){alert(ErrMess)}else{var App=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Task Playbar Applet SelectCutomize - Top");if(App.CanInvokeMethod("NavigatePrev")){App.InvokeMethod("NavigatePrev")}}},1000)}function VFSPSGetOrderId(){var BO=SiebelApp.S_App.GetActiveBusObj();var OrderBC=BO.GetBusCompByName("Order Entry - Orders");return OrderBC.GetIdValue()}function VFSPSCancleOrder(e){var App=SiebelApp.S_App.GetActiveView().GetApplet("VF SPS Task Playbar Applet SelectCutomize - Top");if(App.CanInvokeMethod("CancelTask")){App.InvokeMethod("CancelTask")}}return VFSPSBusinessGrowSelectCustomizeAppletPR}());return"SiebelAppFacade.VFSPSBusinessGrowSelectCustomizeAppletPR"})};